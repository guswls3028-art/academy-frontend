SUBMISSIONS DOMAIN
FRONTEND COMPLETE CONTRACT SPEC (100%)

ê¸°ì¤€: apps/domains/submissions ì „ì²´ ì½”ë“œ
ìƒíƒœ: LOCKED / FINAL
ëª©ì : í”„ë¡ íŠ¸ ë¬´ì§ˆë¬¸ êµ¬í˜„ + ë°±ì—”ë“œ ê³„ì•½ ê³ ì •

0. ë„ë©”ì¸ ì¡´ì¬ ì´ìœ  (í•µì‹¬ ì •ì˜)
submissionsëŠ” ë¬´ì—‡ì¸ê°€?

â€œì œì¶œ í–‰ìœ„ + ì›ë³¸ ë°ì´í„° + ì¤‘ê°„ì‚°ë¬¼(answer)â€ì„ ê´€ë¦¬í•˜ëŠ” ì´ë²¤íŠ¸ ë„ë©”ì¸

ì ìˆ˜ âŒ

ì •ë‹µ íŒì • âŒ

í•©ë¶ˆ âŒ

ì§„í–‰ë¥  âŒ

ğŸ‘‰ ì œì¶œ ì‚¬ì‹¤ + ì›ë³¸ + ì¶”ì¶œëœ ë‹µì•ˆê¹Œì§€ë§Œ ì±…ì„
ğŸ‘‰ ì´í›„ íŒë‹¨ì€ results / homework_results / progressì˜ ì±…ì„

1. ìµœìƒìœ„ ì„¤ê³„ ì›ì¹™ (ì ˆëŒ€ ìœ„ë°˜ ê¸ˆì§€)

Submissionì€ ì´ë²¤íŠ¸(Event) ë‹¤

SubmissionAnswerëŠ” ì¤‘ê°„ì‚°ë¬¼(Raw Answer) ì´ë‹¤

ì ìˆ˜/ì •ì˜¤/íŒì •ì€ submissions ì±…ì„ ì•„ë‹˜

statusëŠ” submissions ë‚´ë¶€ íŒŒì´í”„ë¼ì¸ ì „ìš© ìƒíƒœ

AI ì—°ê³„ëŠ” dispatcher ë‹¨ì¼ ì§„ì…ì 

exam_question_idë§Œ ë¬¸í•­ ë‹¨ì¼ ì§„ì‹¤

question_id / number / legacy ê°œë… âŒ

2. í•µì‹¬ ì—”í‹°í‹°
2.1 Submission (ì œì¶œ ì´ë²¤íŠ¸)
ì˜ë¯¸

â€œí•™ìƒì´ ë¬´ì–¸ê°€ë¥¼ ì œì¶œí–ˆë‹¤â€ëŠ” ì‚¬ì‹¤

ì‹œí—˜ / ê³¼ì œ ê³µí†µ

íŒŒì¼ ì œì¶œ / ì˜¨ë¼ì¸ ì…ë ¥ / AI ê²°ê³¼ ì—°ê³„ í¬í•¨

Submission
- id
- user_id
- enrollment_id
- target_type (exam | homework)
- target_id
- source
- file_key
- payload
- status
- meta

target_type
ê°’	ì˜ë¯¸
exam	ì‹œí—˜ ì œì¶œ
homework	ê³¼ì œ ì œì¶œ
source (ì œì¶œ ë°©ì‹ ë‹¨ì¼ ì§„ì‹¤)
ê°’	ì˜ë¯¸
omr_scan	ì‹œí—˜ OMR ìŠ¤ìº”
omr_manual	ì‹œí—˜ OMR ìˆ˜ê¸°
online	ì˜¨ë¼ì¸ ë‹µì•ˆ
homework_image	ì´ë¯¸ì§€ ìˆ™ì œ
homework_video	ì˜ìƒ ìˆ™ì œ
ai_match	AI ì´ë¯¸ì§€ ë§¤ì¹­

ğŸ‘‰ source ê¸°ì¤€ìœ¼ë¡œ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ ì™„ì „íˆ ë¶„ê¸°

status (ì¤‘ìš”: ë‚´ë¶€ íŒŒì´í”„ë¼ì¸ ìƒíƒœ)
status	ì˜ë¯¸
submitted	ìƒì„± ì§í›„
dispatched	AI ì‘ì—… íì— ë“±ë¡
extracting	(ì˜ˆì•½)
answers_ready	ë‹µì•ˆ ì €ì¥ ì™„ë£Œ
grading	results ì±„ì  ì¤‘
done	ì²˜ë¦¬ ì™„ë£Œ
failed	ì‹¤íŒ¨

â— í”„ë¡ íŠ¸ëŠ” statusë¡œ UX ë¶„ê¸°ë§Œ ê°€ëŠ¥
â— status ì§ì ‘ ì œì–´ âŒ

2.2 SubmissionAnswer (ë¬¸í•­ ë‹¨ìœ„ Raw Answer)
ì˜ë¯¸

ì±„ì  ì „ â€œë‹µì•ˆ ì›ë³¸â€

AI / ì˜¨ë¼ì¸ ì…ë ¥ / ìˆ˜ê¸° ìˆ˜ì • ê²°ê³¼

SubmissionAnswer
- submission_id
- exam_question_id   â† ìœ ì¼í•œ ë¬¸í•­ ê¸°ì¤€
- answer
- meta

í•µì‹¬ ê³„ì•½ (FINAL)

âœ… exam_question_id = exams.ExamQuestion.id

âŒ question_id âŒ

âŒ question_number âŒ

âŒ legacy mapping âŒ

ìœ ë‹ˆí¬ ì œì•½:

(submission_id, exam_question_id)

3. íŒŒì¼ ì²˜ë¦¬ ì›ì¹™ (R2 ê¸°ì¤€)

íŒŒì¼ì€ DBì— ì €ì¥ë˜ì§€ ì•ŠìŒ

R2(Object Storage)ì—ë§Œ ì¡´ì¬

Submissionì—ëŠ” ë©”íƒ€ë§Œ ì €ì¥

file_key
file_type
file_size


ğŸ‘‰ ë‹¤ìš´ë¡œë“œëŠ” presigned URL ë¡œë§Œ

4. Submission ìƒì„± ê³„ì•½
4.1 ê³µí†µ ìƒì„± (REST)

POST /submissions/

{
  "enrollment_id": 123,
  "target_type": "exam",
  "target_id": 45,
  "source": "online",
  "file": null,
  "payload": {...}
}

validation ê·œì¹™ (ì„œë²„ ë‹¨ì¼ ì§„ì‹¤)

exam/homework â†’ enrollment_id í•„ìˆ˜

OMR_SCAN / HOMEWORK_IMAGE / VIDEO â†’ file í•„ìˆ˜

ONLINE â†’ payload í•„ìˆ˜

4.2 ì‹œí—˜ OMR ì „ìš© API (STEP 2)

POST /submissions/exams/{exam_id}/omr/

{
  "enrollment_id": 123,
  "sheet_id": 45,
  "file_key": "exams/submissions/abc.jpg"
}

íŠ¹ì§•

âŒ status ì§ì ‘ ì§€ì • ë¶ˆê°€

âŒ AIJob ì§ì ‘ ìƒì„± ë¶ˆê°€

âœ” Submission ìƒì„±ë§Œ

âœ” ì´í›„ íë¦„ì€ dispatcher ë‹¨ì¼ ì§„ì‹¤

5. Dispatcher (ë‹¨ì¼ ì§„ì…ì )
dispatch_submission(submission)

Submission ìƒì„± í›„ ë°˜ë“œì‹œ í˜¸ì¶œë˜ëŠ” ìœ ì¼í•œ ì§„ì…ì 

5.1 ONLINE ì œì¶œ
SubmissionService.process()
â†’ answers ì €ì¥
â†’ status = ANSWERS_READY
â†’ grade_submission_task enqueue

5.2 FILE ì œì¶œ (OMR / IMAGE / VIDEO)

status = DISPATCHED

AIJob ìƒì„±

Redis Queue(ai:jobs) push

AI Worker ì²˜ë¦¬ ëŒ€ê¸°

6. AI ê²°ê³¼ ì²˜ë¦¬ (ë‹¨ì¼ ì§„ì‹¤)
apply_ai_result_for_submission()

AI Worker â†’ API ì½œë°± ì‹œ ë¬´ì¡°ê±´ ì´ í•¨ìˆ˜ë§Œ ì‚¬ìš©

6.1 ì‹œí—˜ OMR (omr_scan)

SubmissionAnswer ìƒì„±/ê°±ì‹ 

submission.status = ANSWERS_READY

should_grade = True

ì´í›„ results ì±„ì  íŒŒì´í”„ë¼ì¸ ì§„ì…

6.2 ì˜ìƒ ìˆ™ì œ (homework_video)

filled_ratio / too_short ê¸°ë°˜ íŒë³„

meta.homework_video_result ê³ ì •

status = DONE

ì±„ì  âŒ

has_content =
  not too_short AND filled_ratio >= 0.10

6.3 ì´ë¯¸ì§€ ìˆ™ì œ (homework_image)

OCR ê²°ê³¼ meta ì €ì¥

status = DONE

ì±„ì  âŒ

7. ì±„ì  ì—°ê³„ ê·œì¹™ (ì¤‘ìš”)

ì±„ì ì€ results ë„ë©”ì¸ ì±…ì„

submissionsëŠ” grade_submission_taskë¥¼ enqueueë§Œ í•œë‹¤

ANSWERS_READY â†’ grade_submission_task â†’ results

8. ìˆ˜ë™ ìˆ˜ì • + ì¬ì±„ì  API

POST /submissions/{id}/manual-edit/

ë™ì‘

SubmissionAnswer ìˆ˜ì •

metaì— manual_edits ê¸°ë¡

manual_review.required = false

status = ANSWERS_READY

grade_submission_task ì¬ì‹¤í–‰

ğŸ‘‰ ê²°ê³¼ëŠ” í•­ìƒ results ë‹¨ì¼ ì§„ì‹¤

9. Retry API

POST /submissions/{id}/retry/

FAILED ìƒíƒœë§Œ ê°€ëŠ¥

status = SUBMITTED ë¡œ ë˜ëŒë¦¼

dispatcher ì¬ì‹¤í–‰

10. í”„ë¡ íŠ¸ ì ˆëŒ€ ê¸ˆì§€ ëª©ë¡

âŒ status ì„ì˜ ë³€ê²½
âŒ ë‹µì•ˆ ê¸°ë°˜ ì ìˆ˜ ê³„ì‚°
âŒ exam_question_id ë³€í™˜
âŒ AI ê²°ê³¼ í•´ì„
âŒ ì±„ì  ì—¬ë¶€ íŒë‹¨
âŒ submission.meta êµ¬ì¡° ê°€ì •

11. ë‹¤ë¥¸ ë„ë©”ì¸ê³¼ì˜ ê´€ê³„ ìš”ì•½
ë„ë©”ì¸	ì—­í• 
submissions	ì œì¶œ ì´ë²¤íŠ¸ + ì›ë³¸ + ë‹µì•ˆ
results	ì‹œí—˜ ì±„ì  / ì ìˆ˜
homework_results	ê³¼ì œ ì ìˆ˜
progress	ì§‘ê³„ / í†µê³¼ / ìœ„í—˜

ğŸ‘‰ submissionsëŠ” í•­ìƒ ì¶œë°œì ì¼ ë¿, íŒë‹¨ìëŠ” ì•„ë‹ˆë‹¤

12. ìµœì¢… ìš”ì•½ (í•œ ì¤„)

submissionsëŠ” â€œì œì¶œ ì‚¬ì‹¤ê³¼ ë‹µì•ˆ ì¤‘ê°„ì‚°ë¬¼â€ë§Œ ì±…ì„ì§„ë‹¤.
ì ìˆ˜Â·íŒì •Â·ì§„í–‰ì€ ì ˆëŒ€ ì´ ë„ë©”ì¸ì˜ ì¼ì´ ì•„ë‹ˆë‹¤.