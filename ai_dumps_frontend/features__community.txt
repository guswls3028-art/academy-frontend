====================================================================================================
# FRONTEND FOLDER: features__community
# ROOT PATH: C:\academyfront\src\features\community
====================================================================================================


==========================================================================================
# FILE: community_code.html
==========================================================================================
<!doctype html>
<html lang="ko">
<meta charset="utf-8">
<title>community</title>
<style>
body{background:#0f1115;color:#eaeaea;font-family:Consolas,monospace;padding:24px}
h2{color:#7dd3fc;font-size:14px}
pre{background:#111418;padding:16px;border-radius:8px;overflow-x:auto;font-size:13px}
section{margin-bottom:28px}
</style>
<h1>ğŸ“¦ community</h1>

<section>
<h2>components\BoardTabs.tsx</h2>
<pre><code>// src/features/community/components/BoardTabs.tsx
import { NavLink } from &quot;react-router-dom&quot;;

export default function BoardTabs() {
  const base = &quot;/community&quot;;

  const tabClass = ({ isActive }: any) =&gt;
    `px-3 py-2 text-sm font-medium border-b-2 ${
      isActive 
        ? &quot;border-blue-600 text-blue-600&quot;
        : &quot;border-transparent text-gray-600 hover:text-gray-800&quot;
    }`;

  return (
    &lt;div className=&quot;flex gap-6 border-b mb-6&quot;&gt;
      &lt;NavLink to={`${base}/notice`} className={tabClass}&gt;ê³µì§€ì‚¬í•­&lt;/NavLink&gt;
      &lt;NavLink to={`${base}/qna`} className={tabClass}&gt;ì§ˆì˜ì‘ë‹µ&lt;/NavLink&gt;
      &lt;NavLink to={`${base}/review`} className={tabClass}&gt;ìˆ˜ê°•í›„ê¸°&lt;/NavLink&gt;
    &lt;/div&gt;
  );
}
</code></pre>
</section>

<section>
<h2>pages\CommunityPage.tsx</h2>
<pre><code>// src/features/community/pages/CommunityPage.tsx
import PageContainer from &quot;@student/shared/components/Page&quot;;
import PageHeader from &quot;@/shared/ui/dsHeader&quot;;
import BoardTabs from &quot;../components/BoardTabs&quot;;
import { Outlet } from &quot;react-router-dom&quot;;

export default function CommunityPage() {
  return (
    &lt;PageContainer&gt;
      &lt;PageHeader title=&quot;ì»¤ë®¤ë‹ˆí‹°&quot; /&gt;

      &lt;BoardTabs /&gt;

      &lt;Outlet /&gt;
    &lt;/PageContainer&gt;
  );
}
</code></pre>
</section>

<section>
<h2>pages\NoticeBoardPage.tsx</h2>
<pre><code>export default function NoticeBoardPage() {
  return (
    &lt;div&gt;

      &lt;p className=&quot;text-gray-500&quot;&gt;ì•„ì§ ë“±ë¡ëœ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.&lt;/p&gt;
    &lt;/div&gt;
  );
}
</code></pre>
</section>

<section>
<h2>pages\QnaBoardPage.tsx</h2>
<pre><code>import BoardTabs from &quot;../components/BoardTabs&quot;;

export default function QnaBoardPage() {
  return (
    &lt;div className=&quot;p-6&quot;&gt;

      {/* ê²€ìƒ‰ &amp; í•„í„° */}
      &lt;div className=&quot;flex items-center gap-2 mb-4&quot;&gt;
        &lt;select className=&quot;border rounded px-2 py-1 text-sm&quot;&gt;
          &lt;option&gt;ì „ì²´&lt;/option&gt;
          &lt;option&gt;ë‹µë³€ í•„ìš”&lt;/option&gt;
        &lt;/select&gt;

        &lt;input
          className=&quot;border rounded px-2 py-1 text-sm flex-1&quot;
          placeholder=&quot;ê²€ìƒ‰&quot;
        /&gt;

        &lt;button className=&quot;px-3 py-1.5 bg-blue-600 text-white rounded text-sm&quot;&gt;
          ê²€ìƒ‰
        &lt;/button&gt;
      &lt;/div&gt;

      {/* ë¦¬ìŠ¤íŠ¸ */}
      &lt;div className=&quot;border rounded p-4 text-sm text-gray-700 mb-3&quot;&gt;
        &lt;div className=&quot;font-semibold&quot;&gt;ì˜ˆì‹œ QnA ì œëª©&lt;/div&gt;
        &lt;div className=&quot;text-gray-500 text-xs&quot;&gt;ì‘ì„±ì Â· ë‚ ì§œ&lt;/div&gt;
      &lt;/div&gt;

      &lt;div className=&quot;text-center mt-6 text-gray-400 text-sm&quot;&gt;1&lt;/div&gt;
    &lt;/div&gt;
  );
}
</code></pre>
</section>

<section>
<h2>pages\ReviewBoardPage.tsx</h2>
<pre><code>import BoardTabs from &quot;../components/BoardTabs&quot;;

export default function ReviewBoardPage() {
  return (
    &lt;div className=&quot;p-6&quot;&gt;

      &lt;div className=&quot;mt-6 text-gray-500 text-sm&quot;&gt;
        ì•„ì§ ë“±ë¡ëœ í›„ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.
      &lt;/div&gt;
    &lt;/div&gt;
  );
}
</code></pre>
</section>

</html>


==========================================================================================
# FILE: api/community.api.ts
==========================================================================================
// PATH: src/features/community/api/community.api.ts
// ì»¤ë®¤ë‹ˆí‹° í†µí•© ì½˜ì†”ìš© API â€” ê³µì§€(ê²Œì‹œíŒ) Â· ì§ˆì˜ì‘ë‹µ Â· ìë£Œì‹¤
// scope: í†µí•©(ì „ì²´í•™ìƒ) | ê°•ì˜ë³„ | ì„¸ì…˜ë³„

import api from "@/shared/api/axios";

const PREFIX = "/interactions";

export type CommunityScope = "all" | "lecture" | "session";

export interface CommunityScopeParams {
  scope: CommunityScope;
  lectureId?: number | null;
  sessionId?: number | null;
}

// ----------------------------------------
// ê³µì§€/ê²Œì‹œíŒ (Board)
// ----------------------------------------
export interface BoardCategory {
  id: number;
  lecture: number;
  name: string;
  order: number;
}

export interface BoardPost {
  id: number;
  lecture: number;
  category: number;
  title: string;
  content: string;
  created_by: number | null;
  created_at: string;
  attachments: { id: number; post: number; file: string }[];
  lecture_title?: string;
  category_name?: string;
}

function unwrap<T>(data: unknown): T[] {
  if (Array.isArray(data)) return data;
  if (data && typeof data === "object" && "results" in data && Array.isArray((data as { results: T[] }).results))
    return (data as { results: T[] }).results;
  return [];
}

/** ê³µì§€(ê²Œì‹œíŒ) ëª©ë¡ â€” lecture ë¯¸ì§€ì • ì‹œ ì „ì²´(í†µí•©) */
export async function fetchCommunityBoardPosts(params: {
  lectureId?: number | null;
  categoryId?: number | null;
}): Promise<BoardPost[]> {
  const res = await api.get(`${PREFIX}/board-posts/`, {
    params: params.lectureId ? { lecture: params.lectureId, ...(params.categoryId && { category: params.categoryId }) } : undefined,
  });
  return unwrap<BoardPost>(res.data);
}

export async function fetchCommunityBoardCategories(lectureId: number): Promise<BoardCategory[]> {
  const res = await api.get(`${PREFIX}/board-categories/`, {
    params: { lecture: lectureId },
  });
  return unwrap<BoardCategory>(res.data);
}

export async function createCommunityBoardPost(formData: FormData): Promise<BoardPost> {
  const res = await api.post(`${PREFIX}/board-posts/`, formData, {
    headers: { "Content-Type": "multipart/form-data" },
  });
  return res.data;
}

// ----------------------------------------
// ì§ˆì˜ì‘ë‹µ (Questions)
// ----------------------------------------
export interface Question {
  id: number;
  enrollment: number;
  title: string;
  content: string;
  created_at: string;
  is_answered: boolean;
  student_name?: string;
  lecture_id?: number;
  lecture_title?: string;
}

export interface Answer {
  id: number;
  question: number;
  content: string;
  created_at: string;
}

/** ì§ˆì˜ ëª©ë¡ â€” ì „ì²´ ì¡°íšŒ í›„ lectureId ìˆìœ¼ë©´ í•´ë‹¹ ê°•ì˜ ìˆ˜ê°•ìƒ ì§ˆë¬¸ë§Œ í•„í„° (ë°±ì—”ë“œì— lecture í•„í„° ì—†ìŒ) */
export async function fetchCommunityQuestions(_params?: {
  lectureId?: number | null;
  enrollmentIds?: number[];
}): Promise<Question[]> {
  const res = await api.get(`${PREFIX}/questions/`);
  return unwrap<Question>(res.data);
}

export async function fetchQuestionAnswer(questionId: number): Promise<Answer | null> {
  const res = await api.get(`${PREFIX}/answers/`, { params: { question: questionId } });
  const list = unwrap<Answer>(res.data);
  return list[0] ?? null;
}

export async function createAnswer(questionId: number, content: string): Promise<Answer> {
  const res = await api.post(`${PREFIX}/answers/`, { question: questionId, content });
  return res.data;
}

// ----------------------------------------
// ìë£Œì‹¤ (Materials)
// ----------------------------------------
export interface Material {
  id: number;
  lecture: number;
  category: number | null;
  title: string;
  description: string;
  file: string | null;
  url: string | null;
  order: number;
  is_public: boolean;
  created_at: string;
  lecture_title?: string;
}

export interface MaterialCategory {
  id: number;
  lecture: number;
  name: string;
  order: number;
}

/** ìë£Œì‹¤ ëª©ë¡ â€” lectureId ë¯¸ì§€ì • ì‹œ ì „ì²´ */
export async function fetchCommunityMaterials(params: {
  lectureId?: number | null;
  categoryId?: number | null;
}): Promise<Material[]> {
  const res = await api.get(`${PREFIX}/materials/`, {
    params: params.lectureId ? { lecture: params.lectureId, ...(params.categoryId && { category: params.categoryId }) } : undefined,
  });
  return unwrap<Material>(res.data);
}

export async function fetchCommunityMaterialCategories(lectureId: number): Promise<MaterialCategory[]> {
  const res = await api.get(`${PREFIX}/material-categories/`, {
    params: { lecture: lectureId },
  });
  return unwrap<MaterialCategory>(res.data);
}


==========================================================================================
# FILE: components/BoardTabs.tsx
==========================================================================================
// src/features/community/components/BoardTabs.tsx
import { NavLink } from "react-router-dom";

export default function BoardTabs() {
  const base = "/community";

  const tabClass = ({ isActive }: any) =>
    `px-3 py-2 text-sm font-medium border-b-2 ${
      isActive 
        ? "border-blue-600 text-blue-600"
        : "border-transparent text-gray-600 hover:text-gray-800"
    }`;

  return (
    <div className="flex gap-6 border-b mb-6">
      <NavLink to={`${base}/notice`} className={tabClass}>ê³µì§€ì‚¬í•­</NavLink>
      <NavLink to={`${base}/qna`} className={tabClass}>ì§ˆì˜ì‘ë‹µ</NavLink>
      <NavLink to={`${base}/review`} className={tabClass}>ìˆ˜ê°•í›„ê¸°</NavLink>
    </div>
  );
}


==========================================================================================
# FILE: context/CommunityScopeContext.tsx
==========================================================================================
// PATH: src/features/community/context/CommunityScopeContext.tsx
// í†µí•© | ê°•ì˜ë³„ | ì„¸ì…˜ë³„ scope + ì„ íƒëœ ê°•ì˜/ì„¸ì…˜

import { createContext, useContext, useMemo, useState, type ReactNode } from "react";
import type { CommunityScope } from "../api/community.api";

export type CommunityScopeContextValue = {
  scope: CommunityScope;
  setScope: (s: CommunityScope) => void;
  lectureId: number | null;
  setLectureId: (id: number | null) => void;
  sessionId: number | null;
  setSessionId: (id: number | null) => void;
  /** í˜„ì¬ scopeì— ë”°ë¥¸ ì‹¤ì œ ì‚¬ìš©í•  lectureId (í†µí•©ì´ë©´ null, ê°•ì˜/ì„¸ì…˜ë³„ì´ë©´ ì„ íƒëœ ê°•ì˜) */
  effectiveLectureId: number | null;
};

const CommunityScopeContext = createContext<CommunityScopeContextValue | null>(null);

export function CommunityScopeProvider({ children }: { children: ReactNode }) {
  const [scope, setScope] = useState<CommunityScope>("all");
  const [lectureId, setLectureId] = useState<number | null>(null);
  const [sessionId, setSessionId] = useState<number | null>(null);

  const effectiveLectureId = useMemo(() => {
    if (scope === "all") return null;
    return lectureId;
  }, [scope, lectureId]);

  const value = useMemo<CommunityScopeContextValue>(
    () => ({
      scope,
      setScope,
      lectureId,
      setLectureId,
      sessionId,
      setSessionId,
      effectiveLectureId,
    }),
    [scope, lectureId, sessionId, effectiveLectureId]
  );

  return (
    <CommunityScopeContext.Provider value={value}>
      {children}
    </CommunityScopeContext.Provider>
  );
}

export function useCommunityScope() {
  const ctx = useContext(CommunityScopeContext);
  if (!ctx) throw new Error("useCommunityScope must be used within CommunityScopeProvider");
  return ctx;
}


==========================================================================================
# FILE: pages/CommunityPage.tsx
==========================================================================================
// PATH: src/features/community/pages/CommunityPage.tsx
// ì»¤ë®¤ë‹ˆí‹° í†µí•© ì½˜ì†” â€” ê³µì§€ Â· ì§ˆì˜ì‘ë‹µ Â· ìë£Œì‹¤ (í†µí•© | ê°•ì˜ë³„ | ì„¸ì…˜ë³„)

import { Outlet } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";
import { DomainLayout } from "@/shared/ui/layout";
import { CommunityScopeProvider, useCommunityScope } from "../context/CommunityScopeContext";
import { fetchLectures } from "@/features/lectures/api/sessions";
import { fetchSessions } from "@/features/lectures/api/sessions";

const COMMUNITY_TABS = [
  { key: "notice", label: "ê³µì§€ì‚¬í•­", path: "/admin/community/notice" },
  { key: "qna", label: "ì§ˆì˜ì‘ë‹µ", path: "/admin/community/qna" },
  { key: "materials", label: "ìë£Œì‹¤", path: "/admin/community/materials" },
];

function ScopeSelector() {
  const { scope, setScope, lectureId, setLectureId, sessionId, setSessionId } = useCommunityScope();

  const { data: lectures = [] } = useQuery({
    queryKey: ["lectures-list"],
    queryFn: () => fetchLectures({ is_active: true }),
  });

  const { data: sessions = [] } = useQuery({
    queryKey: ["lecture-sessions", lectureId],
    queryFn: () => fetchSessions(lectureId!),
    enabled: scope !== "all" && Number.isFinite(lectureId ?? 0),
  });

  return (
    <div
      className="flex flex-wrap items-center gap-3"
      style={{
        padding: "var(--space-3) 0",
        borderBottom: "1px solid var(--color-border-divider)",
        marginBottom: "var(--space-4)",
      }}
    >
      <span
        style={{
          fontSize: "var(--text-sm)",
          fontWeight: "var(--font-title)",
          color: "var(--color-text-secondary)",
        }}
      >
        ë…¸ì¶œ ë²”ìœ„
      </span>
      <select
        className="ds-input"
        value={scope}
        onChange={(e) => {
          const v = e.target.value as "all" | "lecture" | "session";
          setScope(v);
          if (v === "all") {
            setLectureId(null);
            setSessionId(null);
          } else if (v === "lecture") {
            setSessionId(null);
          }
        }}
        style={{ width: 140 }}
      >
        <option value="all">í†µí•© (ì „ì²´ í•™ìƒ)</option>
        <option value="lecture">ê°•ì˜ë³„</option>
        <option value="session">ì„¸ì…˜ë³„</option>
      </select>

      {(scope === "lecture" || scope === "session") && (
        <select
          className="ds-input"
          value={lectureId ?? ""}
          onChange={(e) => {
            const v = e.target.value ? Number(e.target.value) : null;
            setLectureId(v);
            setSessionId(null);
          }}
          style={{ width: 220 }}
        >
          <option value="">ê°•ì˜ ì„ íƒ</option>
          {lectures.map((lec) => (
            <option key={lec.id} value={lec.id}>
              {lec.title}
            </option>
          ))}
        </select>
      )}

      {scope === "session" && lectureId && (
        <select
          className="ds-input"
          value={sessionId ?? ""}
          onChange={(e) => setSessionId(e.target.value ? Number(e.target.value) : null)}
          style={{ width: 200 }}
        >
          <option value="">ì°¨ì‹œ ì„ íƒ</option>
          {sessions.map((s) => (
            <option key={s.id} value={s.id}>
              {s.order}ì°¨ì‹œ Â· {s.title || "ì œëª© ì—†ìŒ"}
            </option>
          ))}
        </select>
      )}

      {scope === "session" && (
        <span
          style={{
            fontSize: "var(--text-xs)",
            color: "var(--color-text-muted)",
          }}
        >
          (ì„¸ì…˜ë³„ í•„í„°ëŠ” ì¤€ë¹„ ì¤‘ Â· í˜„ì¬ ê°•ì˜ ì „ì²´ë¡œ í‘œì‹œ)
        </span>
      )}
    </div>
  );
}

function CommunityPageInner() {
  return (
    <DomainLayout
      title="ì»¤ë®¤ë‹ˆí‹°"
      description="ê³µì§€ì‚¬í•­ Â· ì§ˆì˜ì‘ë‹µ Â· ìë£Œì‹¤ í†µí•© ê´€ë¦¬ (í†µí•© | ê°•ì˜ë³„ | ì„¸ì…˜ë³„)"
      tabs={COMMUNITY_TABS}
    >
      <ScopeSelector />
      <Outlet />
    </DomainLayout>
  );
}

export default function CommunityPage() {
  return (
    <CommunityScopeProvider>
      <CommunityPageInner />
    </CommunityScopeProvider>
  );
}


==========================================================================================
# FILE: pages/MaterialsBoardPage.tsx
==========================================================================================
// PATH: src/features/community/pages/MaterialsBoardPage.tsx
// ì»¤ë®¤ë‹ˆí‹° ìë£Œì‹¤ â€” scopeì— ë”°ë¼ ëª©ë¡

import { useState, useMemo } from "react";
import { useQuery } from "@tanstack/react-query";
import { useCommunityScope } from "../context/CommunityScopeContext";
import {
  fetchCommunityMaterials,
  fetchCommunityMaterialCategories,
  type Material,
} from "../api/community.api";
import { fetchLectures } from "@/features/lectures/api/sessions";
import { EmptyState, Button } from "@/shared/ui/ds";

export default function MaterialsBoardPage() {
  const { scope, effectiveLectureId } = useCommunityScope();
  const [selectedCategoryId, setSelectedCategoryId] = useState<number | null>(null);

  const { data: lectures = [] } = useQuery({
    queryKey: ["lectures-list"],
    queryFn: () => fetchLectures({ is_active: true }),
  });

  const { data: categories = [] } = useQuery({
    queryKey: ["community-material-categories", effectiveLectureId],
    queryFn: () => fetchCommunityMaterialCategories(effectiveLectureId!),
    enabled: scope === "lecture" && Number.isFinite(effectiveLectureId ?? 0),
  });

  const { data: materials = [], isLoading } = useQuery<Material[]>({
    queryKey: ["community-materials", effectiveLectureId, selectedCategoryId],
    queryFn: () =>
      fetchCommunityMaterials({
        lectureId: effectiveLectureId ?? undefined,
        categoryId: selectedCategoryId ?? undefined,
      }),
    enabled: scope === "all" || (scope === "lecture" && effectiveLectureId != null),
  });

  const lectureTitleMap = useMemo(() => {
    const m = new Map<number, string>();
    lectures.forEach((l) => m.set(l.id, l.title));
    return m;
  }, [lectures]);

  if (scope === "lecture" && effectiveLectureId == null) {
    return (
      <EmptyState
        scope="panel"
        title="ê°•ì˜ë¥¼ ì„ íƒí•˜ì„¸ìš”"
        description="ë…¸ì¶œ ë²”ìœ„ë¥¼ 'ê°•ì˜ë³„'ë¡œ ë‘ê³  ìœ„ì—ì„œ ê°•ì˜ë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ ê°•ì˜ì˜ ìë£Œì‹¤ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
      />
    );
  }

  return (
    <div className="flex flex-col gap-4">
      <div className="flex items-center justify-between">
        <span
          style={{
            fontSize: "var(--text-sm)",
            fontWeight: "var(--font-title)",
            color: "var(--color-text-muted)",
          }}
        >
          {scope === "all" ? "ì „ì²´ ìë£Œ" : "í•´ë‹¹ ê°•ì˜ ìë£Œ"} Â· {materials.length}ê°œ
        </span>
      </div>

      {scope === "lecture" && categories.length > 0 && (
        <div className="flex flex-wrap gap-2">
          <Button
            intent={selectedCategoryId === null ? "secondary" : "ghost"}
            size="sm"
            onClick={() => setSelectedCategoryId(null)}
          >
            ì „ì²´
          </Button>
          {categories.map((c) => (
            <Button
              key={c.id}
              intent={selectedCategoryId === c.id ? "secondary" : "ghost"}
              size="sm"
              onClick={() => setSelectedCategoryId(c.id)}
            >
              {c.name}
            </Button>
          ))}
        </div>
      )}

      {isLoading ? (
        <EmptyState scope="panel" tone="loading" title="ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦" />
      ) : materials.length === 0 ? (
        <EmptyState
          scope="panel"
          title="ë“±ë¡ëœ ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤."
          description={scope === "all" ? "ê°•ì˜ë³„ ìë£Œì‹¤ì—ì„œ ìë£Œë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." : "í•´ë‹¹ ê°•ì˜ ìë£Œì‹¤ì—ì„œ ìë£Œë¥¼ ì¶”ê°€í•´ ë³´ì„¸ìš”."}
        />
      ) : (
        <ul className="flex flex-col gap-2" style={{ listStyle: "none", padding: 0, margin: 0 }}>
          {materials.map((m) => (
            <li
              key={m.id}
              style={{
                padding: "var(--space-4)",
                borderRadius: "var(--radius-lg)",
                border: "1px solid var(--color-border-divider)",
                background: "var(--color-bg-surface)",
              }}
            >
              <div className="flex items-start justify-between gap-2">
                <div>
                  <div
                    style={{
                      fontSize: "var(--text-md)",
                      fontWeight: 700,
                      color: "var(--color-text-primary)",
                    }}
                  >
                    {m.title}
                  </div>
                  {m.description && (
                    <div
                      style={{
                        fontSize: "var(--text-sm)",
                        color: "var(--color-text-secondary)",
                        marginTop: 4,
                      }}
                    >
                      {m.description}
                    </div>
                  )}
                  {scope === "all" && m.lecture && (
                    <span
                      style={{
                        fontSize: "var(--text-xs)",
                        color: "var(--color-text-muted)",
                        marginTop: 4,
                        display: "inline-block",
                      }}
                    >
                      {lectureTitleMap.get(m.lecture) ?? `ê°•ì˜ #${m.lecture}`}
                    </span>
                  )}
                  <div
                    style={{
                      fontSize: "var(--text-xs)",
                      color: "var(--color-text-muted)",
                      marginTop: 6,
                    }}
                  >
                    {new Date(m.created_at).toLocaleDateString("ko-KR")}
                    {m.file && (
                      <a
                        href={m.file}
                        target="_blank"
                        rel="noopener noreferrer"
                        className="ml-2"
                        style={{ color: "var(--color-primary)" }}
                      >
                        íŒŒì¼
                      </a>
                    )}
                    {m.url && (
                      <a
                        href={m.url}
                        target="_blank"
                        rel="noopener noreferrer"
                        className="ml-2"
                        style={{ color: "var(--color-primary)" }}
                      >
                        ë§í¬
                      </a>
                    )}
                  </div>
                </div>
              </div>
            </li>
          ))}
        </ul>
      )}
    </div>
  );
}


==========================================================================================
# FILE: pages/NoticeBoardPage.tsx
==========================================================================================
// PATH: src/features/community/pages/NoticeBoardPage.tsx
// ì»¤ë®¤ë‹ˆí‹° ê³µì§€ì‚¬í•­ â€” scope(í†µí•©/ê°•ì˜ë³„)ì— ë”°ë¼ ëª©ë¡ + ì‘ì„±

import { useState, useMemo } from "react";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import { useCommunityScope } from "../context/CommunityScopeContext";
import {
  fetchCommunityBoardPosts,
  fetchCommunityBoardCategories,
  createCommunityBoardPost,
  type BoardPost,
  type BoardCategory,
} from "../api/community.api";
import { fetchLectures } from "@/features/lectures/api/sessions";
import { EmptyState, Button } from "@/shared/ui/ds";

export default function NoticeBoardPage() {
  const qc = useQueryClient();
  const { scope, effectiveLectureId } = useCommunityScope();
  const [selectedCategoryId, setSelectedCategoryId] = useState<number | null>(null);
  const [showCreate, setShowCreate] = useState(false);

  const { data: lectures = [] } = useQuery({
    queryKey: ["lectures-list"],
    queryFn: () => fetchLectures({ is_active: true }),
  });

  const { data: categories = [], isLoading: loadingCats } = useQuery<BoardCategory[]>({
    queryKey: ["community-board-categories", effectiveLectureId],
    queryFn: () => fetchCommunityBoardCategories(effectiveLectureId!),
    enabled: scope === "lecture" && Number.isFinite(effectiveLectureId ?? 0),
  });

  const { data: posts = [], isLoading: loadingPosts } = useQuery<BoardPost[]>({
    queryKey: ["community-board-posts", effectiveLectureId, selectedCategoryId],
    queryFn: () =>
      fetchCommunityBoardPosts({
        lectureId: effectiveLectureId ?? undefined,
        categoryId: selectedCategoryId ?? undefined,
      }),
    enabled: scope === "all" || (scope === "lecture" && effectiveLectureId != null),
  });

  const lectureTitleMap = useMemo(() => {
    const m = new Map<number, string>();
    lectures.forEach((l) => m.set(l.id, l.title));
    return m;
  }, [lectures]);

  if (scope === "lecture" && effectiveLectureId == null) {
    return (
      <EmptyState
        scope="panel"
        title="ê°•ì˜ë¥¼ ì„ íƒí•˜ì„¸ìš”"
        description="ë…¸ì¶œ ë²”ìœ„ë¥¼ 'ê°•ì˜ë³„'ë¡œ ë‘ê³  ìœ„ì—ì„œ ê°•ì˜ë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ ê°•ì˜ì˜ ê³µì§€ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
      />
    );
  }

  return (
    <div className="flex flex-col gap-4">
      <div className="flex items-center justify-between">
        <span
          style={{
            fontSize: "var(--text-sm)",
            fontWeight: "var(--font-title)",
            color: "var(--color-text-muted)",
          }}
        >
          {scope === "all" ? "ì „ì²´ ê³µì§€" : "í•´ë‹¹ ê°•ì˜ ê³µì§€"} Â· {posts.length}ê°œ
        </span>
        {scope === "lecture" && effectiveLectureId && (
          <Button intent="primary" size="sm" onClick={() => setShowCreate(true)}>
            + ê³µì§€ ì‘ì„±
          </Button>
        )}
      </div>

      {scope === "lecture" && categories.length > 0 && (
        <div className="flex flex-wrap gap-2">
          <Button
            intent={selectedCategoryId === null ? "secondary" : "ghost"}
            size="sm"
            onClick={() => setSelectedCategoryId(null)}
          >
            ì „ì²´
          </Button>
          {categories.map((c) => (
            <Button
              key={c.id}
              intent={selectedCategoryId === c.id ? "secondary" : "ghost"}
              size="sm"
              onClick={() => setSelectedCategoryId(c.id)}
            >
              {c.name}
            </Button>
          ))}
        </div>
      )}

      {loadingPosts ? (
        <EmptyState scope="panel" tone="loading" title="ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦" />
      ) : posts.length === 0 ? (
        <EmptyState
          scope="panel"
          title="ë“±ë¡ëœ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤."
          description={scope === "all" ? "ê°•ì˜ë³„ë¡œ ë“¤ì–´ê°€ í•´ë‹¹ ê°•ì˜ ê³µì§€ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." : "ê³µì§€ë¥¼ ì‘ì„±í•´ ë³´ì„¸ìš”."}
        />
      ) : (
        <ul className="flex flex-col gap-2" style={{ listStyle: "none", padding: 0, margin: 0 }}>
          {posts.map((p) => (
            <li
              key={p.id}
              style={{
                padding: "var(--space-4)",
                borderRadius: "var(--radius-lg)",
                border: "1px solid var(--color-border-divider)",
                background: "var(--color-bg-surface)",
              }}
            >
              <div className="flex items-start justify-between gap-2">
                <div>
                  <div
                    style={{
                      fontSize: "var(--text-md)",
                      fontWeight: 700,
                      color: "var(--color-text-primary)",
                    }}
                  >
                    {p.title}
                  </div>
                  {scope === "all" && p.lecture && (
                    <span
                      style={{
                        fontSize: "var(--text-xs)",
                        color: "var(--color-text-muted)",
                        marginTop: 4,
                        display: "inline-block",
                      }}
                    >
                      {lectureTitleMap.get(p.lecture) ?? `ê°•ì˜ #${p.lecture}`}
                    </span>
                  )}
                  <div
                    style={{
                      fontSize: "var(--text-xs)",
                      color: "var(--color-text-muted)",
                      marginTop: 6,
                    }}
                  >
                    {new Date(p.created_at).toLocaleDateString("ko-KR")}
                  </div>
                </div>
              </div>
            </li>
          ))}
        </ul>
      )}

      {showCreate && effectiveLectureId && (
        <NoticeCreateModal
          lectureId={effectiveLectureId}
          categories={categories}
          onClose={() => setShowCreate(false)}
          onSuccess={() => {
            qc.invalidateQueries({ queryKey: ["community-board-posts"] });
            setShowCreate(false);
          }}
        />
      )}
    </div>
  );
}

function NoticeCreateModal({
  lectureId,
  categories,
  onClose,
  onSuccess,
}: {
  lectureId: number;
  categories: BoardCategory[];
  onClose: () => void;
  onSuccess: () => void;
}) {
  const [title, setTitle] = useState("");
  const [content, setContent] = useState("");
  const [categoryId, setCategoryId] = useState<number | null>(categories[0]?.id ?? null);

  const createMut = useMutation({
    mutationFn: () => {
      const fd = new FormData();
      fd.set("lecture", String(lectureId));
      fd.set("category", String(categoryId ?? categories[0]!.id));
      fd.set("title", title);
      fd.set("content", content);
      return createCommunityBoardPost(fd);
    },
    onSuccess: () => onSuccess(),
  });

  const canSubmit = title.trim() && categories.length > 0 && (categoryId != null || categories[0]?.id);

  return (
    <div
      role="dialog"
      aria-modal="true"
      style={{
        position: "fixed",
        inset: 0,
        background: "rgba(0,0,0,0.4)",
        display: "flex",
        alignItems: "center",
        justifyContent: "center",
        zIndex: 1000,
      }}
      onClick={onClose}
    >
      <div
        style={{
          background: "var(--color-bg-surface)",
          borderRadius: "var(--radius-xl)",
          padding: "var(--space-6)",
          maxWidth: 480,
          width: "90%",
          boxShadow: "var(--elevation-3)",
        }}
        onClick={(e) => e.stopPropagation()}
      >
        <h3 style={{ marginBottom: 16, fontSize: 18, fontWeight: 700 }}>ê³µì§€ ì‘ì„±</h3>
        {categories.length === 0 ? (
          <p style={{ fontSize: 13, color: "var(--color-text-muted)", marginBottom: 16 }}>
            ì´ ê°•ì˜ì— ê²Œì‹œíŒ ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤. ê°•ì˜ &gt; í•´ë‹¹ ê°•ì˜ &gt; ê²Œì‹œíŒì—ì„œ ë¨¼ì € ì¹´í…Œê³ ë¦¬ë¥¼ ì¶”ê°€í•´ ì£¼ì„¸ìš”.
          </p>
        ) : (
          <div style={{ marginBottom: 12 }}>
            <label style={{ fontSize: 12, color: "var(--color-text-muted)", display: "block", marginBottom: 4 }}>
              ì¹´í…Œê³ ë¦¬
            </label>
            <select
              className="ds-input"
              value={categoryId ?? ""}
              onChange={(e) => setCategoryId(e.target.value ? Number(e.target.value) : null)}
              style={{ width: "100%" }}
            >
              {categories.map((c) => (
                <option key={c.id} value={c.id}>
                  {c.name}
                </option>
              ))}
            </select>
          </div>
        )}
        <div style={{ marginBottom: 12 }}>
          <label style={{ fontSize: 12, color: "var(--color-text-muted)", display: "block", marginBottom: 4 }}>
            ì œëª©
          </label>
          <input
            className="ds-input"
            value={title}
            onChange={(e) => setTitle(e.target.value)}
            placeholder="ì œëª©"
            style={{ width: "100%" }}
          />
        </div>
        <div style={{ marginBottom: 16 }}>
          <label style={{ fontSize: 12, color: "var(--color-text-muted)", display: "block", marginBottom: 4 }}>
            ë‚´ìš©
          </label>
          <textarea
            className="ds-input"
            value={content}
            onChange={(e) => setContent(e.target.value)}
            placeholder="ë‚´ìš©"
            rows={4}
            style={{ width: "100%", resize: "vertical" }}
          />
        </div>
        <div className="flex gap-2 justify-end">
          <Button intent="secondary" size="sm" onClick={onClose}>
            ì·¨ì†Œ
          </Button>
          <Button
            intent="primary"
            size="sm"
            onClick={() => createMut.mutate()}
            disabled={!canSubmit || createMut.isPending}
          >
            {createMut.isPending ? "ë“±ë¡ ì¤‘â€¦" : "ë“±ë¡"}
          </Button>
        </div>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: pages/QnaBoardPage.tsx
==========================================================================================
// PATH: src/features/community/pages/QnaBoardPage.tsx
// ì»¤ë®¤ë‹ˆí‹° ì§ˆì˜ì‘ë‹µ â€” scopeì— ë”°ë¼ ëª©ë¡ + ë‹µë³€

import { useState } from "react";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import { useCommunityScope } from "../context/CommunityScopeContext";
import {
  fetchCommunityQuestions,
  fetchQuestionAnswer,
  createAnswer,
  type Question,
} from "../api/community.api";
import { fetchLectureEnrollments } from "@/features/lectures/api/enrollments";
import { EmptyState, Button } from "@/shared/ui/ds";

export default function QnaBoardPage() {
  const qc = useQueryClient();
  const { scope, effectiveLectureId } = useCommunityScope();
  const [openedId, setOpenedId] = useState<number | null>(null);
  const [filterAnswered, setFilterAnswered] = useState<"all" | "pending">("all");

  const { data: enrollments = [] } = useQuery({
    queryKey: ["enrollments", effectiveLectureId],
    queryFn: () => fetchLectureEnrollments(effectiveLectureId!),
    enabled: scope === "lecture" && Number.isFinite(effectiveLectureId ?? 0),
  });

  const enrollmentIds = enrollments.map((e: { id: number }) => e.id);

  const { data: allQuestions = [], isLoading } = useQuery<Question[]>({
    queryKey: ["community-questions"],
    queryFn: () => fetchCommunityQuestions(),
  });

  const questions = scope === "all"
    ? allQuestions
    : allQuestions.filter((q) => enrollmentIds.includes(q.enrollment));

  const filtered = filterAnswered === "pending"
    ? questions.filter((q) => !q.is_answered)
    : questions;

  if (scope === "lecture" && effectiveLectureId == null) {
    return (
      <EmptyState
        scope="panel"
        title="ê°•ì˜ë¥¼ ì„ íƒí•˜ì„¸ìš”"
        description="ë…¸ì¶œ ë²”ìœ„ë¥¼ 'ê°•ì˜ë³„'ë¡œ ë‘ê³  ìœ„ì—ì„œ ê°•ì˜ë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ ê°•ì˜ì˜ ì§ˆì˜ì‘ë‹µì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
      />
    );
  }

  return (
    <div className="flex flex-col gap-4">
      <div className="flex items-center gap-2">
        <select
          className="ds-input"
          value={filterAnswered}
          onChange={(e) => setFilterAnswered(e.target.value as "all" | "pending")}
          style={{ width: 140 }}
        >
          <option value="all">ì „ì²´</option>
          <option value="pending">ë‹µë³€ ëŒ€ê¸°</option>
        </select>
        <span
          style={{
            fontSize: "var(--text-sm)",
            color: "var(--color-text-muted)",
          }}
        >
          {filtered.length}ê±´
        </span>
      </div>

      {isLoading ? (
        <EmptyState scope="panel" tone="loading" title="ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦" />
      ) : filtered.length === 0 ? (
        <EmptyState
          scope="panel"
          title="ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤."
          description="í•™ìƒì´ ì˜¬ë¦° ì§ˆë¬¸ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."
        />
      ) : (
        <ul className="flex flex-col gap-2" style={{ listStyle: "none", padding: 0, margin: 0 }}>
          {filtered.map((q) => (
            <li key={q.id}>
              <QuestionRow
                question={q}
                isOpen={openedId === q.id}
                onToggle={() => setOpenedId((id) => (id === q.id ? null : q.id))}
                onAnswerSuccess={() => {
                  qc.invalidateQueries({ queryKey: ["community-questions"] });
                  setOpenedId(null);
                }}
              />
            </li>
          ))}
        </ul>
      )}
    </div>
  );
}

function QuestionRow({
  question,
  isOpen,
  onToggle,
  onAnswerSuccess,
}: {
  question: Question;
  isOpen: boolean;
  onToggle: () => void;
  onAnswerSuccess: () => void;
}) {
  const { data: answer } = useQuery({
    queryKey: ["question-answer", question.id],
    queryFn: () => fetchQuestionAnswer(question.id),
    enabled: isOpen,
  });

  return (
    <div
      style={{
        padding: "var(--space-4)",
        borderRadius: "var(--radius-lg)",
        border: "1px solid var(--color-border-divider)",
        background: "var(--color-bg-surface)",
      }}
    >
      <button
        type="button"
        onClick={onToggle}
        className="w-full text-left"
        style={{
          display: "flex",
          alignItems: "center",
          justifyContent: "space-between",
          gap: 8,
        }}
      >
        <span
          style={{
            fontSize: "var(--text-md)",
            fontWeight: 600,
            color: "var(--color-text-primary)",
          }}
        >
          {question.title}
        </span>
        <span
          style={{
            fontSize: "var(--text-xs)",
            padding: "2px 8px",
            borderRadius: 999,
            background: question.is_answered
              ? "color-mix(in srgb, var(--color-primary) 15%, transparent)"
              : "var(--color-bg-surface-soft)",
            color: question.is_answered ? "var(--color-primary)" : "var(--color-text-muted)",
          }}
        >
          {question.is_answered ? "ë‹µë³€ ì™„ë£Œ" : "ë‹µë³€ ëŒ€ê¸°"}
        </span>
      </button>
      <div style={{ fontSize: "var(--text-xs)", color: "var(--color-text-muted)", marginTop: 6 }}>
        {new Date(question.created_at).toLocaleDateString("ko-KR")}
      </div>

      {isOpen && (
        <div style={{ marginTop: 16, paddingTop: 16, borderTop: "1px solid var(--color-border-divider)" }}>
          <div
            style={{
              fontSize: "var(--text-sm)",
              color: "var(--color-text-secondary)",
              whiteSpace: "pre-wrap",
            }}
          >
            {question.content}
          </div>
          {answer && (
            <div
              style={{
                marginTop: 12,
                padding: 12,
                background: "var(--color-bg-surface-soft)",
                borderRadius: "var(--radius-md)",
                fontSize: "var(--text-sm)",
              }}
            >
              <div style={{ fontWeight: 600, marginBottom: 4 }}>ë‹µë³€</div>
              <div style={{ whiteSpace: "pre-wrap" }}>{answer.content}</div>
            </div>
          )}
          {!question.is_answered && (
            <AnswerForm questionId={question.id} onSuccess={onAnswerSuccess} />
          )}
        </div>
      )}
    </div>
  );
}

function AnswerForm({ questionId, onSuccess }: { questionId: number; onSuccess: () => void }) {
  const [content, setContent] = useState("");
  const qc = useQueryClient();
  const createMut = useMutation({
    mutationFn: () => createAnswer(questionId, content),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["community-questions"] });
      qc.invalidateQueries({ queryKey: ["question-answer", questionId] });
      setContent("");
      onSuccess();
    },
  });

  return (
    <div style={{ marginTop: 12 }}>
      <textarea
        className="ds-input"
        value={content}
        onChange={(e) => setContent(e.target.value)}
        placeholder="ë‹µë³€ ì…ë ¥"
        rows={3}
        style={{ width: "100%", resize: "vertical" }}
      />
      <Button
        intent="primary"
        size="sm"
        className="mt-2"
        onClick={() => createMut.mutate()}
        disabled={!content.trim() || createMut.isPending}
      >
        {createMut.isPending ? "ë“±ë¡ ì¤‘â€¦" : "ë‹µë³€ ë“±ë¡"}
      </Button>
    </div>
  );
}


==========================================================================================
# FILE: pages/ReviewBoardPage.tsx
==========================================================================================
import BoardTabs from "../components/BoardTabs";

export default function ReviewBoardPage() {
  return (
    <div className="p-6">

      <div className="mt-6 text-gray-500 text-sm">
        ì•„ì§ ë“±ë¡ëœ í›„ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.
      </div>
    </div>
  );
}
