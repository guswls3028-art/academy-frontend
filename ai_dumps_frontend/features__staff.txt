====================================================================================================
# FRONTEND FOLDER: features__staff
# ROOT PATH: C:\academyfront\src\features\staff
====================================================================================================


==========================================================================================
# FILE: StaffLayout.tsx
==========================================================================================
// PATH: src/features/staff/StaffLayout.tsx
// ë„ë©”ì¸ í—¤ë”(ì§ì› ê´€ë¦¬ + íƒ­) ìœ ì§€. í˜ì´ì§€ ë‚´ë¶€ì˜ í° "ê·¼íƒœ" ë“± ì œëª©ë§Œ ì œê±°ëœ ì¢Œ/ìš° íŒ¨ë„ êµ¬ì¡°.
import { Outlet } from "react-router-dom";
import { DomainLayout } from "@/shared/ui/layout";

const STAFF_TABS = [
  { key: "home", label: "í™ˆ", path: "/admin/staff/home" },
  { key: "attendance", label: "ê·¼íƒœ", path: "/admin/staff/attendance" },
  { key: "expenses", label: "ë¹„ìš©/ê²½ë¹„", path: "/admin/staff/expenses" },
  { key: "month-lock", label: "ì›” ë§ˆê°", path: "/admin/staff/month-lock" },
  { key: "payroll-snapshot", label: "ê¸‰ì—¬ ìŠ¤ëƒ…ìƒ·", path: "/admin/staff/payroll-snapshot" },
  { key: "reports", label: "ë¦¬í¬íŠ¸/ëª…ì„¸", path: "/admin/staff/reports" },
];

export default function StaffLayout() {
  return (
    <DomainLayout
      title="ì§ì› ê´€ë¦¬"
      description="ì§ì› ëª©ë¡ Â· ê·¼íƒœ Â· ë¹„ìš©/ê²½ë¹„ Â· ì›” ë§ˆê° Â· ê¸‰ì—¬ ìŠ¤ëƒ…ìƒ· Â· ë¦¬í¬íŠ¸"
      tabs={STAFF_TABS}
    >
      <Outlet />
    </DomainLayout>
  );
}


==========================================================================================
# FILE: StaffRoutes.tsx
==========================================================================================
import { Routes, Route, Navigate } from "react-router-dom";

import StaffLayout from "./StaffLayout";

import HomePage from "./pages/HomePage/HomePage";
import AttendancePage from "./pages/AttendancePage/AttendancePage";
import ExpensesPage from "./pages/ExpensesPage/ExpensesPage";
import MonthLockPage from "./pages/MonthLockPage/MonthLockPage";
import PayrollSnapshotPage from "./pages/PayrollSnapshotPage/PayrollSnapshotPage";
import ReportsPage from "./pages/ReportsPage/ReportsPage";
import StaffDetailOverlay from "./overlays/StaffDetailOverlay/StaffDetailOverlay";

export default function StaffRoutes() {
  return (
    <Routes>
      <Route element={<StaffLayout />}>
        <Route index element={<Navigate to="home" replace />} />
        <Route path="home" element={<HomePage />} />
        <Route path="operations" element={<Navigate to="/admin/staff/attendance" replace />} />
        <Route path="attendance" element={<AttendancePage />} />
        <Route path="expenses" element={<ExpensesPage />} />
        <Route path="month-lock" element={<MonthLockPage />} />
        <Route path="payroll-snapshot" element={<PayrollSnapshotPage />} />
        <Route path="reports" element={<ReportsPage />} />
      </Route>

      {/* ì§ì› ìƒì„¸ëŠ” ë ˆì´ì•„ì›ƒ ë¶„ë¦¬ (Overlay ì„±ê²©) */}
      <Route path=":staffId/*" element={<StaffDetailOverlay />} />
    </Routes>
  );
}


==========================================================================================
# FILE: api/expenses.api.ts
==========================================================================================
// PATH: src/features/staff/api/expenses.api.ts
import api from "@/shared/api/axios";

/** Backend: ExpenseRecord.STATUS_CHOICES */
export type ExpenseStatus = "PENDING" | "APPROVED" | "REJECTED";

/** Backend: ExpenseRecordSerializer */
export type ExpenseRecord = {
  id: number;
  staff: number;
  staff_name: string;
  date: string;
  title: string;
  amount: number;
  memo: string;
  status: ExpenseStatus;
  approved_at: string | null;
  approved_by: number | null;
  approved_by_name: string | null;
  created_at: string;
  updated_at: string;
};

/**
 * GET /staffs/expense-records/
 */
export async function fetchExpenses(params: {
  staff: number;
  status?: ExpenseStatus;
  date_from: string;
  date_to: string;
}) {
  const res = await api.get("/staffs/expense-records/", { params });

  if (Array.isArray(res.data)) return res.data as ExpenseRecord[];
  if (Array.isArray(res.data?.results)) return res.data.results as ExpenseRecord[];
  return [];
}

/**
 * POST /staffs/expense-records/
 * - ë§ˆê°ëœ ì›”ì´ë©´ backendê°€ 400 ë³´ì¥
 */
export async function createExpense(payload: {
  staff: number;
  date: string;
  title: string;
  amount: number;
  memo?: string;
}) {
  const res = await api.post("/staffs/expense-records/", {
    staff: payload.staff,
    date: payload.date,
    title: payload.title,
    amount: payload.amount,
    memo: payload.memo ?? "",
  });

  return res.data as ExpenseRecord;
}

/**
 * PATCH /staffs/expense-records/{id}/
 * ğŸ”’ APPROVED ì´í›„ ìˆ˜ì • ë¶ˆê°€ (ë°±ì—”ë“œ ë³´ì¥)
 * - ìƒíƒœ ë³€ê²½ì€ ê´€ë¦¬ìë§Œ ê°€ëŠ¥ (ë°±ì—”ë“œ ë³´ì¥)
 */
export async function patchExpense(
  id: number,
  payload: Partial<{
    status: ExpenseStatus;
    memo: string;
  }>
) {
  const res = await api.patch(`/staffs/expense-records/${id}/`, payload);
  return res.data as ExpenseRecord;
}


==========================================================================================
# FILE: api/index.ts
==========================================================================================
/**
 * PATH: src/features/staff/api/index.ts
 * Staff Domain API â€“ Single Source of Truth
 */

export * from "./staff.api";
export * from "./staff.detail.api";
export * from "./staffMe.api";

export * from "./workRecords.api";
export * from "./expenses.api";
export * from "./workMonthLocks.api";

export * from "./payrollSnapshots.api";
export * from "./payrollSnapshotPdf.api";

export * from "./staffWorkType.api";


==========================================================================================
# FILE: api/payrollSnapshotPdf.api.ts
==========================================================================================
ï»¿// PATH: src/features/staff/api/payrollSnapshotPDF.api.ts
import api from "@/shared/api/axios";

export async function exportPayrollSnapshotPDF(params: {
  staff: number;
  year: number;
  month: number;
}) {
  const res = await api.get(
    "/staffs/payroll-snapshots/export-pdf/",
    {
      params,
      responseType: "blob",
    }
  );

  const blob = new Blob([res.data], { type: "application/pdf" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = `payroll_${params.staff}_${params.year}_${String(
    params.month
  ).padStart(2, "0")}.pdf`;
  document.body.appendChild(a);
  a.click();
  a.remove();

  URL.revokeObjectURL(url);
}


==========================================================================================
# FILE: api/payrollSnapshots.api.ts
==========================================================================================
// PATH: src/features/staff/api/payrollSnapshots.api.ts
import api from "@/shared/api/axios";
import { pollJobUntilDone, downloadFromUrl } from "@/shared/api/jobExport";

/** Backend: PayrollSnapshotSerializer (work_hours Decimal, no updated_at) */
export type PayrollSnapshot = {
  id: number;
  staff: number;
  staff_name: string;
  year: number;
  month: number;
  work_hours: number;
  work_amount: number;
  approved_expense_amount: number;
  total_amount: number;
  generated_by: number | null;
  generated_by_name: string | null;
  created_at: string;
};

/**
 * GET /staffs/payroll-snapshots/
 */
export async function fetchPayrollSnapshots(params: {
  year?: number;
  month?: number;
  staff?: number;
}) {
  const cleanParams: any = {};
  if (params.staff != null) cleanParams.staff = params.staff;
  if (params.year != null) cleanParams.year = params.year;
  if (params.month != null) cleanParams.month = params.month;

  const res = await api.get("/staffs/payroll-snapshots/", {
    params: cleanParams,
  });

  if (Array.isArray(res.data)) return res.data as PayrollSnapshot[];
  if (Array.isArray(res.data?.results)) return res.data.results as PayrollSnapshot[];
  return [];
}

/**
 * POST /staffs/payroll-snapshots/export-excel/ â†’ job_id â†’ í´ë§ â†’ download_url ë‹¤ìš´ë¡œë“œ
 */
export async function exportPayrollSnapshotExcel(params: {
  year: number;
  month: number;
}): Promise<void> {
  const res = await api.post<{ job_id: string; status: string }>(
    "/staffs/payroll-snapshots/export-excel/",
    params
  );
  const jobId = res.data?.job_id;
  if (!jobId) throw new Error("Export job could not be started.");

  const data = await pollJobUntilDone(jobId);
  const url = data.result?.download_url;
  const filename =
    data.result?.filename ||
    `payroll_${params.year}_${String(params.month).padStart(2, "0")}.xlsx`;
  if (!url) throw new Error("Export completed but no download link.");
  downloadFromUrl(url, filename);
}


==========================================================================================
# FILE: api/staff.api.ts
==========================================================================================
// PATH: src/features/staff/api/staff.api.ts
import api from "@/shared/api/axios";
import type { StaffWorkType } from "./staffWorkType.api";

/** Backend: StaffListSerializer â€” role: TEACHER(ê°•ì‚¬) | ASSISTANT(ì¡°êµ) */
export type Staff = {
  id: number;
  name: string;
  phone: string;
  is_active: boolean;
  is_manager: boolean;
  pay_type: "HOURLY" | "MONTHLY";
  role: "TEACHER" | "ASSISTANT";
  staff_work_types: StaffWorkType[];
  created_at: string;
  updated_at: string;
};

/** ì§ì› ëª©ë¡ API ì‘ë‹µì— í¬í•¨ë˜ëŠ” ì›ì¥(owner) â€” ëª©ë¡ ìƒë‹¨ í‘œì‹œìš© */
export type StaffListOwner = {
  id: null;
  name: string;
  phone?: string | null;
  role: "OWNER";
  is_owner: true;
};

export type StaffListResponse = {
  staffs: Staff[];
  owner: StaffListOwner | null;
};

/**
 * Staff Summary (ì§‘ê³„ ì „ìš©)
 * ğŸ”’ ê³„ì‚° ë‹¨ì¼ì§„ì‹¤
 */
export type StaffSummary = {
  staff_id: number;
  work_hours: number;
  work_amount: number;
  expense_amount: number;
  total_amount: number;
};

/**
 * GET /staffs/
 * ì‘ë‹µì— owner(ì›ì¥) í¬í•¨ ì‹œ { staffs, owner } ë°˜í™˜.
 */
export async function fetchStaffs(params?: {
  search?: string;
  is_active?: boolean;
  is_manager?: boolean;
  pay_type?: string;
}): Promise<StaffListResponse> {
  const res = await api.get<{ results?: Staff[]; owner?: StaffListOwner | null } & Staff[]>("/staffs/", {
    params,
  });

  const raw = res?.data;
  const staffs: Staff[] = Array.isArray(raw)
    ? (raw as Staff[])
    : Array.isArray((raw as Record<string, unknown>)?.results)
      ? ((raw as Record<string, unknown>).results as Staff[])
      : [];
  const ownerRaw =
    raw && typeof raw === "object" && "owner" in (raw as object)
      ? (raw as Record<string, unknown>).owner
      : undefined;
  const owner: StaffListOwner | null =
    ownerRaw && typeof ownerRaw === "object" && ownerRaw !== null && "name" in ownerRaw && (ownerRaw as StaffListOwner).name
      ? (ownerRaw as StaffListOwner)
      : null;

  return { staffs, owner };
}

/**
 * POST /staffs/
 * ğŸ”’ ìƒì„± ìŠ¤í™ ë‹¨ì¼ì§„ì‹¤
 *
 * backend StaffCreateUpdateSerializer.role choices:
 * - TEACHER : ê°•ì‚¬
 * - ASSISTANT : ì¡°êµ
 */
export async function createStaff(payload: {
  username: string;
  password: string;
  name: string;
  phone?: string;
  role: "TEACHER" | "ASSISTANT";
}) {
  const res = await api.post("/staffs/", {
    username: payload.username,
    password: payload.password,
    name: payload.name,
    phone: payload.phone || undefined,
    role: payload.role,
  });

  return res.data as Staff;
}

/**
 * DELETE /staffs/{id}/
 */
export async function deleteStaff(id: number) {
  await api.delete(`/staffs/${id}/`);
  return true;
}


==========================================================================================
# FILE: api/staff.detail.api.ts
==========================================================================================
// PATH: src/features/staff/api/staff.detail.api.ts
import api from "@/shared/api/axios";
import { Staff, StaffSummary } from "./staff.api";

/** Backend: StaffDetailSerializer (list fields + user, user_username, user_is_staff) */
export type StaffDetail = Staff & {
  user: number | null;
  user_username: string | null;
  user_is_staff: boolean;
};

/**
 * GET /staffs/{id}/
 */
export async function fetchStaffDetail(id: number) {
  const res = await api.get(`/staffs/${id}/`);
  return res.data as StaffDetail;
}

/**
 * PATCH /staffs/{id}/
 */
export async function patchStaffDetail(
  id: number,
  payload: Partial<StaffDetail>
) {
  const res = await api.patch(`/staffs/${id}/`, payload);
  return res.data as StaffDetail;
}

/**
 * ğŸ”’ ì§‘ê³„ ë‹¨ì¼ì§„ì‹¤
 */
export async function fetchStaffSummaryByRange(
  staffId: number,
  date_from: string,
  date_to: string
) {
  const res = await api.get(`/staffs/${staffId}/summary/`, {
    params: { date_from, date_to },
  });
  return res.data as StaffSummary;
}


==========================================================================================
# FILE: api/staffMe.api.ts
==========================================================================================
// PATH: src/features/staff/api/staffMe.api.ts
import api from "@/shared/api/axios";

export type StaffMe = {
  is_authenticated: boolean;
  is_superuser: boolean;
  is_staff: boolean;
  is_payroll_manager: boolean;
  /** í˜„ì¬ ì‚¬ìš©ìê°€ ì´ í…Œë„ŒíŠ¸ ì›ì¥(owner)ì¼ ë•Œ true. ì§ì› ëª©ë¡ ì›ì¥ í–‰ í‘œì‹œìš© */
  is_owner?: boolean;
  /** ì›ì¥ í–‰ í‘œì‹œìš© ì´ë¦„ (list APIì— owner ì—†ì„ ë•Œ ì‚¬ìš©) */
  owner_display_name?: string | null;
  /** ì›ì¥ í–‰ í‘œì‹œìš© ì „í™”ë²ˆí˜¸ */
  owner_phone?: string | null;
};

/**
 * ğŸ”’ ë‹¨ì¼ì§„ì‹¤
 * - ê¶Œí•œ íŒë‹¨ì€ ë¬´ì¡°ê±´ ì´ API ê¸°ì¤€
 */
export async function fetchStaffMe() {
  const res = await api.get("/staffs/me/");
  return res.data as StaffMe;
}


==========================================================================================
# FILE: api/staffWorkType.api.ts
==========================================================================================
// PATH: src/features/staff/api/staffWorkType.api.ts
import api from "@/shared/api/axios";

/** Backend: WorkTypeSerializer */
export type WorkType = {
  id: number;
  name: string;
  base_hourly_wage: number;
  color: string;
  description: string;
  is_active: boolean;
  created_at: string;
  updated_at: string;
};

/** Backend: StaffWorkTypeSerializer (work_type nested, work_type_id write_only) */
export type StaffWorkType = {
  id: number;
  staff: number;
  work_type: WorkType;
  hourly_wage: number | null;
  effective_hourly_wage: number;
  created_at: string;
  updated_at: string;
};

/**
 * GET /staffs/work-types/
 */
export async function fetchWorkTypes(params?: { is_active?: boolean }) {
  const res = await api.get("/staffs/work-types/", { params });

  if (Array.isArray(res.data)) return res.data as WorkType[];
  if (Array.isArray(res.data?.results)) return res.data.results as WorkType[];
  return [];
}

/**
 * GET /staffs/staff-work-types/?staff={staffId}
 */
export async function fetchStaffWorkTypes(staffId: number) {
  const res = await api.get("/staffs/staff-work-types/", { params: { staff: staffId } });

  if (Array.isArray(res.data)) return res.data as StaffWorkType[];
  if (Array.isArray(res.data?.results)) return res.data.results as StaffWorkType[];
  return [];
}

/**
 * POST /staffs/staff-work-types/
 */
export async function createStaffWorkType(
  staffId: number,
  payload: { work_type_id: number; hourly_wage?: number | null }
) {
  const res = await api.post("/staffs/staff-work-types/", { staff: staffId, ...payload });
  return res.data as StaffWorkType;
}

export async function patchStaffWorkType(
  id: number,
  payload: { hourly_wage?: number | null }
) {
  const res = await api.patch(`/staffs/staff-work-types/${id}/`, payload);
  return res.data as StaffWorkType;
}

export async function deleteStaffWorkType(id: number) {
  await api.delete(`/staffs/staff-work-types/${id}/`);
  return true;
}


==========================================================================================
# FILE: api/workMonthLocks.api.ts
==========================================================================================
// PATH: src/features/staff/api/workMonthLocks.api.ts
import api from "@/shared/api/axios";

/** Backend: WorkMonthLockSerializer (no updated_at) */
export type WorkMonthLock = {
  id: number;
  staff: number;
  staff_name: string;
  year: number;
  month: number;
  is_locked: boolean;
  locked_by: number | null;
  locked_by_name: string | null;
  created_at: string;
};

/**
 * GET /staffs/work-month-locks/
 * âš ï¸ backendëŠ” staff/year/month í•„í„°ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŒ
 */
export async function fetchWorkMonthLocks(params: {
  staff?: number;
  year: number;
  month: number;
}) {
  const res = await api.get("/staffs/work-month-locks/");

  const rows: WorkMonthLock[] = Array.isArray(res.data)
    ? res.data
    : Array.isArray(res.data?.results)
    ? res.data.results
    : [];

  // ğŸ”’ í•„í„°ë§ì€ ê³„ì‚°ì´ ì•„ë‹ˆë¼ "ì„ íƒ" â†’ í—ˆìš©
  return rows.filter(
    (r) =>
      r.year === params.year &&
      r.month === params.month &&
      (params.staff ? r.staff === params.staff : true)
  );
}

/**
 * POST /staffs/work-month-locks/
 */
export async function lockWorkMonth(payload: {
  staff: number;
  year: number;
  month: number;
}) {
  const res = await api.post("/staffs/work-month-locks/", payload);
  return res.data as WorkMonthLock;
}

export function isLockedFromLocks(
  locks: WorkMonthLock[] | undefined
): boolean {
  if (!locks || locks.length === 0) return false;
  return locks.some((l) => l.is_locked);
}


==========================================================================================
# FILE: api/workRecords.api.ts
==========================================================================================
// PATH: src/features/staff/api/workRecords.api.ts
import api from "@/shared/api/axios";

/** Backend: WorkRecordSerializer (resolved_hourly_wage, current_break_started_at not exposed) */
export type WorkRecord = {
  id: number;
  staff: number;
  staff_name: string;
  work_type: number;
  work_type_name: string;
  date: string;
  start_time: string;
  end_time: string | null;
  break_minutes: number;
  work_hours: number | null;
  amount: number | null;
  memo: string;
  created_at: string;
  updated_at: string;
};

/**
 * GET /staffs/work-records/
 */
export async function fetchWorkRecords(params: {
  staff: number;
  work_type?: number;
  date_from: string;
  date_to: string;
}) {
  const res = await api.get("/staffs/work-records/", { params });

  if (Array.isArray(res.data)) return res.data as WorkRecord[];
  if (Array.isArray(res.data?.results)) return res.data.results as WorkRecord[];
  return [];
}

/**
 * POST /staffs/work-records/
 */
export async function createWorkRecord(payload: {
  staff: number;
  work_type: number;
  date: string;
  start_time: string;
  end_time: string;
  break_minutes?: number;
  memo?: string;
}) {
  const res = await api.post("/staffs/work-records/", payload);
  return res.data as WorkRecord;
}

export async function patchWorkRecord(
  id: number,
  payload: Partial<{
    work_type: number;
    date: string;
    start_time: string;
    end_time: string;
    break_minutes: number;
    memo: string;
  }>
) {
  const res = await api.patch(`/staffs/work-records/${id}/`, payload);
  return res.data as WorkRecord;
}

export async function deleteWorkRecord(id: number) {
  await api.delete(`/staffs/work-records/${id}/`);
  return true;
}


==========================================================================================
# FILE: components/ActionButton.tsx
==========================================================================================
// PATH: src/features/staff/components/ActionButton.tsx
import React from "react";

type Variant =
  | "primary"
  | "secondary"
  | "danger"
  | "success"
  | "ghost"
  | "outline"
  | "danger-outline";

type Size = "xs" | "sm" | "md";

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

const BASE =
  "inline-flex items-center justify-center select-none whitespace-nowrap font-semibold rounded-lg border transition " +
  "focus:outline-none focus:ring-1 focus:ring-[var(--color-primary)]";

const SIZE: Record<Size, string> = {
  xs: "h-[30px] px-2 text-xs",
  sm: "h-[34px] px-3 text-xs",
  md: "h-[38px] px-4 text-sm",
};

/**
 * ì‹¤ë¬´ ê¸°ì¤€ ë²„íŠ¼ í†¤
 * - danger: ì‚­ì œ/ë§ˆê°/í™•ì • (ë˜ëŒë¦´ ìˆ˜ ì—†ìŒ)
 * - success: ìŠ¹ì¸/ì •ìƒ
 * - outline/ghost: íƒìƒ‰Â·ë³´ì¡°
 * - disabled: ì‹œê°ì ìœ¼ë¡œ â€œì£½ì€ ë²„íŠ¼â€ ëª…í™•
 */
const VARIANT: Record<Variant, string> = {
  primary:
    "border-[var(--color-primary)] bg-[var(--color-primary)] text-white hover:opacity-90",
  secondary:
    "border-[var(--border-divider)] bg-[var(--bg-surface)] text-[var(--text-primary)] hover:bg-[var(--bg-surface-soft)]",
  outline:
    "border-[var(--border-divider)] bg-transparent text-[var(--text-primary)] hover:bg-[var(--bg-surface-soft)]",
  ghost:
    "border-transparent bg-transparent text-[var(--text-primary)] hover:bg-[var(--bg-surface-soft)]",
  danger:
    "border-[var(--color-danger)] bg-[var(--color-danger)] text-white hover:opacity-95 shadow-[0_8px_18px_rgba(0,0,0,0.28)]",
  "danger-outline":
    "border-[var(--color-danger)] bg-transparent text-[var(--color-danger)] hover:bg-[var(--color-danger-soft)]",
  success:
    "border-[var(--color-success)] bg-[var(--color-success)] text-white hover:opacity-90",
};

export default function ActionButton({
  variant = "secondary",
  size = "sm",
  disabled,
  disabledReason,
  className,
  title,
  type = "button",
  ...props
}: React.ButtonHTMLAttributes<HTMLButtonElement> & {
  variant?: Variant;
  size?: Size;
  disabledReason?: string;
}) {
  const isDisabled = !!disabled || !!disabledReason;

  return (
    <button
      type={type}
      disabled={isDisabled}
      aria-disabled={isDisabled}
      title={disabledReason || title}
      className={cx(
        BASE,
        SIZE[size],
        VARIANT[variant],
        isDisabled &&
          [
            "opacity-50 cursor-not-allowed",
            "hover:opacity-50 active:opacity-50",
            variant === "outline" ||
            variant === "ghost" ||
            variant === "danger-outline"
              ? "hover:bg-transparent"
              : "",
          ].join(" "),
        className
      )}
      {...props}
    />
  );
}


==========================================================================================
# FILE: components/StaffTable.tsx
==========================================================================================
// PATH: src/features/staff/components/StaffTable.tsx
import { Table } from "antd";
import type { ColumnsType } from "antd/es/table";
import { Staff } from "../api/staff.api";
import { RoleBadge } from "./StatusBadge";

type Props = {
  staffs: Staff[];
  onRowClick?: (staffId: number) => void;
};

export default function StaffTable({ staffs, onRowClick }: Props) {
  const columns: ColumnsType<Staff> = [
    {
      title: "ì´ë¦„",
      dataIndex: "name",
      render: (_, r) => (
        <div className="flex items-center gap-2">
          <span className="font-semibold">{r.name}</span>
          {!r.is_active && (
            <span className="px-2 py-0.5 rounded-full text-xs border text-[var(--text-muted)] bg-[var(--bg-surface-muted)]">
              ë¹„í™œì„±
            </span>
          )}
        </div>
      ),
    },
    {
      title: "ì „í™”ë²ˆí˜¸",
      dataIndex: "phone",
      render: (v) => v || "-",
    },
    {
      title: "ì—­í• ",
      dataIndex: "is_manager",
      render: (v) => <RoleBadge isManager={!!v} />,
    },
    {
      title: "ê¸‰ì—¬",
      dataIndex: "pay_type",
      render: (v) => (v === "HOURLY" ? "ì‹œê¸‰" : "ì›”ê¸‰"),
    },
  ];

  return (
    <Table
      rowKey="id"
      dataSource={staffs}
      columns={columns}
      pagination={false}
      onRow={(r) => ({
        onClick: () => onRowClick?.(r.id),
      })}
    />
  );
}


==========================================================================================
# FILE: components/StatusBadge.tsx
==========================================================================================
// PATH: src/features/staff/components/StatusBadge.tsx
// ì „ì—­ SSOT: .ds-status-badge + data-tone (styles/design-system/ds/status.css)

import React from "react";

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

type Tone = "neutral" | "success" | "danger" | "warning" | "primary";

function Dot({ tone }: { tone: Tone }) {
  const cls =
    tone === "danger"
      ? "bg-[var(--color-danger)]"
      : tone === "success"
      ? "bg-[var(--color-success)]"
      : tone === "warning"
      ? "bg-[var(--color-warning)]"
      : tone === "primary"
      ? "bg-[var(--color-brand-primary)]"
      : "bg-[var(--color-text-muted)]";

  return <span className={cx("inline-block h-1.5 w-1.5 rounded-full shrink-0", cls)} aria-hidden />;
}

type ExpenseStatus = "PENDING" | "APPROVED" | "REJECTED";

export function ExpenseStatusBadge({ status }: { status: ExpenseStatus }) {
  const label =
    status === "APPROVED" ? "ìŠ¹ì¸" : status === "REJECTED" ? "ë°˜ë ¤" : "ëŒ€ê¸°";
  const tone: Tone =
    status === "APPROVED" ? "success" : status === "REJECTED" ? "danger" : "neutral";

  return (
    <span className="ds-status-badge" data-tone={tone}>
      <Dot tone={tone} />
      {label}
    </span>
  );
}

export function LockBadge({
  state,
  compact = false,
}: {
  state: "LOCKED" | "OPEN";
  compact?: boolean;
}) {
  const locked = state === "LOCKED";
  const tone: Tone = locked ? "danger" : "success";

  return (
    <span className="ds-status-badge" data-tone={tone}>
      <Dot tone={tone} />
      {locked ? (compact ? "ë§ˆê°" : "ğŸ”’ ë§ˆê°") : compact ? "ì§„í–‰" : "ğŸ”“ ì§„í–‰ì¤‘"}
    </span>
  );
}

export function RoleBadge({ isManager }: { isManager: boolean }) {
  const tone: Tone = isManager ? "primary" : "neutral";

  return (
    <span className="ds-status-badge" data-tone={tone}>
      <Dot tone={tone} />
      {isManager ? "ê´€ë¦¬ì" : "ì§ì›"}
    </span>
  );
}


==========================================================================================
# FILE: components/WorkMonthLockBar.tsx
==========================================================================================
ï»¿// PATH: src/features/staff/components/WorkMonthLockBar.tsx
import { WorkMonthLock } from "../api/workMonthLocks.api";
import ActionButton from "./ActionButton";
import { LockBadge, RoleBadge } from "./StatusBadge";

export default function WorkMonthLockBar({
  locks,
  isManager,
  onLock,
}: {
  locks?: WorkMonthLock[];
  isManager: boolean;
  onLock?: () => void;
}) {
  const locked = !!locks?.some((l) => !!l.is_locked);

  const disabledReason = locked
    ? "ì´ë¯¸ ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤."
    : !isManager
    ? "ë§ˆê°ì€ ê´€ë¦¬ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤."
    : "";

  return (
    <div className="space-y-2">
      <div
        className={[
          "flex items-start justify-between gap-4 rounded-2xl border px-5 py-4 text-sm",
          locked
            ? "border-[color-mix(in_srgb,var(--color-danger)_55%,transparent)] bg-[var(--color-danger-soft)]"
            : "border-[color-mix(in_srgb,var(--color-success)_55%,transparent)] bg-[var(--color-success-soft)]",
        ].join(" ")}
      >
        <div className="space-y-1">
          <div className="flex items-center gap-2">
            <LockBadge state={locked ? "LOCKED" : "OPEN"} />
            <RoleBadge isManager={isManager} />
          </div>
          <div className="text-[11px] text-[var(--text-muted)]">
            * ì›” ë§ˆê° = ê¸‰ì—¬ í™•ì • Â· ì´í›„ ë³€ê²½ ë¶ˆê°€
          </div>
        </div>

        <ActionButton
          variant="danger"
          size="sm"
          disabledReason={disabledReason}
          title={
            disabledReason ||
            "ì´ë²ˆ ë‹¬ ê·¼ë¬´/ë¹„ìš©ì„ í™•ì •í•©ë‹ˆë‹¤. ì´í›„ ìˆ˜ì •Â·ì‚­ì œ ë¶ˆê°€í•˜ë©° ê¸‰ì—¬ ìŠ¤ëƒ…ìƒ·ì´ ìƒì„±ë©ë‹ˆë‹¤."
          }
          onClick={() => {
            if (disabledReason) return;
            if (
              !confirm(
                [
                  "ì´ë²ˆ ë‹¬ì„ ë§ˆê°í• ê¹Œìš”?",
                  "",
                  "- ë§ˆê° í›„ì—ëŠ” ê·¼ë¬´/ë¹„ìš© ìˆ˜ì •Â·ì‚­ì œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.",
                  "- ê¸‰ì—¬ ìŠ¤ëƒ…ìƒ·ì´ ìƒì„±ë©ë‹ˆë‹¤.",
                ].join("\n")
              )
            )
              return;
            onLock?.();
          }}
        >
          ì›” ë§ˆê°
        </ActionButton>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: components/index.ts
==========================================================================================
ï»¿


==========================================================================================
# FILE: constants/index.ts
==========================================================================================
ï»¿


==========================================================================================
# FILE: hooks/index.ts
==========================================================================================
ï»¿/**
 * PATH: src/features/staff/hooks/index.ts
 */

export * from "./useStaffs";
export * from "./useStaffDetail";
export * from "./useWorkRecords";
export * from "./useExpenses";
export * from "./useWorkMonthLock";
export * from "./usePayrollSnapshots";


==========================================================================================
# FILE: hooks/useExpenses.ts
==========================================================================================
ï»¿// PATH: src/features/staff/hooks/useExpenses.ts
import { useMutation, useQuery, useQueryClient } from "@tanstack/react-query";
import {
  fetchExpenses,
  patchExpense,
  createExpense,
  ExpenseStatus,
} from "../api/expenses.api";

export type UseExpensesParams = {
  staff: number;
  status?: ExpenseStatus;
  date_from: string;
  date_to: string;
};

/**
 * ğŸ”’ ê·œì¹™
 * - ìŠ¹ì¸ ìƒíƒœ íŒë‹¨(ì¶”ë¡ ) âŒ  -> status ê°’ ê·¸ëŒ€ë¡œ ì‚¬ìš©
 * - í•©ê³„ ê³„ì‚° âŒ
 */
export function useExpenses(params: UseExpensesParams) {
  const qc = useQueryClient();

  const listQ = useQuery({
    queryKey: ["expenses", params],
    queryFn: () => fetchExpenses(params),
    enabled: !!params.staff && !!params.date_from && !!params.date_to,
  });

  const invalidate = () => {
    qc.invalidateQueries({ queryKey: ["expenses"] });
    qc.invalidateQueries({ queryKey: ["staff-summary", params.staff] });
    qc.invalidateQueries({ queryKey: ["payroll-snapshots"] });
  };

  const createM = useMutation({
    mutationFn: createExpense,
    onSuccess: invalidate,
  });

  const patchM = useMutation({
    mutationFn: ({ id, payload }: { id: number; payload: any }) =>
      patchExpense(id, payload),
    onSuccess: invalidate,
  });

  return { listQ, createM, patchM };
}


==========================================================================================
# FILE: hooks/usePayrollSnapshots.ts
==========================================================================================
ï»¿// PATH: src/features/staff/hooks/usePayrollSnapshots.ts
import { useQuery } from "@tanstack/react-query";
import { fetchPayrollSnapshots } from "../api/payrollSnapshots.api";

export type UsePayrollSnapshotsParams = {
  staff?: number;
  year?: number;
  month?: number;
};

/**
 * ğŸ”’ PayrollSnapshot = ë¶ˆë³€ ë‹¨ì¼ì§„ì‹¤
 * - í”„ë¡ íŠ¸ ê³„ì‚° âŒ
 * - ìˆ˜ì • âŒ
 */
export function usePayrollSnapshots(params: UsePayrollSnapshotsParams) {
  return useQuery({
    queryKey: ["payroll-snapshots", params],
    queryFn: () => fetchPayrollSnapshots(params),
  });
}


==========================================================================================
# FILE: hooks/useStaffDetail.ts
==========================================================================================
ï»¿// PATH: src/features/staff/hooks/useStaffDetail.ts
import { useQuery } from "@tanstack/react-query";
import { fetchStaffDetail } from "../api/staff.detail.api";

/**
 * ğŸ”’ Staff ë‹¨ê±´ ë‹¨ì¼ì§„ì‹¤
 */
export function useStaffDetail(staffId?: number) {
  return useQuery({
    queryKey: ["staff", staffId],
    queryFn: () => fetchStaffDetail(staffId as number),
    enabled: typeof staffId === "number" && staffId > 0,
  });
}


==========================================================================================
# FILE: hooks/useStaffs.ts
==========================================================================================
ï»¿// PATH: src/features/staff/hooks/useStaffs.ts
import { useQuery } from "@tanstack/react-query";
import { fetchStaffs } from "../api/staff.api";

export type UseStaffsParams = {
  search?: string;
  is_active?: boolean;
  is_manager?: boolean;
  pay_type?: string;
};

/**
 * ğŸ”’ ë‹¨ì¼ì§„ì‹¤
 * - Staff ëª©ë¡ì€ ì„œë²„ ê·¸ëŒ€ë¡œ ì‹ ë¢°
 */
export function useStaffs(params?: UseStaffsParams) {
  return useQuery({
    queryKey: ["staffs", params ?? {}],
    queryFn: () => fetchStaffs(params),
    staleTime: 10_000,
  });
}


==========================================================================================
# FILE: hooks/useWorkMonthLock.ts
==========================================================================================
ï»¿/**
 * PATH: src/features/staff/hooks/useWorkMonthLock.ts
 */

import { useMutation, useQuery, useQueryClient } from "@tanstack/react-query";
import {
  fetchWorkMonthLocks,
  lockWorkMonth,
  isLockedFromLocks,
} from "../api/workMonthLocks.api"; // ??? IA  NOTE: legacy comment removed (encoding issue)

export function useWorkMonthLock(params: { staff: number; year: number; month: number }) {
  const qc = useQueryClient();

  const locksQ = useQuery({
    queryKey: ["work-month-locks", params.staff, params.year, params.month],
    queryFn: () =>
      fetchWorkMonthLocks({
        staff: params.staff,
        year: params.year,
        month: params.month,
      }),
    enabled: !!params.staff && !!params.year && !!params.month,
  });

  const locked = isLockedFromLocks(locksQ.data);

  const lockM = useMutation({
    mutationFn: () => lockWorkMonth({ staff: params.staff, year: params.year, month: params.month }),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["work-month-locks", params.staff] });
      qc.invalidateQueries({ queryKey: ["work-records", params.staff] });
      qc.invalidateQueries({ queryKey: ["expenses", params.staff] });
      qc.invalidateQueries({ queryKey: ["payroll-snapshots"] });
    },
  });

  return { locksQ, locked, lockM };
}


==========================================================================================
# FILE: hooks/useWorkRecords.ts
==========================================================================================
ï»¿// PATH: src/features/staff/hooks/useWorkRecords.ts
import { useMutation, useQuery, useQueryClient } from "@tanstack/react-query";
import {
  fetchWorkRecords,
  createWorkRecord,
  patchWorkRecord,
  deleteWorkRecord,
} from "../api/workRecords.api";

export type UseWorkRecordsParams = {
  staff: number;
  work_type?: number;
  date_from: string;
  date_to: string;
};

/**
 * ğŸ”’ ê·œì¹™
 * - ì‹œê°„/ê¸ˆì•¡ ê³„ì‚° âŒ
 * - ë§ˆê° ì—¬ë¶€ íŒë‹¨ âŒ (ë°±ì—”ë“œì—ì„œ 400)
 */
export function useWorkRecords(params: UseWorkRecordsParams) {
  const qc = useQueryClient();

  const listQ = useQuery({
    queryKey: ["work-records", params],
    queryFn: () => fetchWorkRecords(params),
    enabled:
      !!params.staff && !!params.date_from && !!params.date_to,
  });

  const invalidate = () => {
    qc.invalidateQueries({ queryKey: ["work-records"] });
    qc.invalidateQueries({ queryKey: ["staff-summary", params.staff] });
    qc.invalidateQueries({ queryKey: ["payroll-snapshots"] });
  };

  const createM = useMutation({
    mutationFn: createWorkRecord,
    onSuccess: invalidate,
  });

  const patchM = useMutation({
    mutationFn: ({ id, payload }: { id: number; payload: any }) =>
      patchWorkRecord(id, payload),
    onSuccess: invalidate,
  });

  const deleteM = useMutation({
    mutationFn: deleteWorkRecord,
    onSuccess: invalidate,
  });

  return { listQ, createM, patchM, deleteM };
}


==========================================================================================
# FILE: operations/context/WorkMonthContext.tsx
==========================================================================================
import React, { createContext, useContext, useMemo } from "react";
import { useWorkMonthLock } from "../../hooks/useWorkMonthLock";
import { useQuery } from "@tanstack/react-query";
import { fetchStaffMe } from "../../api/staffMe.api";

type WorkMonthContextValue = {
  staffId: number;
  year: number;
  month: number;
  range: { from: string; to: string };
  locked: boolean;
  canManage: boolean;
  lockM: ReturnType<typeof useWorkMonthLock>["lockM"];
};

const Ctx = createContext<WorkMonthContextValue | null>(null);

function monthRange(year: number, month: number) {
  const from = `${year}-${String(month).padStart(2, "0")}-01`;
  const lastDay = new Date(year, month, 0).getDate();
  const to = `${year}-${String(month).padStart(2, "0")}-${String(
    lastDay
  ).padStart(2, "0")}`;
  return { from, to };
}

export function WorkMonthProvider({
  staffId,
  year,
  month,
  children,
}: React.PropsWithChildren<{ staffId: number; year: number; month: number }>) {
  const { locked, lockM } = useWorkMonthLock({ staff: staffId, year, month });

  const meQ = useQuery({
    queryKey: ["staff-me"],
    queryFn: fetchStaffMe,
  });

  const canManage = !!meQ.data?.is_payroll_manager;

  const range = useMemo(() => monthRange(year, month), [year, month]);

  const value = useMemo(
    () => ({
      staffId,
      year,
      month,
      range,
      locked,
      canManage,
      lockM,
    }),
    [staffId, year, month, range, locked, canManage, lockM]
  );

  return <Ctx.Provider value={value}>{children}</Ctx.Provider>;
}

export function useWorkMonth() {
  const v = useContext(Ctx);
  if (!v) throw new Error("useWorkMonth must be used within WorkMonthProvider");
  return v;
}


==========================================================================================
# FILE: overlays/index.ts
==========================================================================================
ï»¿


==========================================================================================
# FILE: overlays/StaffDetailOverlay/StaffDetailOverlay.tsx
==========================================================================================
// PATH: src/features/staff/overlays/StaffDetailOverlay/StaffDetailOverlay.tsx
// Design: docs/DESIGN_SSOT.md
import { useParams, useNavigate } from "react-router-dom";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import { useState } from "react";

import {
  fetchStaffDetail,
  fetchStaffSummaryByRange,
  patchStaffDetail,
} from "../../api/staff.detail.api";
import {
  fetchWorkMonthLocks,
  isLockedFromLocks,
} from "../../api/workMonthLocks.api";
import { fetchStaffMe } from "../../api/staffMe.api";

import ActionButton from "../../components/ActionButton";
import { LockBadge } from "../../components/StatusBadge";
import { StaffRoleAvatar } from "@/shared/ui/avatars";

import StaffSummaryTab from "./StaffSummaryTab";
import StaffWorkTypeTab from "./StaffWorkTypeTab";
import StaffWorkRecordsTab from "./StaffWorkRecordsTab";
import StaffExpensesTab from "./StaffExpensesTab";
import StaffPayrollHistoryTab from "./StaffPayrollHistoryTab";
import StaffReportTab from "./StaffReportTab";
import StaffSettingsTab from "./StaffSettingsTab";

function StaffManagerToggle({
  staffId,
  isManager,
}: {
  staffId: number;
  isManager: boolean;
}) {
  const qc = useQueryClient();
  const mutation = useMutation({
    mutationFn: (payload: { is_manager: boolean }) =>
      patchStaffDetail(staffId, payload),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["staffs"] });
      qc.invalidateQueries({ queryKey: ["staff", staffId] });
    },
  });
  return (
    <button
      type="button"
      className="ds-status-badge cursor-pointer"
      data-status={isManager ? "active" : "inactive"}
      disabled={mutation.isPending}
      onClick={() => mutation.mutate({ is_manager: !isManager })}
      aria-label={isManager ? "ê´€ë¦¬ì í•´ì œ" : "ê´€ë¦¬ì ë¶€ì—¬"}
    >
      {mutation.isPending ? "â€¦" : isManager ? "ON" : "OFF"}
    </button>
  );
}

function getThisMonthRange() {
  const d = new Date();
  const y = d.getFullYear();
  const m = d.getMonth() + 1;
  const from = `${y}-${String(m).padStart(2, "0")}-01`;
  const last = new Date(y, m, 0).getDate();
  const to = `${y}-${String(m).padStart(2, "0")}-${String(last).padStart(
    2,
    "0"
  )}`;
  return { y, m, from, to };
}

export default function StaffDetailOverlay() {
  const { staffId } = useParams();
  const navigate = useNavigate();
  const sid = Number(staffId);
  const [tab, setTab] = useState("summary");

  const { y, m, from, to } = getThisMonthRange();

  const staffQ = useQuery({
    queryKey: ["staff", sid],
    queryFn: () => fetchStaffDetail(sid),
    enabled: !!sid,
  });

  const meQ = useQuery({
    queryKey: ["staff-me"],
    queryFn: fetchStaffMe,
  });

  const summaryQ = useQuery({
    queryKey: ["staff-summary", sid, from, to],
    queryFn: () => fetchStaffSummaryByRange(sid, from, to),
    enabled: !!sid,
  });

  const locksQ = useQuery({
    queryKey: ["work-month-locks", sid, y, m],
    queryFn: () => fetchWorkMonthLocks({ staff: sid, year: y, month: m }),
    enabled: !!sid,
  });

  if (!sid || !staffQ.data) return null;

  const staff = staffQ.data;
  const summary = summaryQ.data;
  const locked = isLockedFromLocks(locksQ.data);
  const canManage = !!meQ.data?.is_payroll_manager;

  return (
    <>
      {/* Backdrop */}
      <div
        className="fixed inset-0 z-40 bg-black/50"
        onClick={() => navigate(-1)}
      />

      {/* Overlay */}
      <div className="fixed inset-0 z-50 flex justify-center items-start p-6">
        <div className="w-full max-w-[1200px] max-h-[90vh] overflow-auto rounded-xl bg-[var(--bg-surface)] shadow-xl">
          {/* Top Banner (ì›” ë§ˆê° UX ì„íŒ©íŠ¸) */}
          {locked && (
            <div className="px-6 py-3 border-b border-[color-mix(in_srgb,var(--color-danger)_55%,transparent)] bg-[var(--color-danger-soft)]">
              <div className="flex items-center justify-between gap-3">
                <div className="flex items-center gap-2">
                  <LockBadge state="LOCKED" />
                  <div className="text-sm font-semibold text-[var(--color-danger)]">
                    ì´ë²ˆë‹¬ì€ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤. (ê¸‰ì—¬ í™•ì •)
                  </div>
                </div>
                <div className="text-xs text-[var(--text-muted)]">
                  ë§ˆê°ëœ ì›”ì€ ê·¼ë¬´/ë¹„ìš© ìƒì„±Â·ìˆ˜ì •Â·ì‚­ì œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.
                </div>
              </div>
            </div>
          )}

          {/* Action Bar */}
          <div className="flex justify-end gap-2 px-6 py-3 border-b border-[var(--border-divider)]">
            {canManage && (
              <ActionButton variant="secondary" size="sm">
                ìˆ˜ì •
              </ActionButton>
            )}

            {canManage && (
              <ActionButton
                variant="danger-outline"
                size="sm"
                title="ì‚­ì œëŠ” ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
                onClick={() => {
                  if (!confirm("ì§ì›ì„ ì‚­ì œí• ê¹Œìš”? ì—°ê²°ëœ ë°ì´í„°ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.")) return;
                  alert("ì‚­ì œ API ì—°ê²° í•„ìš” (StaffSettingsTabì˜ ì‚­ì œ ë¡œì§ì„ ì¬ì‚¬ìš©í•˜ì„¸ìš”).");
                }}
              >
                ì‚­ì œ
              </ActionButton>
            )}

            <ActionButton variant="outline" size="sm" onClick={() => navigate(-1)}>
              ë‹«ê¸°
            </ActionButton>
          </div>

          {/* Body */}
          <div className="flex gap-5 p-6">
            {/* LEFT */}
            <div className="w-[280px] shrink-0 space-y-4">
              <div className="rounded-lg border border-[var(--border-divider)] bg-[var(--bg-surface-soft)] p-4 space-y-3">
                <div className="flex items-center justify-between">
                  <div className="text-lg font-semibold flex items-center gap-2">
                    <StaffRoleAvatar role={staff.role} size={24} className="shrink-0 text-[var(--color-text-secondary)]" />
                    {staff.name}
                    {staff.user_is_staff && (
                      <span className="ds-status-badge" data-tone="primary">
                        STAFF
                      </span>
                    )}
                  </div>
                  <span
                    className="ds-status-badge"
                    data-status={staff.is_active ? "active" : "inactive"}
                  >
                    {staff.is_active ? "í™œì„±" : "ë¹„í™œì„±"}
                  </span>
                </div>

                <Divider />

                <Info label="ê³„ì •" value={staff.user_username || "ê³„ì • ì—†ìŒ"} />
                <Info label="ì „í™”ë²ˆí˜¸" value={staff.phone || "-"} />
                <Info
                  label="ê¸‰ì—¬ìœ í˜•"
                  value={staff.pay_type === "HOURLY" ? "ì‹œê¸‰" : "ì›”ê¸‰"}
                />

                <div className="flex items-center justify-between text-sm">
                  <span className="text-[var(--color-text-muted)]">ì—­í• </span>
                  <span className="ds-status-badge" data-tone={staff.role === "TEACHER" ? "primary" : "neutral"}>
                    {staff.role === "TEACHER" ? "ê°•ì‚¬" : "ì¡°êµ"}
                  </span>
                </div>
                <div className="flex items-center justify-between text-sm">
                  <span className="text-[var(--color-text-muted)]">ê´€ë¦¬ì</span>
                  {canManage ? (
                    <StaffManagerToggle staffId={staff.id} isManager={!!staff.is_manager} />
                  ) : (
                    <span className="ds-status-badge" data-status={staff.is_manager ? "active" : "inactive"}>
                      {staff.is_manager ? "ON" : "OFF"}
                    </span>
                  )}
                </div>
              </div>

              <div className="rounded-lg border border-[var(--border-divider)] p-4 space-y-2 bg-[var(--bg-surface)]">
                <div className="text-sm font-semibold">ì´ë²ˆë‹¬ ìš”ì•½</div>
                <Info label="ê·¼ë¬´ì‹œê°„" value={`${summary?.work_hours ?? 0} h`} />
                <Info
                  label="ì§€ê¸‰ì•¡"
                  value={`${(summary?.total_amount ?? 0).toLocaleString()} ì›`}
                />

                <div className="flex items-center justify-between text-sm">
                  <span className="text-[var(--text-muted)]">ë§ˆê°ìƒíƒœ</span>
                  <div className="flex items-center gap-2">
                    <LockBadge state={locked ? "LOCKED" : "OPEN"} compact />
                    <span
                      className={[
                        "font-semibold",
                        locked
                          ? "text-[var(--color-danger)]"
                          : "text-[var(--color-success)]",
                      ].join(" ")}
                    >
                      {locked ? "ê¸‰ì—¬ í™•ì •" : "ì§„í–‰ì¤‘"}
                    </span>
                  </div>
                </div>
              </div>
            </div>

            {/* RIGHT â€” í”Œë«íƒ­ + íŒ¨ë„ */}
            <div className="flex-1 flex flex-col min-h-0">
              {(() => {
                const items = [
                  { key: "summary", label: "ìš”ì•½", children: <StaffSummaryTab staffId={sid} /> },
                  { key: "worktype", label: "ì‹œê¸‰Â·ê·¼ë¬´ìœ í˜•", children: <StaffWorkTypeTab staffId={sid} /> },
                  { key: "records", label: "ê·¼ë¬´ê¸°ë¡", children: <StaffWorkRecordsTab staffId={sid} /> },
                  { key: "expenses", label: "ë¹„ìš©", children: <StaffExpensesTab staffId={sid} /> },
                  { key: "history", label: "ê¸‰ì—¬ íˆìŠ¤í† ë¦¬", children: <StaffPayrollHistoryTab /> },
                  { key: "report", label: "ë¦¬í¬íŠ¸", children: <StaffReportTab /> },
                  ...(canManage ? [{ key: "settings", label: "ì„¤ì •", children: <StaffSettingsTab /> }] : []),
                ];
                return (
                  <>
                    <div className="ds-tabs ds-tabs--flat border-b border-[var(--color-border-divider)] mb-3" role="tablist">
                      {items.map((t) => (
                        <button
                          key={t.key}
                          type="button"
                          role="tab"
                          aria-selected={tab === t.key}
                          onClick={() => setTab(t.key)}
                          className={`ds-tab ${tab === t.key ? "is-active" : ""}`}
                        >
                          {t.label}
                        </button>
                      ))}
                    </div>
                    <div className="flex-1 min-h-0 overflow-auto">
                      {items.find((i) => i.key === tab)?.children}
                    </div>
                  </>
                );
              })()}
            </div>
          </div>
        </div>
      </div>
    </>
  );
}

function Info({
  label,
  value,
  valueClass,
}: {
  label: string;
  value: any;
  valueClass?: string;
}) {
  return (
    <div className="flex justify-between text-sm">
      <span className="text-[var(--text-muted)]">{label}</span>
      <span className={`font-semibold ${valueClass ?? ""}`}>{value || "-"}</span>
    </div>
  );
}

function Divider() {
  return <div className="h-px bg-[var(--border-divider)]" />;
}


==========================================================================================
# FILE: overlays/StaffDetailOverlay/StaffExpensesTab.tsx
==========================================================================================
// PATH: src/features/staff/overlays/StaffDetailOverlay/StaffExpensesTab.tsx
import { useMemo } from "react";
import { useQuery } from "@tanstack/react-query";

import { useExpenses } from "../../hooks/useExpenses";
import { fetchWorkMonthLocks, isLockedFromLocks } from "../../api/workMonthLocks.api";
import { fetchStaffMe } from "../../api/staffMe.api";

import ActionButton from "../../components/ActionButton";
import { ExpenseStatusBadge, LockBadge } from "../../components/StatusBadge";

function getThisMonthRange() {
  const d = new Date();
  const y = d.getFullYear();
  const m = d.getMonth() + 1;
  const from = `${y}-${String(m).padStart(2, "0")}-01`;
  const last = new Date(y, m, 0).getDate();
  const to = `${y}-${String(m).padStart(2, "0")}-${String(last).padStart(2, "0")}`;
  return { y, m, from, to };
}

function fmtDateTime(v?: string | null) {
  if (!v) return "-";
  const d = new Date(v);
  if (Number.isNaN(d.getTime())) return "-";
  return d.toLocaleString();
}

export default function StaffExpensesTab({ staffId }: { staffId: number }) {
  const { y, m, from, to } = useMemo(getThisMonthRange, []);
  const expenses = useExpenses({ staff: staffId, date_from: from, date_to: to });

  const locksQ = useQuery({
    queryKey: ["work-month-locks", staffId, y, m],
    queryFn: () => fetchWorkMonthLocks({ staff: staffId, year: y, month: m }),
  });

  const meQ = useQuery({
    queryKey: ["staff-me"],
    queryFn: fetchStaffMe,
  });

  const canManage = !!meQ.data?.is_payroll_manager;
  const locked = isLockedFromLocks(locksQ.data);
  const rows = expenses.listQ.data ?? [];

  return (
    <div className="space-y-3 max-w-[740px]">
      <div className="flex justify-between items-center">
        <div className="text-sm font-semibold">ë¹„ìš©</div>
        {locked && <LockBadge state="LOCKED" />}
      </div>

      {locked && (
        <div className="text-xs text-[var(--color-danger)]">
          * ë§ˆê°ëœ ì›”ì€ ë¹„ìš© ë³€ê²½(ìŠ¹ì¸/ë°˜ë ¤ í¬í•¨)ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.
        </div>
      )}

      {rows.length === 0 && (
        <div className="text-sm text-[var(--text-muted)]">ë¹„ìš© ì—†ìŒ</div>
      )}

      <div className={locked ? "opacity-95" : ""}>
        {rows.map((e) => {
          const isPending = e.status === "PENDING";
          const actionDisabled = locked || expenses.patchM.isPending;

          return (
            <div
              key={e.id}
              className="rounded-lg border border-[var(--border-divider)] px-4 py-3 text-sm bg-[var(--bg-surface)] space-y-2"
            >
              <div className="flex justify-between gap-3">
                <div className="space-y-1">
                  <div className="font-medium">
                    {e.date} Â· {e.title}
                  </div>

                  <div className="flex items-center gap-2">
                    <ExpenseStatusBadge status={e.status} />
                    {e.status !== "PENDING" && (
                      <div className="text-xs text-[var(--text-muted)]">
                        ìŠ¹ì¸ì: {e.approved_by_name ?? "-"} Â· {fmtDateTime(e.approved_at)}
                      </div>
                    )}
                  </div>

                  {!!e.memo && (
                    <div className="text-xs text-[var(--text-muted)]">ë©”ëª¨: {e.memo}</div>
                  )}
                </div>

                <div className="font-semibold">{e.amount.toLocaleString()}ì›</div>
              </div>

              {canManage && (
                <div className="flex items-center justify-end gap-2">
                  <ActionButton
                    variant="success"
                    size="xs"
                    disabledReason={
                      actionDisabled
                        ? locked
                          ? "ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤."
                          : "ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤."
                        : !isPending
                        ? "ëŒ€ê¸° ìƒíƒœì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤."
                        : ""
                    }
                    onClick={() => {
                      if (actionDisabled || !isPending) return;
                      if (!confirm("ì´ ë¹„ìš©ì„ ìŠ¹ì¸í• ê¹Œìš”?")) return;
                      expenses.patchM.mutate({ id: e.id, payload: { status: "APPROVED" } });
                    }}
                  >
                    ìŠ¹ì¸
                  </ActionButton>

                  <ActionButton
                    variant="danger-outline"
                    size="xs"
                    disabledReason={
                      actionDisabled
                        ? locked
                          ? "ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤."
                          : "ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤."
                        : !isPending
                        ? "ëŒ€ê¸° ìƒíƒœì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤."
                        : ""
                    }
                    onClick={() => {
                      if (actionDisabled || !isPending) return;
                      if (!confirm("ì´ ë¹„ìš©ì„ ë°˜ë ¤í• ê¹Œìš”?")) return;
                      expenses.patchM.mutate({ id: e.id, payload: { status: "REJECTED" } });
                    }}
                  >
                    ë°˜ë ¤
                  </ActionButton>
                </div>
              )}
            </div>
          );
        })}
      </div>

      <div className="text-[11px] text-[var(--text-muted)]">
        * ë¹„ìš© ìƒíƒœ/ìŠ¹ì¸ì€ ì„œë²„ ê¸°ì¤€ì´ë©°, í”„ë¡ íŠ¸ëŠ” í‘œì‹œ/ì•¡ì…˜ë§Œ ìˆ˜í–‰í•©ë‹ˆë‹¤.
      </div>
    </div>
  );
}


==========================================================================================
# FILE: overlays/StaffDetailOverlay/StaffPayrollHistoryTab.tsx
==========================================================================================
// PATH: src/features/staff/overlays/StaffDetailOverlay/StaffPayrollHistoryTab.tsx
import PayrollHistoryTable from "../../pages/ReportsPage/PayrollHistoryTable";

export default function StaffPayrollHistoryTab() {
  return (
    <div className="space-y-3">
      <div className="space-y-1">
        <div className="text-sm font-semibold">ê¸‰ì—¬ íˆìŠ¤í† ë¦¬</div>
        <div className="text-xs text-[var(--text-muted)]">
          * ê¸‰ì—¬ëŠ” <b>ì›” ë§ˆê° ì‹œì  PayrollSnapshot</b> ê¸°ì¤€ì´ë©° ì´í›„ ìˆ˜ì • ë¶ˆê°€í•©ë‹ˆë‹¤.
        </div>
      </div>

      <PayrollHistoryTable />
    </div>
  );
}


==========================================================================================
# FILE: overlays/StaffDetailOverlay/StaffPayrollTab.tsx
==========================================================================================
// PATH: src/features/staff/overlays/StaffDetailOverlay/StaffPayrollTab.tsx
import { useParams } from "react-router-dom";
import { usePayrollSnapshots } from "../../hooks/usePayrollSnapshots";

export default function StaffPayrollTab() {
  const { staffId } = useParams();
  const sid = Number(staffId);

  const { data, isLoading } = usePayrollSnapshots({ staff: sid });

  if (isLoading) {
    return <div className="text-sm text-[var(--text-muted)]">Loading payroll...</div>;
  }

  if (!data || data.length === 0) {
    return <div className="text-sm text-[var(--text-muted)]">ê¸‰ì—¬ ë°ì´í„° ì—†ìŒ</div>;
  }

  return (
    <div className="space-y-2">
      {data.map((p) => (
        <div
          key={p.id}
          className="flex justify-between rounded-lg border border-[var(--border-divider)] px-4 py-2 text-sm"
        >
          <div>
            {p.year}-{String(p.month).padStart(2, "0")}
          </div>
          <div className="font-semibold">
            {p.total_amount.toLocaleString()} ì›
          </div>
        </div>
      ))}

      <div className="text-xs text-[var(--text-muted)]">
        * ê¸‰ì—¬ëŠ” ìˆ˜ì • ë¶ˆê°€í•˜ë©° PayrollSnapshot ê¸°ì¤€ìœ¼ë¡œë§Œ í‘œì‹œë©ë‹ˆë‹¤.
      </div>
    </div>
  );
}


==========================================================================================
# FILE: overlays/StaffDetailOverlay/StaffReportTab.tsx
==========================================================================================
ï»¿// PATH: src/features/staff/overlays/StaffDetailOverlay/StaffReportTab.tsx

import { useMemo, useState } from "react";
import { useParams } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";
import { Panel } from "@/shared/ui/ds";


import { fetchStaffSummaryByRange } from "../../api/staff.detail.api";

function todayISO() {
  return new Date().toISOString().slice(0, 10);
}

function getMonthBoundsFrom(dateISO: string) {
  const y = Number(dateISO.slice(0, 4));
  const m = Number(dateISO.slice(5, 7));
  const from = `${y}-${String(m).padStart(2, "0")}-01`;
  const lastDay = new Date(y, m, 0).getDate();
  const to = `${y}-${String(m).padStart(2, "0")}-${String(lastDay).padStart(2, "0")}`;
  return { from, to };
}

export default function StaffReportTab() {
  const { staffId } = useParams();
  const sid = Number(staffId);

  const [range] = useState(() => getMonthBoundsFrom(todayISO()));
  const monthLabel = useMemo(() => `${range.from} ~ ${range.to}`, [range.from, range.to]);

  const summaryQ = useQuery({
    queryKey: ["staff-report-summary", sid, range.from, range.to],
    queryFn: () => fetchStaffSummaryByRange(sid, range.from, range.to),
    enabled: !!sid,
  });

  if (summaryQ.isLoading) {
    return <div className="text-sm text-[var(--text-muted)]">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>;
  }

  if (!summaryQ.data) {
    return <div className="text-sm text-[var(--text-muted)]">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>;
  }

  const s = summaryQ.data;

  return (
    <div className="space-y-4">
      <div className="flex items-end justify-between gap-3">
        <div className="space-y-1">
          <div className="text-sm font-semibold">ë¦¬í¬íŠ¸</div>
          <div className="text-xs text-[var(--text-muted)]">ê¸°ê°„: {monthLabel}</div>
        </div>
      </div>

      <Card>
        <CardBody className="grid grid-cols-2 gap-4 sm:grid-cols-4">
          <Item label="ê·¼ë¬´ì‹œê°„" value={`${s.work_hours} h`} />
          <Item label="ê¸‰ì—¬" value={`${s.work_amount.toLocaleString()} ì›`} />
          <Item label="ë¹„ìš©" value={`${s.expense_amount.toLocaleString()} ì›`} />
          <Item label="ì‹¤ ì§€ê¸‰ì•¡" value={`${s.total_amount.toLocaleString()} ì›`} primary />
        </CardBody>
      </Card>

      <div className="text-xs text-[var(--text-muted)]">
        * ë¦¬í¬íŠ¸ ìˆ˜ì¹˜ëŠ” <b>ì„œë²„ ì§‘ê³„ ê²°ê³¼(Summary API)</b> ê¸°ì¤€ì…ë‹ˆë‹¤.
      </div>
    </div>
  );
}

function Item({ label, value, primary }: { label: string; value: string; primary?: boolean }) {
  return (
    <div className="rounded-lg border border-[var(--border-divider)] bg-[var(--bg-surface-soft)] px-4 py-3">
      <div className="text-xs text-[var(--text-muted)]">{label}</div>
      <div
        className={[
          "mt-1 text-lg font-semibold",
          primary ? "text-[var(--color-primary)]" : "text-[var(--text-primary)]",
        ].join(" ")}
      >
        {value}
      </div>
    </div>
  );
}


==========================================================================================
# FILE: overlays/StaffDetailOverlay/StaffSettingsTab.tsx
==========================================================================================
// PATH: src/features/staff/overlays/StaffDetailOverlay/StaffSettingsTab.tsx
import { useEffect, useState } from "react";
import { useParams, useNavigate } from "react-router-dom";
import { useMutation, useQuery, useQueryClient } from "@tanstack/react-query";

import { fetchStaffDetail, patchStaffDetail, StaffDetail } from "../../api/staff.detail.api";
import { fetchStaffMe } from "../../api/staffMe.api";
import api from "@/shared/api/axios";

export default function StaffSettingsTab() {
  const { staffId } = useParams();
  const sid = Number(staffId);
  const nav = useNavigate();
  const qc = useQueryClient();

  const meQ = useQuery({
    queryKey: ["staff-me"],
    queryFn: fetchStaffMe,
  });

  const canManage = !!meQ.data?.is_payroll_manager;

  const detailQ = useQuery({
    queryKey: ["staff", sid],
    queryFn: () => fetchStaffDetail(sid),
    enabled: !!sid,
  });

  const patchM = useMutation({
    mutationFn: (payload: Partial<StaffDetail>) => patchStaffDetail(sid, payload),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["staff", sid] });
      alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    },
  });

  const deleteM = useMutation({
    mutationFn: async () => {
      await api.delete(`/staffs/${sid}/`);
    },
    onSuccess: async () => {
      alert("ì§ì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
      await qc.invalidateQueries({ queryKey: ["staffs"] });
      nav("/admin/staff");
    },
  });

  const [form, setForm] = useState({
    name: "",
    phone: "",
    is_active: true,
    pay_type: "HOURLY" as "HOURLY" | "MONTHLY",
  });

  useEffect(() => {
    if (!detailQ.data) return;
    setForm({
      name: detailQ.data.name || "",
      phone: detailQ.data.phone || "",
      is_active: detailQ.data.is_active,
      pay_type: detailQ.data.pay_type,
    });
  }, [detailQ.data]);

  if (!canManage) {
    return <div className="text-sm text-[var(--text-muted)]">ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.</div>;
  }

  if (detailQ.isLoading || !detailQ.data) {
    return <div className="text-sm text-[var(--text-muted)]">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>;
  }

  return (
    <div className="max-w-[520px] space-y-6">
      <div className="space-y-3">
        <Field label="ì´ë¦„">
          <input
            value={form.name}
            onChange={(e) => setForm((p) => ({ ...p, name: e.target.value }))}
            className="form-input"
          />
        </Field>

        <Field label="ì „í™”ë²ˆí˜¸">
          <input
            value={form.phone}
            onChange={(e) => setForm((p) => ({ ...p, phone: e.target.value }))}
            className="form-input"
          />
        </Field>

        <Field label="ê¸‰ì—¬ ìœ í˜•">
          <span className="inline-flex rounded-md border border-[var(--border-divider)] p-0.5 bg-[var(--bg-surface-soft)]">
            <button
              type="button"
              onClick={() => setForm((p) => ({ ...p, pay_type: "HOURLY" }))}
              className={[
                "px-3 py-1.5 text-sm font-semibold rounded transition-colors",
                form.pay_type === "HOURLY"
                  ? "bg-[var(--color-brand-primary)] text-[var(--color-text-inverse)]"
                  : "text-[var(--color-text-secondary)] hover:bg-[var(--bg-surface)]",
              ].join(" ")}
            >
              ì‹œê¸‰
            </button>
            <button
              type="button"
              onClick={() => setForm((p) => ({ ...p, pay_type: "MONTHLY" }))}
              className={[
                "px-3 py-1.5 text-sm font-semibold rounded transition-colors",
                form.pay_type === "MONTHLY"
                  ? "bg-[var(--color-brand-primary)] text-[var(--color-text-inverse)]"
                  : "text-[var(--color-text-secondary)] hover:bg-[var(--bg-surface)]",
              ].join(" ")}
            >
              ì›”ê¸‰
            </button>
          </span>
        </Field>

        <label className="flex items-center gap-2 text-sm">
          <input
            type="checkbox"
            checked={form.is_active}
            onChange={(e) => setForm((p) => ({ ...p, is_active: e.target.checked }))}
          />
          í™œì„±
        </label>
      </div>

      <div className="flex items-center justify-between pt-4 border-t border-[var(--border-divider)]">
        <button
          onClick={() => patchM.mutate(form)}
          className="btn-primary"
          disabled={patchM.isPending}
        >
          ì €ì¥
        </button>

        <button
          onClick={() => {
            if (!confirm("ì§ì›ì„ ì‚­ì œí• ê¹Œìš”? ì—°ê²°ëœ ë°ì´í„°ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.")) return;
            deleteM.mutate();
          }}
          className="btn-danger"
        >
          ì§ì› ì‚­ì œ
        </button>
      </div>
    </div>
  );
}

function Field({ label, children }: { label: string; children: React.ReactNode }) {
  return (
    <div className="space-y-1">
      <div className="text-xs font-medium text-[var(--text-muted)]">{label}</div>
      {children}
    </div>
  );
}


==========================================================================================
# FILE: overlays/StaffDetailOverlay/StaffSummaryTab.tsx
==========================================================================================
ï»¿// PATH: src/features/staff/overlays/StaffDetailOverlay/StaffSummaryTab.tsx
import { useQuery } from "@tanstack/react-query";
import { fetchStaffSummaryByRange } from "../../api/staff.detail.api";
import { fetchWorkMonthLocks, isLockedFromLocks } from "../../api/workMonthLocks.api";
import { LockBadge } from "../../components/StatusBadge";

export default function StaffSummaryTab({ staffId }: { staffId: number }) {
  const now = new Date();
  const y = now.getFullYear();
  const m = now.getMonth() + 1;

  const from = `${y}-${String(m).padStart(2, "0")}-01`;
  const last = new Date(y, m, 0).getDate();
  const to = `${y}-${String(m).padStart(2, "0")}-${String(last).padStart(2, "0")}`;

  const summaryQ = useQuery({
    queryKey: ["staff-summary", staffId, from, to],
    queryFn: () => fetchStaffSummaryByRange(staffId, from, to),
  });

  const locksQ = useQuery({
    queryKey: ["work-month-locks", staffId, y, m],
    queryFn: () => fetchWorkMonthLocks({ staff: staffId, year: y, month: m }),
  });

  if (!summaryQ.data) {
    return <div className="text-sm text-[var(--text-muted)]">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>;
  }

  const locked = isLockedFromLocks(locksQ.data);
  const s = summaryQ.data;

  return (
    <div className="space-y-4">
      <div
        className={[
          "rounded-xl border px-4 py-3 flex justify-between items-center",
          locked
            ? "border-[color-mix(in_srgb,var(--color-danger)_55%,transparent)] bg-[var(--color-danger-soft)]"
            : "border-[var(--border-divider)] bg-[var(--bg-surface-soft)]",
        ].join(" ")}
      >
        <div>
          <div className="text-sm font-semibold">ì´ë²ˆë‹¬ ìš”ì•½</div>
          <div className="text-xs text-[var(--text-muted)]">
            {from} ~ {to}
          </div>
        </div>

        <div className="flex items-center gap-2">
          <LockBadge state={locked ? "LOCKED" : "OPEN"} />
          <span
            className={`text-sm font-semibold ${
              locked
                ? "text-[var(--color-danger)]"
                : "text-[var(--color-success)]"
            }`}
          >
            {locked ? "ê¸‰ì—¬ í™•ì •" : "ì§„í–‰ì¤‘"}
          </span>
        </div>
      </div>

      <div className="grid grid-cols-2 sm:grid-cols-4 gap-4">
        <Item label="ê·¼ë¬´ì‹œê°„" value={`${s.work_hours} h`} />
        <Item label="ê¸‰ì—¬" value={s.work_amount.toLocaleString()} />
        <Item label="ë¹„ìš©" value={s.expense_amount.toLocaleString()} />
        <Item label="ì‹¤ì§€ê¸‰ì•¡" value={s.total_amount.toLocaleString()} primary />
      </div>
    </div>
  );
}

function Item({
  label,
  value,
  primary,
}: {
  label: string;
  value: string;
  primary?: boolean;
}) {
  return (
    <div className="rounded-lg border border-[var(--border-divider)] bg-[var(--bg-surface-soft)] px-4 py-3">
      <div className="text-xs text-[var(--text-muted)]">{label}</div>
      <div
        className={`mt-1 text-lg font-semibold ${
          primary ? "text-[var(--color-primary)]" : ""
        }`}
      >
        {value}
      </div>
    </div>
  );
}


==========================================================================================
# FILE: overlays/StaffDetailOverlay/StaffWorkRecordsTab.tsx
==========================================================================================
// PATH: src/features/staff/overlays/StaffDetailOverlay/StaffWorkRecordsTab.tsx
import { useMemo } from "react";
import { useWorkRecords } from "../../hooks/useWorkRecords";
import { fetchWorkMonthLocks, isLockedFromLocks } from "../../api/workMonthLocks.api";
import { useQuery } from "@tanstack/react-query";
import { LockBadge } from "../../components/StatusBadge";
import ActionButton from "../../components/ActionButton";

function getThisMonthRange() {
  const d = new Date();
  const y = d.getFullYear();
  const m = d.getMonth() + 1;
  const from = `${y}-${String(m).padStart(2, "0")}-01`;
  const last = new Date(y, m, 0).getDate();
  const to = `${y}-${String(m).padStart(2, "0")}-${String(last).padStart(2, "0")}`;
  return { y, m, from, to };
}

export default function StaffWorkRecordsTab({ staffId }: { staffId: number }) {
  const { y, m, from, to } = useMemo(getThisMonthRange, []);
  const recordsQ = useWorkRecords({ staff: staffId, date_from: from, date_to: to });

  const locksQ = useQuery({
    queryKey: ["work-month-locks", staffId, y, m],
    queryFn: () => fetchWorkMonthLocks({ staff: staffId, year: y, month: m }),
  });

  const locked = isLockedFromLocks(locksQ.data);
  const rows = recordsQ.listQ.data ?? [];

  return (
    <div className="space-y-3 max-w-[720px]">
      <div className="flex justify-between items-center">
        <div className="flex items-center gap-2">
          <div className="text-sm font-semibold">ê·¼ë¬´ê¸°ë¡</div>
          {locked && <LockBadge state="LOCKED" />}
        </div>
      </div>

      {locked && (
        <div className="text-xs text-[var(--color-danger)]">
          * ë§ˆê°ëœ ì›”ì€ ê·¼ë¬´ê¸°ë¡ ë³€ê²½ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.
        </div>
      )}

      {rows.length === 0 && (
        <div className="text-sm text-[var(--text-muted)]">ê¸°ë¡ ì—†ìŒ</div>
      )}

      <div className={locked ? "opacity-95" : ""}>
        {rows.map((r) => (
          <div
            key={r.id}
            className="flex justify-between rounded-lg border border-[var(--border-divider)] px-4 py-2 text-sm bg-[var(--bg-surface)]"
          >
            <div>
              <div className="font-medium">
                {r.date} Â· {r.work_type_name}
              </div>
              <div className="text-xs text-[var(--text-muted)]">
                {r.start_time} ~ {r.end_time}
              </div>
            </div>

            <div className="flex items-center gap-3">
              <div className="font-semibold">
                {r.amount.toLocaleString()}ì›
              </div>

              <ActionButton
                variant="danger-outline"
                size="xs"
                disabledReason={locked ? "ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤." : ""}
                onClick={() => {
                  if (locked) return;
                  if (!confirm("ì´ ê·¼ë¬´ ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?")) return;
                  recordsQ.deleteM.mutate(r.id);
                }}
              >
                ì‚­ì œ
              </ActionButton>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}


==========================================================================================
# FILE: overlays/StaffDetailOverlay/StaffWorkTypeTab.tsx
==========================================================================================
// PATH: src/features/staff/overlays/StaffDetailOverlay/StaffWorkTypeTab.tsx
// ì‹œê¸‰íƒœê·¸ â€” í•™ìƒ íƒœê·¸ ë””ìì¸ ì¹´í”¼ (ë±ƒì§€ + ì¶”ê°€/ì œê±°)
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import {
  fetchStaffWorkTypes,
  fetchWorkTypes,
  createStaffWorkType,
  deleteStaffWorkType,
} from "../../api/staffWorkType.api";
import type { StaffWorkType } from "../../api/staffWorkType.api";

const LIGHT_COLORS = ["#eab308", "#06b6d4"];
const isLight = (c: string) =>
  LIGHT_COLORS.some((x) => String(c || "").toLowerCase() === x);

function WageBadge({
  st,
  onRemove,
  isRemoving,
}: {
  st: StaffWorkType;
  onRemove: () => void;
  isRemoving: boolean;
}) {
  const wt = st.work_type;
  const color = wt?.color || "#6b7280";
  const name = wt?.name || "â€”";
  const wage =
    st.effective_hourly_wage ?? wt?.base_hourly_wage ?? null;
  const label =
    wage != null ? `${name} ${(wage / 10000).toFixed(1)}ë§Œ` : name;

  return (
    <span
      className="inline-flex items-center gap-1 group cursor-default"
      style={{
        padding: "6px 10px 6px 12px",
        borderRadius: "6px 6px 6px 2px",
        fontSize: 12,
        fontWeight: 700,
        background: color,
        color: isLight(color) ? "#1a1a1a" : "#fff",
        border: "none",
        boxShadow: "0 1px 3px rgba(0,0,0,0.15)",
        textShadow: isLight(color) ? "none" : "0 0 1px rgba(0,0,0,0.2)",
      }}
      title={wage != null ? `${wage.toLocaleString()}ì›/ì‹œ` : name}
    >
      {label}
      <button
        type="button"
        onClick={(e) => {
          e.stopPropagation();
          onRemove();
        }}
        disabled={isRemoving}
        aria-label={`${name} ê·¼ë¬´ìœ í˜• ì œê±°`}
        style={{
          marginLeft: 4,
          padding: 0,
          width: 16,
          height: 16,
          borderRadius: 999,
          border: "none",
          background: "rgba(0,0,0,0.2)",
          color: "#fff",
          fontSize: 12,
          cursor: isRemoving ? "wait" : "pointer",
          display: "grid",
          placeItems: "center",
          lineHeight: 1,
        }}
      >
        Ã—
      </button>
    </span>
  );
}

export default function StaffWorkTypeTab({ staffId }: { staffId: number }) {
  const qc = useQueryClient();

  const staffTypesQ = useQuery({
    queryKey: ["staff-work-types", staffId],
    queryFn: () => fetchStaffWorkTypes(staffId),
  });

  const workTypesQ = useQuery({
    queryKey: ["work-types"],
    queryFn: () => fetchWorkTypes({ is_active: true }),
  });

  const createM = useMutation({
    mutationFn: (payload: { work_type_id: number }) =>
      createStaffWorkType(staffId, payload),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["staff-work-types", staffId] });
      qc.invalidateQueries({ queryKey: ["staff", staffId] });
      qc.invalidateQueries({ queryKey: ["staffs"] });
    },
  });

  const deleteM = useMutation({
    mutationFn: deleteStaffWorkType,
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["staff-work-types", staffId] });
      qc.invalidateQueries({ queryKey: ["staff", staffId] });
      qc.invalidateQueries({ queryKey: ["staffs"] });
    },
  });

  const staffTypes = staffTypesQ.data ?? [];
  const workTypes = workTypesQ.data ?? [];
  const availableToAdd = workTypes.filter(
    (wt) => !staffTypes.some((st) => st.work_type.id === wt.id)
  );

  return (
    <div className="space-y-4 max-w-[640px]">
      <div
        style={{
          fontSize: 11,
          fontWeight: 800,
          marginBottom: 8,
          color: "var(--color-text-muted)",
          letterSpacing: "0.04em",
          textTransform: "uppercase",
        }}
      >
        ì‹œê¸‰ Â· ê·¼ë¬´ìœ í˜•
      </div>

      {staffTypes.length === 0 && (
        <div className="rounded-xl border border-[var(--border-divider)] bg-[var(--bg-surface-soft)] px-4 py-3 text-sm">
          <div className="font-semibold">ê·¼ë¬´ìœ í˜•ì´ ì—†ìŠµë‹ˆë‹¤.</div>
          <div className="text-xs text-[var(--color-text-muted)] mt-1">
            * ê·¼ë¬´ê¸°ë¡ì„ ì…ë ¥í•˜ë ¤ë©´ ìµœì†Œ 1ê°œì˜ ê·¼ë¬´ìœ í˜•ì´ í•„ìš”í•©ë‹ˆë‹¤.
          </div>
        </div>
      )}

      <div className="flex flex-wrap gap-2">
        {staffTypes.map((st) => (
          <WageBadge
            key={st.id}
            st={st}
            onRemove={() => {
              if (!confirm(`"${st.work_type.name}" ê·¼ë¬´ìœ í˜•ì„ ì œê±°í• ê¹Œìš”?`))
                return;
              deleteM.mutate(st.id);
            }}
            isRemoving={deleteM.isPending}
          />
        ))}
      </div>

      <div className="pt-4 border-t border-[var(--border-divider)]">
        <div className="text-xs text-[var(--color-text-muted)] mb-2">
          ê·¼ë¬´ìœ í˜• ì¶”ê°€
        </div>
        <div className="flex flex-wrap gap-2 items-center">
          {availableToAdd.length > 0 ? (
            <select
              className="ds-input"
              style={{ fontSize: 13, minWidth: 160 }}
              value=""
              onChange={(e) => {
                const id = Number(e.target.value);
                if (!id) return;
                createM.mutate({ work_type_id: id });
                e.target.value = "";
              }}
              disabled={createM.isPending}
            >
              <option value="">ê¸°ì¡´ ìœ í˜• ì„ íƒâ€¦</option>
              {availableToAdd.map((wt) => (
                <option key={wt.id} value={wt.id}>
                  {wt.name} ({wt.base_hourly_wage?.toLocaleString()}ì›/ì‹œ)
                </option>
              ))}
            </select>
          ) : (
            <span className="text-sm text-[var(--color-text-muted)]">
              ì¶”ê°€í•  ê·¼ë¬´ìœ í˜•ì´ ì—†ìŠµë‹ˆë‹¤.
            </span>
          )}
        </div>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: overlays/StaffDetailOverlay/index.ts
==========================================================================================
ï»¿


==========================================================================================
# FILE: pages/index.ts
==========================================================================================
ï»¿


==========================================================================================
# FILE: pages/AttendancePage/AttendancePage.tsx
==========================================================================================
// PATH: src/features/staff/pages/AttendancePage/AttendancePage.tsx
// ê·¼íƒœ: ì¢Œì¸¡ DB ì§ì› ì„ íƒ, ìš°ì¸¡ ê·¼ë¬´ ê¸°ë¡.
// â€» íƒ­ ì•„ë˜ "ê·¼íƒœ" í° ë‚´ë¶€ í—¤ë” ì—†ìŒ (ë„ë©”ì¸ í—¤ë”Â·íƒ­ë§Œ ì‚¬ìš©).

import { useMemo } from "react";
import { useSearchParams } from "react-router-dom";
import { WorkMonthProvider } from "../../operations/context/WorkMonthContext";
import StaffOperationTable from "../OperationsPage/StaffOperationTable";
import WorkRecordsPanel from "../OperationsPage/WorkRecordsPanel";
import { EmptyState } from "@/shared/ui/ds";

function getThisMonth() {
  const d = new Date();
  return { year: d.getFullYear(), month: d.getMonth() + 1 };
}

function ymLabel(y: number, m: number) {
  return `${y}ë…„ ${m}ì›”`;
}

export default function AttendancePage() {
  const [params] = useSearchParams();
  const staffId = Number(params.get("staffId"));
  const { year, month } = useMemo(getThisMonth, []);
  const monthText = useMemo(() => ymLabel(year, month), [year, month]);

  return (
    <div className="grid grid-cols-[320px_1fr] gap-6" data-no-internal-header>
        <div className="ds-panel-card">
          <div className="ds-panel-card__header px-4 py-3">
            <div className="text-sm font-semibold text-[var(--color-text-primary)]">ì§ì› ì„ íƒ</div>
            <div className="text-[12px] text-[var(--color-text-muted)] mt-0.5">
              ì¢Œì¸¡ì—ì„œ ì§ì›ì„ ì„ íƒí•˜ë©´ ìš°ì¸¡ ê·¼ë¬´ ê¸°ë¡ì´ í™œì„±í™”ë©ë‹ˆë‹¤.
            </div>
          </div>
          <div className="p-3">
            <StaffOperationTable selectedStaffId={staffId} basePath="attendance" />
          </div>
        </div>

        <div className="ds-panel-card min-h-[420px]">
          <div className="ds-panel-card__header px-5 py-4">
            <div className="text-sm font-semibold text-[var(--color-text-primary)]">ê·¼ë¬´ ê¸°ë¡</div>
            <div className="text-xs text-[var(--color-text-muted)]">
              {staffId ? `${monthText} ê¸°ì¤€` : "ì§ì›ì„ ì„ íƒí•˜ì„¸ìš”."}
            </div>
          </div>
          {!staffId ? (
            <div className="p-8">
              <EmptyState
                scope="panel"
                tone="empty"
                title="ì§ì›ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
                description="ì¢Œì¸¡ì—ì„œ ì§ì›ì„ ì„ íƒí•˜ë©´ ê·¼ë¬´ ê¸°ë¡ì„ ì¡°íšŒÂ·ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
              />
            </div>
          ) : (
            <WorkMonthProvider staffId={staffId} year={year} month={month}>
              <div className="p-5">
                <WorkRecordsPanel />
              </div>
            </WorkMonthProvider>
          )}
        </div>
    </div>
  );
}


==========================================================================================
# FILE: pages/ExpensesPage/ExpensesPage.tsx
==========================================================================================
// PATH: src/features/staff/pages/ExpensesPage/ExpensesPage.tsx
// ë¹„ìš©/ê²½ë¹„: ì§ì›ë³„ ê²½ë¹„ ì²­êµ¬(êµí†µë¹„, ì¬ë£Œë¹„ ë“±), ì •ì‚°

import { useMemo } from "react";
import { useSearchParams } from "react-router-dom";
import { WorkMonthProvider } from "../../operations/context/WorkMonthContext";
import StaffOperationTable from "../OperationsPage/StaffOperationTable";
import ExpensesPanel from "../OperationsPage/ExpensesPanel";
import { EmptyState } from "@/shared/ui/ds";

function getThisMonth() {
  const d = new Date();
  return { year: d.getFullYear(), month: d.getMonth() + 1 };
}

function ymLabel(y: number, m: number) {
  return `${y}ë…„ ${m}ì›”`;
}

export default function ExpensesPage() {
  const [params] = useSearchParams();
  const staffId = Number(params.get("staffId"));
  const { year, month } = useMemo(getThisMonth, []);
  const monthText = useMemo(() => ymLabel(year, month), [year, month]);

  return (
    <div className="grid grid-cols-[320px_1fr] gap-6">
        <div className="ds-panel-card">
          <div className="ds-panel-card__header px-4 py-3">
            <div className="text-sm font-semibold text-[var(--color-text-primary)]">ì§ì› ì„ íƒ</div>
            <div className="text-[12px] text-[var(--color-text-muted)] mt-0.5">
              ì¢Œì¸¡ì—ì„œ ì§ì›ì„ ì„ íƒí•˜ë©´ ìš°ì¸¡ ë¹„ìš© ëª©ë¡ì´ í™œì„±í™”ë©ë‹ˆë‹¤.
            </div>
          </div>
          <div className="p-3">
            <StaffOperationTable selectedStaffId={staffId} basePath="expenses" />
          </div>
        </div>

        <div className="ds-panel-card min-h-[420px]">
          <div className="ds-panel-card__header px-5 py-4">
            <div className="text-sm font-semibold text-[var(--color-text-primary)]">ë¹„ìš© ëª©ë¡</div>
            <div className="text-xs text-[var(--color-text-muted)]">
              {staffId ? `${monthText} ê¸°ì¤€` : "ì§ì›ì„ ì„ íƒí•˜ì„¸ìš”."}
            </div>
          </div>
          {!staffId ? (
            <div className="p-8">
              <EmptyState
                scope="panel"
                tone="empty"
                title="ì§ì›ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
                description="ì¢Œì¸¡ì—ì„œ ì§ì›ì„ ì„ íƒí•˜ë©´ ë¹„ìš©ì„ ì¡°íšŒÂ·ì¶”ê°€Â·ìŠ¹ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
              />
            </div>
          ) : (
            <WorkMonthProvider staffId={staffId} year={year} month={month}>
              <div className="p-5">
                <ExpensesPanel />
              </div>
            </WorkMonthProvider>
          )}
        </div>
    </div>
  );
}


==========================================================================================
# FILE: pages/HomePage/HomeKpiSection.tsx
==========================================================================================
// PATH: src/features/staff/pages/HomePage/HomeKpiSection.tsx
import React from "react";
import ActionButton from "../../components/ActionButton";
import { useNavigate } from "react-router-dom";

export const HomeKpiSection: React.FC<{ canManage: boolean }> = ({ canManage }) => {
  const nav = useNavigate();

  return (
    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div className="rounded-2xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-5 py-4">
        <div className="text-sm font-semibold">ìš´ì˜ ê·œì¹™</div>
        <div className="text-xs text-[var(--text-muted)] mt-2 leading-relaxed">
          â€¢ í•©ê³„/ê¸‰ì—¬/ì‹œê°„/ìƒíƒœ íŒì •: <b>ë°±ì—”ë“œ ë‹¨ì¼ì§„ì‹¤</b> <br />
          â€¢ <b>ì›” ë§ˆê° = ê¸‰ì—¬ í™•ì •</b> Â· ë§ˆê°ëœ ì›”ì€ ë³€ê²½ ë¶ˆê°€ <br />
          â€¢ ìŠ¹ì¸/ë§ˆê°: <b>ê´€ë¦¬ì(is_payroll_manager)</b>ë§Œ ê°€ëŠ¥
        </div>
      </div>

      <div className="rounded-2xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-5 py-4">
        <div className="text-sm font-semibold">ë¹ ë¥¸ ì‘ì—…</div>
        <div className="text-xs text-[var(--text-muted)] mt-2">
          ê·¼íƒœÂ·ë¹„ìš©/ê²½ë¹„Â·ì›” ë§ˆê°ì€ ê° íƒ­ì—ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
        </div>

        <div className="mt-3 flex items-center gap-2">
          <ActionButton
            variant="primary"
            size="sm"
            onClick={() => nav("/admin/staff/attendance")}
          >
            ê·¼íƒœ íƒ­
          </ActionButton>

          <ActionButton
            variant="outline"
            size="sm"
            onClick={() => nav("/admin/staff/reports")}
          >
            ë¦¬í¬íŠ¸/ëª…ì„¸
          </ActionButton>
        </div>

        {!canManage && (
          <div className="mt-2 text-[11px] text-[var(--color-danger)]">
            * í˜„ì¬ ê³„ì •ì€ ìŠ¹ì¸/ë§ˆê° ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.
          </div>
        )}
      </div>
    </div>
  );
};


==========================================================================================
# FILE: pages/HomePage/HomePage.tsx
==========================================================================================
// PATH: src/features/staff/pages/HomePage/HomePage.tsx
// ì§ìœ„ìˆœ ê¸°ë³¸ ì •ë ¬: ëŒ€í‘œ(owner) â†’ ê°•ì‚¬(TEACHER) â†’ ì¡°êµ(ASSISTANT)

import { useNavigate } from "react-router-dom";
import { useMemo, useState } from "react";

const ROLE_ORDER: Record<string, number> = { TEACHER: 0, ASSISTANT: 1 };
import { StaffHomeTable } from "./StaffHomeTable";
import { useStaffs } from "../../hooks/useStaffs";
import StaffCreateModal from "./StaffCreateModal";
import WorkTypeCreateModal from "./WorkTypeCreateModal";
import { useQuery, useQueryClient } from "@tanstack/react-query";
import { fetchStaffMe } from "../../api/staffMe.api";
import { deleteStaff } from "../../api/staff.api";
import { DomainListToolbar } from "@/shared/ui/domain";
import { Button, EmptyState } from "@/shared/ui/ds";
import { feedback } from "@/shared/ui/feedback/feedback";
import { useSendMessageModal } from "@/features/messages/context/SendMessageModalContext";

export default function HomePage() {
  const navigate = useNavigate();
  const qc = useQueryClient();
  const { openSendMessageModal } = useSendMessageModal();
  const { data: staffData, isLoading } = useStaffs();
  const staffs = staffData?.staffs ?? [];
  const meQ = useQuery({
    queryKey: ["staff-me"],
    queryFn: fetchStaffMe,
  });
  /** ì›ì¥ í–‰: ëª©ë¡ API owner ìš°ì„ , ì—†ìœ¼ë©´ /staffs/me ì˜ owner_display_nameÂ·owner_phone */
  const owner = (() => {
    if (staffData?.owner?.name) return staffData.owner;
    const displayName = meQ.data?.owner_display_name ?? (meQ.data?.is_owner ? "ëŒ€í‘œ" : null);
    if (displayName) {
      return {
        id: null,
        name: displayName,
        phone: meQ.data?.owner_phone ?? undefined,
        role: "OWNER" as const,
        is_owner: true as const,
      };
    }
    return null;
  })();
  const [openCreate, setOpenCreate] = useState(false);
  const [openWorkType, setOpenWorkType] = useState(false);
  const [q, setQ] = useState("");
  const [selectedIds, setSelectedIds] = useState<number[]>([]);
  const [deleting, setDeleting] = useState(false);

  const canManage = !!meQ.data?.is_payroll_manager;

  const rows = useMemo(() => {
    const list = Array.isArray(staffs) ? staffs : [];
    const needle = q.trim().toLowerCase();
    const filtered = !needle
      ? list
      : list.filter(
          (s) =>
            (s.name ?? "").toLowerCase().includes(needle) ||
            (s.phone ?? "").toLowerCase().includes(needle)
        );
    return [...filtered].sort(
      (a, b) => (ROLE_ORDER[a.role] ?? 2) - (ROLE_ORDER[b.role] ?? 2)
    );
  }, [staffs, q]);

  const selectionBar = (
    <div className="flex flex-wrap items-center gap-2 pl-1">
      <span
        className="text-[13px] font-semibold"
        style={{
          color: selectedIds.length > 0 ? "var(--color-primary)" : "var(--color-text-muted)",
        }}
      >
        {selectedIds.length}ëª… ì„ íƒë¨
      </span>
      <span className="text-[var(--color-border-divider)]">|</span>
      <Button intent="secondary" size="sm" onClick={() => setSelectedIds([])} disabled={selectedIds.length === 0}>
        ì„ íƒ í•´ì œ
      </Button>
      <span className="text-[var(--color-border-divider)]">|</span>
      <Button intent="secondary" size="sm" onClick={() => openSendMessageModal({ studentIds: [] })}>
        ë©”ì‹œì§€ ë°œì†¡
      </Button>
      <Button intent="secondary" size="sm" onClick={() => feedback.info("ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.")}>
        ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
      </Button>
      <Button intent="secondary" size="sm" onClick={() => feedback.info("ì‹œê¸‰ íƒœê·¸ ì¶”ê°€ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.")}>
        ì‹œê¸‰ íƒœê·¸ ì¶”ê°€
      </Button>
      <Button intent="secondary" size="sm" onClick={() => feedback.info("ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.")}>
        ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
      </Button>
      <Button
        intent="danger"
        size="sm"
        disabled={selectedIds.filter((id) => id > 0).length === 0 || deleting}
        onClick={async () => {
          const staffIds = selectedIds.filter((id) => id > 0);
          if (staffIds.length === 0) return;
          if (!window.confirm(`ì„ íƒí•œ ì§ì› ${staffIds.length}ëª…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ëŒ€í‘œëŠ” ì‚­ì œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤)`)) return;
          setDeleting(true);
          try {
            for (const id of staffIds) {
              await deleteStaff(id);
            }
            setSelectedIds(selectedIds.filter((id) => id <= 0));
            qc.invalidateQueries({ queryKey: ["staffs"] });
            qc.invalidateQueries({ queryKey: ["staff"] });
            feedback.success(`${staffIds.length}ëª… ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
          } catch (e: unknown) {
            feedback.error(e instanceof Error ? e.message : "ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          } finally {
            setDeleting(false);
          }
        }}
      >
        {deleting ? "ì‚­ì œ ì¤‘â€¦" : "ì‚­ì œ"}
      </Button>
    </div>
  );

  return (
    <div className="flex flex-col gap-4">
      <DomainListToolbar
        totalLabel={
          isLoading
            ? "â€¦"
            : owner
              ? `ì´ ${staffs.length + 1}ëª…`
              : Array.isArray(staffs)
                ? `ì´ ${staffs.length}ëª…`
                : "â€”"
        }
        searchSlot={
          <input
            className="ds-input"
            placeholder="ì´ë¦„/ì „í™”ë²ˆí˜¸ ê²€ìƒ‰"
            value={q}
            onChange={(e) => setQ(e.target.value)}
            style={{ maxWidth: 360 }}
          />
        }
        primaryAction={
          canManage ? (
            <div className="flex items-center gap-2">
              <Button
                type="button"
                intent="secondary"
                onClick={() => setOpenWorkType(true)}
              >
                ì‹œê¸‰íƒœê·¸ ìƒì„±
              </Button>
              <Button
                type="button"
                intent="primary"
                onClick={() => setOpenCreate(true)}
              >
                + ì§ì› ë“±ë¡
              </Button>
            </div>
          ) : null
        }
        belowSlot={selectionBar}
      />

      {isLoading ? (
        <EmptyState scope="panel" tone="loading" title="ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦" />
      ) : (
        <StaffHomeTable
          staffs={rows}
          owner={owner}
          canManage={canManage}
          onOperate={(id) => navigate(`/admin/staff/attendance?staffId=${id}`)}
          onDetail={(id) => navigate(`/admin/staff/${id}`)}
          selectedIds={selectedIds}
          onSelectionChange={setSelectedIds}
        />
      )}

      <StaffCreateModal open={openCreate} onClose={() => setOpenCreate(false)} />
      <WorkTypeCreateModal
        open={openWorkType}
        onClose={() => setOpenWorkType(false)}
      />
    </div>
  );
}


==========================================================================================
# FILE: pages/HomePage/StaffCreateModal.tsx
==========================================================================================
// PATH: src/features/staff/pages/HomePage/StaffCreateModal.tsx
import { useState } from "react";
import { useMutation, useQueryClient } from "@tanstack/react-query";
import api from "@/shared/api/axios";

import {
  AdminModal,
  ModalHeader,
  ModalBody,
  ModalFooter,
} from "@/shared/ui/modal";
import { ActionButton } from "@/shared/ui/ds";

type Props = {
  open: boolean;
  onClose: () => void;
};

type PermissionRole = "TEACHER" | "ASSISTANT";

export default function StaffCreateModal({ open, onClose }: Props) {
  const qc = useQueryClient();

  const [form, setForm] = useState({
    username: "",
    password: "",
    name: "",
    phone: "",
    permission_role: "ASSISTANT" as PermissionRole,
  });

  const createM = useMutation({
    mutationFn: async () => {
      const res = await api.post("/staffs/", {
        username: form.username,
        password: form.password,
        name: form.name,
        phone: form.phone || undefined,
        role: form.permission_role,
      });

      return res.data;
    },
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["staffs"] });
      alert("ì§ì›ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.");
      onClose();
      setForm({
        username: "",
        password: "",
        name: "",
        phone: "",
        permission_role: "ASSISTANT",
      });
    },
    onError: (e: any) => {
      const msg =
        e?.response?.data?.detail ||
        e?.response?.data?.message ||
        "ì§ì› ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
      alert(msg);
    },
  });

  const invalidUsername = !String(form.username || "").trim();
  const invalidPassword = !String(form.password || "").trim();
  const invalidName = !String(form.name || "").trim();

  return (
    <AdminModal open={open} onClose={onClose} type="action">
      <ModalHeader
        title="ì§ì› ë“±ë¡"
        description="ë¡œê·¸ì¸ ê³„ì •ì„ í¬í•¨í•œ ì§ì› ì •ë³´ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤."
        type="action"
      />

      <ModalBody>
        <div style={{ display: "grid", gap: 12 }}>
          <Field label="ë¡œê·¸ì¸ ì•„ì´ë”” *">
            <input
              className="ds-input"
              value={form.username}
              onChange={(e) =>
                setForm((p) => ({ ...p, username: e.target.value }))
              }
              data-required="true"
              data-invalid={invalidUsername ? "true" : "false"}
              autoFocus
            />
          </Field>

          <Field label="ë¹„ë°€ë²ˆí˜¸ *">
            <input
              type="password"
              className="ds-input"
              value={form.password}
              onChange={(e) =>
                setForm((p) => ({ ...p, password: e.target.value }))
              }
              data-required="true"
              data-invalid={invalidPassword ? "true" : "false"}
            />
          </Field>

          <Field label="ì´ë¦„ *">
            <input
              className="ds-input"
              value={form.name}
              onChange={(e) =>
                setForm((p) => ({ ...p, name: e.target.value }))
              }
              data-required="true"
              data-invalid={invalidName ? "true" : "false"}
            />
          </Field>

          <Field label="ì „í™”ë²ˆí˜¸">
            <input
              className="ds-input"
              value={form.phone}
              onChange={(e) =>
                setForm((p) => ({ ...p, phone: e.target.value }))
              }
              placeholder="010XXXXXXXX"
            />
          </Field>

          <Field label="ê¶Œí•œ *">
            <select
              className="ds-input"
              value={form.permission_role}
              onChange={(e) =>
                setForm((p) => ({
                  ...p,
                  permission_role: e.target.value as PermissionRole,
                }))
              }
              data-required="true"
              aria-label="ê¶Œí•œ ì„ íƒ"
            >
              <option value="ASSISTANT">ì¡°êµ (ì¼ë°˜ ì§ì›)</option>
              <option value="TEACHER">ê°•ì‚¬</option>
            </select>
          </Field>
        </div>
      </ModalBody>

      <ModalFooter
        right={
          <>
            <ActionButton
              action="close"
              onClick={onClose}
              disabled={createM.isPending}
            />
            <ActionButton
              action="create"
              loading={createM.isPending}
              onClick={() => {
                if (invalidUsername || invalidPassword || invalidName) {
                  alert("í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");
                  return;
                }
                createM.mutate();
              }}
            >
              ë“±ë¡
            </ActionButton>
          </>
        }
      />
    </AdminModal>
  );
}

function Field({
  label,
  children,
}: {
  label: string;
  children: React.ReactNode;
}) {
  return (
    <div style={{ display: "grid", gap: 4 }}>
      <div
        style={{
          fontSize: 12,
          fontWeight: 800,
          color: "var(--color-text-muted)",
        }}
      >
        {label}
      </div>
      {children}
    </div>
  );
}


==========================================================================================
# FILE: pages/HomePage/StaffHomeTable.tsx
==========================================================================================
// PATH: src/features/staff/pages/HomePage/StaffHomeTable.tsx
// Design: docs/DESIGN_SSOT.md â€” staff ë„ë©”ì¸: ëŒ€í‘œ(ì›ì¥) / ê°•ì‚¬ / ì¡°êµ í†µì¼

import { useMemo, useState, useEffect, useRef } from "react";
import { Plus } from "lucide-react";
import { EmptyState } from "@/shared/ui/ds";
import { DomainTable, TABLE_COL } from "@/shared/ui/domain";
import { StaffRoleAvatar } from "@/shared/ui/avatars";
import { Staff, type StaffListOwner } from "../../api/staff.api";
import { useMutation, useQuery, useQueryClient } from "@tanstack/react-query";
import { patchStaffDetail } from "../../api/staff.detail.api";
import { fetchWorkTypes, createStaffWorkType, type WorkType } from "../../api/staffWorkType.api";

/** ì§ì› ëª©ë¡ ì„ íƒ ì‹œ ì›ì¥ í–‰ìš© sentinel id (ì‚­ì œ ì œì™¸) */
export const OWNER_SELECTION_ID = -1;

const LIGHT_TAG_COLORS = ["#eab308", "#06b6d4"];
function isLightTagColor(c: string) {
  return LIGHT_TAG_COLORS.some((x) => String(c || "").toLowerCase() === x);
}

/** ì‹œê¸‰íƒœê·¸ â€” í•™ìƒ íƒœê·¸ ë””ìì¸ ì¹´í”¼ (ì´ë¦„ + ìƒ‰ìƒ ë±ƒì§€). ë¹ˆ ëª©ë¡ì´ë©´ ì•„ë¬´ê²ƒë„ í‘œì‹œí•˜ì§€ ì•ŠìŒ */
function WorkTypeTags({ workTypes }: { workTypes: Staff["staff_work_types"] }) {
  const list = Array.isArray(workTypes) ? workTypes : [];

  if (list.length === 0) return null;

  return (
    <span className="inline-flex flex-wrap gap-1 justify-center">
      {list.slice(0, 4).map((st) => {
        const wt = st.work_type;
        const color = wt?.color || "#6b7280";
        const name = wt?.name || "-";
        const wage = wt?.base_hourly_wage != null ? st.effective_hourly_wage ?? wt.base_hourly_wage : null;
        const label = wage != null ? `${name} ${(wage / 10000).toFixed(1)}ë§Œ` : name;
        return (
          <span
            key={st.id}
            className="inline-flex items-center shrink-0 px-1.5 py-0.5 rounded text-[11px] font-semibold whitespace-nowrap"
            style={{
              backgroundColor: color,
              color: isLightTagColor(color) ? "#1a1a1a" : "#fff",
              border: "none",
              boxShadow: "0 1px 2px rgba(0,0,0,0.12)",
            }}
            title={`${name} Â· ${wage != null ? `${wage.toLocaleString()}ì›/ì‹œ` : ""}`}
          >
            {label}
          </span>
        );
      })}
      {list.length > 4 && <span className="text-[11px] text-[var(--color-text-muted)]">+{list.length - 4}</span>}
    </span>
  );
}

/** ë“œë¡­ì—… ì˜µì…˜ 1ê°œ â€” ì‹¤ì œ ìƒ‰ìƒ ë±ƒì§€ë¡œ í‘œì‹œ */
function WorkTypeOption({
  wt,
  onSelect,
  disabled,
}: {
  wt: WorkType;
  onSelect: () => void;
  disabled: boolean;
}) {
  const color = wt.color || "#6b7280";
  const name = wt.name || "";
  const wageText =
    wt.base_hourly_wage != null ? ` (${(wt.base_hourly_wage / 10000).toFixed(1)}ë§Œ/ì‹œ)` : "";
  const label = `${name}${wageText}`;
  return (
    <button
      type="button"
      className="w-full text-left px-2 py-1.5 rounded hover:opacity-90 transition-opacity disabled:opacity-50"
      onClick={onSelect}
      disabled={disabled}
    >
      <span
        className="inline-flex items-center shrink-0 px-2 py-1 rounded text-[12px] font-semibold"
        style={{
          backgroundColor: color,
          color: isLightTagColor(color) ? "#1a1a1a" : "#fff",
          boxShadow: "0 1px 2px rgba(0,0,0,0.12)",
        }}
      >
        {label}
      </span>
    </button>
  );
}

interface Props {
  staffs: Staff[] | undefined;
  owner?: StaffListOwner | null;
  onOperate: (staffId: number) => void;
  onDetail: (staffId: number) => void;
  canManage: boolean;
  selectedIds?: number[];
  onSelectionChange?: (ids: number[]) => void;
}

const COL = {
  checkbox: TABLE_COL.checkbox,
  role: 72,
  name: TABLE_COL.nameCompact,
  phone: TABLE_COL.phone,
  status: TABLE_COL.statusBadge,
  manager: 88,
  payType: 124,
  workTypeTags: 380,
} as const;

const TABLE_WIDTH =
  COL.checkbox +
  COL.role +
  COL.name +
  COL.phone +
  COL.status +
  COL.manager +
  COL.payType +
  COL.workTypeTags;

export function StaffHomeTable({
  staffs,
  owner,
  onOperate,
  onDetail,
  canManage,
  selectedIds: controlledSelectedIds,
  onSelectionChange,
}: Props) {
  const dataSource: Staff[] = Array.isArray(staffs) ? staffs : [];
  const hasOwner = !!owner?.name;
  const qc = useQueryClient();
  const [internalSelected, setInternalSelected] = useState<number[]>([]);
  const selectedIds = onSelectionChange && controlledSelectedIds !== undefined ? controlledSelectedIds : internalSelected;
  const setSelectedIds = onSelectionChange && controlledSelectedIds !== undefined
    ? onSelectionChange
    : setInternalSelected;
  const selectedSet = useMemo(() => new Set(selectedIds), [selectedIds]);
  const allIds = useMemo(
    () => (hasOwner ? [OWNER_SELECTION_ID] : []).concat(dataSource.map((r) => r.id)),
    [hasOwner, dataSource]
  );
  const allSelected = allIds.length > 0 && allIds.every((id) => selectedSet.has(id));

  const toggleSelect = (id: number) => {
    if (selectedSet.has(id)) setSelectedIds(selectedIds.filter((x) => x !== id));
    else setSelectedIds([...selectedIds, id]);
  };
  const toggleSelectAll = () => {
    if (allSelected) setSelectedIds(selectedIds.filter((id) => !allIds.includes(id)));
    else setSelectedIds([...new Set([...selectedIds, ...allIds])]);
  };

  const patchPayTypeM = useMutation({
    mutationFn: ({ staffId, pay_type }: { staffId: number; pay_type: "HOURLY" | "MONTHLY" }) =>
      patchStaffDetail(staffId, { pay_type }),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["staffs"] });
      qc.invalidateQueries({ queryKey: ["staff"] });
    },
    onError: (e: unknown) => {
      const msg =
        (e as { response?: { data?: { detail?: string; message?: string } } })?.response?.data?.detail ||
        (e as { response?: { data?: { message?: string } } })?.response?.data?.message ||
        "ê¸‰ì—¬ ìœ í˜• ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
      alert(msg);
    },
  });

  const patchManagerM = useMutation({
    mutationFn: ({ staffId, is_manager }: { staffId: number; is_manager: boolean }) =>
      patchStaffDetail(staffId, { is_manager }),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["staffs"] });
      qc.invalidateQueries({ queryKey: ["staff"] });
    },
    onError: (e: unknown) => {
      const msg =
        (e as { response?: { data?: { detail?: string; message?: string } } })?.response?.data?.detail ||
        (e as { response?: { data?: { message?: string } } })?.response?.data?.message ||
        "ê´€ë¦¬ì ê¶Œí•œ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
      alert(msg);
    },
  });

  const workTypesQ = useQuery({
    queryKey: ["staffs", "work-types"],
    queryFn: () => fetchWorkTypes({ is_active: true }),
  });
  const allWorkTypes = workTypesQ.data ?? [];

  const addTagM = useMutation({
    mutationFn: ({ staffId, work_type_id }: { staffId: number; work_type_id: number }) =>
      createStaffWorkType(staffId, { work_type_id }),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["staffs"] });
      qc.invalidateQueries({ queryKey: ["staff"] });
      setOpenAddForStaffId(null);
    },
    onError: (e: unknown) => {
      const msg =
        (e as { response?: { data?: { detail?: string } } })?.response?.data?.detail ||
        "ì‹œê¸‰íƒœê·¸ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
      alert(msg);
    },
  });

  const [openAddForStaffId, setOpenAddForStaffId] = useState<number | null>(null);
  const addDropdownRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (openAddForStaffId === null) return;
    function handleClickOutside(ev: MouseEvent) {
      if (addDropdownRef.current?.contains(ev.target as Node)) return;
      setOpenAddForStaffId(null);
    }
    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, [openAddForStaffId]);

  if (dataSource.length === 0 && !hasOwner) {
    return (
      <EmptyState
        title="ì§ì› ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤."
        description="ì§ì›ì„ ë“±ë¡í•˜ê±°ë‚˜ ê²€ìƒ‰ ì¡°ê±´ì„ í™•ì¸í•´ ì£¼ì„¸ìš”."
        scope="panel"
      />
    );
  }

  return (
    <div style={{ width: "fit-content" }}>
      <DomainTable
        tableClassName="ds-table--flat ds-table--center"
        tableStyle={{ tableLayout: "fixed", width: TABLE_WIDTH }}
      >
        <colgroup>
          <col style={{ width: COL.checkbox }} />
          <col style={{ width: COL.role }} />
          <col style={{ width: COL.name }} />
          <col style={{ width: COL.phone }} />
          <col style={{ width: COL.status }} />
          <col style={{ width: COL.manager }} />
          <col style={{ width: COL.payType }} />
          <col style={{ width: COL.workTypeTags }} />
        </colgroup>

        <thead>
          <tr>
            <th scope="col" style={{ width: COL.checkbox }} className="ds-checkbox-cell" onClick={(e) => e.stopPropagation()}>
              <input
                type="checkbox"
                checked={Boolean(allSelected)}
                ref={(el) => {
                  if (el) el.indeterminate = !allSelected && selectedSet.size > 0;
                }}
                onChange={toggleSelectAll}
                aria-label="ì „ì²´ ì„ íƒ"
                className="cursor-pointer"
              />
            </th>
            <th scope="col">ì§ìœ„</th>
            <th scope="col">ì´ë¦„</th>
            <th scope="col">ì „í™”ë²ˆí˜¸</th>
            <th scope="col">ìƒíƒœ</th>
            <th scope="col">ê´€ë¦¬ìê¶Œí•œ</th>
            <th scope="col">ê¸‰ì—¬ìœ í˜•</th>
            <th scope="col">ì‹œê¸‰íƒœê·¸</th>
          </tr>
        </thead>

        <tbody>
          {hasOwner && (
            <tr className="bg-[var(--color-bg-surface-hover)]/60" aria-label="ëŒ€í‘œ">
              <td onClick={(e) => e.stopPropagation()} style={{ width: COL.checkbox }} className="ds-checkbox-cell align-middle">
                <input
                  type="checkbox"
                  checked={!!selectedSet.has(OWNER_SELECTION_ID)}
                  onChange={() => toggleSelect(OWNER_SELECTION_ID)}
                  onClick={(e) => e.stopPropagation()}
                  aria-label="ëŒ€í‘œ ì„ íƒ"
                  className="cursor-pointer"
                />
              </td>
              <td className="align-middle">
                <span className="ds-status-badge ds-status-badge--action" data-tone="primary" aria-label="ëŒ€í‘œ">
                  ëŒ€í‘œ
                </span>
              </td>
              <td className="align-middle">
                <span className="inline-flex items-center gap-2 min-w-0">
                  <StaffRoleAvatar role="owner" />
                  <span className="text-[15px] font-bold leading-6 text-[var(--color-text-primary)] truncate">
                    {owner!.name}
                  </span>
                </span>
              </td>
              <td className="text-[14px] leading-6 text-[var(--color-text-secondary)] truncate align-middle">
                {owner!.phone || "-"}
              </td>
              <td className="align-middle">
                <span className="ds-status-badge ds-status-badge--action" data-status="active">í™œì„±</span>
              </td>
              <td className="align-middle">
                <span className="ds-status-badge ds-status-badge--action" data-status="active">ON</span>
              </td>
              <td className="align-middle">
                <span className="ds-status-badge" data-tone="neutral">-</span>
              </td>
              <td className="align-middle">
                <span className="ds-status-badge" data-tone="neutral">-</span>
              </td>
            </tr>
          )}
          {dataSource.map((r) => (
            <tr
              key={r.id}
              onClick={() => onDetail(r.id)}
              tabIndex={0}
              role="button"
              className={`group cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-[var(--color-border-focus)]/40 ${selectedSet.has(r.id) ? "ds-row-selected" : ""}`}
            >
              <td onClick={(e) => e.stopPropagation()} style={{ width: COL.checkbox }} className="ds-checkbox-cell align-middle">
                <input
                  type="checkbox"
                  checked={!!selectedSet.has(r.id)}
                  onChange={() => toggleSelect(r.id)}
                  onClick={(e) => e.stopPropagation()}
                  aria-label={`${r.name} ì„ íƒ`}
                  className="cursor-pointer"
                />
              </td>
              <td className="align-middle">
                <span className="ds-status-badge ds-status-badge--action" data-tone={r.role === "TEACHER" ? "primary" : "neutral"} aria-label={r.role === "TEACHER" ? "ê°•ì‚¬" : "ì¡°êµ"}>
                  {r.role === "TEACHER" ? "ê°•ì‚¬" : "ì¡°êµ"}
                </span>
              </td>
              <td className="align-middle">
                <span className="inline-flex items-center gap-2 min-w-0">
                  <StaffRoleAvatar role={r.role} />
                  <span className="text-[15px] font-bold leading-6 text-[var(--color-text-primary)] truncate">
                    {r.name}
                  </span>
                </span>
              </td>
              <td className="text-[14px] leading-6 text-[var(--color-text-secondary)] truncate align-middle">
                {r.phone || "-"}
              </td>
              <td className="align-middle">
                <span className="ds-status-badge ds-status-badge--action" data-status={r.is_active ? "active" : "inactive"}>
                  {r.is_active ? "í™œì„±" : "ë¹„í™œì„±"}
                </span>
              </td>
              <td className="align-middle" onClick={(e) => e.stopPropagation()}>
                {canManage ? (
                  <button
                    type="button"
                    className="ds-status-badge ds-status-badge--action"
                    data-status={r.is_manager ? "active" : "inactive"}
                    disabled={patchManagerM.isPending}
                    onClick={() => patchManagerM.mutate({ staffId: r.id, is_manager: !r.is_manager })}
                    aria-label={r.is_manager ? "ê´€ë¦¬ì í•´ì œ" : "ê´€ë¦¬ì ë¶€ì—¬"}
                  >
                    {patchManagerM.isPending ? "â€¦" : r.is_manager ? "ON" : "OFF"}
                  </button>
                ) : (
                  <span className="ds-status-badge ds-status-badge--action" data-status={r.is_manager ? "active" : "inactive"}>
                    {r.is_manager ? "ON" : "OFF"}
                  </span>
                )}
              </td>
              <td className="align-middle" onClick={(e) => e.stopPropagation()}>
                {!canManage ? (
                  <span className="ds-status-badge" data-tone="neutral">
                    {r.pay_type === "HOURLY" ? "ì‹œê¸‰" : "ì›”ê¸‰"}
                  </span>
                ) : (
                  <span className="inline-flex gap-1">
                    <button
                      type="button"
                      className="ds-status-badge ds-status-badge--action"
                      data-status={r.pay_type === "HOURLY" ? "active" : "inactive"}
                      disabled={patchPayTypeM.isPending}
                      onClick={() => {
                        if (r.pay_type === "HOURLY") return;
                        patchPayTypeM.mutate({ staffId: r.id, pay_type: "HOURLY" });
                      }}
                      aria-label={`${r.name} ì‹œê¸‰`}
                    >
                      {patchPayTypeM.isPending ? "â€¦" : "ì‹œê¸‰"}
                    </button>
                    <button
                      type="button"
                      className="ds-status-badge ds-status-badge--action"
                      data-status={r.pay_type === "MONTHLY" ? "active" : "inactive"}
                      disabled={patchPayTypeM.isPending}
                      onClick={() => {
                        if (r.pay_type === "MONTHLY") return;
                        patchPayTypeM.mutate({ staffId: r.id, pay_type: "MONTHLY" });
                      }}
                      aria-label={`${r.name} ì›”ê¸‰`}
                    >
                      {patchPayTypeM.isPending ? "â€¦" : "ì›”ê¸‰"}
                    </button>
                  </span>
                )}
              </td>
              <td className="align-middle relative" onClick={(e) => e.stopPropagation()}>
                <div
                  className="inline-flex items-center gap-1.5 flex-wrap min-w-0 relative"
                  ref={openAddForStaffId === r.id ? addDropdownRef : undefined}
                >
                  <WorkTypeTags workTypes={r.staff_work_types} />
                  {canManage && (
                    <>
                      <button
                        type="button"
                        className="inline-flex items-center justify-center w-7 h-7 rounded border border-[var(--color-border-divider)] bg-[var(--bg-surface-soft)] text-[var(--color-text-secondary)] hover:bg-[var(--bg-surface-hover)] hover:border-[var(--color-border-strong)] transition-colors"
                        onClick={() => setOpenAddForStaffId((prev) => (prev === r.id ? null : r.id))}
                        aria-label={`${r.name} ì‹œê¸‰íƒœê·¸ ì¶”ê°€`}
                        disabled={addTagM.isPending}
                      >
                        <Plus size={14} strokeWidth={2.5} />
                      </button>
                      {openAddForStaffId === r.id && (
                        <div className="absolute z-10 left-0 bottom-full mb-1 py-1 min-w-[180px] max-h-[280px] overflow-y-auto rounded-md border border-[var(--color-border-divider)] bg-[var(--color-bg-surface)] shadow-lg">
                          {allWorkTypes.filter(
                            (wt) => !(r.staff_work_types || []).some((swt) => swt.work_type?.id === wt.id)
                          ).length === 0 ? (
                            <div className="px-3 py-2 text-[13px] text-[var(--color-text-muted)]">
                              ì¶”ê°€í•  ì‹œê¸‰íƒœê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.
                            </div>
                          ) : (
                            allWorkTypes
                              .filter((wt) => !(r.staff_work_types || []).some((swt) => swt.work_type?.id === wt.id))
                              .map((wt) => (
                                <WorkTypeOption
                                  key={wt.id}
                                  wt={wt}
                                  onSelect={() => addTagM.mutate({ staffId: r.id, work_type_id: wt.id })}
                                  disabled={addTagM.isPending}
                                />
                              ))
                          )}
                        </div>
                      )}
                    </>
                  )}
                </div>
              </td>
            </tr>
          ))}
        </tbody>
      </DomainTable>
    </div>
  );
}


==========================================================================================
# FILE: pages/HomePage/WorkTypeCreateModal.tsx
==========================================================================================
// PATH: src/features/staff/pages/HomePage/WorkTypeCreateModal.tsx
// ì‹œê¸‰ ê¸‰ì—¬ìœ í˜•: ì´ë¦„Â·ì‹œê¸‰Â·ìƒ‰ìƒ(ì „ì—­ ColorPickerField)

import { useState } from "react";
import { useMutation, useQueryClient } from "@tanstack/react-query";
import api from "@/shared/api/axios";

import {
  AdminModal,
  ModalHeader,
  ModalBody,
  ModalFooter,
} from "@/shared/ui/modal";
import { ActionButton } from "@/shared/ui/ds";
import { ColorPickerField } from "@/shared/ui/domain";

export default function WorkTypeCreateModal({
  open,
  onClose,
}: {
  open: boolean;
  onClose: () => void;
}) {
  const qc = useQueryClient();

  const [form, setForm] = useState({
    name: "",
    base_hourly_wage: 0,
    color: "#22c55e",
    description: "",
  });

  const createM = useMutation({
    mutationFn: async () => {
      const res = await api.post("/staffs/work-types/", {
        name: form.name,
        base_hourly_wage: Number(form.base_hourly_wage),
        color: form.color,
        description: form.description,
      });
      return res.data;
    },
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["work-types"] });
      qc.invalidateQueries({ queryKey: ["staffs", "work-types"] });
      alert("ì‹œê¸‰íƒœê·¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.");
      onClose();
      setForm({
        name: "",
        base_hourly_wage: 0,
        color: "#22c55e",
        description: "",
      });
    },
    onError: (e: any) => {
      alert(
        e?.response?.data?.detail ||
          e?.response?.data?.message ||
          "ì‹œê¸‰íƒœê·¸ ìƒì„± ì‹¤íŒ¨"
      );
    },
  });

  return (
    <AdminModal open={open} onClose={onClose} type="action">
      <ModalHeader
        title="ì‹œê¸‰íƒœê·¸ ìƒì„±"
        description="ì§ì› ì‹œê¸‰íƒœê·¸ë¡œ ì‚¬ìš©í•  ìœ í˜•ì„ ì¶”ê°€í•©ë‹ˆë‹¤. ìƒì„± í›„ í…Œì´ë¸” ì‹œê¸‰íƒœê·¸ ì˜ì—­ì—ì„œ ì§ì›ë³„ë¡œ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
        type="action"
      />

      <ModalBody>
        <div className="grid gap-3">
          <Field label="ì‹œê¸‰íƒœê·¸ëª… *">
            <input
              className="ds-input"
              value={form.name}
              onChange={(e) =>
                setForm((p) => ({ ...p, name: e.target.value }))
              }
            />
          </Field>

          <Field label="ê¸°ë³¸ ì‹œê¸‰(ì›) *">
            <input
              type="number"
              className="ds-input"
              value={form.base_hourly_wage}
              onChange={(e) =>
                setForm((p) => ({
                  ...p,
                  base_hourly_wage: Number(e.target.value),
                }))
              }
            />
          </Field>

          <Field label="ìƒ‰ìƒ">
            <ColorPickerField
              value={form.color}
              onChange={(color) => setForm((p) => ({ ...p, color: color ?? p.color }))}
            />
          </Field>

          <Field label="ì„¤ëª…">
            <textarea
              className="ds-input"
              rows={2}
              value={form.description}
              onChange={(e) =>
                setForm((p) => ({ ...p, description: e.target.value }))
              }
            />
          </Field>
        </div>
      </ModalBody>

      <ModalFooter
        right={
          <>
            <ActionButton action="close" onClick={onClose} />
            <ActionButton
              action="create"
              loading={createM.isPending}
              onClick={() => {
                if (!form.name.trim() || form.base_hourly_wage <= 0) {
                  alert("í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”.");
                  return;
                }
                createM.mutate();
              }}
            >
              ìƒì„±
            </ActionButton>
          </>
        }
      />
    </AdminModal>
  );
}

function Field({
  label,
  children,
}: {
  label: string;
  children: React.ReactNode;
}) {
  return (
    <div className="grid gap-1">
      <div className="text-xs font-semibold text-[var(--text-muted)]">
        {label}
      </div>
      {children}
    </div>
  );
}


==========================================================================================
# FILE: pages/MonthLockPage/MonthLockPage.tsx
==========================================================================================
// PATH: src/features/staff/pages/MonthLockPage/MonthLockPage.tsx
// ì›” ë§ˆê°: ì›” ë‹¨ìœ„ í™•ì • (ì´ë²ˆ ë‹¬ ìˆ˜ì • ë¶ˆê°€)

import { useMemo } from "react";
import { useSearchParams } from "react-router-dom";
import { WorkMonthProvider } from "../../operations/context/WorkMonthContext";
import StaffOperationTable from "../OperationsPage/StaffOperationTable";
import MonthLockPanel from "../OperationsPage/MonthLockPanel";
import { EmptyState } from "@/shared/ui/ds";

function getThisMonth() {
  const d = new Date();
  return { year: d.getFullYear(), month: d.getMonth() + 1 };
}

function ymLabel(y: number, m: number) {
  return `${y}ë…„ ${m}ì›”`;
}

export default function MonthLockPage() {
  const [params] = useSearchParams();
  const staffId = Number(params.get("staffId"));
  const { year, month } = useMemo(getThisMonth, []);
  const monthText = useMemo(() => ymLabel(year, month), [year, month]);

  return (
    <div className="grid grid-cols-[320px_1fr] gap-6">
        <div className="ds-panel-card">
          <div className="ds-panel-card__header px-4 py-3">
            <div className="text-sm font-semibold text-[var(--color-text-primary)]">ì§ì› ì„ íƒ</div>
            <div className="text-[12px] text-[var(--color-text-muted)] mt-0.5">
              ì¢Œì¸¡ì—ì„œ ì§ì›ì„ ì„ íƒí•œ ë’¤ ìš°ì¸¡ì—ì„œ í•´ë‹¹ ì›”ì„ ë§ˆê°í•©ë‹ˆë‹¤.
            </div>
          </div>
          <div className="p-3">
            <StaffOperationTable selectedStaffId={staffId} basePath="month-lock" />
          </div>
        </div>

        <div className="ds-panel-card min-h-[320px]">
          <div className="ds-panel-card__header px-5 py-4">
            <div className="text-sm font-semibold text-[var(--color-text-primary)]">ì›” ë§ˆê°</div>
            <div className="text-xs text-[var(--color-text-muted)]">
              {staffId ? `${monthText}` : "ì§ì›ì„ ì„ íƒí•˜ì„¸ìš”."}
            </div>
          </div>
          {!staffId ? (
            <div className="p-8">
              <EmptyState
                scope="panel"
                tone="empty"
                title="ì§ì›ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
                description="ì¢Œì¸¡ì—ì„œ ì§ì›ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ ì›” ë§ˆê°(ê¸‰ì—¬ í™•ì •)ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
              />
            </div>
          ) : (
            <WorkMonthProvider staffId={staffId} year={year} month={month}>
              <div className="p-5">
                <MonthLockPanel />
              </div>
            </WorkMonthProvider>
          )}
        </div>
    </div>
  );
}


==========================================================================================
# FILE: pages/OperationsPage/CreateExpenseModal.tsx
==========================================================================================
// PATH: src/features/staff/pages/OperationsPage/CreateExpenseModal.tsx
import { useEffect, useState } from "react";
import { useWorkMonth } from "../../operations/context/WorkMonthContext";
import { useExpenses } from "../../hooks/useExpenses";

import {
  AdminModal,
  ModalHeader,
  ModalBody,
  ModalFooter,
} from "@/shared/ui/modal";
import { ActionButton } from "@/shared/ui/ds";
import { DatePicker } from "@/shared/ui/date";

export default function CreateExpenseModal({
  open,
  onClose,
}: {
  open: boolean;
  onClose: () => void;
}) {
  const { staffId, range, locked } = useWorkMonth();

  const { createM } = useExpenses({
    staff: staffId,
    date_from: range.from,
    date_to: range.to,
  });

  const [form, setForm] = useState({
    date: range.from,
    title: "",
    amount: 0,
    memo: "",
  });

  useEffect(() => {
    if (open) {
      setForm((p) => ({ ...p, date: range.from }));
    }
  }, [open, range.from]);

  if (locked) return null;

  return (
    <AdminModal open={open} onClose={onClose} type="action">
      <ModalHeader
        title="ë¹„ìš© ì¶”ê°€"
        description="ì§ì›ì˜ ë¹„ìš© í•­ëª©ì„ ì¶”ê°€í•©ë‹ˆë‹¤."
        type="action"
      />

      <ModalBody>
        <div className="grid gap-3">
          <Field label="ë‚ ì§œ">
            <DatePicker
              value={form.date}
              onChange={(v) =>
                setForm((p) => ({ ...p, date: v }))
              }
            />
          </Field>

          <Field label="í•­ëª© *">
            <input
              className="ds-input"
              value={form.title}
              onChange={(e) =>
                setForm((p) => ({ ...p, title: e.target.value }))
              }
            />
          </Field>

          <Field label="ê¸ˆì•¡(ì›) *">
            <input
              type="number"
              className="ds-input"
              value={form.amount}
              onChange={(e) =>
                setForm((p) => ({
                  ...p,
                  amount: Number(e.target.value),
                }))
              }
            />
          </Field>

          <Field label="ë©”ëª¨">
            <textarea
              className="ds-input"
              rows={3}
              value={form.memo}
              onChange={(e) =>
                setForm((p) => ({ ...p, memo: e.target.value }))
              }
            />
          </Field>
        </div>
      </ModalBody>

      <ModalFooter
        right={
          <>
            <ActionButton action="close" onClick={onClose} />
            <ActionButton
              action="create"
              loading={createM.isPending}
              onClick={() => {
                if (!form.title.trim() || form.amount <= 0) {
                  alert("í•­ëª©ê³¼ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.");
                  return;
                }

                createM.mutate(
                  {
                    staff: staffId,
                    date: form.date,
                    title: form.title,
                    amount: form.amount,
                    memo: form.memo,
                  },
                  { onSuccess: onClose }
                );
              }}
            >
              ì¶”ê°€
            </ActionButton>
          </>
        }
      />
    </AdminModal>
  );
}

function Field({ label, children }: { label: string; children: React.ReactNode }) {
  return (
    <div className="grid gap-1">
      <div className="text-xs font-semibold text-[var(--text-muted)]">
        {label}
      </div>
      {children}
    </div>
  );
}


==========================================================================================
# FILE: pages/OperationsPage/CreateWorkRecordModal.tsx
==========================================================================================
// PATH: src/features/staff/pages/OperationsPage/CreateWorkRecordModal.tsx
import { useEffect, useState } from "react";
import { useQuery } from "@tanstack/react-query";
import { useWorkMonth } from "../../operations/context/WorkMonthContext";
import { useWorkRecords } from "../../hooks/useWorkRecords";
import { fetchStaffWorkTypes } from "../../api/staffWorkType.api";

import {
  AdminModal,
  ModalHeader,
  ModalBody,
  ModalFooter,
} from "@/shared/ui/modal";
import { ActionButton } from "@/shared/ui/ds";
import { DatePicker } from "@/shared/ui/date";

type Props = {
  open: boolean;
  onClose: () => void;
};

export default function CreateWorkRecordModal({ open, onClose }: Props) {
  const { staffId, range, locked } = useWorkMonth();

  const { createM } = useWorkRecords({
    staff: staffId,
    date_from: range.from,
    date_to: range.to,
  });

  const workTypesQ = useQuery({
    queryKey: ["staff-work-types", staffId],
    queryFn: () => fetchStaffWorkTypes(staffId),
    enabled: open,
  });

  const staffWorkTypes = workTypesQ.data ?? [];

  const [form, setForm] = useState({
    date: range.from,
    work_type: undefined as number | undefined,
    start_time: "",
    end_time: "",
    break_minutes: 0,
    memo: "",
  });

  useEffect(() => {
    if (open) {
      setForm((p) => ({ ...p, date: range.from, work_type: undefined }));
    }
  }, [open, range.from]);

  if (locked) return null;

  return (
    <AdminModal open={open} onClose={onClose} type="action">
      <ModalHeader
        title="ê·¼ë¬´ ê¸°ë¡ ì¶”ê°€"
        description="ì§ì›ì˜ ê·¼ë¬´ ê¸°ë¡ì„ ë“±ë¡í•©ë‹ˆë‹¤."
        type="action"
      />

      <ModalBody>
        <div className="grid gap-3">
          <Field label="ë‚ ì§œ">
            <DatePicker
              value={form.date}
              onChange={(v) =>
                setForm((p) => ({ ...p, date: v }))
              }
            />
          </Field>

          <Field label="ê·¼ë¬´ìœ í˜• *">
            <select
              className="ds-input"
              value={form.work_type ?? ""}
              onChange={(e) =>
                setForm((p) => ({
                  ...p,
                  work_type: e.target.value
                    ? Number(e.target.value)
                    : undefined,
                }))
              }
            >
              <option value="">ì„ íƒ</option>
              {staffWorkTypes.map((st) => (
                <option key={st.id} value={st.work_type.id}>
                  {st.work_type.name}
                </option>
              ))}
            </select>
          </Field>

          <div className="grid grid-cols-2 gap-3">
            <Field label="ì‹œì‘ ì‹œê°„ *">
              <input
                type="time"
                className="ds-input"
                value={form.start_time}
                onChange={(e) =>
                  setForm((p) => ({ ...p, start_time: e.target.value }))
                }
              />
            </Field>

            <Field label="ì¢…ë£Œ ì‹œê°„ *">
              <input
                type="time"
                className="ds-input"
                value={form.end_time}
                onChange={(e) =>
                  setForm((p) => ({ ...p, end_time: e.target.value }))
                }
              />
            </Field>
          </div>

          <Field label="íœ´ê²Œì‹œê°„(ë¶„)">
            <input
              type="number"
              className="ds-input"
              min={0}
              value={form.break_minutes}
              onChange={(e) =>
                setForm((p) => ({
                  ...p,
                  break_minutes: Number(e.target.value),
                }))
              }
            />
          </Field>

          <Field label="ë©”ëª¨">
            <textarea
              className="ds-input"
              rows={3}
              value={form.memo}
              onChange={(e) =>
                setForm((p) => ({ ...p, memo: e.target.value }))
              }
            />
          </Field>
        </div>
      </ModalBody>

      <ModalFooter
        right={
          <>
            <ActionButton action="close" onClick={onClose} />
            <ActionButton
              action="create"
              loading={createM.isPending}
              onClick={() => {
                if (
                  !form.work_type ||
                  !form.start_time ||
                  !form.end_time
                ) {
                  alert("í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”.");
                  return;
                }

                createM.mutate(
                  {
                    staff: staffId,
                    work_type: form.work_type,
                    date: form.date,
                    start_time: form.start_time,
                    end_time: form.end_time,
                    break_minutes: form.break_minutes,
                    memo: form.memo,
                  },
                  {
                    onSuccess: () => {
                      onClose();
                      setForm({
                        date: range.from,
                        work_type: undefined,
                        start_time: "",
                        end_time: "",
                        break_minutes: 0,
                        memo: "",
                      });
                    },
                  }
                );
              }}
            >
              ì¶”ê°€
            </ActionButton>
          </>
        }
      />
    </AdminModal>
  );
}

function Field({
  label,
  children,
}: {
  label: string;
  children: React.ReactNode;
}) {
  return (
    <div className="grid gap-1">
      <div className="text-xs font-semibold text-[var(--text-muted)]">
        {label}
      </div>
      {children}
    </div>
  );
}


==========================================================================================
# FILE: pages/OperationsPage/ExpensesPanel.tsx
==========================================================================================
// PATH: src/features/staff/pages/OperationsPage/ExpensesPanel.tsx
import { useMemo, useState } from "react";
import { useWorkMonth } from "../../operations/context/WorkMonthContext";
import { useExpenses } from "../../hooks/useExpenses";
import CreateExpenseModal from "./CreateExpenseModal";
import ActionButton from "../../components/ActionButton";
import { ExpenseStatusBadge, LockBadge } from "../../components/StatusBadge";

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

function fmtDateTime(v?: string | null) {
  if (!v) return "-";
  const d = new Date(v);
  if (Number.isNaN(d.getTime())) return "-";
  return d.toLocaleString();
}

export default function ExpensesPanel() {
  const { staffId, range, locked, canManage } = useWorkMonth();

  const { listQ, patchM } = useExpenses({
    staff: staffId,
    date_from: range.from,
    date_to: range.to,
  });

  const [open, setOpen] = useState(false);

  const rows = useMemo(() => listQ.data ?? [], [listQ.data]);

  if (listQ.isLoading) {
    return (
      <div className="rounded-2xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-5 py-4">
        <div className="text-sm text-[var(--text-muted)]">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </div>
    );
  }

  return (
    <div
      className={cx(
        "rounded-2xl border border-[var(--border-divider)] bg-[var(--bg-surface)]",
        "overflow-hidden"
      )}
    >
      <div
        className={cx(
          "px-5 py-4 border-b border-[var(--border-divider)]",
          locked ? "bg-[var(--color-danger-soft)]" : "bg-[var(--bg-surface-soft)]"
        )}
      >
        <div className="flex items-start justify-between gap-4">
          <div className="space-y-1">
            <div className="flex items-center gap-2">
              <div className="text-sm font-semibold">ë¹„ìš©</div>
              {locked && <LockBadge state="LOCKED" />}
              <span className="text-xs text-[var(--text-muted)]">
                ({range.from} ~ {range.to})
              </span>
            </div>
            <div className="text-[11px] text-[var(--text-muted)]">
              * ìƒíƒœ/ìŠ¹ì¸/ë°˜ë ¤ëŠ” ì„œë²„ ê¸°ì¤€ì´ë©°, í”„ë¡ íŠ¸ëŠ” í‘œì‹œ/ì•¡ì…˜ë§Œ ìˆ˜í–‰í•©ë‹ˆë‹¤.
            </div>
          </div>

          <div className="shrink-0">
            <ActionButton
              variant="primary"
              size="xs"
              disabledReason={locked ? "ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤." : ""}
              onClick={() => setOpen(true)}
            >
              + ì¶”ê°€
            </ActionButton>
          </div>
        </div>

        {locked && (
          <div className="mt-2 text-xs text-[var(--color-danger)]">
            ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤ Â· ìƒì„±/ìˆ˜ì •/ìŠ¹ì¸/ë°˜ë ¤ ë¶ˆê°€
          </div>
        )}
      </div>

      <div className={cx("p-5", locked && "opacity-95")}>
        {rows.length === 0 ? (
          <div className="rounded-2xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-5 py-5">
            <div className="text-sm font-semibold">ë¹„ìš© ì—†ìŒ</div>
            <div className="text-xs text-[var(--text-muted)] mt-1">
              ë¹„ìš©ì„ ì¶”ê°€í•˜ë©´ ì´ê³³ì— ë¦¬ìŠ¤íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤.
            </div>
          </div>
        ) : (
          <div className="space-y-2">
            {rows.map((r) => {
              const isPending = r.status === "PENDING";
              const actionDisabled = locked || patchM.isPending;

              return (
                <div
                  key={r.id}
                  className="rounded-xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-4 py-3"
                >
                  <div className="flex items-start justify-between gap-4">
                    <div className="min-w-0 space-y-2">
                      <div className="font-semibold">
                        {r.date} Â· {r.title}
                      </div>

                      <div className="flex flex-wrap items-center gap-2">
                        <ExpenseStatusBadge status={r.status} />
                        {r.status !== "PENDING" && (
                          <div className="text-xs text-[var(--text-muted)]">
                            ìŠ¹ì¸ì: {r.approved_by_name ?? "-"} Â· {fmtDateTime(r.approved_at)}
                          </div>
                        )}
                      </div>

                      {!!r.memo && (
                        <div className="text-xs text-[var(--text-muted)]">
                          ë©”ëª¨: {r.memo}
                        </div>
                      )}
                    </div>

                    <div className="shrink-0 text-right">
                      <div className="text-xs text-[var(--text-muted)]">ê¸ˆì•¡</div>
                      <div className="font-semibold">{r.amount.toLocaleString()}ì›</div>
                    </div>
                  </div>

                  {/* ê´€ë¦¬ì ì•¡ì…˜: PENDINGë§Œ ìŠ¹ì¸/ë°˜ë ¤, ë©”ëª¨ ìˆ˜ì • */}
                  {canManage && (
                    <div className="mt-3 pt-3 border-t border-[var(--border-divider)] flex flex-col gap-2">
                      <div className="flex items-center justify-between gap-2">
                        <div className="flex items-center gap-2">
                          <ActionButton
                            variant="success"
                            size="xs"
                            disabledReason={
                              actionDisabled
                                ? locked
                                  ? "ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤."
                                  : "ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤."
                                : !isPending
                                ? "ëŒ€ê¸° ìƒíƒœì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤."
                                : ""
                            }
                            onClick={() => {
                              if (actionDisabled || !isPending) return;
                              if (!confirm("ì´ ë¹„ìš©ì„ ìŠ¹ì¸í• ê¹Œìš”?")) return;
                              patchM.mutate({ id: r.id, payload: { status: "APPROVED" } });
                            }}
                          >
                            ìŠ¹ì¸
                          </ActionButton>

                          <ActionButton
                            variant="danger-outline"
                            size="xs"
                            disabledReason={
                              actionDisabled
                                ? locked
                                  ? "ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤."
                                  : "ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤."
                                : !isPending
                                ? "ëŒ€ê¸° ìƒíƒœì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤."
                                : ""
                            }
                            onClick={() => {
                              if (actionDisabled || !isPending) return;
                              if (!confirm("ì´ ë¹„ìš©ì„ ë°˜ë ¤í• ê¹Œìš”?")) return;
                              patchM.mutate({ id: r.id, payload: { status: "REJECTED" } });
                            }}
                          >
                            ë°˜ë ¤
                          </ActionButton>
                        </div>

                        <div className="text-[11px] text-[var(--text-muted)]">
                          * ìŠ¹ì¸ í›„ ìˆ˜ì • ë¶ˆê°€(ì„œë²„ ê·œì¹™)
                        </div>
                      </div>

                      <div className="flex items-center gap-2">
                        <div className="text-xs text-[var(--text-muted)] shrink-0 w-[52px]">
                          ë©”ëª¨
                        </div>
                        <input
                          className="h-[34px] rounded-lg border border-[var(--border-divider)] bg-[var(--bg-surface)] px-3 text-sm w-full"
                          placeholder="ë©”ëª¨ ìˆ˜ì • (ìŠ¹ì¸ í›„ì—ëŠ” backendê°€ ê±°ì ˆ)"
                          defaultValue={r.memo}
                          disabled={actionDisabled}
                          onBlur={(e) => {
                            const next = e.target.value ?? "";
                            if (next === (r.memo ?? "")) return;
                            if (actionDisabled) return;

                            patchM.mutate(
                              { id: r.id, payload: { memo: next } },
                              {
                                onError: (err: any) => {
                                  const msg =
                                    err?.response?.data?.detail ||
                                    err?.response?.data?.message ||
                                    "ë©”ëª¨ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
                                  alert(msg);
                                },
                              }
                            );
                          }}
                        />
                      </div>
                    </div>
                  )}
                </div>
              );
            })}
          </div>
        )}

        {!locked && <CreateExpenseModal open={open} onClose={() => setOpen(false)} />}
      </div>

      <div className="px-5 pb-4">
        <div className="text-[11px] text-[var(--text-muted)]">
          * ìŠ¹ì¸/ë°˜ë ¤/ì ê¸ˆ ê·œì¹™ì€ ì„œë²„ ë‹¨ì¼ì§„ì‹¤ì…ë‹ˆë‹¤. í”„ë¡ íŠ¸ëŠ” UXë¡œë§Œ ì•ˆë‚´/ì°¨ë‹¨í•©ë‹ˆë‹¤.
        </div>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: pages/OperationsPage/MonthLockPanel.tsx
==========================================================================================
// PATH: src/features/staff/pages/OperationsPage/MonthLockPanel.tsx
import ActionButton from "../../components/ActionButton";
import { LockBadge } from "../../components/StatusBadge";
import { useWorkMonth } from "../../operations/context/WorkMonthContext";

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

export default function MonthLockPanel() {
  const { year, month, locked, canManage, lockM } = useWorkMonth();

  const disabledReason = locked
    ? "ì´ë¯¸ ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤."
    : !canManage
    ? "ë§ˆê°ì€ ê´€ë¦¬ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤."
    : "";

  return (
    <div
      className={cx(
        "rounded-2xl border px-5 py-4 space-y-2",
        locked
          ? "border-[color-mix(in_srgb,var(--color-danger)_55%,transparent)] bg-[var(--color-danger-soft)]"
          : "border-[color-mix(in_srgb,var(--color-success)_55%,transparent)] bg-[var(--color-success-soft)]"
      )}
    >
      <div className="flex items-start justify-between gap-4">
        <div className="space-y-1">
          <div className="flex items-center gap-2">
            <div className="text-sm font-semibold">
              {year}ë…„ {month}ì›”
            </div>
            <LockBadge state={locked ? "LOCKED" : "OPEN"} />
          </div>

          <div className="text-[11px] text-[var(--text-muted)] leading-relaxed">
            * <b>ì›” ë§ˆê° = ê¸‰ì—¬ í™•ì •</b> Â· ë§ˆê° í›„ ê·¼ë¬´/ë¹„ìš© <b>ìƒì„±Â·ìˆ˜ì •Â·ì‚­ì œ</b> ë¶ˆê°€
            <br />
            * ê¸‰ì—¬ ìŠ¤ëƒ…ìƒ·(PayrollSnapshot)ì´ ìƒì„±ë˜ë©° ì´í›„ ë³€ê²½ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
          </div>
        </div>

        <div className="shrink-0 flex items-center gap-2">
          <ActionButton
            variant="danger"
            size="sm"
            disabledReason={disabledReason || (lockM.isPending ? "ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤." : "")}
            title={
              disabledReason ||
              "ì´ë²ˆ ë‹¬ ê·¼ë¬´/ë¹„ìš©ì„ í™•ì •í•©ë‹ˆë‹¤. ì´í›„ ìˆ˜ì •Â·ì‚­ì œ ë¶ˆê°€í•˜ë©° ê¸‰ì—¬ ìŠ¤ëƒ…ìƒ·ì´ ìƒì„±ë©ë‹ˆë‹¤."
            }
            onClick={() => {
              if (disabledReason || lockM.isPending) return;

              if (
                !confirm(
                  [
                    `${year}ë…„ ${month}ì›”ì„ ë§ˆê°í• ê¹Œìš”?`,
                    "",
                    "- ë§ˆê° í›„ì—ëŠ” ê·¼ë¬´/ë¹„ìš© ìˆ˜ì •Â·ì‚­ì œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.",
                    "- ê¸‰ì—¬ ìŠ¤ëƒ…ìƒ·ì´ ìƒì„±ë©ë‹ˆë‹¤.",
                  ].join("\n")
                )
              )
                return;

              lockM.mutate();
            }}
          >
            ì›” ë§ˆê°
          </ActionButton>
        </div>
      </div>

      {locked && (
        <div className="rounded-xl border border-[color-mix(in_srgb,var(--color-danger)_45%,transparent)] bg-[color-mix(in_srgb,var(--color-danger-soft)_70%,white)] px-4 py-3">
          <div className="text-sm font-semibold text-[var(--color-danger)]">
            ë§ˆê° ì™„ë£Œ: ì´ ë‹¬ì€ í™•ì • ë°ì´í„°ì…ë‹ˆë‹¤.
          </div>
          <div className="text-xs text-[var(--text-muted)] mt-1">
            ë§ˆê°ëœ ì›”ì€ ë³€ê²½ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. (ì„œë²„ì—ì„œ 400ìœ¼ë¡œ ë³´ì¥)
          </div>
        </div>
      )}
    </div>
  );
}


==========================================================================================
# FILE: pages/OperationsPage/OperationsPage.tsx
==========================================================================================
// PATH: src/features/staff/pages/OperationsPage/OperationsPage.tsx
// Design: docs/DESIGN_SSOT.md ë‹¨ì¼ì§„ì‹¤

import { useMemo } from "react";
import { useSearchParams } from "react-router-dom";
import { WorkMonthProvider } from "../../operations/context/WorkMonthContext";

import StaffOperationTable from "./StaffOperationTable";
import MonthLockPanel from "./MonthLockPanel";
import WorkRecordsPanel from "./WorkRecordsPanel";
import ExpensesPanel from "./ExpensesPanel";
import { SectionHeader, EmptyState } from "@/shared/ui/ds";

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

function getThisMonth() {
  const d = new Date();
  return {
    year: d.getFullYear(),
    month: d.getMonth() + 1,
  };
}

function ymLabel(y: number, m: number) {
  return `${y}ë…„ ${m}ì›”`;
}

export default function OperationsPage() {
  const [params] = useSearchParams();
  const staffId = Number(params.get("staffId"));

  const { year, month } = useMemo(getThisMonth, []);
  const monthText = useMemo(() => ymLabel(year, month), [year, month]);

  return (
    <div className="flex flex-col gap-4">
      <SectionHeader
        title="ì‘ì—…"
        description={`${monthText} Â· ê·¼ë¬´/ë¹„ìš© ì…ë ¥ ë° ì›” ë§ˆê°(ê¸‰ì—¬ í™•ì •) ì²˜ë¦¬. í•©ê³„/ê¸‰ì—¬/ì‹œê°„/ìƒíƒœ íŒì •ì€ ë°±ì—”ë“œ ë‹¨ì¼ì§„ì‹¤ì…ë‹ˆë‹¤.`}
      />

      <div className="grid grid-cols-[320px_1fr] gap-6">
        <div className="ds-panel-card">
          <div className="ds-panel-card__header px-4 py-3">
            <div className="text-sm font-semibold text-[var(--color-text-primary)]">ì§ì› ì„ íƒ</div>
            <div className="text-[12px] text-[var(--color-text-muted)] mt-0.5">
              ì¢Œì¸¡ì—ì„œ ì§ì›ì„ ì„ íƒí•˜ë©´ ìš°ì¸¡ ì‘ì—… ì½˜ì†”ì´ í™œì„±í™”ë©ë‹ˆë‹¤.
            </div>
          </div>

          <div className="p-3">
            <StaffOperationTable selectedStaffId={staffId} />
          </div>

          <div className="px-4 pb-4 pt-2 text-[11px] text-[var(--color-text-muted)]">
            * ì§ì› ì„ íƒì€ â€œì„ íƒâ€ UIì´ë©°, ê³„ì‚°/ì¶”ë¡ ì´ ì•„ë‹™ë‹ˆë‹¤.
          </div>
        </div>

        <div className="ds-panel-card min-h-[520px]">
          <div className="ds-panel-card__header px-5 py-4">
            <div className="flex items-start justify-between gap-4">
              <div className="space-y-1">
                <div className="text-sm font-semibold text-[var(--color-text-primary)]">ì‘ì—… ì½˜ì†”</div>
                <div className="text-xs text-[var(--color-text-muted)]">
                  {staffId ? (
                    <>ì„ íƒëœ ì§ì› ê¸°ì¤€ìœ¼ë¡œ <b>{monthText}</b> ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</>
                  ) : (
                    <>ë¨¼ì € ì¢Œì¸¡ì—ì„œ <b>ì§ì›</b>ì„ ì„ íƒí•˜ì„¸ìš”.</>
                  )}
                </div>
              </div>
              <div className="text-xs text-[var(--color-text-muted)]">
                {staffId ? <>ì§ì› ID: <span className="font-semibold">{staffId}</span></> : <>ìƒíƒœ: <span className="font-semibold">ëŒ€ê¸°</span></>}
              </div>
            </div>
          </div>

          {!staffId ? (
            <div className="p-8">
              <EmptyState
                scope="panel"
                tone="empty"
                title="ì§ì›ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
                description="ì¢Œì¸¡ ì§ì› ì„ íƒì—ì„œ ì§ì›ì„ í´ë¦­í•˜ë©´, ì´ ì˜ì—­ì— ì›” ë§ˆê°Â·ê·¼ë¬´ ê¸°ë¡Â·ë¹„ìš© ì‘ì—… íŒ¨ë„ì´ í™œì„±í™”ë©ë‹ˆë‹¤. ë§ˆê°ëœ ì›”ì€ ìƒì„±/ìˆ˜ì •/ì‚­ì œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤."
              />
            </div>
          ) : (
            <WorkMonthProvider staffId={staffId} year={year} month={month}>
              <div className="p-5 space-y-4">
                <MonthLockPanel />
                <WorkRecordsPanel />
                <ExpensesPanel />
              </div>
            </WorkMonthProvider>
          )}
        </div>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: pages/OperationsPage/StaffOperationTable.tsx
==========================================================================================
// PATH: src/features/staff/pages/OperationsPage/StaffOperationTable.tsx
// Design: docs/DESIGN_SSOT.md
// ì§ì› ì„ íƒ: ì•„ë°”íƒ€Â·ì´ë¦„Â·ì§ìœ„Â·ê¸‰ì—¬ìœ í˜• í•œ ì¤„ í‘œì‹œ. ë¦¬ìŠ¤íŠ¸ í–‰ ìŠ¤íƒ€ì¼(ì¹´ë“œ ì•ˆ ì¹´ë“œ ì—†ìŒ, students ë„ë©”ì¸ í†¤).

import { useMemo, useState } from "react";
import { useStaffs } from "../../hooks/useStaffs";
import { useNavigate, useSearchParams } from "react-router-dom";
import { Staff } from "../../api/staff.api";
import { EmptyState } from "@/shared/ui/ds";
import { StaffRoleAvatar } from "@/shared/ui/avatars";

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

function payLabel(v: Staff["pay_type"]) {
  return v === "HOURLY" ? "ì‹œê¸‰" : "ì›”ê¸‰";
}

/** basePath: í•´ë‹¹ íƒ­ ê²½ë¡œ (attendance | expenses | month-lock ë“±) */
export default function StaffOperationTable({
  selectedStaffId,
  basePath = "operations",
}: {
  selectedStaffId?: number;
  basePath?: "operations" | "attendance" | "expenses" | "month-lock" | "reports";
}) {
  const { data, isLoading } = useStaffs();
  const navigate = useNavigate();
  const [params] = useSearchParams();
  const [q, setQ] = useState("");

  /** ì‘ì—… ì½˜ì†”ì€ Staffë§Œ ëŒ€ìƒ(ì›ì¥ ì œì™¸) */
  const staffs: Staff[] = Array.isArray(data?.staffs) ? data!.staffs : [];

  // âœ… UX: ê²€ìƒ‰ì€ â€œí•„í„°ë§(ì„ íƒ)â€ì´ë©° ê³„ì‚°/ì¶”ë¡ ì´ ì•„ë‹˜
  const filtered = useMemo(() => {
    const needle = q.trim().toLowerCase();
    if (!needle) return staffs;

    return staffs.filter((s) => {
      const name = (s.name ?? "").toLowerCase();
      const phone = (s.phone ?? "").toLowerCase();
      return name.includes(needle) || phone.includes(needle);
    });
  }, [staffs, q]);

  const active = filtered.filter((s) => s.is_active);
  const inactive = filtered.filter((s) => !s.is_active);

  const pick = (id: number) => {
    params.set("staffId", String(id));
    navigate(`/admin/staff/${basePath}?${params.toString()}`);
  };

  return (
    <div className="space-y-3">
      <input
        type="search"
        className="ds-input w-full"
        value={q}
        onChange={(e) => setQ(e.target.value)}
        placeholder="ì´ë¦„/ì „í™”ë²ˆí˜¸ ê²€ìƒ‰"
        aria-label="ì§ì› ê²€ìƒ‰"
      />

      {isLoading && (
        <EmptyState scope="panel" tone="loading" title="ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦" />
      )}

      {!isLoading && staffs.length === 0 && (
        <EmptyState
          scope="panel"
          tone="empty"
          title="ì§ì› ì—†ìŒ"
          description="ì§ì›ì´ ë“±ë¡ë˜ì–´ì•¼ ì‘ì—… ì½˜ì†”ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
        />
      )}

      {!isLoading && staffs.length > 0 && filtered.length === 0 && (
        <EmptyState
          scope="panel"
          tone="empty"
          title="ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ"
          description="ì´ë¦„ ë˜ëŠ” ì „í™”ë²ˆí˜¸ë¡œ ë‹¤ì‹œ ê²€ìƒ‰í•´ë³´ì„¸ìš”."
        />
      )}

      {!isLoading && filtered.length > 0 && (
        <div className="space-y-4">
          <Section title={`í™œì„± (${active.length})`} emptyText="í™œì„± ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.">
            {active.map((s) => (
              <Row
                key={s.id}
                staff={s}
                selected={s.id === selectedStaffId}
                onClick={() => pick(s.id)}
              />
            ))}
          </Section>

          <Section title={`ë¹„í™œì„± (${inactive.length})`} emptyText="ë¹„í™œì„± ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.">
            {inactive.map((s) => (
              <Row
                key={s.id}
                staff={s}
                selected={s.id === selectedStaffId}
                onClick={() => pick(s.id)}
              />
            ))}
          </Section>
        </div>
      )}

      <p className="text-[11px] text-[var(--color-text-muted)]">
        * ì„ íƒëœ ì§ì›ì´ ìš°ì¸¡ íŒ¨ë„ì— ë°˜ì˜ë©ë‹ˆë‹¤.
      </p>
    </div>
  );
}

function Section({
  title,
  emptyText,
  children,
}: {
  title: string;
  emptyText: string;
  children: React.ReactNode;
}) {
  const hasItems = !!children && Array.isArray(children) ? children.length > 0 : true;

  return (
    <div className="space-y-1.5">
      <div className="text-xs font-semibold text-[var(--color-text-secondary)] px-0.5">{title}</div>
      {!hasItems ? (
        <div className="rounded-lg bg-[var(--color-bg-surface-soft)] px-3 py-2.5 text-sm text-[var(--color-text-muted)]">
          {emptyText}
        </div>
      ) : (
        <div className="rounded-xl border border-[var(--color-border-divider)] overflow-hidden bg-[var(--color-bg-surface)]">
          {children}
        </div>
      )}
    </div>
  );
}

function Row({
  staff,
  selected,
  onClick,
}: {
  staff: Staff;
  selected: boolean;
  onClick: () => void;
}) {
  return (
    <button
      type="button"
      onClick={onClick}
      className={cx(
        "w-full text-left flex items-center gap-2.5 px-3 py-2.5 border-b border-[var(--color-border-divider)] last:border-b-0 transition-colors",
        "focus:outline-none focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-[var(--color-border-focus)]/50",
        selected
          ? "bg-[var(--state-selected-bg)]"
          : "hover:bg-[var(--color-bg-surface-soft)]"
      )}
    >
      <StaffRoleAvatar role={staff.role} size={20} className="shrink-0 text-[var(--color-text-secondary)]" />
      <span className="min-w-0 flex-1 truncate text-sm font-medium text-[var(--color-text-primary)]">
        {staff.name}
      </span>
      {!staff.is_active && (
        <span className="ds-status-badge shrink-0" data-status="inactive" aria-hidden>ë¹„í™œì„±</span>
      )}
      <span className="ds-status-badge ds-status-badge--action shrink-0" data-tone={staff.role === "TEACHER" ? "primary" : "neutral"} aria-label={staff.role === "TEACHER" ? "ê°•ì‚¬" : "ì¡°êµ"}>
        {staff.role === "TEACHER" ? "ê°•ì‚¬" : "ì¡°êµ"}
      </span>
      <span className="ds-status-badge shrink-0" data-tone="neutral">
        {payLabel(staff.pay_type)}
      </span>
    </button>
  );
}


==========================================================================================
# FILE: pages/OperationsPage/WorkRecordsPanel.tsx
==========================================================================================
// PATH: src/features/staff/pages/OperationsPage/WorkRecordsPanel.tsx
import { useState } from "react";
import ActionButton from "../../components/ActionButton";
import { LockBadge } from "../../components/StatusBadge";
import { useWorkMonth } from "../../operations/context/WorkMonthContext";
import { useWorkRecords } from "../../hooks/useWorkRecords";
import CreateWorkRecordModal from "./CreateWorkRecordModal";

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

export default function WorkRecordsPanel() {
  const { staffId, range, locked } = useWorkMonth();
  const { listQ, deleteM } = useWorkRecords({
    staff: staffId,
    date_from: range.from,
    date_to: range.to,
  });

  const [open, setOpen] = useState(false);

  if (listQ.isLoading) {
    return (
      <div className="rounded-2xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-5 py-4">
        <div className="text-sm text-[var(--text-muted)]">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </div>
    );
  }

  const rows = listQ.data ?? [];

  return (
    <div
      className={cx(
        "rounded-2xl border border-[var(--border-divider)] bg-[var(--bg-surface)]",
        "overflow-hidden"
      )}
    >
      <div
        className={cx(
          "px-5 py-4 border-b border-[var(--border-divider)]",
          locked ? "bg-[var(--color-danger-soft)]" : "bg-[var(--bg-surface-soft)]"
        )}
      >
        <div className="flex items-start justify-between gap-4">
          <div className="space-y-1">
            <div className="flex items-center gap-2">
              <div className="text-sm font-semibold">ê·¼ë¬´ ê¸°ë¡</div>
              {locked && <LockBadge state="LOCKED" />}
              <span className="text-xs text-[var(--text-muted)]">
                ({range.from} ~ {range.to})
              </span>
            </div>
            <div className="text-[11px] text-[var(--text-muted)]">
              * ê·¼ë¬´ì‹œê°„Â·ê¸ˆì•¡ì€ ì„œë²„ì—ì„œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤. (í”„ë¡ íŠ¸ ê³„ì‚° ê¸ˆì§€)
            </div>
          </div>

          <div className="shrink-0">
            <ActionButton
              variant="primary"
              size="xs"
              disabledReason={locked ? "ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤." : ""}
              onClick={() => setOpen(true)}
            >
              + ì¶”ê°€
            </ActionButton>
          </div>
        </div>

        {locked && (
          <div className="mt-2 text-xs text-[var(--color-danger)]">
            ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤ Â· ìƒì„±/ìˆ˜ì •/ì‚­ì œ ë¶ˆê°€
          </div>
        )}
      </div>

      <div className={cx("p-5", locked && "opacity-95")}>
        {rows.length === 0 ? (
          <div className="rounded-2xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-5 py-5">
            <div className="text-sm font-semibold">ê¸°ë¡ ì—†ìŒ</div>
            <div className="text-xs text-[var(--text-muted)] mt-1">
              ê·¼ë¬´ ê¸°ë¡ì„ ì¶”ê°€í•˜ë©´ ì´ê³³ì— ë¦¬ìŠ¤íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤.
            </div>
          </div>
        ) : (
          <div className="space-y-2">
            {rows.map((r) => (
              <div
                key={r.id}
                className="rounded-xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-4 py-3"
              >
                <div className="flex items-start justify-between gap-4">
                  <div className="min-w-0">
                    <div className="font-semibold">
                      {r.date} Â· {r.work_type_name}
                    </div>
                    <div className="text-xs text-[var(--text-muted)] mt-1">
                      {r.start_time} ~ {r.end_time}{" "}
                      {typeof r.break_minutes === "number" && r.break_minutes > 0
                        ? `Â· íœ´ê²Œ ${r.break_minutes}ë¶„`
                        : ""}
                    </div>
                    {!!r.memo && (
                      <div className="text-xs text-[var(--text-muted)] mt-1">
                        ë©”ëª¨: {r.memo}
                      </div>
                    )}
                  </div>

                  <div className="shrink-0 flex items-center gap-3">
                    <div className="text-right">
                      <div className="text-xs text-[var(--text-muted)]">ê¸ˆì•¡</div>
                      <div className="font-semibold">
                        {r.amount?.toLocaleString() ?? "-"}ì›
                      </div>
                    </div>

                    <ActionButton
                      variant="danger-outline"
                      size="xs"
                      disabledReason={locked ? "ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤." : deleteM.isPending ? "ì²˜ë¦¬ ì¤‘..." : ""}
                      onClick={() => {
                        if (locked || deleteM.isPending) return;
                        if (!confirm("ì´ ê·¼ë¬´ ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?")) return;
                        deleteM.mutate(r.id);
                      }}
                    >
                      ì‚­ì œ
                    </ActionButton>
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}

        {!locked && <CreateWorkRecordModal open={open} onClose={() => setOpen(false)} />}
      </div>

      <div className="px-5 pb-4">
        <div className="text-[11px] text-[var(--text-muted)]">
          * ë§ˆê°ëœ ì›”ì€ ì„œë²„ì—ì„œ ë³€ê²½ì„ ê±°ë¶€í•©ë‹ˆë‹¤(400). í”„ë¡ íŠ¸ëŠ” UXë¡œë§Œ ì°¨ë‹¨í•©ë‹ˆë‹¤.
        </div>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: pages/PayrollSnapshotPage/PayrollSnapshotPage.tsx
==========================================================================================
// PATH: src/features/staff/pages/PayrollSnapshotPage/PayrollSnapshotPage.tsx
// ê¸‰ì—¬ ìŠ¤ëƒ…ìƒ·: ì›”ë³„ í™•ì • ê·¼ë¬´ì‹œê°„Â·ê¸‰ì—¬Â·ê²½ë¹„ ìš”ì•½
// â€» ì§ì› ì—´ ë±ƒì§€/ê¸‰ì—¬í˜•íƒœëŠ” í™ˆ(ê·¼íƒœ) íƒ­ê³¼ ë™ì¼ SSOT: StaffRoleAvatar, RoleBadge, payLabel

import { useMemo, useState } from "react";
import { useQuery } from "@tanstack/react-query";
import {
  fetchPayrollSnapshots,
  exportPayrollSnapshotExcel,
  type PayrollSnapshot,
} from "../../api/payrollSnapshots.api";
import { exportPayrollSnapshotPDF } from "../../api/payrollSnapshotPdf.api";
import { useStaffs } from "../../hooks/useStaffs";
import type { Staff } from "../../api/staff.api";
import { StaffRoleAvatar } from "@/shared/ui/avatars";
import { RoleBadge } from "../../components/StatusBadge";
import ActionButton from "../../components/ActionButton";

function ymLabel(y: number, m: number) {
  return `${y}ë…„ ${m}ì›”`;
}

function payLabel(payType: Staff["pay_type"]) {
  return payType === "HOURLY" ? "ì‹œê¸‰" : "ì›”ê¸‰";
}

export default function PayrollSnapshotPage() {
  const now = useMemo(() => new Date(), []);
  const [ym, setYm] = useState({
    year: now.getFullYear(),
    month: now.getMonth() + 1,
  });

  const { data: staffsData } = useStaffs();
  const staffById = useMemo(() => {
    const list = Array.isArray(staffsData?.staffs) ? staffsData!.staffs : [];
    return new Map(list.map((s) => [s.id, s]));
  }, [staffsData]);

  const listQ = useQuery({
    queryKey: ["payroll-snapshots", ym.year, ym.month],
    queryFn: () => fetchPayrollSnapshots({ year: ym.year, month: ym.month }),
  });

  const rows: PayrollSnapshot[] = useMemo(() => listQ.data ?? [], [listQ.data]);
  const [exportingExcel, setExportingExcel] = useState(false);
  const [exportingPdfStaffId, setExportingPdfStaffId] = useState<number | null>(null);

  const handleExcel = async () => {
    setExportingExcel(true);
    try {
      await exportPayrollSnapshotExcel({ year: ym.year, month: ym.month });
    } finally {
      setExportingExcel(false);
    }
  };

  const handlePdf = async (staff: number) => {
    setExportingPdfStaffId(staff);
    try {
      await exportPayrollSnapshotPDF({ staff, year: ym.year, month: ym.month });
    } finally {
      setExportingPdfStaffId(null);
    }
  };

  return (
    <>
    <div className="ds-panel-card px-6 py-4">
        <div className="flex items-start justify-between gap-4 flex-wrap">
          <div className="space-y-1">
            <div className="text-sm font-semibold text-[var(--color-text-primary)]">ê¸°ì¤€ì›”</div>
            <div className="flex items-center gap-2 mt-2">
              <select
                value={ym.year}
                onChange={(e) => setYm((p) => ({ ...p, year: Number(e.target.value) }))}
                className="ds-input h-9 min-w-[88px]"
                aria-label="ì—°ë„"
              >
                {[ym.year - 1, ym.year, ym.year + 1].map((y) => (
                  <option key={y} value={y}>{y}ë…„</option>
                ))}
              </select>
              <select
                value={ym.month}
                onChange={(e) => setYm((p) => ({ ...p, month: Number(e.target.value) }))}
                className="ds-input h-9 min-w-[80px]"
                aria-label="ì›”"
              >
                {Array.from({ length: 12 }, (_, i) => i + 1).map((m) => (
                  <option key={m} value={m}>{m}ì›”</option>
                ))}
              </select>
            </div>
          </div>
          <div className="flex items-center gap-2">
            <ActionButton
              variant="primary"
              size="sm"
              disabled={exportingExcel || rows.length === 0}
              onClick={handleExcel}
            >
              {exportingExcel ? "ë‹¤ìš´ë¡œë“œ ì¤‘â€¦" : "ì—‘ì…€ ë‹¤ìš´ë¡œë“œ"}
            </ActionButton>
          </div>
        </div>
        <div className="mt-2 text-[11px] text-[var(--color-text-muted)]">
          * {ymLabel(ym.year, ym.month)} ì›” ë§ˆê° ì‹œ ìƒì„±ëœ ìŠ¤ëƒ…ìƒ·ë§Œ í‘œì‹œë©ë‹ˆë‹¤.
        </div>
    </div>

      {listQ.isLoading && (
        <div className="ds-panel-card p-8 text-center text-[var(--color-text-muted)]">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
      )}

      {!listQ.isLoading && rows.length === 0 && (
        <div className="ds-panel-card p-8">
          <div className="text-sm font-semibold text-[var(--color-text-primary)]">í™•ì • ê¸‰ì—¬ ì—†ìŒ</div>
          <div className="text-xs text-[var(--color-text-muted)] mt-1">
            í•´ë‹¹ ì›”ì€ ì•„ì§ ë§ˆê°ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ê¸‰ì—¬ ìŠ¤ëƒ…ìƒ·ì´ ì—†ìŠµë‹ˆë‹¤. ì›” ë§ˆê° íƒ­ì—ì„œ ë§ˆê° í›„ í™•ì¸í•˜ì„¸ìš”.
          </div>
        </div>
      )}

      {!listQ.isLoading && rows.length > 0 && (
        <div className="ds-panel-card overflow-hidden">
          <div className="overflow-x-auto">
            <table className="w-full ds-table--flat" style={{ tableLayout: "fixed" }}>
              <thead>
                <tr>
                  <th className="text-left py-3 px-4 text-xs font-semibold text-[var(--color-text-muted)]">ì§ì›</th>
                  <th className="text-right py-3 px-4 text-xs font-semibold text-[var(--color-text-muted)]">ê·¼ë¬´ì‹œê°„</th>
                  <th className="text-right py-3 px-4 text-xs font-semibold text-[var(--color-text-muted)]">ê·¼ë¬´ê¸ˆì•¡</th>
                  <th className="text-right py-3 px-4 text-xs font-semibold text-[var(--color-text-muted)]">ìŠ¹ì¸ê²½ë¹„</th>
                  <th className="text-right py-3 px-4 text-xs font-semibold text-[var(--color-text-muted)]">ì´ ê¸‰ì—¬</th>
                  <th className="text-right py-3 px-4 text-xs font-semibold text-[var(--color-text-muted)]">ëª…ì„¸</th>
                </tr>
              </thead>
              <tbody>
                {rows.map((r) => {
                  const staff = staffById.get(r.staff);
                  return (
                  <tr key={r.id} className="border-t border-[var(--color-border-divider)]">
                    <td className="py-3 px-4 text-sm">
                      {staff ? (
                        <div className="flex items-center gap-2 flex-wrap">
                          <StaffRoleAvatar role={staff.role} size={20} className="shrink-0 text-[var(--color-text-secondary)]" />
                          <span className="font-medium text-[var(--color-text-primary)]">{r.staff_name}</span>
                          <RoleBadge isManager={!!staff.is_manager} />
                          <span className="text-xs text-[var(--color-text-muted)]">{payLabel(staff.pay_type)}</span>
                        </div>
                      ) : (
                        <span className="font-medium text-[var(--color-text-primary)]">{r.staff_name}</span>
                      )}
                    </td>
                    <td className="py-3 px-4 text-sm text-right">{r.work_hours}</td>
                    <td className="py-3 px-4 text-sm text-right">{r.work_amount.toLocaleString()}ì›</td>
                    <td className="py-3 px-4 text-sm text-right">{r.approved_expense_amount.toLocaleString()}ì›</td>
                    <td className="py-3 px-4 text-sm font-semibold text-right">{r.total_amount.toLocaleString()}ì›</td>
                    <td className="py-3 px-4 text-right">
                      <ActionButton
                        variant="outline"
                        size="xs"
                        disabled={exportingPdfStaffId === r.staff}
                        onClick={() => handlePdf(r.staff)}
                      >
                        {exportingPdfStaffId === r.staff ? "â€¦" : "PDF"}
                      </ActionButton>
                    </td>
                  </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
          <div className="px-4 pb-4 text-[11px] text-[var(--color-text-muted)]">
            * PDFëŠ” ì§ì›ë³„ ê¸‰ì—¬ëª…ì„¸, ì—‘ì…€ì€ í•´ë‹¹ ì›” ì „ì²´ ì§ì› ëª©ë¡ì…ë‹ˆë‹¤.
          </div>
        </div>
      )}
    </>
  );
}


==========================================================================================
# FILE: pages/ReportsPage/PayrollHistoryTable.tsx
==========================================================================================
// PATH: src/features/staff/pages/ReportsPage/PayrollHistoryTable.tsx
import { useMemo } from "react";
import { useParams } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";

import {
  fetchPayrollSnapshots,
  exportPayrollSnapshotExcel,
} from "../../api/payrollSnapshots.api";
import { exportPayrollSnapshotPDF } from "../../api/payrollSnapshotPdf.api";
import ActionButton from "../../components/ActionButton";

function ymLabel(y: number, m: number) {
  return `${y}-${String(m).padStart(2, "0")}`;
}

/** staffIdProp: ë¦¬í¬íŠ¸/ëª…ì„¸ í˜ì´ì§€ì—ì„œ ì¿¼ë¦¬ë¡œ ì „ë‹¬í•  ë•Œ ì‚¬ìš©. ì—†ìœ¼ë©´ useParams (ìƒì„¸ ì˜¤ë²„ë ˆì´) */
export default function PayrollHistoryTable({ staffId: staffIdProp }: { staffId?: number } = {}) {
  const { staffId: paramId } = useParams();
  const sid = staffIdProp ?? (paramId ? Number(paramId) : undefined);

  const listQ = useQuery({
    queryKey: ["payroll-history", sid],
    queryFn: () => fetchPayrollSnapshots({ staff: sid }),
    enabled: typeof sid === "number" && sid > 0,
  });

  const rows = useMemo(
    () =>
      (listQ.data ?? []).slice().sort(
        (a, b) => b.year * 100 + b.month - (a.year * 100 + a.month)
      ),
    [listQ.data]
  );

  if (!sid) {
    return (
      <div className="text-sm text-[var(--text-muted)]">
        ì§ì› ìƒì„¸ í™”ë©´ì—ì„œë§Œ ê¸‰ì—¬ íˆìŠ¤í† ë¦¬ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </div>
    );
  }

  if (listQ.isLoading) {
    return <div className="text-sm text-[var(--text-muted)]">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>;
  }

  if (rows.length === 0) {
    return (
      <div className="rounded-xl border border-[var(--border-divider)] bg-[var(--bg-surface-soft)] px-5 py-6">
        <div className="text-sm font-semibold">ê¸‰ì—¬ íˆìŠ¤í† ë¦¬ ì—†ìŒ</div>
        <div className="text-xs text-[var(--text-muted)] mt-1">
          ì•„ì§ ë§ˆê°ëœ ê¸‰ì—¬ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-3">
      {rows.map((r) => (
        <div
          key={r.id}
          className="rounded-lg border border-[var(--border-divider)] bg-[var(--bg-surface)] px-5 py-4 flex justify-between items-center gap-4"
        >
          <div>
            <div className="font-semibold">{ymLabel(r.year, r.month)}</div>
            <div className="text-xs text-[var(--text-muted)]">
              ìƒì„±:{" "}
              {r.created_at ? new Date(r.created_at).toLocaleString() : "-"}
            </div>
          </div>

          <div className="flex items-center gap-3">
            <div className="font-semibold">{r.total_amount.toLocaleString()}ì›</div>

            <ActionButton
              variant="outline"
              size="xs"
              onClick={() =>
                exportPayrollSnapshotPDF({
                  staff: sid as number,
                  year: r.year,
                  month: r.month,
                })
              }
            >
              PDF
            </ActionButton>

            <ActionButton
              variant="outline"
              size="xs"
              title="ì—‘ì…€ì€ í•´ë‹¹ ì›” ì „ì²´ ê¸‰ì—¬ ë‹¤ìš´ë¡œë“œì…ë‹ˆë‹¤."
              onClick={() =>
                exportPayrollSnapshotExcel({
                  year: r.year,
                  month: r.month,
                })
              }
            >
              XLSX
            </ActionButton>
          </div>
        </div>
      ))}
    </div>
  );
}


==========================================================================================
# FILE: pages/ReportsPage/PayrollSnapshotList.tsx
==========================================================================================
// PATH: src/features/staff/pages/ReportsPage/PayrollSnapshotList.tsx
import { useMemo } from "react";
import { useParams } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";

import {
  fetchPayrollSnapshots,
  exportPayrollSnapshotExcel,
} from "../../api/payrollSnapshots.api";
import { exportPayrollSnapshotPDF } from "../../api/payrollSnapshotPdf.api";
import ActionButton from "../../components/ActionButton";

export default function PayrollSnapshotList({
  year,
  month,
}: {
  year: number;
  month: number;
}) {
  const { staffId } = useParams();
  const sid = staffId ? Number(staffId) : undefined;

  const listQ = useQuery({
    queryKey: ["payroll-snapshots", sid, year, month],
    queryFn: () => fetchPayrollSnapshots({ staff: sid, year, month }),
    enabled: typeof sid === "number" && sid > 0,
  });

  const rows = useMemo(() => listQ.data ?? [], [listQ.data]);

  if (!sid) {
    return (
      <div className="rounded-xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-5 py-4 text-sm text-[var(--text-muted)]">
        ì§ì› ìƒì„¸ í™”ë©´ì—ì„œë§Œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.
      </div>
    );
  }

  if (listQ.isLoading) {
    return <div className="text-sm text-[var(--text-muted)]">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>;
  }

  if (rows.length === 0) {
    return (
      <div className="rounded-xl border border-[var(--border-divider)] bg-[var(--bg-surface-soft)] px-5 py-6">
        <div className="text-sm font-semibold">í™•ì • ê¸‰ì—¬ ì—†ìŒ</div>
        <div className="text-xs text-[var(--text-muted)] mt-1">
          í•´ë‹¹ ì›”ì€ ì•„ì§ ë§ˆê°ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ê¸‰ì—¬ ìŠ¤ëƒ…ìƒ·ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-3">
      {rows.map((r) => (
        <div
          key={r.id}
          className="rounded-xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-5 py-4"
        >
          <div className="flex justify-between items-start gap-4">
            <div className="space-y-1">
              <div className="text-sm font-semibold">
                {r.year}-{String(r.month).padStart(2, "0")} ê¸‰ì—¬
              </div>
              <div className="text-xs text-[var(--text-muted)]">
                ìƒì„±ì¼: {r.created_at ? new Date(r.created_at).toLocaleString() : "-"}
              </div>
              {!!r.generated_by_name && (
                <div className="text-xs text-[var(--text-muted)]">
                  ìƒì„±ì: {r.generated_by_name}
                </div>
              )}
            </div>

            <div className="text-right space-y-2">
              <div className="text-lg font-semibold">{r.total_amount.toLocaleString()}ì›</div>

              <div className="flex gap-2 justify-end">
                <ActionButton
                  variant="outline"
                  size="xs"
                  onClick={() =>
                    exportPayrollSnapshotPDF({
                      staff: sid as number,
                      year: r.year,
                      month: r.month,
                    })
                  }
                >
                  PDF
                </ActionButton>

                <ActionButton
                  variant="outline"
                  size="xs"
                  title="ì—‘ì…€ì€ í•´ë‹¹ ì›” ì „ì²´ ì§ì› ê¸‰ì—¬ì…ë‹ˆë‹¤."
                  onClick={() =>
                    exportPayrollSnapshotExcel({
                      year: r.year,
                      month: r.month,
                    })
                  }
                >
                  XLSX
                </ActionButton>
              </div>
            </div>
          </div>
        </div>
      ))}

      <div className="text-[11px] text-[var(--text-muted)]">
        * Payroll Snapshotì€ ë§ˆê° ì‹œì  í™•ì • ë°ì´í„°ì´ë©° ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
      </div>
    </div>
  );
}


==========================================================================================
# FILE: pages/ReportsPage/ReportsPage.tsx
==========================================================================================
// PATH: src/features/staff/pages/ReportsPage/ReportsPage.tsx
// ë¦¬í¬íŠ¸/ëª…ì„¸: ì§ì›ë³„Â·ì›”ë³„ ì§‘ê³„, ì—‘ì…€/PDF ë‹¤ìš´ë¡œë“œ

import { useMemo, useState } from "react";
import { useSearchParams } from "react-router-dom";
import StaffOperationTable from "../OperationsPage/StaffOperationTable";
import PayrollHistoryTable from "./PayrollHistoryTable";
import WorkMonthLockHistory from "./WorkMonthLockHistory";
import { EmptyState } from "@/shared/ui/ds";

function ymLabel(y: number, m: number) {
  return `${y}ë…„ ${m}ì›”`;
}

export default function ReportsPage() {
  const [params] = useSearchParams();
  const staffId = params.get("staffId") ? Number(params.get("staffId")) : undefined;
  const now = useMemo(() => new Date(), []);
  const [ym, setYm] = useState({
    year: now.getFullYear(),
    month: now.getMonth() + 1,
  });

  return (
    <div className="grid grid-cols-[320px_1fr] gap-6">
        <div className="ds-panel-card">
          <div className="ds-panel-card__header px-4 py-3">
            <div className="text-sm font-semibold text-[var(--color-text-primary)]">ì§ì› ì„ íƒ</div>
            <div className="text-[12px] text-[var(--color-text-muted)] mt-0.5">
              ì§ì›ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ ì§ì›ì˜ ê¸‰ì—¬ ì´ë ¥ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
          </div>
          <div className="p-3">
            <StaffOperationTable selectedStaffId={staffId} basePath="reports" />
          </div>
        </div>

        <div className="ds-panel-card min-h-[400px] space-y-6">
          <div className="ds-panel-card__header px-5 py-4 border-b border-[var(--color-border-divider)]">
            <div className="text-sm font-semibold text-[var(--color-text-primary)]">ì§ì›ë³„ ê¸‰ì—¬ ì´ë ¥</div>
            <div className="text-xs text-[var(--color-text-muted)]">
              {staffId ? "ì„ íƒí•œ ì§ì›ì˜ ì›”ë³„ í™•ì • ê¸‰ì—¬" : "ì¢Œì¸¡ì—ì„œ ì§ì›ì„ ì„ íƒí•˜ì„¸ìš”."}
            </div>
          </div>
          <div className="px-5 pb-5">
            {!staffId ? (
              <EmptyState
                scope="panel"
                tone="empty"
                title="ì§ì›ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
                description="ì§ì›ì„ ì„ íƒí•˜ë©´ ê¸‰ì—¬ ì´ë ¥(ì›”ë³„ í™•ì • ë‚´ì—­)ì„ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
              />
            ) : (
              <PayrollHistoryTable staffId={staffId} />
            )}
          </div>

          <div className="border-t border-[var(--color-border-divider)] pt-4 px-5 pb-5">
            <div className="flex items-center justify-between gap-4 mb-3">
              <div className="text-sm font-semibold text-[var(--color-text-primary)]">ì›”ë³„ ë§ˆê° ì´ë ¥</div>
              <div className="flex items-center gap-2">
                <select
                  value={ym.year}
                  onChange={(e) => setYm((p) => ({ ...p, year: Number(e.target.value) }))}
                  className="ds-input h-9 min-w-[80px]"
                  aria-label="ì—°ë„"
                >
                  {[ym.year - 1, ym.year, ym.year + 1].map((y) => (
                    <option key={y} value={y}>{y}ë…„</option>
                  ))}
                </select>
                <select
                  value={ym.month}
                  onChange={(e) => setYm((p) => ({ ...p, month: Number(e.target.value) }))}
                  className="ds-input h-9 min-w-[72px]"
                  aria-label="ì›”"
                >
                  {Array.from({ length: 12 }, (_, i) => i + 1).map((m) => (
                    <option key={m} value={m}>{m}ì›”</option>
                  ))}
                </select>
              </div>
            </div>
            <WorkMonthLockHistory year={ym.year} month={ym.month} />
          </div>

          <div className="px-5 pb-5 text-[11px] text-[var(--color-text-muted)]">
            * ì—‘ì…€/PDF ë‹¤ìš´ë¡œë“œëŠ” <b>ê¸‰ì—¬ ìŠ¤ëƒ…ìƒ·</b> íƒ­ì—ì„œ ê¸°ì¤€ì›” ì„ íƒ í›„ ì‚¬ìš©í•˜ì„¸ìš”.
          </div>
        </div>
    </div>
  );
}


==========================================================================================
# FILE: pages/ReportsPage/WorkMonthLockHistory.tsx
==========================================================================================
ï»¿// PATH: src/features/staff/pages/ReportsPage/WorkMonthLockHistory.tsx
import { useQuery } from "@tanstack/react-query";
import { fetchWorkMonthLocks } from "../../api/workMonthLocks.api";
import { LockBadge } from "../../components/StatusBadge";

function ymLabel(y: number, m: number) {
  return `${y}-${String(m).padStart(2, "0")}`;
}

export default function WorkMonthLockHistory({
  year,
  month,
}: {
  year: number;
  month: number;
}) {
  const listQ = useQuery({
    queryKey: ["work-month-lock-history", year, month],
    queryFn: () => fetchWorkMonthLocks({ year, month }),
  });

  const rows = listQ.data ?? [];

  if (listQ.isLoading) {
    return <div className="text-sm text-[var(--text-muted)]">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>;
  }

  if (rows.length === 0) {
    return (
      <div className="rounded-xl border border-[var(--border-divider)] bg-[var(--bg-surface-soft)] px-5 py-6">
        <div className="text-sm font-semibold">ë§ˆê° ë‚´ì—­ ì—†ìŒ</div>
        <div className="text-xs text-[var(--text-muted)] mt-1">
          í•´ë‹¹ ì›”ì—ëŠ” ì•„ì§ ë§ˆê°ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-3">
      {rows.map((r) => (
        <div
          key={r.id}
          className="rounded-lg border border-[var(--border-divider)] bg-[var(--bg-surface)] px-5 py-4 flex justify-between items-center gap-4"
        >
          <div>
            <div className="font-semibold">
              {r.staff_name ?? `Staff#${r.staff}`}
            </div>
            <div className="text-xs text-[var(--text-muted)]">
              {ymLabel(r.year, r.month)} Â· ë§ˆê°ì{" "}
              {r.locked_by_name ?? "-"}
            </div>
          </div>

          <LockBadge state={r.is_locked ? "LOCKED" : "OPEN"} />
        </div>
      ))}
    </div>
  );
}


==========================================================================================
# FILE: types/index.ts
==========================================================================================
ï»¿


==========================================================================================
# FILE: utils/index.ts
==========================================================================================
ï»¿
