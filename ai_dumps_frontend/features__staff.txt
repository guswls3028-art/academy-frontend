====================================================================================================
# FRONTEND FOLDER: features__staff
# ROOT PATH: C:\academyfront\src\features\staff
====================================================================================================


==========================================================================================
# FILE: StaffLayout.tsx
==========================================================================================
import { Outlet, useNavigate, useLocation } from "react-router-dom";
import { Tabs } from "antd";

export default function StaffLayout() {
  const navigate = useNavigate();
  const location = useLocation();

  const activeKey = location.pathname.includes("/operations")
    ? "operations"
    : location.pathname.includes("/reports")
    ? "reports"
    : "home";

  return (
    <div className="p-6 space-y-4">
      {/* í—¤ë” */}
      <div className="flex items-center justify-between">
        <div className="text-xl font-semibold">ì§ì› ê´€ë¦¬</div>
      </div>

      {/* ë¡œì»¬ ë„¤ë¹„ê²Œì´ì…˜ */}
      <Tabs
        activeKey={activeKey}
        onChange={(key) => navigate(`/admin/staff/${key}`)}
        items={[
          { key: "home", label: "í™ˆ" },
          { key: "operations", label: "ì‘ì—…" },
          { key: "reports", label: "ë¦¬í¬íŠ¸" },
        ]}
      />

      {/* í˜ì´ì§€ */}
      <Outlet />
    </div>
  );
}


==========================================================================================
# FILE: StaffRoutes.tsx
==========================================================================================
ï»¿import { Routes, Route, Navigate } from "react-router-dom";

import StaffLayout from "./StaffLayout";

import HomePage from "./pages/HomePage/HomePage";
import OperationsPage from "./pages/OperationsPage/OperationsPage";
import ReportsPage from "./pages/ReportsPage/ReportsPage";
import StaffDetailOverlay from "./overlays/StaffDetailOverlay/StaffDetailOverlay";

export default function StaffRoutes() {
  return (
    <Routes>
      <Route element={<StaffLayout />}>
        <Route index element={<Navigate to="home" replace />} />
        <Route path="home" element={<HomePage />} />
        <Route path="operations" element={<OperationsPage />} />
        <Route path="reports" element={<ReportsPage />} />
      </Route>

      {/* ì§ì› ìƒì„¸ëŠ” ë ˆì´ì•„ì›ƒ ë¶„ë¦¬ (Overlay ì„±ê²©) */}
      <Route path=":staffId/*" element={<StaffDetailOverlay />} />
    </Routes>
  );
}


==========================================================================================
# FILE: api/expenses.api.ts
==========================================================================================
ï»¿// PATH: src/features/staff/api/expenses.api.ts
import api from "@/shared/api/axios";

export type ExpenseStatus = "PENDING" | "APPROVED" | "REJECTED";

export type ExpenseRecord = {
  id: number;
  staff: number;
  staff_name?: string;
  date: string;
  title: string;
  amount: number;
  memo: string;
  status: ExpenseStatus;
  approved_at?: string | null;
  approved_by?: number | null;
  approved_by_name?: string | null;
};

/**
 * GET /staffs/expense-records/
 */
export async function fetchExpenses(params: {
  staff: number;
  status?: ExpenseStatus;
  date_from: string;
  date_to: string;
}) {
  const res = await api.get("/staffs/expense-records/", { params });

  if (Array.isArray(res.data)) return res.data as ExpenseRecord[];
  if (Array.isArray(res.data?.results)) return res.data.results as ExpenseRecord[];
  return [];
}

/**
 * POST /staffs/expense-records/
 * - ë§ˆê°ëœ ì›”ì´ë©´ backendê°€ 400 ë³´ì¥
 */
export async function createExpense(payload: {
  staff: number;
  date: string;
  title: string;
  amount: number;
  memo?: string;
}) {
  const res = await api.post("/staffs/expense-records/", {
    staff: payload.staff,
    date: payload.date,
    title: payload.title,
    amount: payload.amount,
    memo: payload.memo ?? "",
  });

  return res.data as ExpenseRecord;
}

/**
 * PATCH /staffs/expense-records/{id}/
 * ğŸ”’ APPROVED ì´í›„ ìˆ˜ì • ë¶ˆê°€ (ë°±ì—”ë“œ ë³´ì¥)
 * - ìƒíƒœ ë³€ê²½ì€ ê´€ë¦¬ìë§Œ ê°€ëŠ¥ (ë°±ì—”ë“œ ë³´ì¥)
 */
export async function patchExpense(
  id: number,
  payload: Partial<{
    status: ExpenseStatus;
    memo: string;
  }>
) {
  const res = await api.patch(`/staffs/expense-records/${id}/`, payload);
  return res.data as ExpenseRecord;
}


==========================================================================================
# FILE: api/index.ts
==========================================================================================
ï»¿/**
 * PATH: src/features/staff/api/index.ts
 * Staff Domain API â€“ Single Source of Truth
 */

export * from "./staff.api";
export * from "./staff.detail.api";
export * from "./staffMe.api";

export * from "./workRecords.api";
export * from "./expenses.api";
export * from "./workMonthLocks.api";

export * from "./payrollSnapshots.api";
export * from "./payrollSnapshotPDF.api";

export * from "./staffWorkType.api";


==========================================================================================
# FILE: api/payrollSnapshotPdf.api.ts
==========================================================================================
ï»¿// PATH: src/features/staff/api/payrollSnapshotPDF.api.ts
import api from "@/shared/api/axios";

export async function exportPayrollSnapshotPDF(params: {
  staff: number;
  year: number;
  month: number;
}) {
  const res = await api.get(
    "/staffs/payroll-snapshots/export-pdf/",
    {
      params,
      responseType: "blob",
    }
  );

  const blob = new Blob([res.data], { type: "application/pdf" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = `payroll_${params.staff}_${params.year}_${String(
    params.month
  ).padStart(2, "0")}.pdf`;
  document.body.appendChild(a);
  a.click();
  a.remove();

  URL.revokeObjectURL(url);
}


==========================================================================================
# FILE: api/payrollSnapshots.api.ts
==========================================================================================
ï»¿// PATH: src/features/staff/api/payrollSnapshots.api.ts
import api from "@/shared/api/axios";

export type PayrollSnapshot = {
  id: number;
  staff: number;
  staff_name?: string;
  year: number;
  month: number;
  work_hours: number;
  work_amount: number;
  approved_expense_amount: number;
  total_amount: number;
  generated_by?: number;
  generated_by_name?: string;
  created_at: string;
};

/**
 * GET /staffs/payroll-snapshots/
 */
export async function fetchPayrollSnapshots(params: {
  year?: number;
  month?: number;
  staff?: number;
}) {
  const cleanParams: any = {};
  if (params.staff != null) cleanParams.staff = params.staff;
  if (params.year != null) cleanParams.year = params.year;
  if (params.month != null) cleanParams.month = params.month;

  const res = await api.get("/staffs/payroll-snapshots/", {
    params: cleanParams,
  });

  if (Array.isArray(res.data)) return res.data as PayrollSnapshot[];
  if (Array.isArray(res.data?.results)) return res.data.results as PayrollSnapshot[];
  return [];
}

/**
 * GET /staffs/payroll-snapshots/export-excel/
 */
export async function exportPayrollSnapshotExcel(params: {
  year: number;
  month: number;
}) {
  const res = await api.get(
    "/staffs/payroll-snapshots/export-excel/",
    {
      params,
      responseType: "blob",
    }
  );

  const blob = new Blob([res.data], {
    type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
  });

  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `payroll_${params.year}_${String(params.month).padStart(2, "0")}.xlsx`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}


==========================================================================================
# FILE: api/staff.api.ts
==========================================================================================
ï»¿ï»¿// PATH: src/features/staff/api/staff.api.ts
import api from "@/shared/api/axios";

/**
 * Staff (ì§ì›)
 */
export type Staff = {
  id: number;
  name: string;
  phone: string;
  is_active: boolean;
  is_manager: boolean;
  pay_type: "HOURLY" | "MONTHLY";
  staff_work_types?: {
    id: number;
    work_type: number;
    hourly_wage: number | null;
    effective_hourly_wage: number;
  }[];
  created_at?: string;
  updated_at?: string;
};

/**
 * Staff Summary (ì§‘ê³„ ì „ìš©)
 * ğŸ”’ ê³„ì‚° ë‹¨ì¼ì§„ì‹¤
 */
export type StaffSummary = {
  staff_id: number;
  work_hours: number;
  work_amount: number;
  expense_amount: number;
  total_amount: number;
};

/**
 * GET /staffs/
 */
export async function fetchStaffs(params?: {
  search?: string;
  is_active?: boolean;
  is_manager?: boolean;
  pay_type?: string;
}) {
  const res = await api.get("/staffs/", { params });

  if (Array.isArray(res.data)) return res.data as Staff[];
  if (Array.isArray(res.data?.results)) return res.data.results as Staff[];
  return [];
}

/**
 * POST /staffs/
 * ğŸ”’ ìƒì„± ìŠ¤í™ ë‹¨ì¼ì§„ì‹¤
 *
 * permission_role:
 * - ASSISTANT : ì¼ë°˜ ì§ì›
 * - TEACHER   : ê°•ì‚¬
 * - ADMIN     : ê´€ë¦¬ì (ìŠ¹ì¸/ë§ˆê° ê°€ëŠ¥)
 *
 * âš ï¸ OWNERëŠ” ë°±ì—”ë“œ ì „ìš©ì´ë©° í”„ë¡ íŠ¸ì—ì„œ ì§€ì • ë¶ˆê°€
 * âš ï¸ is_manager / is_payroll_manager ë³€í™˜ ì±…ì„ì€ ë°±ì—”ë“œ
 */
export async function createStaff(payload: {
  username: string;
  password: string;
  name: string;
  phone?: string;
  permission_role: "ADMIN" | "TEACHER" | "ASSISTANT";
}) {
  const res = await api.post("/staffs/", payload);
  return res.data as Staff;
}

/**
 * DELETE /staffs/{id}/
 */
export async function deleteStaff(id: number) {
  await api.delete(`/staffs/${id}/`);
  return true;
}


==========================================================================================
# FILE: api/staff.detail.api.ts
==========================================================================================
ï»¿// PATH: src/features/staff/api/staff.detail.api.ts
import api from "@/shared/api/axios";
import { Staff, StaffSummary } from "./staff.api";

export type StaffDetail = Staff & {
  user: number | null;
  user_username?: string | null;
  user_is_staff?: boolean;
};

/**
 * GET /staffs/{id}/
 */
export async function fetchStaffDetail(id: number) {
  const res = await api.get(`/staffs/${id}/`);
  return res.data as StaffDetail;
}

/**
 * PATCH /staffs/{id}/
 */
export async function patchStaffDetail(
  id: number,
  payload: Partial<StaffDetail>
) {
  const res = await api.patch(`/staffs/${id}/`, payload);
  return res.data as StaffDetail;
}

/**
 * ğŸ”’ ì§‘ê³„ ë‹¨ì¼ì§„ì‹¤
 */
export async function fetchStaffSummaryByRange(
  staffId: number,
  date_from: string,
  date_to: string
) {
  const res = await api.get(`/staffs/${staffId}/summary/`, {
    params: { date_from, date_to },
  });
  return res.data as StaffSummary;
}


==========================================================================================
# FILE: api/staffMe.api.ts
==========================================================================================
ï»¿// PATH: src/features/staff/api/staffMe.api.ts
import api from "@/shared/api/axios";

export type StaffMe = {
  is_authenticated: boolean;
  is_superuser: boolean;
  is_staff: boolean;
  is_payroll_manager: boolean;
};

/**
 * ğŸ”’ ë‹¨ì¼ì§„ì‹¤
 * - ê¶Œí•œ íŒë‹¨ì€ ë¬´ì¡°ê±´ ì´ API ê¸°ì¤€
 */
export async function fetchStaffMe() {
  const res = await api.get("/staffs/me/");
  return res.data as StaffMe;
}


==========================================================================================
# FILE: api/staffWorkType.api.ts
==========================================================================================
ï»¿// PATH: src/features/staff/api/staffWorkType.api.ts
import api from "@/shared/api/axios";

export type WorkType = {
  id: number;
  name: string;
  base_hourly_wage: number;
  color: string;
  is_active?: boolean;
};

export type StaffWorkType = {
  id: number;
  staff: number;
  work_type: WorkType;
  hourly_wage: number | null;
  effective_hourly_wage: number;
  created_at?: string;
  updated_at?: string;
};

/**
 * GET /staffs/work-types/
 */
export async function fetchWorkTypes(params?: { is_active?: boolean }) {
  const res = await api.get("/staffs/work-types/", { params });

  if (Array.isArray(res.data)) return res.data as WorkType[];
  if (Array.isArray(res.data?.results)) return res.data.results as WorkType[];
  return [];
}

/**
 * GET /staffs/{staff_id}/work-types/
 */
export async function fetchStaffWorkTypes(staffId: number) {
  const res = await api.get(`/staffs/${staffId}/work-types/`);

  if (Array.isArray(res.data)) return res.data as StaffWorkType[];
  if (Array.isArray(res.data?.results)) return res.data.results as StaffWorkType[];
  return [];
}

/**
 * POST /staffs/{staff_id}/work-types/
 */
export async function createStaffWorkType(
  staffId: number,
  payload: { work_type_id: number; hourly_wage?: number | null }
) {
  const res = await api.post(`/staffs/${staffId}/work-types/`, payload);
  return res.data as StaffWorkType[];
}

export async function patchStaffWorkType(
  id: number,
  payload: { hourly_wage?: number | null }
) {
  const res = await api.patch(`/staffs/staff-work-types/${id}/`, payload);
  return res.data as StaffWorkType;
}

export async function deleteStaffWorkType(id: number) {
  await api.delete(`/staffs/staff-work-types/${id}/`);
  return true;
}


==========================================================================================
# FILE: api/workMonthLocks.api.ts
==========================================================================================
ï»¿// PATH: src/features/staff/api/workMonthLocks.api.ts
import api from "@/shared/api/axios";

export type WorkMonthLock = {
  id: number;
  staff: number;
  staff_name?: string;
  year: number;
  month: number;
  is_locked: boolean;
  locked_by?: number;
  locked_by_name?: string;
  created_at?: string;
};

/**
 * GET /staffs/work-month-locks/
 * âš ï¸ backendëŠ” staff/year/month í•„í„°ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŒ
 */
export async function fetchWorkMonthLocks(params: {
  staff?: number;
  year: number;
  month: number;
}) {
  const res = await api.get("/staffs/work-month-locks/");

  const rows: WorkMonthLock[] = Array.isArray(res.data)
    ? res.data
    : Array.isArray(res.data?.results)
    ? res.data.results
    : [];

  // ğŸ”’ í•„í„°ë§ì€ ê³„ì‚°ì´ ì•„ë‹ˆë¼ "ì„ íƒ" â†’ í—ˆìš©
  return rows.filter(
    (r) =>
      r.year === params.year &&
      r.month === params.month &&
      (params.staff ? r.staff === params.staff : true)
  );
}

/**
 * POST /staffs/work-month-locks/
 */
export async function lockWorkMonth(payload: {
  staff: number;
  year: number;
  month: number;
}) {
  const res = await api.post("/staffs/work-month-locks/", payload);
  return res.data as WorkMonthLock;
}

export function isLockedFromLocks(
  locks: WorkMonthLock[] | undefined
): boolean {
  if (!locks || locks.length === 0) return false;
  return locks.some((l) => l.is_locked);
}


==========================================================================================
# FILE: api/workRecords.api.ts
==========================================================================================
ï»¿// PATH: src/features/staff/api/workRecords.api.ts
import api from "@/shared/api/axios";

export type WorkRecord = {
  id: number;
  staff: number;
  staff_name?: string;
  work_type: number;
  work_type_name?: string;
  date: string;
  start_time: string;
  end_time: string;
  break_minutes: number;
  work_hours: number;
  amount: number;
  memo: string;
};

/**
 * GET /staffs/work-records/
 */
export async function fetchWorkRecords(params: {
  staff: number;
  work_type?: number;
  date_from: string;
  date_to: string;
}) {
  const res = await api.get("/staffs/work-records/", { params });

  if (Array.isArray(res.data)) return res.data as WorkRecord[];
  if (Array.isArray(res.data?.results)) return res.data.results as WorkRecord[];
  return [];
}

/**
 * POST /staffs/work-records/
 */
export async function createWorkRecord(payload: {
  staff: number;
  work_type: number;
  date: string;
  start_time: string;
  end_time: string;
  break_minutes?: number;
  memo?: string;
}) {
  const res = await api.post("/staffs/work-records/", payload);
  return res.data as WorkRecord;
}

export async function patchWorkRecord(
  id: number,
  payload: Partial<{
    work_type: number;
    date: string;
    start_time: string;
    end_time: string;
    break_minutes: number;
    memo: string;
  }>
) {
  const res = await api.patch(`/staffs/work-records/${id}/`, payload);
  return res.data as WorkRecord;
}

export async function deleteWorkRecord(id: number) {
  await api.delete(`/staffs/work-records/${id}/`);
  return true;
}


==========================================================================================
# FILE: components/ActionButton.tsx
==========================================================================================
// PATH: src/features/staff/components/ActionButton.tsx
import React from "react";

type Variant =
  | "primary"
  | "secondary"
  | "danger"
  | "success"
  | "ghost"
  | "outline"
  | "danger-outline";

type Size = "xs" | "sm" | "md";

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

const BASE =
  "inline-flex items-center justify-center select-none whitespace-nowrap font-semibold rounded-lg border transition " +
  "focus:outline-none focus:ring-1 focus:ring-[var(--color-primary)]";

const SIZE: Record<Size, string> = {
  xs: "h-[30px] px-2 text-xs",
  sm: "h-[34px] px-3 text-xs",
  md: "h-[38px] px-4 text-sm",
};

/**
 * ì‹¤ë¬´ ê¸°ì¤€ ë²„íŠ¼ í†¤
 * - danger: ì‚­ì œ/ë§ˆê°/í™•ì • (ë˜ëŒë¦´ ìˆ˜ ì—†ìŒ)
 * - success: ìŠ¹ì¸/ì •ìƒ
 * - outline/ghost: íƒìƒ‰Â·ë³´ì¡°
 * - disabled: ì‹œê°ì ìœ¼ë¡œ â€œì£½ì€ ë²„íŠ¼â€ ëª…í™•
 */
const VARIANT: Record<Variant, string> = {
  primary:
    "border-[var(--color-primary)] bg-[var(--color-primary)] text-white hover:opacity-90",
  secondary:
    "border-[var(--border-divider)] bg-[var(--bg-surface)] text-[var(--text-primary)] hover:bg-[var(--bg-surface-soft)]",
  outline:
    "border-[var(--border-divider)] bg-transparent text-[var(--text-primary)] hover:bg-[var(--bg-surface-soft)]",
  ghost:
    "border-transparent bg-transparent text-[var(--text-primary)] hover:bg-[var(--bg-surface-soft)]",
  danger:
    "border-[var(--color-danger)] bg-[var(--color-danger)] text-white hover:opacity-95 shadow-[0_8px_18px_rgba(0,0,0,0.28)]",
  "danger-outline":
    "border-[var(--color-danger)] bg-transparent text-[var(--color-danger)] hover:bg-[var(--color-danger-soft)]",
  success:
    "border-[var(--color-success)] bg-[var(--color-success)] text-white hover:opacity-90",
};

export default function ActionButton({
  variant = "secondary",
  size = "sm",
  disabled,
  disabledReason,
  className,
  title,
  type = "button",
  ...props
}: React.ButtonHTMLAttributes<HTMLButtonElement> & {
  variant?: Variant;
  size?: Size;
  disabledReason?: string;
}) {
  const isDisabled = !!disabled || !!disabledReason;

  return (
    <button
      type={type}
      disabled={isDisabled}
      aria-disabled={isDisabled}
      title={disabledReason || title}
      className={cx(
        BASE,
        SIZE[size],
        VARIANT[variant],
        isDisabled &&
          [
            "opacity-50 cursor-not-allowed",
            "hover:opacity-50 active:opacity-50",
            variant === "outline" ||
            variant === "ghost" ||
            variant === "danger-outline"
              ? "hover:bg-transparent"
              : "",
          ].join(" "),
        className
      )}
      {...props}
    />
  );
}


==========================================================================================
# FILE: components/StaffTable.tsx
==========================================================================================
// PATH: src/features/staff/components/StaffTable.tsx
import { Table } from "antd";
import type { ColumnsType } from "antd/es/table";
import { Staff } from "../api/staff.api";
import { RoleBadge } from "./StatusBadge";

type Props = {
  staffs: Staff[];
  onRowClick?: (staffId: number) => void;
};

export default function StaffTable({ staffs, onRowClick }: Props) {
  const columns: ColumnsType<Staff> = [
    {
      title: "ì´ë¦„",
      dataIndex: "name",
      render: (_, r) => (
        <div className="flex items-center gap-2">
          <span className="font-semibold">{r.name}</span>
          {!r.is_active && (
            <span className="px-2 py-0.5 rounded-full text-xs border text-[var(--text-muted)] bg-[var(--bg-surface-muted)]">
              ë¹„í™œì„±
            </span>
          )}
        </div>
      ),
    },
    {
      title: "ì „í™”ë²ˆí˜¸",
      dataIndex: "phone",
      render: (v) => v || "-",
    },
    {
      title: "ì—­í• ",
      dataIndex: "is_manager",
      render: (v) => <RoleBadge isManager={!!v} />,
    },
    {
      title: "ê¸‰ì—¬",
      dataIndex: "pay_type",
      render: (v) => (v === "HOURLY" ? "ì‹œê¸‰" : "ì›”ê¸‰"),
    },
  ];

  return (
    <Table
      rowKey="id"
      dataSource={staffs}
      columns={columns}
      pagination={false}
      onRow={(r) => ({
        onClick: () => onRowClick?.(r.id),
      })}
    />
  );
}


==========================================================================================
# FILE: components/StatusBadge.tsx
==========================================================================================
// PATH: src/features/staff/components/StatusBadge.tsx
import React from "react";

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

/**
 * StatusBadge â€“ ì‹¤ë¬´ ë‹¨ì¼ ê¸°ì¤€
 *
 * ì›ì¹™:
 * - ìƒ‰ìƒ + í…ìŠ¤íŠ¸ë§Œìœ¼ë¡œ ìƒíƒœ ì¦‰ì‹œ ì¸ì§€
 * - danger = ë¶ˆë³€ / ìœ„í—˜ / ë˜ëŒë¦´ ìˆ˜ ì—†ìŒ
 * - success = ì •ìƒ / í™•ì • / ìŠ¹ì¸
 * - neutral = ì •ë³´ / ëŒ€ê¸°
 */

type ExpenseStatus = "PENDING" | "APPROVED" | "REJECTED";

type Tone = "neutral" | "success" | "danger" | "primary";
type Density = "soft" | "solid";

const BASE =
  "inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-semibold border leading-none";

function toneClass(tone: Tone, density: Density = "soft") {
  if (density === "solid") {
    if (tone === "danger")
      return "bg-[var(--color-danger)] text-white border-[var(--color-danger)]";
    if (tone === "success")
      return "bg-[var(--color-success)] text-white border-[var(--color-success)]";
    if (tone === "primary")
      return "bg-[var(--color-primary)] text-white border-[var(--color-primary)]";
    return "bg-[var(--bg-surface-muted)] text-[var(--text-primary)] border-[var(--border-divider)]";
  }

  if (tone === "success")
    return "bg-[var(--color-success-soft)] text-[var(--color-success)] border-[color-mix(in_srgb,var(--color-success)_55%,transparent)]";
  if (tone === "danger")
    return "bg-[var(--color-danger-soft)] text-[var(--color-danger)] border-[color-mix(in_srgb,var(--color-danger)_55%,transparent)]";
  if (tone === "primary")
    return "bg-[var(--color-primary-soft)] text-[var(--color-primary)] border-[color-mix(in_srgb,var(--color-primary)_55%,transparent)]";

  return "bg-[var(--bg-surface-muted)] text-[var(--text-secondary)] border-[var(--border-divider)]";
}

function Dot({ tone }: { tone: Tone }) {
  const cls =
    tone === "danger"
      ? "bg-[var(--color-danger)]"
      : tone === "success"
      ? "bg-[var(--color-success)]"
      : tone === "primary"
      ? "bg-[var(--color-primary)]"
      : "bg-[var(--text-muted)]";

  return <span className={cx("inline-block h-1.5 w-1.5 rounded-full", cls)} />;
}

/* =========================
   Expense Status
========================= */

export function ExpenseStatusBadge({ status }: { status: ExpenseStatus }) {
  const label =
    status === "APPROVED" ? "ìŠ¹ì¸" : status === "REJECTED" ? "ë°˜ë ¤" : "ëŒ€ê¸°";

  const tone: Tone =
    status === "APPROVED"
      ? "success"
      : status === "REJECTED"
      ? "danger"
      : "neutral";

  return (
    <span className={cx(BASE, toneClass(tone))}>
      <Dot tone={tone} />
      {label}
    </span>
  );
}

/* =========================
   Lock Status
========================= */

export function LockBadge({
  state,
  compact = false,
}: {
  state: "LOCKED" | "OPEN";
  compact?: boolean;
}) {
  const locked = state === "LOCKED";
  const tone: Tone = locked ? "danger" : "success";

  return (
    <span className={cx(BASE, toneClass(tone))}>
      <Dot tone={tone} />
      {locked ? (compact ? "ë§ˆê°" : "ğŸ”’ ë§ˆê°") : compact ? "ì§„í–‰" : "ğŸ”“ ì§„í–‰ì¤‘"}
    </span>
  );
}

/* =========================
   Role
========================= */

export function RoleBadge({ isManager }: { isManager: boolean }) {
  const tone: Tone = isManager ? "primary" : "neutral";

  return (
    <span className={cx(BASE, toneClass(tone))}>
      <Dot tone={tone} />
      {isManager ? "ê´€ë¦¬ì" : "ì§ì›"}
    </span>
  );
}


==========================================================================================
# FILE: components/WorkMonthLockBar.tsx
==========================================================================================
ï»¿// PATH: src/features/staff/components/WorkMonthLockBar.tsx
import { WorkMonthLock } from "../api/workMonthLocks.api";
import ActionButton from "./ActionButton";
import { LockBadge, RoleBadge } from "./StatusBadge";

export default function WorkMonthLockBar({
  locks,
  isManager,
  onLock,
}: {
  locks?: WorkMonthLock[];
  isManager: boolean;
  onLock?: () => void;
}) {
  const locked = !!locks?.some((l) => !!l.is_locked);

  const disabledReason = locked
    ? "ì´ë¯¸ ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤."
    : !isManager
    ? "ë§ˆê°ì€ ê´€ë¦¬ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤."
    : "";

  return (
    <div className="space-y-2">
      <div
        className={[
          "flex items-start justify-between gap-4 rounded-2xl border px-5 py-4 text-sm",
          locked
            ? "border-[color-mix(in_srgb,var(--color-danger)_55%,transparent)] bg-[var(--color-danger-soft)]"
            : "border-[color-mix(in_srgb,var(--color-success)_55%,transparent)] bg-[var(--color-success-soft)]",
        ].join(" ")}
      >
        <div className="space-y-1">
          <div className="flex items-center gap-2">
            <LockBadge state={locked ? "LOCKED" : "OPEN"} />
            <RoleBadge isManager={isManager} />
          </div>
          <div className="text-[11px] text-[var(--text-muted)]">
            * ì›” ë§ˆê° = ê¸‰ì—¬ í™•ì • Â· ì´í›„ ë³€ê²½ ë¶ˆê°€
          </div>
        </div>

        <ActionButton
          variant="danger"
          size="sm"
          disabledReason={disabledReason}
          title={
            disabledReason ||
            "ì´ë²ˆ ë‹¬ ê·¼ë¬´/ë¹„ìš©ì„ í™•ì •í•©ë‹ˆë‹¤. ì´í›„ ìˆ˜ì •Â·ì‚­ì œ ë¶ˆê°€í•˜ë©° ê¸‰ì—¬ ìŠ¤ëƒ…ìƒ·ì´ ìƒì„±ë©ë‹ˆë‹¤."
          }
          onClick={() => {
            if (disabledReason) return;
            if (
              !confirm(
                [
                  "ì´ë²ˆ ë‹¬ì„ ë§ˆê°í• ê¹Œìš”?",
                  "",
                  "- ë§ˆê° í›„ì—ëŠ” ê·¼ë¬´/ë¹„ìš© ìˆ˜ì •Â·ì‚­ì œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.",
                  "- ê¸‰ì—¬ ìŠ¤ëƒ…ìƒ·ì´ ìƒì„±ë©ë‹ˆë‹¤.",
                ].join("\n")
              )
            )
              return;
            onLock?.();
          }}
        >
          ì›” ë§ˆê°
        </ActionButton>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: components/index.ts
==========================================================================================
ï»¿


==========================================================================================
# FILE: constants/index.ts
==========================================================================================
ï»¿


==========================================================================================
# FILE: hooks/index.ts
==========================================================================================
ï»¿/**
 * PATH: src/features/staff/hooks/index.ts
 */

export * from "./useStaffs";
export * from "./useStaffDetail";
export * from "./useWorkRecords";
export * from "./useExpenses";
export * from "./useWorkMonthLock";
export * from "./usePayrollSnapshots";


==========================================================================================
# FILE: hooks/useExpenses.ts
==========================================================================================
ï»¿// PATH: src/features/staff/hooks/useExpenses.ts
import { useMutation, useQuery, useQueryClient } from "@tanstack/react-query";
import {
  fetchExpenses,
  patchExpense,
  createExpense,
  ExpenseStatus,
} from "../api/expenses.api";

export type UseExpensesParams = {
  staff: number;
  status?: ExpenseStatus;
  date_from: string;
  date_to: string;
};

/**
 * ğŸ”’ ê·œì¹™
 * - ìŠ¹ì¸ ìƒíƒœ íŒë‹¨(ì¶”ë¡ ) âŒ  -> status ê°’ ê·¸ëŒ€ë¡œ ì‚¬ìš©
 * - í•©ê³„ ê³„ì‚° âŒ
 */
export function useExpenses(params: UseExpensesParams) {
  const qc = useQueryClient();

  const listQ = useQuery({
    queryKey: ["expenses", params],
    queryFn: () => fetchExpenses(params),
    enabled: !!params.staff && !!params.date_from && !!params.date_to,
  });

  const invalidate = () => {
    qc.invalidateQueries({ queryKey: ["expenses"] });
    qc.invalidateQueries({ queryKey: ["staff-summary", params.staff] });
    qc.invalidateQueries({ queryKey: ["payroll-snapshots"] });
  };

  const createM = useMutation({
    mutationFn: createExpense,
    onSuccess: invalidate,
  });

  const patchM = useMutation({
    mutationFn: ({ id, payload }: { id: number; payload: any }) =>
      patchExpense(id, payload),
    onSuccess: invalidate,
  });

  return { listQ, createM, patchM };
}


==========================================================================================
# FILE: hooks/usePayrollSnapshots.ts
==========================================================================================
ï»¿// PATH: src/features/staff/hooks/usePayrollSnapshots.ts
import { useQuery } from "@tanstack/react-query";
import { fetchPayrollSnapshots } from "../api/payrollSnapshots.api";

export type UsePayrollSnapshotsParams = {
  staff?: number;
  year?: number;
  month?: number;
};

/**
 * ğŸ”’ PayrollSnapshot = ë¶ˆë³€ ë‹¨ì¼ì§„ì‹¤
 * - í”„ë¡ íŠ¸ ê³„ì‚° âŒ
 * - ìˆ˜ì • âŒ
 */
export function usePayrollSnapshots(params: UsePayrollSnapshotsParams) {
  return useQuery({
    queryKey: ["payroll-snapshots", params],
    queryFn: () => fetchPayrollSnapshots(params),
  });
}


==========================================================================================
# FILE: hooks/useStaffDetail.ts
==========================================================================================
ï»¿// PATH: src/features/staff/hooks/useStaffDetail.ts
import { useQuery } from "@tanstack/react-query";
import { fetchStaffDetail } from "../api/staff.detail.api";

/**
 * ğŸ”’ Staff ë‹¨ê±´ ë‹¨ì¼ì§„ì‹¤
 */
export function useStaffDetail(staffId?: number) {
  return useQuery({
    queryKey: ["staff", staffId],
    queryFn: () => fetchStaffDetail(staffId as number),
    enabled: typeof staffId === "number" && staffId > 0,
  });
}


==========================================================================================
# FILE: hooks/useStaffs.ts
==========================================================================================
ï»¿// PATH: src/features/staff/hooks/useStaffs.ts
import { useQuery } from "@tanstack/react-query";
import { fetchStaffs } from "../api/staff.api";

export type UseStaffsParams = {
  search?: string;
  is_active?: boolean;
  is_manager?: boolean;
  pay_type?: string;
};

/**
 * ğŸ”’ ë‹¨ì¼ì§„ì‹¤
 * - Staff ëª©ë¡ì€ ì„œë²„ ê·¸ëŒ€ë¡œ ì‹ ë¢°
 */
export function useStaffs(params?: UseStaffsParams) {
  return useQuery({
    queryKey: ["staffs", params ?? {}],
    queryFn: () => fetchStaffs(params),
    staleTime: 10_000,
  });
}


==========================================================================================
# FILE: hooks/useWorkMonthLock.ts
==========================================================================================
ï»¿/**
 * PATH: src/features/staff/hooks/useWorkMonthLock.ts
 */

import { useMutation, useQuery, useQueryClient } from "@tanstack/react-query";
import {
  fetchWorkMonthLocks,
  lockWorkMonth,
  isLockedFromLocks,
} from "../api/workMonthLocks.api"; // ??? IA  NOTE: legacy comment removed (encoding issue)

export function useWorkMonthLock(params: { staff: number; year: number; month: number }) {
  const qc = useQueryClient();

  const locksQ = useQuery({
    queryKey: ["work-month-locks", params.staff, params.year, params.month],
    queryFn: () =>
      fetchWorkMonthLocks({
        staff: params.staff,
        year: params.year,
        month: params.month,
      }),
    enabled: !!params.staff && !!params.year && !!params.month,
  });

  const locked = isLockedFromLocks(locksQ.data);

  const lockM = useMutation({
    mutationFn: () => lockWorkMonth({ staff: params.staff, year: params.year, month: params.month }),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["work-month-locks", params.staff] });
      qc.invalidateQueries({ queryKey: ["work-records", params.staff] });
      qc.invalidateQueries({ queryKey: ["expenses", params.staff] });
      qc.invalidateQueries({ queryKey: ["payroll-snapshots"] });
    },
  });

  return { locksQ, locked, lockM };
}


==========================================================================================
# FILE: hooks/useWorkRecords.ts
==========================================================================================
ï»¿// PATH: src/features/staff/hooks/useWorkRecords.ts
import { useMutation, useQuery, useQueryClient } from "@tanstack/react-query";
import {
  fetchWorkRecords,
  createWorkRecord,
  patchWorkRecord,
  deleteWorkRecord,
} from "../api/workRecords.api";

export type UseWorkRecordsParams = {
  staff: number;
  work_type?: number;
  date_from: string;
  date_to: string;
};

/**
 * ğŸ”’ ê·œì¹™
 * - ì‹œê°„/ê¸ˆì•¡ ê³„ì‚° âŒ
 * - ë§ˆê° ì—¬ë¶€ íŒë‹¨ âŒ (ë°±ì—”ë“œì—ì„œ 400)
 */
export function useWorkRecords(params: UseWorkRecordsParams) {
  const qc = useQueryClient();

  const listQ = useQuery({
    queryKey: ["work-records", params],
    queryFn: () => fetchWorkRecords(params),
    enabled:
      !!params.staff && !!params.date_from && !!params.date_to,
  });

  const invalidate = () => {
    qc.invalidateQueries({ queryKey: ["work-records"] });
    qc.invalidateQueries({ queryKey: ["staff-summary", params.staff] });
    qc.invalidateQueries({ queryKey: ["payroll-snapshots"] });
  };

  const createM = useMutation({
    mutationFn: createWorkRecord,
    onSuccess: invalidate,
  });

  const patchM = useMutation({
    mutationFn: ({ id, payload }: { id: number; payload: any }) =>
      patchWorkRecord(id, payload),
    onSuccess: invalidate,
  });

  const deleteM = useMutation({
    mutationFn: deleteWorkRecord,
    onSuccess: invalidate,
  });

  return { listQ, createM, patchM, deleteM };
}


==========================================================================================
# FILE: operations/context/WorkMonthContext.tsx
==========================================================================================
import React, { createContext, useContext, useMemo } from "react";
import { useWorkMonthLock } from "../../hooks/useWorkMonthLock";
import { useQuery } from "@tanstack/react-query";
import { fetchStaffMe } from "../../api/staffMe.api";

type WorkMonthContextValue = {
  staffId: number;
  year: number;
  month: number;
  range: { from: string; to: string };
  locked: boolean;
  canManage: boolean;
  lockM: ReturnType<typeof useWorkMonthLock>["lockM"];
};

const Ctx = createContext<WorkMonthContextValue | null>(null);

function monthRange(year: number, month: number) {
  const from = `${year}-${String(month).padStart(2, "0")}-01`;
  const lastDay = new Date(year, month, 0).getDate();
  const to = `${year}-${String(month).padStart(2, "0")}-${String(
    lastDay
  ).padStart(2, "0")}`;
  return { from, to };
}

export function WorkMonthProvider({
  staffId,
  year,
  month,
  children,
}: React.PropsWithChildren<{ staffId: number; year: number; month: number }>) {
  const { locked, lockM } = useWorkMonthLock({ staff: staffId, year, month });

  const meQ = useQuery({
    queryKey: ["staff-me"],
    queryFn: fetchStaffMe,
  });

  const canManage = !!meQ.data?.is_payroll_manager;

  const range = useMemo(() => monthRange(year, month), [year, month]);

  const value = useMemo(
    () => ({
      staffId,
      year,
      month,
      range,
      locked,
      canManage,
      lockM,
    }),
    [staffId, year, month, range, locked, canManage, lockM]
  );

  return <Ctx.Provider value={value}>{children}</Ctx.Provider>;
}

export function useWorkMonth() {
  const v = useContext(Ctx);
  if (!v) throw new Error("useWorkMonth must be used within WorkMonthProvider");
  return v;
}


==========================================================================================
# FILE: overlays/index.ts
==========================================================================================
ï»¿


==========================================================================================
# FILE: overlays/StaffDetailOverlay/StaffDetailOverlay.tsx
==========================================================================================
ï»¿// PATH: src/features/staff/overlays/StaffDetailOverlay/StaffDetailOverlay.tsx
import { useParams, useNavigate } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";
import { useState } from "react";
import { Tabs } from "antd";

import {
  fetchStaffDetail,
  fetchStaffSummaryByRange,
} from "../../api/staff.detail.api";
import {
  fetchWorkMonthLocks,
  isLockedFromLocks,
} from "../../api/workMonthLocks.api";
import { fetchStaffMe } from "../../api/staffMe.api";

import ActionButton from "../../components/ActionButton";
import { LockBadge, RoleBadge } from "../../components/StatusBadge";

import StaffSummaryTab from "./StaffSummaryTab";
import StaffWorkTypeTab from "./StaffWorkTypeTab";
import StaffWorkRecordsTab from "./StaffWorkRecordsTab";
import StaffExpensesTab from "./StaffExpensesTab";
import StaffPayrollHistoryTab from "./StaffPayrollHistoryTab";
import StaffReportTab from "./StaffReportTab";
import StaffSettingsTab from "./StaffSettingsTab";

function getThisMonthRange() {
  const d = new Date();
  const y = d.getFullYear();
  const m = d.getMonth() + 1;
  const from = `${y}-${String(m).padStart(2, "0")}-01`;
  const last = new Date(y, m, 0).getDate();
  const to = `${y}-${String(m).padStart(2, "0")}-${String(last).padStart(
    2,
    "0"
  )}`;
  return { y, m, from, to };
}

export default function StaffDetailOverlay() {
  const { staffId } = useParams();
  const navigate = useNavigate();
  const sid = Number(staffId);
  const [tab, setTab] = useState("summary");

  const { y, m, from, to } = getThisMonthRange();

  const staffQ = useQuery({
    queryKey: ["staff", sid],
    queryFn: () => fetchStaffDetail(sid),
    enabled: !!sid,
  });

  const meQ = useQuery({
    queryKey: ["staff-me"],
    queryFn: fetchStaffMe,
  });

  const summaryQ = useQuery({
    queryKey: ["staff-summary", sid, from, to],
    queryFn: () => fetchStaffSummaryByRange(sid, from, to),
    enabled: !!sid,
  });

  const locksQ = useQuery({
    queryKey: ["work-month-locks", sid, y, m],
    queryFn: () => fetchWorkMonthLocks({ staff: sid, year: y, month: m }),
    enabled: !!sid,
  });

  if (!sid || !staffQ.data) return null;

  const staff = staffQ.data;
  const summary = summaryQ.data;
  const locked = isLockedFromLocks(locksQ.data);
  const canManage = !!meQ.data?.is_payroll_manager;

  return (
    <>
      {/* Backdrop */}
      <div
        className="fixed inset-0 z-40 bg-black/50"
        onClick={() => navigate(-1)}
      />

      {/* Overlay */}
      <div className="fixed inset-0 z-50 flex justify-center items-start p-6">
        <div className="w-full max-w-[1200px] max-h-[90vh] overflow-auto rounded-xl bg-[var(--bg-surface)] shadow-xl">
          {/* Top Banner (ì›” ë§ˆê° UX ì„íŒ©íŠ¸) */}
          {locked && (
            <div className="px-6 py-3 border-b border-[color-mix(in_srgb,var(--color-danger)_55%,transparent)] bg-[var(--color-danger-soft)]">
              <div className="flex items-center justify-between gap-3">
                <div className="flex items-center gap-2">
                  <LockBadge state="LOCKED" />
                  <div className="text-sm font-semibold text-[var(--color-danger)]">
                    ì´ë²ˆë‹¬ì€ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤. (ê¸‰ì—¬ í™•ì •)
                  </div>
                </div>
                <div className="text-xs text-[var(--text-muted)]">
                  ë§ˆê°ëœ ì›”ì€ ê·¼ë¬´/ë¹„ìš© ìƒì„±Â·ìˆ˜ì •Â·ì‚­ì œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.
                </div>
              </div>
            </div>
          )}

          {/* Action Bar */}
          <div className="flex justify-end gap-2 px-6 py-3 border-b border-[var(--border-divider)]">
            {canManage && (
              <ActionButton variant="secondary" size="sm">
                ìˆ˜ì •
              </ActionButton>
            )}

            {canManage && (
              <ActionButton
                variant="danger-outline"
                size="sm"
                title="ì‚­ì œëŠ” ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
                onClick={() => {
                  if (!confirm("ì§ì›ì„ ì‚­ì œí• ê¹Œìš”? ì—°ê²°ëœ ë°ì´í„°ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.")) return;
                  alert("ì‚­ì œ API ì—°ê²° í•„ìš” (StaffSettingsTabì˜ ì‚­ì œ ë¡œì§ì„ ì¬ì‚¬ìš©í•˜ì„¸ìš”).");
                }}
              >
                ì‚­ì œ
              </ActionButton>
            )}

            <ActionButton variant="outline" size="sm" onClick={() => navigate(-1)}>
              ë‹«ê¸°
            </ActionButton>
          </div>

          {/* Body */}
          <div className="flex gap-5 p-6">
            {/* LEFT */}
            <div className="w-[280px] shrink-0 space-y-4">
              <div className="rounded-lg border border-[var(--border-divider)] bg-[var(--bg-surface-soft)] p-4 space-y-3">
                <div className="flex items-center justify-between">
                  <div className="text-lg font-semibold flex items-center gap-2">
                    {staff.name}
                    {staff.user_is_staff && (
                      <span className="px-2 py-0.5 rounded-full text-xs font-semibold bg-[var(--color-primary-soft)] text-[var(--color-primary)] border border-[color-mix(in_srgb,var(--color-primary)_45%,transparent)]">
                        STAFF
                      </span>
                    )}
                  </div>
                  <span
                    className={[
                      "px-2 py-0.5 rounded-full text-xs font-semibold border",
                      staff.is_active
                        ? "bg-[var(--color-success-soft)] text-[var(--color-success)] border-[color-mix(in_srgb,var(--color-success)_45%,transparent)]"
                        : "bg-[var(--bg-surface-muted)] text-[var(--text-disabled)] border-[var(--border-divider)]",
                    ].join(" ")}
                  >
                    {staff.is_active ? "í™œì„±" : "ë¹„í™œì„±"}
                  </span>
                </div>

                <Divider />

                <Info label="ê³„ì •" value={staff.user_username || "ê³„ì • ì—†ìŒ"} />
                <Info label="ì „í™”ë²ˆí˜¸" value={staff.phone || "-"} />
                <Info
                  label="ê¸‰ì—¬ìœ í˜•"
                  value={staff.pay_type === "HOURLY" ? "ì‹œê¸‰" : "ì›”ê¸‰"}
                />

                <div className="flex items-center justify-between text-sm">
                  <span className="text-[var(--text-muted)]">ì—­í• </span>
                  <RoleBadge isManager={!!staff.is_manager} />
                </div>
              </div>

              <div className="rounded-lg border border-[var(--border-divider)] p-4 space-y-2 bg-[var(--bg-surface)]">
                <div className="text-sm font-semibold">ì´ë²ˆë‹¬ ìš”ì•½</div>
                <Info label="ê·¼ë¬´ì‹œê°„" value={`${summary?.work_hours ?? 0} h`} />
                <Info
                  label="ì§€ê¸‰ì•¡"
                  value={`${(summary?.total_amount ?? 0).toLocaleString()} ì›`}
                />

                <div className="flex items-center justify-between text-sm">
                  <span className="text-[var(--text-muted)]">ë§ˆê°ìƒíƒœ</span>
                  <div className="flex items-center gap-2">
                    <LockBadge state={locked ? "LOCKED" : "OPEN"} compact />
                    <span
                      className={[
                        "font-semibold",
                        locked
                          ? "text-[var(--color-danger)]"
                          : "text-[var(--color-success)]",
                      ].join(" ")}
                    >
                      {locked ? "ê¸‰ì—¬ í™•ì •" : "ì§„í–‰ì¤‘"}
                    </span>
                  </div>
                </div>
              </div>
            </div>

            {/* RIGHT */}
            <div className="flex-1">
              <Tabs
                activeKey={tab}
                onChange={setTab}
                items={[
                  {
                    key: "summary",
                    label: "ìš”ì•½",
                    children: <StaffSummaryTab staffId={sid} />,
                  },
                  {
                    key: "worktype",
                    label: "ì‹œê¸‰Â·ê·¼ë¬´ìœ í˜•",
                    children: <StaffWorkTypeTab staffId={sid} />,
                  },
                  {
                    key: "records",
                    label: "ê·¼ë¬´ê¸°ë¡",
                    children: <StaffWorkRecordsTab staffId={sid} />,
                  },
                  {
                    key: "expenses",
                    label: "ë¹„ìš©",
                    children: <StaffExpensesTab staffId={sid} />,
                  },
                  {
                    key: "history",
                    label: "ê¸‰ì—¬ íˆìŠ¤í† ë¦¬",
                    children: <StaffPayrollHistoryTab />,
                  },
                  {
                    key: "report",
                    label: "ë¦¬í¬íŠ¸",
                    children: <StaffReportTab />,
                  },
                  canManage
                    ? {
                        key: "settings",
                        label: "ì„¤ì •",
                        children: <StaffSettingsTab />,
                      }
                    : null,
                ].filter(Boolean) as any}
              />
            </div>
          </div>
        </div>
      </div>
    </>
  );
}

function Info({
  label,
  value,
  valueClass,
}: {
  label: string;
  value: any;
  valueClass?: string;
}) {
  return (
    <div className="flex justify-between text-sm">
      <span className="text-[var(--text-muted)]">{label}</span>
      <span className={`font-semibold ${valueClass ?? ""}`}>{value || "-"}</span>
    </div>
  );
}

function Divider() {
  return <div className="h-px bg-[var(--border-divider)]" />;
}


==========================================================================================
# FILE: overlays/StaffDetailOverlay/StaffExpensesTab.tsx
==========================================================================================
// PATH: src/features/staff/overlays/StaffDetailOverlay/StaffExpensesTab.tsx
import { useMemo } from "react";
import { useQuery } from "@tanstack/react-query";

import { useExpenses } from "../../hooks/useExpenses";
import { fetchWorkMonthLocks, isLockedFromLocks } from "../../api/workMonthLocks.api";
import { fetchStaffMe } from "../../api/staffMe.api";

import ActionButton from "../../components/ActionButton";
import { ExpenseStatusBadge, LockBadge } from "../../components/StatusBadge";

function getThisMonthRange() {
  const d = new Date();
  const y = d.getFullYear();
  const m = d.getMonth() + 1;
  const from = `${y}-${String(m).padStart(2, "0")}-01`;
  const last = new Date(y, m, 0).getDate();
  const to = `${y}-${String(m).padStart(2, "0")}-${String(last).padStart(2, "0")}`;
  return { y, m, from, to };
}

function fmtDateTime(v?: string | null) {
  if (!v) return "-";
  const d = new Date(v);
  if (Number.isNaN(d.getTime())) return "-";
  return d.toLocaleString();
}

export default function StaffExpensesTab({ staffId }: { staffId: number }) {
  const { y, m, from, to } = useMemo(getThisMonthRange, []);
  const expenses = useExpenses({ staff: staffId, date_from: from, date_to: to });

  const locksQ = useQuery({
    queryKey: ["work-month-locks", staffId, y, m],
    queryFn: () => fetchWorkMonthLocks({ staff: staffId, year: y, month: m }),
  });

  const meQ = useQuery({
    queryKey: ["staff-me"],
    queryFn: fetchStaffMe,
  });

  const canManage = !!meQ.data?.is_payroll_manager;
  const locked = isLockedFromLocks(locksQ.data);
  const rows = expenses.listQ.data ?? [];

  return (
    <div className="space-y-3 max-w-[740px]">
      <div className="flex justify-between items-center">
        <div className="text-sm font-semibold">ë¹„ìš©</div>
        {locked && <LockBadge state="LOCKED" />}
      </div>

      {locked && (
        <div className="text-xs text-[var(--color-danger)]">
          * ë§ˆê°ëœ ì›”ì€ ë¹„ìš© ë³€ê²½(ìŠ¹ì¸/ë°˜ë ¤ í¬í•¨)ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.
        </div>
      )}

      {rows.length === 0 && (
        <div className="text-sm text-[var(--text-muted)]">ë¹„ìš© ì—†ìŒ</div>
      )}

      <div className={locked ? "opacity-95" : ""}>
        {rows.map((e) => {
          const isPending = e.status === "PENDING";
          const actionDisabled = locked || expenses.patchM.isPending;

          return (
            <div
              key={e.id}
              className="rounded-lg border border-[var(--border-divider)] px-4 py-3 text-sm bg-[var(--bg-surface)] space-y-2"
            >
              <div className="flex justify-between gap-3">
                <div className="space-y-1">
                  <div className="font-medium">
                    {e.date} Â· {e.title}
                  </div>

                  <div className="flex items-center gap-2">
                    <ExpenseStatusBadge status={e.status} />
                    {e.status !== "PENDING" && (
                      <div className="text-xs text-[var(--text-muted)]">
                        ìŠ¹ì¸ì: {e.approved_by_name ?? "-"} Â· {fmtDateTime(e.approved_at)}
                      </div>
                    )}
                  </div>

                  {!!e.memo && (
                    <div className="text-xs text-[var(--text-muted)]">ë©”ëª¨: {e.memo}</div>
                  )}
                </div>

                <div className="font-semibold">{e.amount.toLocaleString()}ì›</div>
              </div>

              {canManage && (
                <div className="flex items-center justify-end gap-2">
                  <ActionButton
                    variant="success"
                    size="xs"
                    disabledReason={
                      actionDisabled
                        ? locked
                          ? "ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤."
                          : "ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤."
                        : !isPending
                        ? "ëŒ€ê¸° ìƒíƒœì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤."
                        : ""
                    }
                    onClick={() => {
                      if (actionDisabled || !isPending) return;
                      if (!confirm("ì´ ë¹„ìš©ì„ ìŠ¹ì¸í• ê¹Œìš”?")) return;
                      expenses.patchM.mutate({ id: e.id, payload: { status: "APPROVED" } });
                    }}
                  >
                    ìŠ¹ì¸
                  </ActionButton>

                  <ActionButton
                    variant="danger-outline"
                    size="xs"
                    disabledReason={
                      actionDisabled
                        ? locked
                          ? "ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤."
                          : "ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤."
                        : !isPending
                        ? "ëŒ€ê¸° ìƒíƒœì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤."
                        : ""
                    }
                    onClick={() => {
                      if (actionDisabled || !isPending) return;
                      if (!confirm("ì´ ë¹„ìš©ì„ ë°˜ë ¤í• ê¹Œìš”?")) return;
                      expenses.patchM.mutate({ id: e.id, payload: { status: "REJECTED" } });
                    }}
                  >
                    ë°˜ë ¤
                  </ActionButton>
                </div>
              )}
            </div>
          );
        })}
      </div>

      <div className="text-[11px] text-[var(--text-muted)]">
        * ë¹„ìš© ìƒíƒœ/ìŠ¹ì¸ì€ ì„œë²„ ê¸°ì¤€ì´ë©°, í”„ë¡ íŠ¸ëŠ” í‘œì‹œ/ì•¡ì…˜ë§Œ ìˆ˜í–‰í•©ë‹ˆë‹¤.
      </div>
    </div>
  );
}


==========================================================================================
# FILE: overlays/StaffDetailOverlay/StaffPayrollHistoryTab.tsx
==========================================================================================
// PATH: src/features/staff/overlays/StaffDetailOverlay/StaffPayrollHistoryTab.tsx
import PayrollHistoryTable from "../../pages/ReportsPage/PayrollHistoryTable";

export default function StaffPayrollHistoryTab() {
  return (
    <div className="space-y-3">
      <div className="space-y-1">
        <div className="text-sm font-semibold">ê¸‰ì—¬ íˆìŠ¤í† ë¦¬</div>
        <div className="text-xs text-[var(--text-muted)]">
          * ê¸‰ì—¬ëŠ” <b>ì›” ë§ˆê° ì‹œì  PayrollSnapshot</b> ê¸°ì¤€ì´ë©° ì´í›„ ìˆ˜ì • ë¶ˆê°€í•©ë‹ˆë‹¤.
        </div>
      </div>

      <PayrollHistoryTable />
    </div>
  );
}


==========================================================================================
# FILE: overlays/StaffDetailOverlay/StaffPayrollTab.tsx
==========================================================================================
// PATH: src/features/staff/overlays/StaffDetailOverlay/StaffPayrollTab.tsx
import { useParams } from "react-router-dom";
import { usePayrollSnapshots } from "../../hooks/usePayrollSnapshots";

export default function StaffPayrollTab() {
  const { staffId } = useParams();
  const sid = Number(staffId);

  const { data, isLoading } = usePayrollSnapshots({ staff: sid });

  if (isLoading) {
    return <div className="text-sm text-[var(--text-muted)]">Loading payroll...</div>;
  }

  if (!data || data.length === 0) {
    return <div className="text-sm text-[var(--text-muted)]">ê¸‰ì—¬ ë°ì´í„° ì—†ìŒ</div>;
  }

  return (
    <div className="space-y-2">
      {data.map((p) => (
        <div
          key={p.id}
          className="flex justify-between rounded-lg border border-[var(--border-divider)] px-4 py-2 text-sm"
        >
          <div>
            {p.year}-{String(p.month).padStart(2, "0")}
          </div>
          <div className="font-semibold">
            {p.total_amount.toLocaleString()} ì›
          </div>
        </div>
      ))}

      <div className="text-xs text-[var(--text-muted)]">
        * ê¸‰ì—¬ëŠ” ìˆ˜ì • ë¶ˆê°€í•˜ë©° PayrollSnapshot ê¸°ì¤€ìœ¼ë¡œë§Œ í‘œì‹œë©ë‹ˆë‹¤.
      </div>
    </div>
  );
}


==========================================================================================
# FILE: overlays/StaffDetailOverlay/StaffReportTab.tsx
==========================================================================================
ï»¿// PATH: src/features/staff/overlays/StaffDetailOverlay/StaffReportTab.tsx

import { useMemo, useState } from "react";
import { useParams } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";
import { Card, CardBody } from "@/shared/ui/card";

import { fetchStaffSummaryByRange } from "../../api/staff.detail.api";

function todayISO() {
  return new Date().toISOString().slice(0, 10);
}

function getMonthBoundsFrom(dateISO: string) {
  const y = Number(dateISO.slice(0, 4));
  const m = Number(dateISO.slice(5, 7));
  const from = `${y}-${String(m).padStart(2, "0")}-01`;
  const lastDay = new Date(y, m, 0).getDate();
  const to = `${y}-${String(m).padStart(2, "0")}-${String(lastDay).padStart(2, "0")}`;
  return { from, to };
}

export default function StaffReportTab() {
  const { staffId } = useParams();
  const sid = Number(staffId);

  const [range] = useState(() => getMonthBoundsFrom(todayISO()));
  const monthLabel = useMemo(() => `${range.from} ~ ${range.to}`, [range.from, range.to]);

  const summaryQ = useQuery({
    queryKey: ["staff-report-summary", sid, range.from, range.to],
    queryFn: () => fetchStaffSummaryByRange(sid, range.from, range.to),
    enabled: !!sid,
  });

  if (summaryQ.isLoading) {
    return <div className="text-sm text-[var(--text-muted)]">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>;
  }

  if (!summaryQ.data) {
    return <div className="text-sm text-[var(--text-muted)]">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>;
  }

  const s = summaryQ.data;

  return (
    <div className="space-y-4">
      <div className="flex items-end justify-between gap-3">
        <div className="space-y-1">
          <div className="text-sm font-semibold">ë¦¬í¬íŠ¸</div>
          <div className="text-xs text-[var(--text-muted)]">ê¸°ê°„: {monthLabel}</div>
        </div>
      </div>

      <Card>
        <CardBody className="grid grid-cols-2 gap-4 sm:grid-cols-4">
          <Item label="ê·¼ë¬´ì‹œê°„" value={`${s.work_hours} h`} />
          <Item label="ê¸‰ì—¬" value={`${s.work_amount.toLocaleString()} ì›`} />
          <Item label="ë¹„ìš©" value={`${s.expense_amount.toLocaleString()} ì›`} />
          <Item label="ì‹¤ ì§€ê¸‰ì•¡" value={`${s.total_amount.toLocaleString()} ì›`} primary />
        </CardBody>
      </Card>

      <div className="text-xs text-[var(--text-muted)]">
        * ë¦¬í¬íŠ¸ ìˆ˜ì¹˜ëŠ” <b>ì„œë²„ ì§‘ê³„ ê²°ê³¼(Summary API)</b> ê¸°ì¤€ì…ë‹ˆë‹¤.
      </div>
    </div>
  );
}

function Item({ label, value, primary }: { label: string; value: string; primary?: boolean }) {
  return (
    <div className="rounded-lg border border-[var(--border-divider)] bg-[var(--bg-surface-soft)] px-4 py-3">
      <div className="text-xs text-[var(--text-muted)]">{label}</div>
      <div
        className={[
          "mt-1 text-lg font-semibold",
          primary ? "text-[var(--color-primary)]" : "text-[var(--text-primary)]",
        ].join(" ")}
      >
        {value}
      </div>
    </div>
  );
}


==========================================================================================
# FILE: overlays/StaffDetailOverlay/StaffSettingsTab.tsx
==========================================================================================
ï»¿// PATH: src/features/staff/overlays/StaffDetailOverlay/StaffSettingsTab.tsx
import { useEffect, useState } from "react";
import { useParams, useNavigate } from "react-router-dom";
import { useMutation, useQuery, useQueryClient } from "@tanstack/react-query";

import { fetchStaffDetail, patchStaffDetail, StaffDetail } from "../../api/staff.detail.api";
import { fetchStaffMe } from "../../api/staffMe.api";
import api from "@/shared/api/axios";

export default function StaffSettingsTab() {
  const { staffId } = useParams();
  const sid = Number(staffId);
  const nav = useNavigate();
  const qc = useQueryClient();

  const meQ = useQuery({
    queryKey: ["staff-me"],
    queryFn: fetchStaffMe,
  });

  const canManage = !!meQ.data?.is_payroll_manager;

  const detailQ = useQuery({
    queryKey: ["staff", sid],
    queryFn: () => fetchStaffDetail(sid),
    enabled: !!sid,
  });

  const patchM = useMutation({
    mutationFn: (payload: Partial<StaffDetail>) => patchStaffDetail(sid, payload),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["staff", sid] });
      alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    },
  });

  const deleteM = useMutation({
    mutationFn: async () => {
      await api.delete(`/staffs/${sid}/`);
    },
    onSuccess: async () => {
      alert("ì§ì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
      await qc.invalidateQueries({ queryKey: ["staffs"] });
      nav("/admin/staff");
    },
  });

  const [form, setForm] = useState({
    name: "",
    phone: "",
    is_active: true,
    pay_type: "HOURLY" as "HOURLY" | "MONTHLY",
  });

  useEffect(() => {
    if (!detailQ.data) return;
    setForm({
      name: detailQ.data.name || "",
      phone: detailQ.data.phone || "",
      is_active: detailQ.data.is_active,
      pay_type: detailQ.data.pay_type,
    });
  }, [detailQ.data]);

  if (!canManage) {
    return <div className="text-sm text-[var(--text-muted)]">ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.</div>;
  }

  if (detailQ.isLoading || !detailQ.data) {
    return <div className="text-sm text-[var(--text-muted)]">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>;
  }

  return (
    <div className="max-w-[520px] space-y-6">
      <div className="space-y-3">
        <Field label="ì´ë¦„">
          <input
            value={form.name}
            onChange={(e) => setForm((p) => ({ ...p, name: e.target.value }))}
            className="form-input"
          />
        </Field>

        <Field label="ì „í™”ë²ˆí˜¸">
          <input
            value={form.phone}
            onChange={(e) => setForm((p) => ({ ...p, phone: e.target.value }))}
            className="form-input"
          />
        </Field>

        <Field label="ê¸‰ì—¬ ìœ í˜•">
          <select
            value={form.pay_type}
            onChange={(e) => setForm((p) => ({ ...p, pay_type: e.target.value as any }))}
            className="form-input"
          >
            <option value="HOURLY">ì‹œê¸‰</option>
            <option value="MONTHLY">ì›”ê¸‰</option>
          </select>
        </Field>

        <label className="flex items-center gap-2 text-sm">
          <input
            type="checkbox"
            checked={form.is_active}
            onChange={(e) => setForm((p) => ({ ...p, is_active: e.target.checked }))}
          />
          í™œì„±
        </label>
      </div>

      <div className="flex items-center justify-between pt-4 border-t border-[var(--border-divider)]">
        <button
          onClick={() => patchM.mutate(form)}
          className="btn-primary"
          disabled={patchM.isPending}
        >
          ì €ì¥
        </button>

        <button
          onClick={() => {
            if (!confirm("ì§ì›ì„ ì‚­ì œí• ê¹Œìš”? ì—°ê²°ëœ ë°ì´í„°ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.")) return;
            deleteM.mutate();
          }}
          className="btn-danger"
        >
          ì§ì› ì‚­ì œ
        </button>
      </div>
    </div>
  );
}

function Field({ label, children }: { label: string; children: React.ReactNode }) {
  return (
    <div className="space-y-1">
      <div className="text-xs font-medium text-[var(--text-muted)]">{label}</div>
      {children}
    </div>
  );
}


==========================================================================================
# FILE: overlays/StaffDetailOverlay/StaffSummaryTab.tsx
==========================================================================================
ï»¿// PATH: src/features/staff/overlays/StaffDetailOverlay/StaffSummaryTab.tsx
import { useQuery } from "@tanstack/react-query";
import { fetchStaffSummaryByRange } from "../../api/staff.detail.api";
import { fetchWorkMonthLocks, isLockedFromLocks } from "../../api/workMonthLocks.api";
import { LockBadge } from "../../components/StatusBadge";

export default function StaffSummaryTab({ staffId }: { staffId: number }) {
  const now = new Date();
  const y = now.getFullYear();
  const m = now.getMonth() + 1;

  const from = `${y}-${String(m).padStart(2, "0")}-01`;
  const last = new Date(y, m, 0).getDate();
  const to = `${y}-${String(m).padStart(2, "0")}-${String(last).padStart(2, "0")}`;

  const summaryQ = useQuery({
    queryKey: ["staff-summary", staffId, from, to],
    queryFn: () => fetchStaffSummaryByRange(staffId, from, to),
  });

  const locksQ = useQuery({
    queryKey: ["work-month-locks", staffId, y, m],
    queryFn: () => fetchWorkMonthLocks({ staff: staffId, year: y, month: m }),
  });

  if (!summaryQ.data) {
    return <div className="text-sm text-[var(--text-muted)]">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>;
  }

  const locked = isLockedFromLocks(locksQ.data);
  const s = summaryQ.data;

  return (
    <div className="space-y-4">
      <div
        className={[
          "rounded-xl border px-4 py-3 flex justify-between items-center",
          locked
            ? "border-[color-mix(in_srgb,var(--color-danger)_55%,transparent)] bg-[var(--color-danger-soft)]"
            : "border-[var(--border-divider)] bg-[var(--bg-surface-soft)]",
        ].join(" ")}
      >
        <div>
          <div className="text-sm font-semibold">ì´ë²ˆë‹¬ ìš”ì•½</div>
          <div className="text-xs text-[var(--text-muted)]">
            {from} ~ {to}
          </div>
        </div>

        <div className="flex items-center gap-2">
          <LockBadge state={locked ? "LOCKED" : "OPEN"} />
          <span
            className={`text-sm font-semibold ${
              locked
                ? "text-[var(--color-danger)]"
                : "text-[var(--color-success)]"
            }`}
          >
            {locked ? "ê¸‰ì—¬ í™•ì •" : "ì§„í–‰ì¤‘"}
          </span>
        </div>
      </div>

      <div className="grid grid-cols-2 sm:grid-cols-4 gap-4">
        <Item label="ê·¼ë¬´ì‹œê°„" value={`${s.work_hours} h`} />
        <Item label="ê¸‰ì—¬" value={s.work_amount.toLocaleString()} />
        <Item label="ë¹„ìš©" value={s.expense_amount.toLocaleString()} />
        <Item label="ì‹¤ì§€ê¸‰ì•¡" value={s.total_amount.toLocaleString()} primary />
      </div>
    </div>
  );
}

function Item({
  label,
  value,
  primary,
}: {
  label: string;
  value: string;
  primary?: boolean;
}) {
  return (
    <div className="rounded-lg border border-[var(--border-divider)] bg-[var(--bg-surface-soft)] px-4 py-3">
      <div className="text-xs text-[var(--text-muted)]">{label}</div>
      <div
        className={`mt-1 text-lg font-semibold ${
          primary ? "text-[var(--color-primary)]" : ""
        }`}
      >
        {value}
      </div>
    </div>
  );
}


==========================================================================================
# FILE: overlays/StaffDetailOverlay/StaffWorkRecordsTab.tsx
==========================================================================================
// PATH: src/features/staff/overlays/StaffDetailOverlay/StaffWorkRecordsTab.tsx
import { useMemo } from "react";
import { useWorkRecords } from "../../hooks/useWorkRecords";
import { fetchWorkMonthLocks, isLockedFromLocks } from "../../api/workMonthLocks.api";
import { useQuery } from "@tanstack/react-query";
import { LockBadge } from "../../components/StatusBadge";
import ActionButton from "../../components/ActionButton";

function getThisMonthRange() {
  const d = new Date();
  const y = d.getFullYear();
  const m = d.getMonth() + 1;
  const from = `${y}-${String(m).padStart(2, "0")}-01`;
  const last = new Date(y, m, 0).getDate();
  const to = `${y}-${String(m).padStart(2, "0")}-${String(last).padStart(2, "0")}`;
  return { y, m, from, to };
}

export default function StaffWorkRecordsTab({ staffId }: { staffId: number }) {
  const { y, m, from, to } = useMemo(getThisMonthRange, []);
  const recordsQ = useWorkRecords({ staff: staffId, date_from: from, date_to: to });

  const locksQ = useQuery({
    queryKey: ["work-month-locks", staffId, y, m],
    queryFn: () => fetchWorkMonthLocks({ staff: staffId, year: y, month: m }),
  });

  const locked = isLockedFromLocks(locksQ.data);
  const rows = recordsQ.listQ.data ?? [];

  return (
    <div className="space-y-3 max-w-[720px]">
      <div className="flex justify-between items-center">
        <div className="flex items-center gap-2">
          <div className="text-sm font-semibold">ê·¼ë¬´ê¸°ë¡</div>
          {locked && <LockBadge state="LOCKED" />}
        </div>
      </div>

      {locked && (
        <div className="text-xs text-[var(--color-danger)]">
          * ë§ˆê°ëœ ì›”ì€ ê·¼ë¬´ê¸°ë¡ ë³€ê²½ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.
        </div>
      )}

      {rows.length === 0 && (
        <div className="text-sm text-[var(--text-muted)]">ê¸°ë¡ ì—†ìŒ</div>
      )}

      <div className={locked ? "opacity-95" : ""}>
        {rows.map((r) => (
          <div
            key={r.id}
            className="flex justify-between rounded-lg border border-[var(--border-divider)] px-4 py-2 text-sm bg-[var(--bg-surface)]"
          >
            <div>
              <div className="font-medium">
                {r.date} Â· {r.work_type_name}
              </div>
              <div className="text-xs text-[var(--text-muted)]">
                {r.start_time} ~ {r.end_time}
              </div>
            </div>

            <div className="flex items-center gap-3">
              <div className="font-semibold">
                {r.amount.toLocaleString()}ì›
              </div>

              <ActionButton
                variant="danger-outline"
                size="xs"
                disabledReason={locked ? "ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤." : ""}
                onClick={() => {
                  if (locked) return;
                  if (!confirm("ì´ ê·¼ë¬´ ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?")) return;
                  recordsQ.deleteM.mutate(r.id);
                }}
              >
                ì‚­ì œ
              </ActionButton>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}


==========================================================================================
# FILE: overlays/StaffDetailOverlay/StaffWorkTypeTab.tsx
==========================================================================================
// PATH: src/features/staff/overlays/StaffDetailOverlay/StaffWorkTypeTab.tsx
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import {
  fetchStaffWorkTypes,
  fetchWorkTypes,
  createStaffWorkType,
  patchStaffWorkType,
  deleteStaffWorkType,
} from "../../api/staffWorkType.api";

export default function StaffWorkTypeTab({ staffId }: { staffId: number }) {
  const qc = useQueryClient();

  const staffTypesQ = useQuery({
    queryKey: ["staff-work-types", staffId],
    queryFn: () => fetchStaffWorkTypes(staffId),
  });

  const workTypesQ = useQuery({
    queryKey: ["work-types"],
    queryFn: () => fetchWorkTypes({ is_active: true }),
  });

  const createM = useMutation({
    mutationFn: (payload: { work_type_id: number }) =>
      createStaffWorkType(staffId, payload),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["staff-work-types", staffId] });
    },
  });

  const patchM = useMutation({
    mutationFn: ({ id, hourly_wage }: { id: number; hourly_wage: number | null }) =>
      patchStaffWorkType(id, { hourly_wage }),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["staff-work-types", staffId] });
    },
  });

  const deleteM = useMutation({
    mutationFn: deleteStaffWorkType,
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["staff-work-types", staffId] });
    },
  });

  const staffTypes = staffTypesQ.data ?? [];
  const workTypes = workTypesQ.data ?? [];

  return (
    <div className="space-y-4 max-w-[640px]">
      <div className="text-sm font-semibold">ì‹œê¸‰ Â· ê·¼ë¬´ìœ í˜•</div>

      {staffTypes.length === 0 && (
        <div className="rounded-xl border border-[var(--border-divider)] bg-[var(--bg-surface-soft)] px-4 py-3 text-sm">
          <div className="font-semibold">ê·¼ë¬´ìœ í˜•ì´ ì—†ìŠµë‹ˆë‹¤.</div>
          <div className="text-xs text-[var(--text-muted)] mt-1">
            * ê·¼ë¬´ê¸°ë¡ì„ ì…ë ¥í•˜ë ¤ë©´ ìµœì†Œ 1ê°œì˜ ê·¼ë¬´ìœ í˜•ì´ í•„ìš”í•©ë‹ˆë‹¤.
          </div>
        </div>
      )}

      {staffTypes.map((st) => (
        <div
          key={st.id}
          className="flex items-center justify-between rounded-lg border px-4 py-3 text-sm"
        >
          <div>
            <div className="font-medium">{st.work_type.name}</div>
            <div className="text-xs text-[var(--text-muted)]">
              {st.hourly_wage == null
                ? "ê¸°ë³¸ ì‹œê¸‰ ì‚¬ìš©"
                : `ê°œë³„ ì‹œê¸‰: ${st.hourly_wage.toLocaleString()}ì›`}
            </div>
          </div>

          <div className="flex items-center gap-2">
            <input
              type="number"
              className="w-[120px] input"
              defaultValue={st.hourly_wage ?? ""}
              placeholder="ì‹œê¸‰"
              onBlur={(e) => {
                const v = e.target.value;
                patchM.mutate({
                  id: st.id,
                  hourly_wage: v === "" ? null : Number(v),
                });
              }}
            />

            <button
              onClick={() => {
                if (!confirm("ì´ ê·¼ë¬´ìœ í˜•ì„ ì œê±°í• ê¹Œìš”?")) return;
                deleteM.mutate(st.id);
              }}
              className="text-xs text-[var(--color-danger)]"
            >
              ì‚­ì œ
            </button>
          </div>
        </div>
      ))}

      <div className="pt-4 border-t">
        <div className="text-xs text-[var(--text-muted)] mb-1">
          ê·¼ë¬´ìœ í˜• ì¶”ê°€
        </div>
        <select
          className="input"
          onChange={(e) => {
            const id = Number(e.target.value);
            if (!id) return;
            createM.mutate({ work_type_id: id });
            e.target.value = "";
          }}
        >
          <option value="">ì„ íƒ</option>
          {workTypes
            .filter(
              (wt) => !staffTypes.some((st) => st.work_type.id === wt.id)
            )
            .map((wt) => (
              <option key={wt.id} value={wt.id}>
                {wt.name}
              </option>
            ))}
        </select>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: overlays/StaffDetailOverlay/index.ts
==========================================================================================
ï»¿


==========================================================================================
# FILE: pages/index.ts
==========================================================================================
ï»¿


==========================================================================================
# FILE: pages/HomePage/HomeKpiSection.tsx
==========================================================================================
ï»¿// PATH: src/features/staff/pages/HomePage/HomeKpiSection.tsx
import React from "react";
import ActionButton from "../../components/ActionButton";
import { useNavigate } from "react-router-dom";

export const HomeKpiSection: React.FC<{ canManage: boolean }> = ({ canManage }) => {
  const nav = useNavigate();

  return (
    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div className="rounded-2xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-5 py-4">
        <div className="text-sm font-semibold">ìš´ì˜ ê·œì¹™</div>
        <div className="text-xs text-[var(--text-muted)] mt-2 leading-relaxed">
          â€¢ í•©ê³„/ê¸‰ì—¬/ì‹œê°„/ìƒíƒœ íŒì •: <b>ë°±ì—”ë“œ ë‹¨ì¼ì§„ì‹¤</b> <br />
          â€¢ <b>ì›” ë§ˆê° = ê¸‰ì—¬ í™•ì •</b> Â· ë§ˆê°ëœ ì›”ì€ ë³€ê²½ ë¶ˆê°€ <br />
          â€¢ ìŠ¹ì¸/ë§ˆê°: <b>ê´€ë¦¬ì(is_payroll_manager)</b>ë§Œ ê°€ëŠ¥
        </div>
      </div>

      <div className="rounded-2xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-5 py-4">
        <div className="text-sm font-semibold">ë¹ ë¥¸ ì‘ì—…</div>
        <div className="text-xs text-[var(--text-muted)] mt-2">
          ê·¼ë¬´/ë¹„ìš© ì…ë ¥ ë° ì›” ë§ˆê°(ê¸‰ì—¬ í™•ì •)ì€ ì‘ì—… íƒ­ì—ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
        </div>

        <div className="mt-3 flex items-center gap-2">
          <ActionButton
            variant="primary"
            size="sm"
            onClick={() => nav("/admin/staff/operations")}
          >
            ì‘ì—… íƒ­ ì—´ê¸°
          </ActionButton>

          <ActionButton
            variant="outline"
            size="sm"
            onClick={() => nav("/admin/staff/reports")}
          >
            ë¦¬í¬íŠ¸ ë³´ê¸°
          </ActionButton>
        </div>

        {!canManage && (
          <div className="mt-2 text-[11px] text-[var(--color-danger)]">
            * í˜„ì¬ ê³„ì •ì€ ìŠ¹ì¸/ë§ˆê° ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.
          </div>
        )}
      </div>
    </div>
  );
};


==========================================================================================
# FILE: pages/HomePage/HomePage.tsx
==========================================================================================
ï»¿// PATH: src/features/staff/pages/HomePage/HomePage.tsx
import { useNavigate } from "react-router-dom";
import { useMemo, useState } from "react";
import { StaffHomeTable } from "./StaffHomeTable";
import { useStaffs } from "../../hooks/useStaffs";
import StaffCreateModal from "./StaffCreateModal";
import WorkTypeCreateModal from "./WorkTypeCreateModal";
import { useQuery } from "@tanstack/react-query";
import { fetchStaffMe } from "../../api/staffMe.api";
import { Input } from "antd";

export default function HomePage() {
  const navigate = useNavigate();
  const { data: staffs, isLoading } = useStaffs();
  const [openCreate, setOpenCreate] = useState(false);
  const [openWorkType, setOpenWorkType] = useState(false);
  const [q, setQ] = useState("");

  const meQ = useQuery({
    queryKey: ["staff-me"],
    queryFn: fetchStaffMe,
  });

  const canManage = !!meQ.data?.is_payroll_manager;

  const rows = useMemo(() => {
    const list = Array.isArray(staffs) ? staffs : [];
    const needle = q.trim().toLowerCase();
    if (!needle) return list;

    return list.filter((s) => {
      return (
        (s.name ?? "").toLowerCase().includes(needle) ||
        (s.phone ?? "").toLowerCase().includes(needle)
      );
    });
  }, [staffs, q]);

  if (isLoading) {
    return <div className="text-sm text-gray-500">Loading...</div>;
  }

  return (
    <div className="space-y-4 p-6">
      <div className="flex items-start justify-between gap-4">
        <div className="space-y-1">
          <div className="text-lg font-semibold">ì§ì› ê´€ë¦¬</div>
          <div className="text-xs text-[var(--text-muted)]">
            * ê¸‰ì—¬/ì‹œê°„/í•©ê³„ëŠ” ë°±ì—”ë“œ ê¸°ì¤€ Â· ë§ˆê°ëœ ì›”ì€ ë³€ê²½ ë¶ˆê°€
          </div>
        </div>

        {canManage && (
          <div className="flex gap-2">
            <button
              onClick={() => setOpenWorkType(true)}
              className="btn-outline"
            >
              + ê·¼ë¬´ìœ í˜• ìƒì„±
            </button>
            <button
              onClick={() => setOpenCreate(true)}
              className="btn-primary"
            >
              + ì§ì› ë“±ë¡
            </button>
          </div>
        )}
      </div>

      <div className="max-w-[420px]">
        <Input
          value={q}
          onChange={(e) => setQ(e.target.value)}
          allowClear
          placeholder="ì´ë¦„/ì „í™”ë²ˆí˜¸ ê²€ìƒ‰"
        />
      </div>

      <StaffHomeTable
        staffs={rows}
        canManage={canManage}
        onOperate={(id) => navigate(`/admin/staff/operations?staffId=${id}`)}
        onDetail={(id) => navigate(`/admin/staff/${id}`)}
      />

      <StaffCreateModal open={openCreate} onClose={() => setOpenCreate(false)} />
      <WorkTypeCreateModal
        open={openWorkType}
        onClose={() => setOpenWorkType(false)}
      />
    </div>
  );
}


==========================================================================================
# FILE: pages/HomePage/StaffCreateModal.tsx
==========================================================================================
// PATH: src/features/staff/pages/HomePage/StaffCreateModal.tsx

import { Modal } from "antd";
import { useState } from "react";
import { useMutation, useQueryClient } from "@tanstack/react-query";
import api from "@/shared/api/axios";

type Props = {
  open: boolean;
  onClose: () => void;
};

type PermissionRole = "ADMIN" | "TEACHER" | "ASSISTANT" | "OWNER";

export default function StaffCreateModal({ open, onClose }: Props) {
  const qc = useQueryClient();

  const [form, setForm] = useState({
    username: "",
    password: "",
    name: "",
    phone: "",
    permission_role: "ASSISTANT" as PermissionRole,
  });

  const createM = useMutation({
    mutationFn: async () => {
      /**
       * ğŸ”’ ìŠ¤í™ ë‹¨ì¼ì§„ì‹¤
       * - backendëŠ” role í•„ë“œë§Œ ì¸ì‹
       * - OWNERëŠ” í”„ë¡ íŠ¸ì—ì„œ ì „ì†¡ ê¸ˆì§€
       */
      const role =
        form.permission_role === "OWNER"
          ? undefined
          : form.permission_role;

      const res = await api.post("/staffs/", {
        username: form.username,
        password: form.password,
        name: form.name,
        phone: form.phone || undefined,
        role, // âœ… í•µì‹¬ ìˆ˜ì •
      });

      return res.data;
    },
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["staffs"] });
      alert("ì§ì›ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.");
      onClose();
      setForm({
        username: "",
        password: "",
        name: "",
        phone: "",
        permission_role: "ASSISTANT",
      });
    },
    onError: (e: any) => {
      const msg =
        e?.response?.data?.detail ||
        e?.response?.data?.message ||
        "ì§ì› ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
      alert(msg);
    },
  });

  return (
    <Modal
      title="ì§ì› ë“±ë¡"
      open={open}
      onCancel={onClose}
      onOk={() => {
        if (
          !form.username.trim() ||
          !form.password.trim() ||
          !form.name.trim() ||
          !form.permission_role
        ) {
          alert("í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");
          return;
        }
        createM.mutate();
      }}
      okText="ë“±ë¡"
      cancelText="ì·¨ì†Œ"
      confirmLoading={createM.isPending}
    >
      <div className="space-y-3">
        <Field label="ë¡œê·¸ì¸ ì•„ì´ë”” *">
          <input
            className="input"
            value={form.username}
            onChange={(e) =>
              setForm((p) => ({ ...p, username: e.target.value }))
            }
            placeholder="ë¡œê·¸ì¸ì— ì‚¬ìš©ë©ë‹ˆë‹¤"
          />
        </Field>

        <Field label="ë¹„ë°€ë²ˆí˜¸ *">
          <input
            type="password"
            className="input"
            value={form.password}
            onChange={(e) =>
              setForm((p) => ({ ...p, password: e.target.value }))
            }
          />
        </Field>

        <Field label="ì´ë¦„ *">
          <input
            className="input"
            value={form.name}
            onChange={(e) =>
              setForm((p) => ({ ...p, name: e.target.value }))
            }
          />
        </Field>

        <Field label="ì „í™”ë²ˆí˜¸">
          <input
            className="input"
            value={form.phone}
            onChange={(e) =>
              setForm((p) => ({ ...p, phone: e.target.value }))
            }
          />
        </Field>

        <Field label="ê¶Œí•œ *">
          <select
            className="input"
            value={form.permission_role}
            onChange={(e) =>
              setForm((p) => ({
                ...p,
                permission_role: e.target.value as PermissionRole,
              }))
            }
          >
            <option value="ASSISTANT">ì¡°êµ (ì¼ë°˜ ì§ì›)</option>
            <option value="TEACHER">ê°•ì‚¬</option>
            <option value="ADMIN">ê´€ë¦¬ì</option>
            <option value="OWNER" disabled>
              ì˜¤ë„ˆ (ë°±ì—”ë“œ ì§€ì •)
            </option>
          </select>
        </Field>

        <div className="text-xs text-[var(--text-muted)] leading-relaxed">
          â€¢ <b>ê´€ë¦¬ì</b>: ì§ì› ê´€ë¦¬ Â· ìŠ¹ì¸ Â· ë§ˆê° ê°€ëŠ¥<br />
          â€¢ <b>ê°•ì‚¬</b>: ê°•ì˜ ë‹´ë‹¹ (ê¶Œí•œì€ ë°±ì—”ë“œ ì •ì±…ì— ë”°ë¦„)<br />
          â€¢ <b>ì¡°êµ</b>: ì¼ë°˜ ì§ì›<br />
          â€¢ <b>ì˜¤ë„ˆ</b>: ì‹œìŠ¤í…œ ì „ìš© (í”„ë¡ íŠ¸ì—ì„œ ì§€ì • ë¶ˆê°€)
        </div>
      </div>
    </Modal>
  );
}

function Field({
  label,
  children,
}: {
  label: string;
  children: React.ReactNode;
}) {
  return (
    <div className="space-y-1">
      <div className="text-xs font-medium text-[var(--text-muted)]">
        {label}
      </div>
      {children}
    </div>
  );
}


==========================================================================================
# FILE: pages/HomePage/StaffHomeTable.tsx
==========================================================================================
ï»¿// PATH: src/features/staff/pages/HomePage/StaffHomeTable.tsx
import { Table, Button, Select } from "antd";
import type { ColumnsType } from "antd/es/table";
import { Staff } from "../../api/staff.api";
import { RoleBadge } from "../../components/StatusBadge";
import { useMutation, useQueryClient } from "@tanstack/react-query";
import { patchStaffDetail } from "../../api/staff.detail.api";

interface Props {
  staffs: Staff[] | undefined;
  onOperate: (staffId: number) => void;
  onDetail: (staffId: number) => void;
  canManage: boolean;
}

export function StaffHomeTable({ staffs, onOperate, onDetail, canManage }: Props) {
  const dataSource: Staff[] = Array.isArray(staffs) ? staffs : [];
  const qc = useQueryClient();

  const patchPayTypeM = useMutation({
    mutationFn: ({ staffId, pay_type }: { staffId: number; pay_type: "HOURLY" | "MONTHLY" }) =>
      patchStaffDetail(staffId, { pay_type }),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["staffs"] });
      qc.invalidateQueries({ queryKey: ["staff"] });
    },
    onError: (e: any) => {
      const msg =
        e?.response?.data?.detail ||
        e?.response?.data?.message ||
        "ê¸‰ì—¬ ìœ í˜• ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
      alert(msg);
    },
  });

  const columns: ColumnsType<Staff> = [
    {
      title: "ì´ë¦„",
      dataIndex: "name",
      render: (_, r) => (
        <div className="flex items-center gap-2">
          <span className="font-semibold">{r.name}</span>
          {!r.is_active && (
            <span className="px-2 py-0.5 rounded-full text-xs border text-[var(--text-muted)] bg-[var(--bg-surface-muted)]">
              ë¹„í™œì„±
            </span>
          )}
        </div>
      ),
    },
    { title: "ì „í™”ë²ˆí˜¸", dataIndex: "phone", render: (v) => v || "-" },
    {
      title: "ì—­í• ",
      dataIndex: "is_manager",
      render: (v) => <RoleBadge isManager={!!v} />,
    },
    {
      title: "ê¸‰ì—¬ ìœ í˜•",
      dataIndex: "pay_type",
      render: (v: Staff["pay_type"], record) => {
        if (!canManage) return v === "HOURLY" ? "ì‹œê¸‰" : "ì›”ê¸‰";

        return (
          <div
            onClick={(e) => e.stopPropagation()}
            onMouseDown={(e) => e.stopPropagation()}
          >
            <Select
              size="small"
              value={v}
              style={{ width: 110 }}
              disabled={patchPayTypeM.isPending}
              options={[
                { value: "HOURLY", label: "ì‹œê¸‰" },
                { value: "MONTHLY", label: "ì›”ê¸‰" },
              ]}
              onChange={(next) => {
                if (next === record.pay_type) return;
                patchPayTypeM.mutate({ staffId: record.id, pay_type: next });
              }}
            />
          </div>
        );
      },
    },
    {
      title: "ê´€ë¦¬",
      render: (_, record) => (
        <div className="flex gap-2">
          <Button
            type="link"
            disabled={!canManage}
            onClick={(e) => {
              e.stopPropagation();
              onOperate(record.id);
            }}
          >
            ì‘ì—…
          </Button>
          <Button
            type="link"
            onClick={(e) => {
              e.stopPropagation();
              onDetail(record.id);
            }}
          >
            ìƒì„¸
          </Button>
        </div>
      ),
    },
  ];

  return (
    <Table
      rowKey="id"
      dataSource={dataSource}
      columns={columns}
      pagination={false}
      onRow={(r) => ({
        onClick: () => onDetail(r.id), // âœ… row í´ë¦­ â†’ ìƒì„¸ ì˜¤ë²„ë ˆì´
      })}
    />
  );
}


==========================================================================================
# FILE: pages/HomePage/WorkTypeCreateModal.tsx
==========================================================================================
// PATH: src/features/staff/pages/HomePage/WorkTypeCreateModal.tsx
import { Modal } from "antd";
import { useState } from "react";
import { useMutation, useQueryClient } from "@tanstack/react-query";
import api from "@/shared/api/axios";

export default function WorkTypeCreateModal({
  open,
  onClose,
}: {
  open: boolean;
  onClose: () => void;
}) {
  const qc = useQueryClient();

  const [form, setForm] = useState({
    name: "",
    base_hourly_wage: 0,
    color: "#22c55e",
    description: "",
  });

  const createM = useMutation({
    mutationFn: async () => {
      const res = await api.post("/staffs/work-types/", {
        name: form.name,
        base_hourly_wage: Number(form.base_hourly_wage),
        color: form.color,
        description: form.description,
      });
      return res.data;
    },
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["work-types"] });
      alert("ê·¼ë¬´ìœ í˜•ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.");
      onClose();
      setForm({
        name: "",
        base_hourly_wage: 0,
        color: "#22c55e",
        description: "",
      });
    },
    onError: (e: any) => {
      alert(
        e?.response?.data?.detail ||
          e?.response?.data?.message ||
          "ê·¼ë¬´ìœ í˜• ìƒì„± ì‹¤íŒ¨"
      );
    },
  });

  return (
    <Modal
      title="ê·¼ë¬´ìœ í˜• ìƒì„±"
      open={open}
      onCancel={onClose}
      okText="ìƒì„±"
      cancelText="ì·¨ì†Œ"
      confirmLoading={createM.isPending}
      onOk={() => {
        if (!form.name.trim()) {
          alert("ê·¼ë¬´ìœ í˜• ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
          return;
        }
        if (form.base_hourly_wage <= 0) {
          alert("ê¸°ë³¸ ì‹œê¸‰ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.");
          return;
        }
        createM.mutate();
      }}
    >
      <div className="space-y-3">
        <Field label="ê·¼ë¬´ìœ í˜•ëª… *">
          <input
            className="input"
            value={form.name}
            onChange={(e) =>
              setForm((p) => ({ ...p, name: e.target.value }))
            }
            placeholder="ì˜ˆ: ê°•ì˜, ìƒë‹´, ë³´ì¡°ì—…ë¬´"
          />
        </Field>

        <Field label="ê¸°ë³¸ ì‹œê¸‰(ì›) *">
          <input
            type="number"
            className="input"
            min={0}
            value={form.base_hourly_wage}
            onChange={(e) =>
              setForm((p) => ({
                ...p,
                base_hourly_wage: Number(e.target.value),
              }))
            }
          />
        </Field>

        <Field label="ìƒ‰ìƒ">
          <input
            type="color"
            value={form.color}
            onChange={(e) =>
              setForm((p) => ({ ...p, color: e.target.value }))
            }
          />
        </Field>

        <Field label="ì„¤ëª…">
          <textarea
            className="input"
            rows={2}
            value={form.description}
            onChange={(e) =>
              setForm((p) => ({ ...p, description: e.target.value }))
            }
          />
        </Field>

        <div className="text-xs text-[var(--text-muted)]">
          * ìƒì„± ì¦‰ì‹œ ì§ì› ê·¼ë¬´ìœ í˜•/ê·¼ë¬´ê¸°ë¡ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
        </div>
      </div>
    </Modal>
  );
}

function Field({
  label,
  children,
}: {
  label: string;
  children: React.ReactNode;
}) {
  return (
    <div className="space-y-1">
      <div className="text-xs font-medium text-[var(--text-muted)]">
        {label}
      </div>
      {children}
    </div>
  );
}


==========================================================================================
# FILE: pages/OperationsPage/CreateExpenseModal.tsx
==========================================================================================
// PATH: src/features/staff/pages/OperationsPage/CreateExpenseModal.tsx
import { Modal } from "antd";
import { useEffect, useState } from "react";
import { useWorkMonth } from "../../operations/context/WorkMonthContext";
import { useExpenses } from "../../hooks/useExpenses";

export default function CreateExpenseModal({
  open,
  onClose,
}: {
  open: boolean;
  onClose: () => void;
}) {
  const { staffId, range, locked } = useWorkMonth();

  const { createM } = useExpenses({
    staff: staffId,
    date_from: range.from,
    date_to: range.to,
  });

  const [form, setForm] = useState({
    date: range.from,
    title: "",
    amount: 0,
    memo: "",
  });

  useEffect(() => {
    if (!open) return;
    setForm((p) => ({ ...p, date: range.from }));
  }, [open, range.from]);

  // ğŸ”’ ë§ˆê° ì›”ì´ë©´ ëª¨ë‹¬ ìì²´ë¥¼ ì•ˆ ë„ì›€ (UX: â€œì¶”ê°€ ë²„íŠ¼ ë¹„í™œì„± + ì‚¬ìœ â€ë¡œ ì´ë¯¸ ì•ˆë‚´ë¨)
  if (locked) return null;

  return (
    <Modal
      title="ë¹„ìš© ì¶”ê°€"
      open={open}
      onCancel={onClose}
      onOk={() => {
        if (!form.title.trim() || !form.amount || form.amount <= 0) {
          alert("í•­ëª©ê³¼ ê¸ˆì•¡(0ë³´ë‹¤ í¼)ì„ ì…ë ¥í•˜ì„¸ìš”.");
          return;
        }

        createM.mutate(
          {
            staff: staffId,
            date: form.date,
            title: form.title.trim(),
            amount: Number(form.amount),
            memo: form.memo ?? "",
          },
          {
            onSuccess: () => {
              onClose();
              setForm({
                date: range.from,
                title: "",
                amount: 0,
                memo: "",
              });
            },
            onError: (e: any) => {
              const msg =
                e?.response?.data?.detail ||
                e?.response?.data?.message ||
                "ë¹„ìš© ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
              alert(msg);
            },
          }
        );
      }}
      okText="ì¶”ê°€"
      cancelText="ì·¨ì†Œ"
      confirmLoading={createM.isPending}
    >
      <div className="space-y-3">
        <Field label="ë‚ ì§œ">
          <input
            type="date"
            className="input"
            value={form.date}
            onChange={(e) => setForm((p) => ({ ...p, date: e.target.value }))}
          />
        </Field>

        <Field label="í•­ëª© *">
          <input
            className="input"
            value={form.title}
            onChange={(e) => setForm((p) => ({ ...p, title: e.target.value }))}
            placeholder="ì˜ˆ: êµì¬ë¹„, êµí†µë¹„"
          />
        </Field>

        <Field label="ê¸ˆì•¡(ì›) *">
          <input
            type="number"
            className="input"
            value={form.amount}
            onChange={(e) =>
              setForm((p) => ({ ...p, amount: Number(e.target.value) }))
            }
            min={0}
          />
        </Field>

        <Field label="ë©”ëª¨">
          <textarea
            className="input"
            value={form.memo}
            onChange={(e) => setForm((p) => ({ ...p, memo: e.target.value }))}
            placeholder="ì„ íƒ"
            rows={3}
          />
        </Field>

        <div className="text-xs text-[var(--text-muted)]">
          * ê¸ˆì•¡/ìƒíƒœ/ìŠ¹ì¸ì€ ì„œë²„ ê¸°ì¤€ì…ë‹ˆë‹¤.
        </div>
      </div>
    </Modal>
  );
}

function Field({ label, children }: { label: string; children: React.ReactNode }) {
  return (
    <div className="space-y-1">
      <div className="text-xs font-medium text-[var(--text-muted)]">{label}</div>
      {children}
    </div>
  );
}


==========================================================================================
# FILE: pages/OperationsPage/CreateWorkRecordModal.tsx
==========================================================================================
// PATH: src/features/staff/pages/OperationsPage/CreateWorkRecordModal.tsx
import { Modal } from "antd";
import { useEffect, useState } from "react";
import { useWorkMonth } from "../../operations/context/WorkMonthContext";
import { useWorkRecords } from "../../hooks/useWorkRecords";
import { useQuery } from "@tanstack/react-query";
import { fetchStaffWorkTypes } from "../../api/staffWorkType.api";
import ActionButton from "../../components/ActionButton";

export default function CreateWorkRecordModal({
  open,
  onClose,
}: {
  open: boolean;
  onClose: () => void;
}) {
  const { staffId, range, locked } = useWorkMonth();

  const { createM } = useWorkRecords({
    staff: staffId,
    date_from: range.from,
    date_to: range.to,
  });

  const workTypesQ = useQuery({
    queryKey: ["staff-work-types", staffId],
    queryFn: () => fetchStaffWorkTypes(staffId),
    enabled: open,
  });

  const staffWorkTypes = workTypesQ.data ?? [];
  const hasWorkTypes = staffWorkTypes.length > 0;

  const [form, setForm] = useState({
    date: range.from,
    work_type: undefined as number | undefined,
    start_time: "",
    end_time: "",
    break_minutes: 0,
    memo: "",
  });

  useEffect(() => {
    if (!open) return;
    setForm((p) => ({ ...p, date: range.from, work_type: undefined }));
  }, [open, range.from]);

  if (locked) return null;

  return (
    <Modal
      title="ê·¼ë¬´ ê¸°ë¡ ì¶”ê°€"
      open={open}
      onCancel={onClose}
      okText="ì¶”ê°€"
      cancelText="ì·¨ì†Œ"
      confirmLoading={createM.isPending}
      onOk={() => {
        if (!hasWorkTypes) {
          alert("ë¨¼ì € ì§ì›ì—ê²Œ ê·¼ë¬´ìœ í˜•ì„ ë“±ë¡í•˜ì„¸ìš”.");
          return;
        }
        if (!form.work_type) {
          alert("ê·¼ë¬´ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.");
          return;
        }
        if (!form.start_time || !form.end_time) {
          alert("ì‹œì‘/ì¢…ë£Œ ì‹œê°„ì„ ì…ë ¥í•˜ì„¸ìš”.");
          return;
        }

        createM.mutate(
          {
            staff: staffId,
            work_type: form.work_type,
            date: form.date,
            start_time: form.start_time,
            end_time: form.end_time,
            break_minutes: form.break_minutes,
            memo: form.memo,
          },
          {
            onSuccess: () => {
              onClose();
              setForm({
                date: range.from,
                work_type: undefined,
                start_time: "",
                end_time: "",
                break_minutes: 0,
                memo: "",
              });
            },
          }
        );
      }}
    >
      <div className="space-y-3">
        <Field label="ë‚ ì§œ">
          <input
            type="date"
            className="input"
            value={form.date}
            onChange={(e) => setForm((p) => ({ ...p, date: e.target.value }))}
          />
        </Field>

        <Field label="ê·¼ë¬´ìœ í˜• *">
          <select
            className="input"
            disabled={!hasWorkTypes}
            value={form.work_type ?? ""}
            onChange={(e) =>
              setForm((p) => ({
                ...p,
                work_type: e.target.value ? Number(e.target.value) : undefined,
              }))
            }
          >
            <option value="">
              {hasWorkTypes ? "ì„ íƒ" : "ë“±ë¡ëœ ê·¼ë¬´ìœ í˜• ì—†ìŒ"}
            </option>
            {staffWorkTypes.map((st) => (
              <option key={st.id} value={st.work_type.id}>
                {st.work_type.name}
              </option>
            ))}
          </select>

          {!hasWorkTypes && (
            <div className="text-xs text-[var(--color-danger)] mt-1">
              * ê·¼ë¬´ê¸°ë¡ì„ ì¶”ê°€í•˜ë ¤ë©´ ë¨¼ì € <b>ì‹œê¸‰Â·ê·¼ë¬´ìœ í˜•</b> íƒ­ì—ì„œ ê·¼ë¬´ìœ í˜•ì„
              ë“±ë¡í•˜ì„¸ìš”.
            </div>
          )}
        </Field>

        <div className="grid grid-cols-2 gap-3">
          <Field label="ì‹œì‘ ì‹œê°„ *">
            <input
              type="time"
              className="input"
              value={form.start_time}
              onChange={(e) =>
                setForm((p) => ({ ...p, start_time: e.target.value }))
              }
            />
          </Field>

          <Field label="ì¢…ë£Œ ì‹œê°„ *">
            <input
              type="time"
              className="input"
              value={form.end_time}
              onChange={(e) =>
                setForm((p) => ({ ...p, end_time: e.target.value }))
              }
            />
          </Field>
        </div>

        <Field label="íœ´ê²Œì‹œê°„(ë¶„)">
          <input
            type="number"
            className="input"
            min={0}
            value={form.break_minutes}
            onChange={(e) =>
              setForm((p) => ({
                ...p,
                break_minutes: Number(e.target.value),
              }))
            }
          />
        </Field>

        <Field label="ë©”ëª¨">
          <textarea
            className="input"
            rows={3}
            value={form.memo}
            onChange={(e) =>
              setForm((p) => ({ ...p, memo: e.target.value }))
            }
          />
        </Field>

        <div className="text-xs text-[var(--text-muted)]">
          * ê·¼ë¬´ì‹œê°„Â·ê¸ˆì•¡ì€ ì„œë²„ì—ì„œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.
        </div>
      </div>
    </Modal>
  );
}

function Field({
  label,
  children,
}: {
  label: string;
  children: React.ReactNode;
}) {
  return (
    <div className="space-y-1">
      <div className="text-xs font-medium text-[var(--text-muted)]">{label}</div>
      {children}
    </div>
  );
}


==========================================================================================
# FILE: pages/OperationsPage/ExpensesPanel.tsx
==========================================================================================
// PATH: src/features/staff/pages/OperationsPage/ExpensesPanel.tsx
import { useMemo, useState } from "react";
import { useWorkMonth } from "../../operations/context/WorkMonthContext";
import { useExpenses } from "../../hooks/useExpenses";
import CreateExpenseModal from "./CreateExpenseModal";
import ActionButton from "../../components/ActionButton";
import { ExpenseStatusBadge, LockBadge } from "../../components/StatusBadge";

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

function fmtDateTime(v?: string | null) {
  if (!v) return "-";
  const d = new Date(v);
  if (Number.isNaN(d.getTime())) return "-";
  return d.toLocaleString();
}

export default function ExpensesPanel() {
  const { staffId, range, locked, canManage } = useWorkMonth();

  const { listQ, patchM } = useExpenses({
    staff: staffId,
    date_from: range.from,
    date_to: range.to,
  });

  const [open, setOpen] = useState(false);

  const rows = useMemo(() => listQ.data ?? [], [listQ.data]);

  if (listQ.isLoading) {
    return (
      <div className="rounded-2xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-5 py-4">
        <div className="text-sm text-[var(--text-muted)]">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </div>
    );
  }

  return (
    <div
      className={cx(
        "rounded-2xl border border-[var(--border-divider)] bg-[var(--bg-surface)]",
        "overflow-hidden"
      )}
    >
      <div
        className={cx(
          "px-5 py-4 border-b border-[var(--border-divider)]",
          locked ? "bg-[var(--color-danger-soft)]" : "bg-[var(--bg-surface-soft)]"
        )}
      >
        <div className="flex items-start justify-between gap-4">
          <div className="space-y-1">
            <div className="flex items-center gap-2">
              <div className="text-sm font-semibold">ë¹„ìš©</div>
              {locked && <LockBadge state="LOCKED" />}
              <span className="text-xs text-[var(--text-muted)]">
                ({range.from} ~ {range.to})
              </span>
            </div>
            <div className="text-[11px] text-[var(--text-muted)]">
              * ìƒíƒœ/ìŠ¹ì¸/ë°˜ë ¤ëŠ” ì„œë²„ ê¸°ì¤€ì´ë©°, í”„ë¡ íŠ¸ëŠ” í‘œì‹œ/ì•¡ì…˜ë§Œ ìˆ˜í–‰í•©ë‹ˆë‹¤.
            </div>
          </div>

          <div className="shrink-0">
            <ActionButton
              variant="primary"
              size="xs"
              disabledReason={locked ? "ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤." : ""}
              onClick={() => setOpen(true)}
            >
              + ì¶”ê°€
            </ActionButton>
          </div>
        </div>

        {locked && (
          <div className="mt-2 text-xs text-[var(--color-danger)]">
            ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤ Â· ìƒì„±/ìˆ˜ì •/ìŠ¹ì¸/ë°˜ë ¤ ë¶ˆê°€
          </div>
        )}
      </div>

      <div className={cx("p-5", locked && "opacity-95")}>
        {rows.length === 0 ? (
          <div className="rounded-2xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-5 py-5">
            <div className="text-sm font-semibold">ë¹„ìš© ì—†ìŒ</div>
            <div className="text-xs text-[var(--text-muted)] mt-1">
              ë¹„ìš©ì„ ì¶”ê°€í•˜ë©´ ì´ê³³ì— ë¦¬ìŠ¤íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤.
            </div>
          </div>
        ) : (
          <div className="space-y-2">
            {rows.map((r) => {
              const isPending = r.status === "PENDING";
              const actionDisabled = locked || patchM.isPending;

              return (
                <div
                  key={r.id}
                  className="rounded-xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-4 py-3"
                >
                  <div className="flex items-start justify-between gap-4">
                    <div className="min-w-0 space-y-2">
                      <div className="font-semibold">
                        {r.date} Â· {r.title}
                      </div>

                      <div className="flex flex-wrap items-center gap-2">
                        <ExpenseStatusBadge status={r.status} />
                        {r.status !== "PENDING" && (
                          <div className="text-xs text-[var(--text-muted)]">
                            ìŠ¹ì¸ì: {r.approved_by_name ?? "-"} Â· {fmtDateTime(r.approved_at)}
                          </div>
                        )}
                      </div>

                      {!!r.memo && (
                        <div className="text-xs text-[var(--text-muted)]">
                          ë©”ëª¨: {r.memo}
                        </div>
                      )}
                    </div>

                    <div className="shrink-0 text-right">
                      <div className="text-xs text-[var(--text-muted)]">ê¸ˆì•¡</div>
                      <div className="font-semibold">{r.amount.toLocaleString()}ì›</div>
                    </div>
                  </div>

                  {/* ê´€ë¦¬ì ì•¡ì…˜: PENDINGë§Œ ìŠ¹ì¸/ë°˜ë ¤, ë©”ëª¨ ìˆ˜ì • */}
                  {canManage && (
                    <div className="mt-3 pt-3 border-t border-[var(--border-divider)] flex flex-col gap-2">
                      <div className="flex items-center justify-between gap-2">
                        <div className="flex items-center gap-2">
                          <ActionButton
                            variant="success"
                            size="xs"
                            disabledReason={
                              actionDisabled
                                ? locked
                                  ? "ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤."
                                  : "ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤."
                                : !isPending
                                ? "ëŒ€ê¸° ìƒíƒœì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤."
                                : ""
                            }
                            onClick={() => {
                              if (actionDisabled || !isPending) return;
                              if (!confirm("ì´ ë¹„ìš©ì„ ìŠ¹ì¸í• ê¹Œìš”?")) return;
                              patchM.mutate({ id: r.id, payload: { status: "APPROVED" } });
                            }}
                          >
                            ìŠ¹ì¸
                          </ActionButton>

                          <ActionButton
                            variant="danger-outline"
                            size="xs"
                            disabledReason={
                              actionDisabled
                                ? locked
                                  ? "ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤."
                                  : "ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤."
                                : !isPending
                                ? "ëŒ€ê¸° ìƒíƒœì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤."
                                : ""
                            }
                            onClick={() => {
                              if (actionDisabled || !isPending) return;
                              if (!confirm("ì´ ë¹„ìš©ì„ ë°˜ë ¤í• ê¹Œìš”?")) return;
                              patchM.mutate({ id: r.id, payload: { status: "REJECTED" } });
                            }}
                          >
                            ë°˜ë ¤
                          </ActionButton>
                        </div>

                        <div className="text-[11px] text-[var(--text-muted)]">
                          * ìŠ¹ì¸ í›„ ìˆ˜ì • ë¶ˆê°€(ì„œë²„ ê·œì¹™)
                        </div>
                      </div>

                      <div className="flex items-center gap-2">
                        <div className="text-xs text-[var(--text-muted)] shrink-0 w-[52px]">
                          ë©”ëª¨
                        </div>
                        <input
                          className="h-[34px] rounded-lg border border-[var(--border-divider)] bg-[var(--bg-surface)] px-3 text-sm w-full"
                          placeholder="ë©”ëª¨ ìˆ˜ì • (ìŠ¹ì¸ í›„ì—ëŠ” backendê°€ ê±°ì ˆ)"
                          defaultValue={r.memo}
                          disabled={actionDisabled}
                          onBlur={(e) => {
                            const next = e.target.value ?? "";
                            if (next === (r.memo ?? "")) return;
                            if (actionDisabled) return;

                            patchM.mutate(
                              { id: r.id, payload: { memo: next } },
                              {
                                onError: (err: any) => {
                                  const msg =
                                    err?.response?.data?.detail ||
                                    err?.response?.data?.message ||
                                    "ë©”ëª¨ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
                                  alert(msg);
                                },
                              }
                            );
                          }}
                        />
                      </div>
                    </div>
                  )}
                </div>
              );
            })}
          </div>
        )}

        {!locked && <CreateExpenseModal open={open} onClose={() => setOpen(false)} />}
      </div>

      <div className="px-5 pb-4">
        <div className="text-[11px] text-[var(--text-muted)]">
          * ìŠ¹ì¸/ë°˜ë ¤/ì ê¸ˆ ê·œì¹™ì€ ì„œë²„ ë‹¨ì¼ì§„ì‹¤ì…ë‹ˆë‹¤. í”„ë¡ íŠ¸ëŠ” UXë¡œë§Œ ì•ˆë‚´/ì°¨ë‹¨í•©ë‹ˆë‹¤.
        </div>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: pages/OperationsPage/MonthLockPanel.tsx
==========================================================================================
// PATH: src/features/staff/pages/OperationsPage/MonthLockPanel.tsx
import ActionButton from "../../components/ActionButton";
import { LockBadge } from "../../components/StatusBadge";
import { useWorkMonth } from "../../operations/context/WorkMonthContext";

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

export default function MonthLockPanel() {
  const { year, month, locked, canManage, lockM } = useWorkMonth();

  const disabledReason = locked
    ? "ì´ë¯¸ ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤."
    : !canManage
    ? "ë§ˆê°ì€ ê´€ë¦¬ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤."
    : "";

  return (
    <div
      className={cx(
        "rounded-2xl border px-5 py-4 space-y-2",
        locked
          ? "border-[color-mix(in_srgb,var(--color-danger)_55%,transparent)] bg-[var(--color-danger-soft)]"
          : "border-[color-mix(in_srgb,var(--color-success)_55%,transparent)] bg-[var(--color-success-soft)]"
      )}
    >
      <div className="flex items-start justify-between gap-4">
        <div className="space-y-1">
          <div className="flex items-center gap-2">
            <div className="text-sm font-semibold">
              {year}ë…„ {month}ì›”
            </div>
            <LockBadge state={locked ? "LOCKED" : "OPEN"} />
          </div>

          <div className="text-[11px] text-[var(--text-muted)] leading-relaxed">
            * <b>ì›” ë§ˆê° = ê¸‰ì—¬ í™•ì •</b> Â· ë§ˆê° í›„ ê·¼ë¬´/ë¹„ìš© <b>ìƒì„±Â·ìˆ˜ì •Â·ì‚­ì œ</b> ë¶ˆê°€
            <br />
            * ê¸‰ì—¬ ìŠ¤ëƒ…ìƒ·(PayrollSnapshot)ì´ ìƒì„±ë˜ë©° ì´í›„ ë³€ê²½ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
          </div>
        </div>

        <div className="shrink-0 flex items-center gap-2">
          <ActionButton
            variant="danger"
            size="sm"
            disabledReason={disabledReason || (lockM.isPending ? "ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤." : "")}
            title={
              disabledReason ||
              "ì´ë²ˆ ë‹¬ ê·¼ë¬´/ë¹„ìš©ì„ í™•ì •í•©ë‹ˆë‹¤. ì´í›„ ìˆ˜ì •Â·ì‚­ì œ ë¶ˆê°€í•˜ë©° ê¸‰ì—¬ ìŠ¤ëƒ…ìƒ·ì´ ìƒì„±ë©ë‹ˆë‹¤."
            }
            onClick={() => {
              if (disabledReason || lockM.isPending) return;

              if (
                !confirm(
                  [
                    `${year}ë…„ ${month}ì›”ì„ ë§ˆê°í• ê¹Œìš”?`,
                    "",
                    "- ë§ˆê° í›„ì—ëŠ” ê·¼ë¬´/ë¹„ìš© ìˆ˜ì •Â·ì‚­ì œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.",
                    "- ê¸‰ì—¬ ìŠ¤ëƒ…ìƒ·ì´ ìƒì„±ë©ë‹ˆë‹¤.",
                  ].join("\n")
                )
              )
                return;

              lockM.mutate();
            }}
          >
            ì›” ë§ˆê°
          </ActionButton>
        </div>
      </div>

      {locked && (
        <div className="rounded-xl border border-[color-mix(in_srgb,var(--color-danger)_45%,transparent)] bg-[color-mix(in_srgb,var(--color-danger-soft)_70%,white)] px-4 py-3">
          <div className="text-sm font-semibold text-[var(--color-danger)]">
            ë§ˆê° ì™„ë£Œ: ì´ ë‹¬ì€ í™•ì • ë°ì´í„°ì…ë‹ˆë‹¤.
          </div>
          <div className="text-xs text-[var(--text-muted)] mt-1">
            ë§ˆê°ëœ ì›”ì€ ë³€ê²½ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. (ì„œë²„ì—ì„œ 400ìœ¼ë¡œ ë³´ì¥)
          </div>
        </div>
      )}
    </div>
  );
}


==========================================================================================
# FILE: pages/OperationsPage/OperationsPage.tsx
==========================================================================================
ï»¿// PATH: src/features/staff/pages/OperationsPage/OperationsPage.tsx
import { useMemo } from "react";
import { useSearchParams } from "react-router-dom";
import { WorkMonthProvider } from "../../operations/context/WorkMonthContext";

import StaffOperationTable from "./StaffOperationTable";
import MonthLockPanel from "./MonthLockPanel";
import WorkRecordsPanel from "./WorkRecordsPanel";
import ExpensesPanel from "./ExpensesPanel";

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

function getThisMonth() {
  const d = new Date();
  return {
    year: d.getFullYear(),
    month: d.getMonth() + 1,
  };
}

function ymLabel(y: number, m: number) {
  return `${y}ë…„ ${m}ì›”`;
}

export default function OperationsPage() {
  const [params] = useSearchParams();
  const staffId = Number(params.get("staffId"));

  const { year, month } = useMemo(getThisMonth, []);
  const monthText = useMemo(() => ymLabel(year, month), [year, month]);

  // âœ… UX: â€œì§ì› ì„ íƒ ì „â€ ìƒíƒœì—ì„œë„ í™”ë©´ì´ ë¹„ì§€ ì•Šë„ë¡ ì½˜ì†” í”„ë ˆì„ ìœ ì§€
  return (
    <div className="p-6">
      <div className="flex items-end justify-between gap-3 mb-4">
        <div className="space-y-1">
          <div className="text-lg font-semibold">ì‘ì—…</div>
          <div className="text-xs text-[var(--text-muted)]">
            {monthText} Â· ê·¼ë¬´/ë¹„ìš© ì…ë ¥ ë° ì›” ë§ˆê°(ê¸‰ì—¬ í™•ì •) ì²˜ë¦¬
          </div>
        </div>

        <div className="text-xs text-[var(--text-muted)]">
          * í•©ê³„/ê¸‰ì—¬/ì‹œê°„/ìƒíƒœ íŒì •ì€ <b>ë°±ì—”ë“œ ë‹¨ì¼ì§„ì‹¤</b>ì…ë‹ˆë‹¤.
        </div>
      </div>

      <div className="grid grid-cols-[320px_1fr] gap-6">
        {/* LEFT: Staff list (Sidebar) */}
        <div
          className={cx(
            "rounded-2xl border border-[var(--border-divider)] bg-[var(--bg-surface)]",
            "overflow-hidden"
          )}
        >
          <div className="px-4 py-3 border-b border-[var(--border-divider)] bg-[var(--bg-surface-soft)]">
            <div className="text-sm font-semibold">ì§ì› ì„ íƒ</div>
            <div className="text-[11px] text-[var(--text-muted)] mt-0.5">
              ì¢Œì¸¡ì—ì„œ ì§ì›ì„ ì„ íƒí•˜ë©´ ìš°ì¸¡ ì‘ì—… ì½˜ì†”ì´ í™œì„±í™”ë©ë‹ˆë‹¤.
            </div>
          </div>

          <div className="p-3">
            <StaffOperationTable selectedStaffId={staffId} />
          </div>

          <div className="px-4 pb-4 pt-2">
            <div className="text-[11px] text-[var(--text-muted)]">
              * ì§ì› ì„ íƒì€ â€œì„ íƒâ€ UIì´ë©°, ê³„ì‚°/ì¶”ë¡ ì´ ì•„ë‹™ë‹ˆë‹¤.
            </div>
          </div>
        </div>

        {/* RIGHT: Operations Console */}
        <div
          className={cx(
            "rounded-2xl border border-[var(--border-divider)] bg-[var(--bg-surface)]",
            "min-h-[520px]"
          )}
        >
          <div className="px-5 py-4 border-b border-[var(--border-divider)] bg-[var(--bg-surface-soft)]">
            <div className="flex items-start justify-between gap-4">
              <div className="space-y-1">
                <div className="text-sm font-semibold">ì‘ì—… ì½˜ì†”</div>
                <div className="text-xs text-[var(--text-muted)]">
                  {staffId ? (
                    <>
                      ì„ íƒëœ ì§ì› ê¸°ì¤€ìœ¼ë¡œ <b>{monthText}</b> ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
                    </>
                  ) : (
                    <>
                      ë¨¼ì € ì¢Œì¸¡ì—ì„œ <b>ì§ì›</b>ì„ ì„ íƒí•˜ì„¸ìš”.
                    </>
                  )}
                </div>
              </div>

              {staffId ? (
                <div className="text-xs text-[var(--text-muted)]">
                  ì§ì› ID: <span className="font-semibold">{staffId}</span>
                </div>
              ) : (
                <div className="text-xs text-[var(--text-muted)]">
                  ìƒíƒœ: <span className="font-semibold">ëŒ€ê¸°</span>
                </div>
              )}
            </div>
          </div>

          {!staffId ? (
            <div className="p-10">
              <div className="rounded-2xl border border-[var(--border-divider)] bg-[var(--bg-surface)] p-6">
                <div className="flex items-start gap-4">
                  <div className="shrink-0 h-10 w-10 rounded-xl bg-[var(--color-primary-soft)] border border-[color-mix(in_srgb,var(--color-primary)_35%,transparent)] flex items-center justify-center">
                    <span className="text-[var(--color-primary)] font-bold">!</span>
                  </div>
                  <div className="space-y-2">
                    <div className="text-sm font-semibold">
                      ì§ì›ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
                    </div>
                    <div className="text-sm text-[var(--text-muted)] leading-relaxed">
                      ì¢Œì¸¡ <b>ì§ì› ì„ íƒ</b>ì—ì„œ ì§ì›ì„ í´ë¦­í•˜ë©´,
                      <br />
                      ì´ ì˜ì—­ì— <b>ì›” ë§ˆê°</b>, <b>ê·¼ë¬´ ê¸°ë¡</b>, <b>ë¹„ìš©</b> ì‘ì—…
                      íŒ¨ë„ì´ í™œì„±í™”ë©ë‹ˆë‹¤.
                    </div>
                    <div className="text-[11px] text-[var(--text-muted)]">
                      * ë§ˆê°ëœ ì›”ì€ ìƒì„±/ìˆ˜ì •/ì‚­ì œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. (ì„œë²„ ê·œì¹™)
                    </div>
                  </div>
                </div>
              </div>
            </div>
          ) : (
            <WorkMonthProvider staffId={staffId} year={year} month={month}>
              <div className="p-5 space-y-4">
                <MonthLockPanel />
                <WorkRecordsPanel />
                <ExpensesPanel />
              </div>
            </WorkMonthProvider>
          )}
        </div>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: pages/OperationsPage/StaffOperationTable.tsx
==========================================================================================
ï»¿// PATH: src/features/staff/pages/OperationsPage/StaffOperationTable.tsx
import { useMemo, useState } from "react";
import { useStaffs } from "../../hooks/useStaffs";
import { useNavigate, useSearchParams } from "react-router-dom";
import { Staff } from "../../api/staff.api";
import { Input } from "antd";

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

function payLabel(v: Staff["pay_type"]) {
  return v === "HOURLY" ? "ì‹œê¸‰" : "ì›”ê¸‰";
}

export default function StaffOperationTable({
  selectedStaffId,
}: {
  selectedStaffId?: number;
}) {
  const { data, isLoading } = useStaffs();
  const navigate = useNavigate();
  const [params] = useSearchParams();
  const [q, setQ] = useState("");

  /**
   * ğŸ”’ ì•ˆì •ì„± ë³´ì¥
   * - dataSource ëŠ” ë°˜ë“œì‹œ ë°°ì—´ì´ì–´ì•¼ í•¨
   */
  const staffs: Staff[] = Array.isArray(data)
    ? data
    : Array.isArray((data as any)?.results)
    ? (data as any).results
    : [];

  // âœ… UX: ê²€ìƒ‰ì€ â€œí•„í„°ë§(ì„ íƒ)â€ì´ë©° ê³„ì‚°/ì¶”ë¡ ì´ ì•„ë‹˜
  const filtered = useMemo(() => {
    const needle = q.trim().toLowerCase();
    if (!needle) return staffs;

    return staffs.filter((s) => {
      const name = (s.name ?? "").toLowerCase();
      const phone = (s.phone ?? "").toLowerCase();
      return name.includes(needle) || phone.includes(needle);
    });
  }, [staffs, q]);

  const active = filtered.filter((s) => s.is_active);
  const inactive = filtered.filter((s) => !s.is_active);

  const pick = (id: number) => {
    params.set("staffId", String(id));
    navigate(`/admin/staff/operations?${params.toString()}`);
  };

  return (
    <div className="space-y-3">
      <Input
        value={q}
        onChange={(e) => setQ(e.target.value)}
        placeholder="ì´ë¦„/ì „í™”ë²ˆí˜¸ ê²€ìƒ‰"
        allowClear
        size="middle"
      />

      {isLoading && (
        <div className="rounded-xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-4 py-3 text-sm text-[var(--text-muted)]">
          ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
        </div>
      )}

      {!isLoading && staffs.length === 0 && (
        <div className="rounded-xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-4 py-3">
          <div className="text-sm font-semibold">ì§ì› ì—†ìŒ</div>
          <div className="text-xs text-[var(--text-muted)] mt-1">
            ì§ì›ì´ ë“±ë¡ë˜ì–´ì•¼ ì‘ì—… ì½˜ì†”ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </div>
        </div>
      )}

      {!isLoading && staffs.length > 0 && filtered.length === 0 && (
        <div className="rounded-xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-4 py-3">
          <div className="text-sm font-semibold">ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</div>
          <div className="text-xs text-[var(--text-muted)] mt-1">
            ì´ë¦„ ë˜ëŠ” ì „í™”ë²ˆí˜¸ë¡œ ë‹¤ì‹œ ê²€ìƒ‰í•´ë³´ì„¸ìš”.
          </div>
        </div>
      )}

      {!isLoading && filtered.length > 0 && (
        <div className="space-y-4">
          <Section
            title={`í™œì„± (${active.length})`}
            hint="í˜„ì¬ ê·¼ë¬´/ë¹„ìš© ì…ë ¥ ëŒ€ìƒ"
            emptyText="í™œì„± ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤."
          >
            {active.map((s) => (
              <Row
                key={s.id}
                staff={s}
                selected={s.id === selectedStaffId}
                onClick={() => pick(s.id)}
              />
            ))}
          </Section>

          <Section
            title={`ë¹„í™œì„± (${inactive.length})`}
            hint="ì„ íƒì€ ê°€ëŠ¥í•˜ì§€ë§Œ ìš´ì˜ ì •ì±…ì— ë§ê²Œ ì‚¬ìš©"
            emptyText="ë¹„í™œì„± ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤."
          >
            {inactive.map((s) => (
              <Row
                key={s.id}
                staff={s}
                selected={s.id === selectedStaffId}
                onClick={() => pick(s.id)}
              />
            ))}
          </Section>
        </div>
      )}

      <div className="text-[11px] text-[var(--text-muted)]">
        * ì„ íƒëœ ì§ì›ì€ ìš°ì¸¡ ì‘ì—… ì½˜ì†”ì— ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤.
      </div>
    </div>
  );
}

function Section({
  title,
  hint,
  emptyText,
  children,
}: {
  title: string;
  hint?: string;
  emptyText: string;
  children: React.ReactNode;
}) {
  const hasItems = !!children && Array.isArray(children) ? children.length > 0 : true;

  return (
    <div className="space-y-2">
      <div className="flex items-end justify-between gap-2">
        <div className="text-xs font-semibold text-[var(--text-primary)]">{title}</div>
        {!!hint && <div className="text-[11px] text-[var(--text-muted)]">{hint}</div>}
      </div>

      {!hasItems ? (
        <div className="rounded-xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-4 py-3 text-sm text-[var(--text-muted)]">
          {emptyText}
        </div>
      ) : (
        <div className="space-y-2">{children}</div>
      )}
    </div>
  );
}

function Row({
  staff,
  selected,
  onClick,
}: {
  staff: Staff;
  selected: boolean;
  onClick: () => void;
}) {
  return (
    <button
      type="button"
      onClick={onClick}
      className={cx(
        "w-full text-left rounded-xl border px-4 py-3 transition",
        "focus:outline-none focus:ring-1 focus:ring-[var(--color-primary)]",
        selected
          ? "border-[color-mix(in_srgb,var(--color-primary)_45%,transparent)] bg-[var(--color-primary-soft)]"
          : "border-[var(--border-divider)] bg-[var(--bg-surface)] hover:bg-[var(--bg-surface-soft)]"
      )}
    >
      <div className="flex items-start justify-between gap-3">
        <div className="min-w-0">
          <div className="flex items-center gap-2">
            <div className="font-semibold truncate">{staff.name}</div>
            {!staff.is_active && (
              <span className="px-2 py-0.5 rounded-full text-[11px] font-semibold border border-[var(--border-divider)] text-[var(--text-muted)] bg-[var(--bg-surface-muted)]">
                ë¹„í™œì„±
              </span>
            )}
            {staff.is_manager && (
              <span className="px-2 py-0.5 rounded-full text-[11px] font-semibold border border-[color-mix(in_srgb,var(--color-primary)_35%,transparent)] text-[var(--color-primary)] bg-[var(--color-primary-soft)]">
                ê´€ë¦¬ì
              </span>
            )}
          </div>

          <div className="text-xs text-[var(--text-muted)] mt-1 truncate">
            {staff.phone || "-"}
          </div>
        </div>

        <div className="shrink-0 text-right">
          <div className="text-xs text-[var(--text-muted)]">ê¸‰ì—¬</div>
          <div className="text-sm font-semibold">{payLabel(staff.pay_type)}</div>
        </div>
      </div>
    </button>
  );
}


==========================================================================================
# FILE: pages/OperationsPage/WorkRecordsPanel.tsx
==========================================================================================
// PATH: src/features/staff/pages/OperationsPage/WorkRecordsPanel.tsx
import { useState } from "react";
import ActionButton from "../../components/ActionButton";
import { LockBadge } from "../../components/StatusBadge";
import { useWorkMonth } from "../../operations/context/WorkMonthContext";
import { useWorkRecords } from "../../hooks/useWorkRecords";
import CreateWorkRecordModal from "./CreateWorkRecordModal";

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

export default function WorkRecordsPanel() {
  const { staffId, range, locked } = useWorkMonth();
  const { listQ, deleteM } = useWorkRecords({
    staff: staffId,
    date_from: range.from,
    date_to: range.to,
  });

  const [open, setOpen] = useState(false);

  if (listQ.isLoading) {
    return (
      <div className="rounded-2xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-5 py-4">
        <div className="text-sm text-[var(--text-muted)]">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </div>
    );
  }

  const rows = listQ.data ?? [];

  return (
    <div
      className={cx(
        "rounded-2xl border border-[var(--border-divider)] bg-[var(--bg-surface)]",
        "overflow-hidden"
      )}
    >
      <div
        className={cx(
          "px-5 py-4 border-b border-[var(--border-divider)]",
          locked ? "bg-[var(--color-danger-soft)]" : "bg-[var(--bg-surface-soft)]"
        )}
      >
        <div className="flex items-start justify-between gap-4">
          <div className="space-y-1">
            <div className="flex items-center gap-2">
              <div className="text-sm font-semibold">ê·¼ë¬´ ê¸°ë¡</div>
              {locked && <LockBadge state="LOCKED" />}
              <span className="text-xs text-[var(--text-muted)]">
                ({range.from} ~ {range.to})
              </span>
            </div>
            <div className="text-[11px] text-[var(--text-muted)]">
              * ê·¼ë¬´ì‹œê°„Â·ê¸ˆì•¡ì€ ì„œë²„ì—ì„œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤. (í”„ë¡ íŠ¸ ê³„ì‚° ê¸ˆì§€)
            </div>
          </div>

          <div className="shrink-0">
            <ActionButton
              variant="primary"
              size="xs"
              disabledReason={locked ? "ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤." : ""}
              onClick={() => setOpen(true)}
            >
              + ì¶”ê°€
            </ActionButton>
          </div>
        </div>

        {locked && (
          <div className="mt-2 text-xs text-[var(--color-danger)]">
            ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤ Â· ìƒì„±/ìˆ˜ì •/ì‚­ì œ ë¶ˆê°€
          </div>
        )}
      </div>

      <div className={cx("p-5", locked && "opacity-95")}>
        {rows.length === 0 ? (
          <div className="rounded-2xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-5 py-5">
            <div className="text-sm font-semibold">ê¸°ë¡ ì—†ìŒ</div>
            <div className="text-xs text-[var(--text-muted)] mt-1">
              ê·¼ë¬´ ê¸°ë¡ì„ ì¶”ê°€í•˜ë©´ ì´ê³³ì— ë¦¬ìŠ¤íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤.
            </div>
          </div>
        ) : (
          <div className="space-y-2">
            {rows.map((r) => (
              <div
                key={r.id}
                className="rounded-xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-4 py-3"
              >
                <div className="flex items-start justify-between gap-4">
                  <div className="min-w-0">
                    <div className="font-semibold">
                      {r.date} Â· {r.work_type_name}
                    </div>
                    <div className="text-xs text-[var(--text-muted)] mt-1">
                      {r.start_time} ~ {r.end_time}{" "}
                      {typeof r.break_minutes === "number" && r.break_minutes > 0
                        ? `Â· íœ´ê²Œ ${r.break_minutes}ë¶„`
                        : ""}
                    </div>
                    {!!r.memo && (
                      <div className="text-xs text-[var(--text-muted)] mt-1">
                        ë©”ëª¨: {r.memo}
                      </div>
                    )}
                  </div>

                  <div className="shrink-0 flex items-center gap-3">
                    <div className="text-right">
                      <div className="text-xs text-[var(--text-muted)]">ê¸ˆì•¡</div>
                      <div className="font-semibold">
                        {r.amount?.toLocaleString() ?? "-"}ì›
                      </div>
                    </div>

                    <ActionButton
                      variant="danger-outline"
                      size="xs"
                      disabledReason={locked ? "ë§ˆê°ëœ ì›”ì…ë‹ˆë‹¤." : deleteM.isPending ? "ì²˜ë¦¬ ì¤‘..." : ""}
                      onClick={() => {
                        if (locked || deleteM.isPending) return;
                        if (!confirm("ì´ ê·¼ë¬´ ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?")) return;
                        deleteM.mutate(r.id);
                      }}
                    >
                      ì‚­ì œ
                    </ActionButton>
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}

        {!locked && <CreateWorkRecordModal open={open} onClose={() => setOpen(false)} />}
      </div>

      <div className="px-5 pb-4">
        <div className="text-[11px] text-[var(--text-muted)]">
          * ë§ˆê°ëœ ì›”ì€ ì„œë²„ì—ì„œ ë³€ê²½ì„ ê±°ë¶€í•©ë‹ˆë‹¤(400). í”„ë¡ íŠ¸ëŠ” UXë¡œë§Œ ì°¨ë‹¨í•©ë‹ˆë‹¤.
        </div>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: pages/ReportsPage/PayrollHistoryTable.tsx
==========================================================================================
ï»¿// PATH: src/features/staff/pages/ReportsPage/PayrollHistoryTable.tsx
import { useMemo } from "react";
import { useParams } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";

import {
  fetchPayrollSnapshots,
  exportPayrollSnapshotExcel,
} from "../../api/payrollSnapshots.api";
import { exportPayrollSnapshotPDF } from "../../api/payrollSnapshotPdf.api";
import ActionButton from "../../components/ActionButton";

function ymLabel(y: number, m: number) {
  return `${y}-${String(m).padStart(2, "0")}`;
}

export default function PayrollHistoryTable() {
  const { staffId } = useParams();
  const sid = staffId ? Number(staffId) : undefined;

  const listQ = useQuery({
    queryKey: ["payroll-history", sid],
    queryFn: () => fetchPayrollSnapshots({ staff: sid }),
    enabled: typeof sid === "number" && sid > 0,
  });

  const rows = useMemo(
    () =>
      (listQ.data ?? []).slice().sort(
        (a, b) => b.year * 100 + b.month - (a.year * 100 + a.month)
      ),
    [listQ.data]
  );

  if (!sid) {
    return (
      <div className="text-sm text-[var(--text-muted)]">
        ì§ì› ìƒì„¸ í™”ë©´ì—ì„œë§Œ ê¸‰ì—¬ íˆìŠ¤í† ë¦¬ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </div>
    );
  }

  if (listQ.isLoading) {
    return <div className="text-sm text-[var(--text-muted)]">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>;
  }

  if (rows.length === 0) {
    return (
      <div className="rounded-xl border border-[var(--border-divider)] bg-[var(--bg-surface-soft)] px-5 py-6">
        <div className="text-sm font-semibold">ê¸‰ì—¬ íˆìŠ¤í† ë¦¬ ì—†ìŒ</div>
        <div className="text-xs text-[var(--text-muted)] mt-1">
          ì•„ì§ ë§ˆê°ëœ ê¸‰ì—¬ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-3">
      {rows.map((r) => (
        <div
          key={r.id}
          className="rounded-lg border border-[var(--border-divider)] bg-[var(--bg-surface)] px-5 py-4 flex justify-between items-center gap-4"
        >
          <div>
            <div className="font-semibold">{ymLabel(r.year, r.month)}</div>
            <div className="text-xs text-[var(--text-muted)]">
              ìƒì„±:{" "}
              {r.created_at
                ? new Date(r.created_at).toLocaleString()
                : "-"}
            </div>
          </div>

          <div className="flex items-center gap-3">
            <div className="font-semibold">
              {r.total_amount.toLocaleString()}ì›
            </div>

            <ActionButton
              variant="outline"
              size="xs"
              onClick={() =>
                exportPayrollSnapshotPDF({
                  staff: sid as number,
                  year: r.year,
                  month: r.month,
                })
              }
            >
              PDF
            </ActionButton>

            <ActionButton
              variant="outline"
              size="xs"
              title="ì—‘ì…€ì€ í•´ë‹¹ ì›” ì „ì²´ ê¸‰ì—¬ ë‹¤ìš´ë¡œë“œì…ë‹ˆë‹¤."
              onClick={() =>
                exportPayrollSnapshotExcel({
                  year: r.year,
                  month: r.month,
                })
              }
            >
              XLSX
            </ActionButton>
          </div>
        </div>
      ))}
    </div>
  );
}


==========================================================================================
# FILE: pages/ReportsPage/PayrollSnapshotList.tsx
==========================================================================================
ï»¿// PATH: src/features/staff/pages/ReportsPage/PayrollSnapshotList.tsx
import { useMemo } from "react";
import { useParams } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";

import {
  fetchPayrollSnapshots,
  exportPayrollSnapshotExcel,
} from "../../api/payrollSnapshots.api";
import { exportPayrollSnapshotPDF } from "../../api/payrollSnapshotPdf.api";
import ActionButton from "../../components/ActionButton";

export default function PayrollSnapshotList({
  year,
  month,
}: {
  year: number;
  month: number;
}) {
  const { staffId } = useParams();
  const sid = staffId ? Number(staffId) : undefined;

  const listQ = useQuery({
    queryKey: ["payroll-snapshots", sid, year, month],
    queryFn: () => fetchPayrollSnapshots({ staff: sid, year, month }),
    enabled: typeof sid === "number" && sid > 0,
  });

  const rows = useMemo(() => listQ.data ?? [], [listQ.data]);

  if (!sid) {
    return (
      <div className="rounded-xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-5 py-4 text-sm text-[var(--text-muted)]">
        ì§ì› ìƒì„¸ í™”ë©´ì—ì„œë§Œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.
      </div>
    );
  }

  if (listQ.isLoading) {
    return <div className="text-sm text-[var(--text-muted)]">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>;
  }

  if (rows.length === 0) {
    return (
      <div className="rounded-xl border border-[var(--border-divider)] bg-[var(--bg-surface-soft)] px-5 py-6">
        <div className="text-sm font-semibold">í™•ì • ê¸‰ì—¬ ì—†ìŒ</div>
        <div className="text-xs text-[var(--text-muted)] mt-1">
          í•´ë‹¹ ì›”ì€ ì•„ì§ ë§ˆê°ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ê¸‰ì—¬ ìŠ¤ëƒ…ìƒ·ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-3">
      {rows.map((r) => (
        <div
          key={r.id}
          className="rounded-xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-5 py-4"
        >
          <div className="flex justify-between items-start gap-4">
            <div className="space-y-1">
              <div className="text-sm font-semibold">
                {r.year}-{String(r.month).padStart(2, "0")} ê¸‰ì—¬
              </div>
              <div className="text-xs text-[var(--text-muted)]">
                ìƒì„±ì¼:{" "}
                {r.created_at
                  ? new Date(r.created_at).toLocaleString()
                  : "-"}
              </div>
              {!!r.generated_by_name && (
                <div className="text-xs text-[var(--text-muted)]">
                  ìƒì„±ì: {r.generated_by_name}
                </div>
              )}
            </div>

            <div className="text-right space-y-2">
              <div className="text-lg font-semibold">
                {r.total_amount.toLocaleString()}ì›
              </div>

              <div className="flex gap-2 justify-end">
                <ActionButton
                  variant="outline"
                  size="xs"
                  onClick={() =>
                    exportPayrollSnapshotPDF({
                      staff: sid as number,
                      year: r.year,
                      month: r.month,
                    })
                  }
                >
                  PDF
                </ActionButton>

                <ActionButton
                  variant="outline"
                  size="xs"
                  title="ì—‘ì…€ì€ í•´ë‹¹ ì›” ì „ì²´ ì§ì› ê¸‰ì—¬ì…ë‹ˆë‹¤."
                  onClick={() =>
                    exportPayrollSnapshotExcel({
                      year: r.year,
                      month: r.month,
                    })
                  }
                >
                  XLSX
                </ActionButton>
              </div>
            </div>
          </div>
        </div>
      ))}

      <div className="text-[11px] text-[var(--text-muted)]">
        * Payroll Snapshotì€ ë§ˆê° ì‹œì  í™•ì • ë°ì´í„°ì´ë©° ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
      </div>
    </div>
  );
}


==========================================================================================
# FILE: pages/ReportsPage/ReportsPage.tsx
==========================================================================================
ï»¿// PATH: src/features/staff/pages/ReportsPage/ReportsPage.tsx
import { Tabs } from "antd";
import { useMemo, useState } from "react";
import PayrollSnapshotList from "./PayrollSnapshotList";
import PayrollHistoryTable from "./PayrollHistoryTable";
import WorkMonthLockHistory from "./WorkMonthLockHistory";

function ymLabel(y: number, m: number) {
  return `${y}-${String(m).padStart(2, "0")}`;
}

export default function ReportsPage() {
  const now = useMemo(() => new Date(), []);
  const [ym, setYm] = useState({
    year: now.getFullYear(),
    month: now.getMonth() + 1,
  });

  return (
    <div className="p-6 space-y-4">
      {/* ê¸°ì¤€ ì›” í—¤ë” */}
      <div className="rounded-2xl border border-[var(--border-divider)] bg-[var(--bg-surface)] px-6 py-4">
        <div className="flex items-start justify-between gap-4">
          <div className="space-y-1">
            <div className="text-lg font-semibold">ë¦¬í¬íŠ¸</div>
            <div className="text-sm text-[var(--text-muted)]">
              ê¸°ì¤€ì›” <b>{ymLabel(ym.year, ym.month)}</b> Â· ëª¨ë“  ìˆ˜ì¹˜ëŠ”{" "}
              <b>ì„œë²„ í™•ì • ë°ì´í„°</b> ê¸°ì¤€ì…ë‹ˆë‹¤.
            </div>
          </div>

          <div className="flex items-center gap-2">
            <select
              value={ym.year}
              onChange={(e) =>
                setYm((p) => ({ ...p, year: Number(e.target.value) }))
              }
              className="h-[36px] rounded-lg border border-[var(--border-divider)] px-3 text-sm bg-[var(--bg-surface)]"
            >
              {[ym.year - 1, ym.year, ym.year + 1].map((y) => (
                <option key={y} value={y}>
                  {y}ë…„
                </option>
              ))}
            </select>

            <select
              value={ym.month}
              onChange={(e) =>
                setYm((p) => ({ ...p, month: Number(e.target.value) }))
              }
              className="h-[36px] rounded-lg border border-[var(--border-divider)] px-3 text-sm bg-[var(--bg-surface)]"
            >
              {Array.from({ length: 12 }, (_, i) => i + 1).map((m) => (
                <option key={m} value={m}>
                  {m}ì›”
                </option>
              ))}
            </select>
          </div>
        </div>

        <div className="mt-2 text-[11px] text-[var(--text-muted)]">
          * Payroll Snapshotì€ <b>ì›” ë§ˆê° ì‹œ ìƒì„±</b>ë˜ë©° ì´í›„ ìˆ˜ì •ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
        </div>
      </div>

      <Tabs
        items={[
          {
            key: "snapshot",
            label: "Payroll Snapshot",
            children: (
              <PayrollSnapshotList year={ym.year} month={ym.month} />
            ),
          },
          {
            key: "history",
            label: "Payroll History",
            children: <PayrollHistoryTable />,
          },
          {
            key: "lock",
            label: "Month Lock History",
            children: (
              <WorkMonthLockHistory year={ym.year} month={ym.month} />
            ),
          },
        ]}
      />
    </div>
  );
}


==========================================================================================
# FILE: pages/ReportsPage/WorkMonthLockHistory.tsx
==========================================================================================
ï»¿// PATH: src/features/staff/pages/ReportsPage/WorkMonthLockHistory.tsx
import { useQuery } from "@tanstack/react-query";
import { fetchWorkMonthLocks } from "../../api/workMonthLocks.api";
import { LockBadge } from "../../components/StatusBadge";

function ymLabel(y: number, m: number) {
  return `${y}-${String(m).padStart(2, "0")}`;
}

export default function WorkMonthLockHistory({
  year,
  month,
}: {
  year: number;
  month: number;
}) {
  const listQ = useQuery({
    queryKey: ["work-month-lock-history", year, month],
    queryFn: () => fetchWorkMonthLocks({ year, month }),
  });

  const rows = listQ.data ?? [];

  if (listQ.isLoading) {
    return <div className="text-sm text-[var(--text-muted)]">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>;
  }

  if (rows.length === 0) {
    return (
      <div className="rounded-xl border border-[var(--border-divider)] bg-[var(--bg-surface-soft)] px-5 py-6">
        <div className="text-sm font-semibold">ë§ˆê° ë‚´ì—­ ì—†ìŒ</div>
        <div className="text-xs text-[var(--text-muted)] mt-1">
          í•´ë‹¹ ì›”ì—ëŠ” ì•„ì§ ë§ˆê°ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-3">
      {rows.map((r) => (
        <div
          key={r.id}
          className="rounded-lg border border-[var(--border-divider)] bg-[var(--bg-surface)] px-5 py-4 flex justify-between items-center gap-4"
        >
          <div>
            <div className="font-semibold">
              {r.staff_name ?? `Staff#${r.staff}`}
            </div>
            <div className="text-xs text-[var(--text-muted)]">
              {ymLabel(r.year, r.month)} Â· ë§ˆê°ì{" "}
              {r.locked_by_name ?? "-"}
            </div>
          </div>

          <LockBadge state={r.is_locked ? "LOCKED" : "OPEN"} />
        </div>
      ))}
    </div>
  );
}


==========================================================================================
# FILE: types/index.ts
==========================================================================================
ï»¿


==========================================================================================
# FILE: utils/index.ts
==========================================================================================
ï»¿
