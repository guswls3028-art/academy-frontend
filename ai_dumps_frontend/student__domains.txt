====================================================================================================
# FRONTEND FOLDER: student__domains
# ROOT PATH: C:\academyfront\src\student\domains
====================================================================================================


==========================================================================================
# FILE: attendance/pages/AttendancePage.tsx
==========================================================================================
/**
 * ì¶œê²° í˜„í™© â€” ëŒ€í˜•í•™ì› SaaS ê¸°ì¤€ placeholder
 */
import EmptyState from "@/student/shared/ui/layout/EmptyState";

export default function AttendancePage() {
  return (
    <div style={{ padding: "var(--stu-space-4) 0" }}>
      <h1 style={{ fontSize: 20, fontWeight: 800, marginBottom: "var(--stu-space-6)" }}>
        ì¶œê²° í˜„í™©
      </h1>
      <EmptyState
        title="ì¶œê²° ì •ë³´"
        description="ìˆ˜ì—…ë³„ ì¶œì„ í˜„í™©ì€ ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ í™•ì¸í•œ ë’¤ ì•ˆë‚´ë©ë‹ˆë‹¤. API ì—°ë™ ì‹œ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."
      />
    </div>
  );
}


==========================================================================================
# FILE: clinic-idcard/api/idcard.ts
==========================================================================================
// PATH: src/student/domains/clinic-idcard/api/idcard.ts
// ì‹¤ì œ API: GET /api/v1/clinic/idcard/ (ì°¨ì‹œë³„ í•©ë¶ˆ ë‹¨ì¼ ì§„ì‹¤: progress.ClinicLink)

import api from "@/student/shared/api/studentApi";

export type ClinicIdcardResult = "SUCCESS" | "FAIL";

export type ClinicIdcardHistoryItem = {
  session_order: number;
  passed: boolean;
  clinic_required: boolean;
};

export type ClinicIdcardData = {
  student_name: string;
  profile_photo_url: string | null;
  background_colors: [string, string, string];  // ìœ„ì¡° ë°©ì§€ìš© ë°°ê²½ ê·¸ë¼ë°ì´ì…˜ ìƒ‰ìƒ 3ê°œ
  server_date: string;
  server_datetime: string;
  histories: ClinicIdcardHistoryItem[];
  current_result: ClinicIdcardResult;
};

export async function fetchClinicIdcard(): Promise<ClinicIdcardData> {
  const res = await api.get("/clinic/idcard/");
  const data = res.data as ClinicIdcardData;
  const defaultColors: [string, string, string] = ["#ef4444", "#3b82f6", "#22c55e"];
  const bgColors = Array.isArray(data.background_colors) && data.background_colors.length >= 3
    ? [data.background_colors[0], data.background_colors[1], data.background_colors[2]] as [string, string, string]
    : defaultColors;
  
  return {
    student_name: data.student_name ?? "",
    profile_photo_url: data.profile_photo_url ?? null,
    background_colors: bgColors,
    server_date: data.server_date ?? "",
    server_datetime: data.server_datetime ?? "",
    histories: Array.isArray(data.histories) ? data.histories : [],
    current_result: data.current_result === "FAIL" ? "FAIL" : "SUCCESS",
  };
}


==========================================================================================
# FILE: clinic-idcard/components/HistoryStrip.tsx
==========================================================================================
// PATH: src/student/domains/clinic-idcard/components/HistoryStrip.tsx

import { ClinicHistoryItem } from "../pages/ClinicIDCardPage";

export default function HistoryStrip({
  histories,
}: {
  histories: ClinicHistoryItem[];
}) {
  return (
    <div className="history-strip">
      {histories.map((h, idx) => (
        <div
          key={idx}
          className={`history-item ${h.result.toLowerCase()}`}
        >
          {h.week}ì°¨
        </div>
      ))}
    </div>
  );
}


==========================================================================================
# FILE: clinic-idcard/components/LiveStamp.tsx
==========================================================================================
// PATH: src/student/domains/clinic-idcard/components/LiveStamp.tsx

import { useEffect, useState } from "react";

export default function LiveStamp() {
  const [now, setNow] = useState(new Date());

  useEffect(() => {
    const t = setInterval(() => setNow(new Date()), 1000);
    return () => clearInterval(t);
  }, []);

  return (
    <div className="live-stamp">
      <span className="live-dot" />
      {now.toLocaleDateString()} {now.toLocaleTimeString()}
    </div>
  );
}


==========================================================================================
# FILE: clinic-idcard/components/ResultBanner.tsx
==========================================================================================
// PATH: src/student/domains/clinic-idcard/components/ResultBanner.tsx

import { ClinicResult } from "../pages/ClinicIDCardPage";

export default function ResultBanner({ result }: { result: ClinicResult }) {
  return (
    <div className={`result-banner ${result.toLowerCase()}`}>
      {result === "SUCCESS" ? "í•©ê²©" : "í´ë¦¬ë‹‰ ëŒ€ìƒ"}
    </div>
  );
}


==========================================================================================
# FILE: clinic-idcard/pages/ClinicIDCardPage.tsx
==========================================================================================
/**
 * í´ë¦¬ë‹‰ ì¸ì¦(íŒ¨ìŠ¤ì¹´ë“œ) â€” ì‹¤ë¬´: ì¡°êµ 1ëª…ì´ 100ëª…ê°€ëŸ‰ ë¹ ë¥´ê²Œ ì‹œê° í™•ì¸
 * - ê¹¡ë¸”ë™ ë°°ê²½ + ëˆˆì— ë„ëŠ” ìƒ‰/ì• ë‹ˆë©”ì´ì…˜
 * - ì‹¤ì‹œê°„ ì‹œê³„(ì´ˆ ë‹¨ìœ„ ê°±ì‹ )ë¡œ ìœ„ì¡°Â·ìŠ¤í¬ë¦°ìƒ· ì¦‰ì‹œ íŒë³„
 */
import { useEffect, useState } from "react";
import { useQuery } from "@tanstack/react-query";
import { fetchClinicIdcard } from "../api/idcard";
import "../styles/idcard.css";

/** ì‹¤ì‹œê°„ ì‹œê° ë¬¸ìì—´ (ì´ˆ ë‹¨ìœ„) â€” ìœ„ì¡°/ìŠ¤í¬ë¦°ìƒ· ì‹œ ì´ˆê°€ ë©ˆì¶° ë³´ì´ë¯€ë¡œ íŒë³„ìš© */
function useLiveClock() {
  const [now, setNow] = useState(() => new Date());
  useEffect(() => {
    const id = setInterval(() => setNow(new Date()), 1000);
    return () => clearInterval(id);
  }, []);
  return now;
}

function formatLiveTime(d: Date): string {
  const h = d.getHours();
  const ampm = h < 12 ? "ì˜¤ì „" : "ì˜¤í›„";
  const h12 = h % 12 || 12;
  const m = d.getMinutes();
  const s = d.getSeconds();
  return `${ampm} ${h12}:${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;
}

/** ì´ˆ ë‹¨ìœ„ ìƒ‰ ë³€í™” (ì§ìˆ˜/í™€ìˆ˜ ì´ˆ) â€” ë…¹í™” ì˜ìƒ ë°©ì§€ */
function getTimeColor(seconds: number): string {
  return seconds % 2 === 0 ? "#22c55e" : "#60efff";
}

/** ì´ë¦„ ì´ë‹ˆì…œ (í”„ë¡œí•„ ì‚¬ì§„ ì—†ì„ ë•Œ) */
function getInitials(name: string): string {
  if (!name || name.length === 0) return "?";
  const trimmed = name.trim();
  if (trimmed.length <= 2) return trimmed;
  return trimmed.slice(0, 2);
}

function formatLiveDate(d: Date): string {
  const y = d.getFullYear();
  const m = d.getMonth() + 1;
  const day = d.getDate();
  const weekdays = ["ì¼ìš”ì¼", "ì›”ìš”ì¼", "í™”ìš”ì¼", "ìˆ˜ìš”ì¼", "ëª©ìš”ì¼", "ê¸ˆìš”ì¼", "í† ìš”ì¼"];
  const w = weekdays[d.getDay()];
  return `${y}ë…„ ${m}ì›” ${day}ì¼ ${w}`;
}

export default function ClinicIDCardPage() {
  const liveNow = useLiveClock();
  const [profilePhotoError, setProfilePhotoError] = useState(false);
  const { data, isLoading, error } = useQuery({
    queryKey: ["clinic-idcard"],
    queryFn: fetchClinicIdcard,
    refetchInterval: 2000, // 2ì´ˆë§ˆë‹¤ ìë™ ê°±ì‹  (ì„ ìƒë‹˜ì´ ìƒ‰ìƒ ë³€ê²½ ì‹œ ì¦‰ì‹œ ë°˜ì˜)
  });

  // ë°ì´í„°ê°€ ë³€ê²½ë˜ë©´ í”„ë¡œí•„ ì‚¬ì§„ ì—ëŸ¬ ìƒíƒœ ë¦¬ì…‹
  useEffect(() => {
    if (data) {
      setProfilePhotoError(false);
    }
  }, [data]);

  if (isLoading) {
    return (
      <div className="idcard-page idcard-page--black">
        <div className="idcard-page__loading">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
      </div>
    );
  }

  if (error || !data) {
    return (
      <div className="idcard-page idcard-page--black">
        <div className="idcard-page__error">
          {error instanceof Error ? error.message : "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."}
        </div>
      </div>
    );
  }

  const isClinicTarget = data.current_result === "FAIL";
  const bgColors = data.background_colors || ["#ef4444", "#3b82f6", "#22c55e"];
  // ë¶ˆí•©ê²©(í´ë¦¬ë‹‰ ëŒ€ìƒ)ì¼ ë•ŒëŠ” ê²€ì •ìƒ‰ ë°°ê²½ ê³ ì •
  const bgGradient = isClinicTarget
    ? "#000000"
    : `linear-gradient(135deg, ${bgColors[0]} 0%, ${bgColors[1]} 50%, ${bgColors[2]} 100%)`;

  const seconds = liveNow.getSeconds();
  const timeColor = getTimeColor(seconds);

  return (
    <div
      className="idcard-page idcard-page--black"
      style={{
        background: bgGradient,
        backgroundSize: isClinicTarget ? "100% 100%" : "200% 200%",
        animation: isClinicTarget ? "none" : "idcard-background-flow 8s ease infinite",
      }}
    >
      {/* LIVE ë±ƒì§€ + ì‹¤ì‹œê°„ ì‹œê³„ (ì´ˆ ë‹¨ìœ„) â€” ìœ„ì¡° íŒë³„ìš© */}
      <div className="idcard-page__live-badge">
        <span className="idcard-page__live-dot" aria-hidden />
        <span>LIVE</span>
      </div>

      {/* í•™ìƒ í”„ë¡œí•„ ì‚¬ì§„ (ì‹ ì› í™•ì¸ìš©) â€” ì¢Œì¸¡ ìƒë‹¨ */}
      {data.profile_photo_url && !profilePhotoError ? (
        <div className="idcard-page__profile-photo">
          <img
            src={data.profile_photo_url}
            alt={data.student_name || ""}
            onError={(e) => {
              // ì´ë¯¸ì§€ ë¡œë”© ì‹¤íŒ¨ ì‹œ ì´ë‹ˆì…œ í‘œì‹œë¡œ ì „í™˜
              console.error("í”„ë¡œí•„ ì‚¬ì§„ ë¡œë”© ì‹¤íŒ¨:", data.profile_photo_url);
              setProfilePhotoError(true);
              // ì´ë¯¸ì§€ ìš”ì†Œ ìˆ¨ê¸°ê¸°
              const img = e.target as HTMLImageElement;
              if (img) {
                img.style.display = "none";
              }
            }}
            onLoad={() => {
              // ì´ë¯¸ì§€ ë¡œë”© ì„±ê³µ ì‹œ ì—ëŸ¬ ìƒíƒœ ë¦¬ì…‹
              setProfilePhotoError(false);
            }}
            crossOrigin="anonymous"
          />
        </div>
      ) : (
        <div className="idcard-page__profile-initials">
          {getInitials(data.student_name || "")}
        </div>
      )}

      <div className="idcard-page__label">ì¡°íšŒ ì¼ì‹œ</div>
      <div className="idcard-page__date">{formatLiveDate(liveNow)}</div>
      <div
        className="idcard-page__time"
        aria-live="polite"
        style={{ color: timeColor }}
      >
        {formatLiveTime(liveNow)}
      </div>

      {/* í•™ìƒ ì´ë¦„ */}
      <div className="idcard-page__name">{data.student_name || "-"}</div>

      {/* íŒ¨ìŠ¤ì¹´ë“œ: í•©ê²© / í´ë¦¬ë‹‰ ì˜ˆì•½ ëŒ€ìƒì â€” í¼ì§€ë§‰í•˜ê²Œ í•œ ì¤„ë¡œ */}
      <div
        className={`idcard-page__pass-card ${isClinicTarget ? "idcard-page__pass-card--clinic" : "idcard-page__pass-card--pass"}`}
      >
        <div className="idcard-page__pass-card-title">
          {isClinicTarget ? "í´ë¦¬ë‹‰ ì˜ˆì•½ ëŒ€ìƒì" : "í•©ê²©"}
        </div>
      </div>

      {/* ì°¨ì‹œë³„ ì´ë ¥ (1~n) â€” ì½ê¸° ì „ìš© */}
      <div className="idcard-page__history-label">ì°¨ì‹œë³„ ì´ë ¥ (í•©ê²©/í´ë¦¬ë‹‰ ëŒ€ìƒ)</div>
      <div className="idcard-page__history-grid">
        {data.histories.length === 0 ? (
          <div className="idcard-page__history-empty">ì°¨ì‹œ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</div>
        ) : (
          data.histories.map((h) => (
            <div
              key={h.session_order}
              className={`idcard-page__history-item ${h.clinic_required ? "idcard-page__history-item--clinic" : "idcard-page__history-item--pass"}`}
            >
              {h.session_order}ì°¨ì‹œ
              <div className="idcard-page__history-item-sub">
                {h.clinic_required ? "í´ë¦¬ë‹‰ ëŒ€ìƒ" : "í•©ê²©"}
              </div>
            </div>
          ))
        )}
      </div>

      {isClinicTarget && (
        <div className="idcard-page__clinic-notice">
          ì„ ìƒë‹˜ ì•ˆë‚´ì— ë”°ë¼ í´ë¦¬ë‹‰ ì°¸ì—¬í•´ ì£¼ì„¸ìš”.
        </div>
      )}
    </div>
  );
}


==========================================================================================
# FILE: clinic-idcard/styles/idcard.css
==========================================================================================
/* PATH: src/student/domains/clinic-idcard/styles/idcard.css
 * íŒ¨ìŠ¤ì¹´ë“œ: ê¹¡ë¸”ë™ ë°°ê²½, ì‹¤ì‹œê°„ ì‹œê³„(ìœ„ì¡° íŒë³„), ëˆˆì— ë„ëŠ” ì• ë‹ˆë©”ì´ì…˜
 */

html,
body {
  margin: 0;
  padding: 0;
}

/* ---------- í˜ì´ì§€ ê³µí†µ: ê¹¡ë¸”ë™ ---------- */
.idcard-page {
  position: relative;
  min-height: 100dvh;
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: var(--stu-space-6, 24px) var(--stu-space-4, 16px);
  padding-top: max(var(--stu-safe-top, 0px), 24px);
  font-family: system-ui, -apple-system, sans-serif;
}

.idcard-page--black {
  background: #000;
  background-size: 200% 200%;
  animation: idcard-background-flow 8s ease infinite;
}

.idcard-page__loading,
.idcard-page__error {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  flex: 1;
  padding: 24px;
}

.idcard-page__loading {
  font-size: 18px;
  color: #94a3b8;
}

.idcard-page__error {
  font-size: 16px;
  color: #f87171;
}

/* ---------- LIVE ë±ƒì§€ + ì‹¤ì‹œê°„ ì‹œê³„ (ì´ˆ ë‹¨ìœ„) ---------- */
.idcard-page__live-badge {
  position: absolute;
  top: max(var(--stu-safe-top, 0px), 16px);
  right: 16px;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  font-weight: 800;
  letter-spacing: 0.05em;
  color: #22c55e;
}

.idcard-page__live-dot {
  width: 8px;
  height: 8px;
  background: #22c55e;
  border-radius: 50%;
  animation: idcard-pulse 1.2s ease-in-out infinite;
}

.idcard-page__label {
  font-size: clamp(1.25rem, 5vw, 1.75rem);
  font-weight: 800;
  letter-spacing: -0.02em;
  margin-bottom: 8px;
  color: #94a3b8;
}

.idcard-page__date {
  font-size: clamp(1.5rem, 6vw, 2.25rem);
  font-weight: 900;
  letter-spacing: -0.02em;
  margin-bottom: 8px;
  color: #e2e8f0;
}

.idcard-page__time {
  font-size: clamp(1.5rem, 6vw, 2.5rem);
  font-weight: 900;
  letter-spacing: 0.02em;
  margin-bottom: 32px;
  font-variant-numeric: tabular-nums;
  transition: color 0.3s ease;
}

.idcard-page__name {
  font-size: clamp(1.25rem, 5vw, 1.5rem);
  font-weight: 800;
  margin-bottom: 28px;
  color: #fff;
}

/* ---------- í”„ë¡œí•„ ì‚¬ì§„ (ì‹ ì› í™•ì¸ìš©) â€” ì¢Œì¸¡ ìƒë‹¨ ---------- */
.idcard-page__profile-photo {
  position: absolute;
  top: max(var(--stu-safe-top, 0px), 16px);
  left: 16px;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  overflow: hidden;
  border: 3px solid #fff;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
  z-index: 10;
}

.idcard-page__profile-photo img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.idcard-page__profile-initials {
  position: absolute;
  top: max(var(--stu-safe-top, 0px), 16px);
  left: 16px;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
  border: 3px solid #fff;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: 900;
  color: #fff;
  z-index: 10;
}

/* ---------- íŒ¨ìŠ¤ì¹´ë“œ: íë¥´ëŠ” ê·¸ë¼ë°ì´ì…˜ + ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ ìƒë™ê°Â·ìœ„ì¡° íŒë³„ ---------- */
.idcard-page__pass-card {
  width: 100%;
  max-width: 420px;
  padding: 36px 24px;
  border-radius: 16px;
  text-align: center;
  margin-bottom: 32px;
  color: #fff;
  position: relative;
  overflow: hidden;
  animation: idcard-card-glow 2.5s ease-in-out infinite;
}

.idcard-page__pass-card::before {
  content: "";
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(
    120deg,
    transparent,
    rgba(255, 255, 255, 0.1),
    transparent
  );
  animation: idcard-shimmer 3s linear infinite;
  pointer-events: none;
}

.idcard-page__pass-card--pass {
  background: linear-gradient(135deg, #22c55e 0%, #15803d 50%, #14532d 100%);
  background-size: 200% 200%;
  animation: idcard-card-glow 2.5s ease-in-out infinite, idcard-gradient-flow 4s ease infinite;
  box-shadow: 0 0 24px rgba(34, 197, 94, 0.4), 0 8px 32px rgba(21, 128, 61, 0.35);
}

.idcard-page__pass-card--clinic {
  background: linear-gradient(135deg, #ef4444 0%, #b91c1c 50%, #7f1d1d 100%);
  background-size: 200% 200%;
  animation: idcard-card-glow 2.5s ease-in-out infinite, idcard-gradient-flow 4s ease infinite;
  box-shadow: 0 0 24px rgba(239, 68, 68, 0.4), 0 8px 32px rgba(185, 28, 28, 0.35);
}

.idcard-page__pass-card-title {
  font-size: clamp(2rem, 10vw, 3.5rem);
  font-weight: 900;
  letter-spacing: -0.03em;
  line-height: 1.15;
  position: relative;
  z-index: 1;
}

/* ---------- ì°¨ì‹œ ì´ë ¥ ---------- */
.idcard-page__history-label {
  font-size: 12px;
  font-weight: 700;
  color: #64748b;
  margin-bottom: 12px;
  align-self: flex-start;
  max-width: 420px;
  width: 100%;
}

.idcard-page__history-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(72px, 1fr));
  gap: 10px;
  width: 100%;
  max-width: 420px;
}

.idcard-page__history-empty {
  grid-column: 1 / -1;
  text-align: center;
  color: #64748b;
  font-size: 14px;
}

.idcard-page__history-item {
  padding: 14px 8px;
  border-radius: 12px;
  text-align: center;
  font-weight: 800;
  font-size: 14px;
  color: #fff;
  pointer-events: none;
  user-select: none;
}

.idcard-page__history-item--pass {
  background: #14532d;
}

.idcard-page__history-item--clinic {
  background: #7f1d1d;
}

.idcard-page__history-item-sub {
  margin-top: 6px;
  font-size: 12px;
  opacity: 0.95;
}

.idcard-page__clinic-notice {
  margin-top: 28px;
  color: #fca5a5;
  font-size: 15px;
  font-weight: 700;
  text-align: center;
}

/* ---------- ë ˆê±°ì‹œ í´ë˜ìŠ¤ (í˜¸í™˜) ---------- */
.idcard-root {
  min-height: 100vh;
  padding: 24px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-family: system-ui, sans-serif;
  color: #fff;
  animation: fadeIn 0.3s ease;
}

.idcard-root.fail {
  background: #7f1d1d;
  animation: shake 0.4s ease;
}

.idcard-root.success {
  background: #14532d;
}

.idcard-name {
  font-size: 28px;
  font-weight: 900;
  margin: 12px 0;
}

.result-banner {
  font-size: 64px;
  font-weight: 900;
  margin: 24px 0;
  letter-spacing: 2px;
}

.result-banner.fail {
  color: #fecaca;
}

.result-banner.success {
  color: #bbf7d0;
}

.live-stamp {
  position: absolute;
  top: 16px;
  right: 16px;
  font-size: 14px;
  opacity: 0.9;
}

.live-dot {
  display: inline-block;
  width: 8px;
  height: 8px;
  background: #22c55e;
  border-radius: 50%;
  margin-right: 6px;
  animation: idcard-pulse 1s infinite;
}

.history-strip {
  display: flex;
  gap: 8px;
  margin-top: 24px;
}

.history-item {
  padding: 10px 14px;
  border-radius: 8px;
  font-weight: 800;
}

.history-item.success {
  background: #16a34a;
}

.history-item.fail {
  background: #dc2626;
}

/* ---------- í‚¤í”„ë ˆì„ ---------- */
@keyframes idcard-pulse {
  0%,
  100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.5;
    transform: scale(1.1);
  }
}

@keyframes idcard-card-glow {
  0%,
  100% {
    filter: brightness(1);
  }
  50% {
    filter: brightness(1.08);
  }
}

@keyframes idcard-gradient-flow {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

@keyframes idcard-shimmer {
  0% {
    transform: translateX(-100%) translateY(-100%) rotate(45deg);
  }
  100% {
    transform: translateX(100%) translateY(100%) rotate(45deg);
  }
}

@keyframes idcard-background-flow {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: 0.4; }
  100% { opacity: 1; }
}

@keyframes shake {
  0% { transform: translateX(0); }
  25% { transform: translateX(-6px); }
  50% { transform: translateX(6px); }
  75% { transform: translateX(-4px); }
  100% { transform: translateX(0); }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}


==========================================================================================
# FILE: dashboard/api/dashboard.ts
==========================================================================================
// PATH: src/student/domains/dashboard/api/dashboard.ts

import api from "@/student/shared/api/studentApi";

/**
 * âœ… Student Dashboard API (HOME ì „ìš©)
 *
 * ì›ì¹™:
 * - í™ˆì—ì„œëŠ” "í–‰ë™ ìœ ë„ ì •ë³´"ë§Œ ì‚¬ìš©
 * - ê³µì§€ / ì¼ì • ìƒì„¸ëŠ” ê° ë„ë©”ì¸ì—ì„œë§Œ ë…¸ì¶œ
 */

export type StudentDashboardBadges = {
  clinic_upcoming?: boolean;
  counseling_upcoming?: boolean;
  [key: string]: any;
};

export type StudentDashboardResponse = {
  badges: StudentDashboardBadges;
};

export async function fetchStudentDashboard(): Promise<StudentDashboardResponse> {
  const res = await api.get("/student/dashboard/");
  const data = res.data ?? {};

  return {
    badges:
      typeof data.badges === "object" && data.badges
        ? data.badges
        : {},
  };
}


==========================================================================================
# FILE: dashboard/components/DashboardScheduleCard.tsx
==========================================================================================
// PATH: src/student/domains/dashboard/components/DashboardScheduleCard.tsx
/**
 * âœ… DashboardScheduleCard
 * - í´ë¦¬ë‹‰ / ìƒë‹´ ì¼ì •
 */

import EmptyState from "@/student/shared/ui/layout/EmptyState";
import { formatYmd } from "@/student/shared/utils/date";
import { DashboardScheduleItem } from "../api/dashboard";

export default function DashboardScheduleCard({
  items,
}: {
  items: DashboardScheduleItem[];
}) {
  return (
    <div className="stu-section">
      <div style={{ fontWeight: 900, marginBottom: 12 }}>
        í´ë¦¬ë‹‰ Â· ìƒë‹´ ì¼ì •
      </div>

      {items.length === 0 && (
        <EmptyState title="ì˜ˆì •ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤." />
      )}

      {items.length > 0 && (
        <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
          {items.map((it) => (
            <div
              key={`${it.type}-${it.id}`}
              style={{
                padding: 12,
                borderRadius: "var(--stu-radius-md)",
                background: "var(--stu-surface-2)",
                display: "flex",
                justifyContent: "space-between",
                alignItems: "center",
              }}
            >
              <div>
                <div style={{ fontWeight: 800 }}>{it.title}</div>
                <div
                  style={{
                    fontSize: 12,
                    color: "var(--stu-text-muted)",
                    marginTop: 4,
                  }}
                >
                  {formatYmd(it.date)} Â·{" "}
                  {it.type === "CLINIC" ? "í´ë¦¬ë‹‰" : "ìƒë‹´"}
                </div>
              </div>
              <span style={{ opacity: 0.4 }}>â€º</span>
            </div>
          ))}
        </div>
      )}
    </div>
  );
}


==========================================================================================
# FILE: dashboard/components/NoticeBanner.tsx
==========================================================================================
// PATH: src/student/domains/dashboard/components/NoticeBanner.tsx

import { DashboardNotice } from "../api/dashboard";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import { formatYmd } from "@/student/shared/utils/date";

export default function NoticeBanner({
  notices,
}: {
  notices: DashboardNotice[];
}) {
  if (!notices || notices.length === 0) {
    return <EmptyState title="ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤." />;
  }

  const first = notices[0];

  return (
    <div className="stu-card">
      <div
        style={{
          display: "flex",
          justifyContent: "space-between",
          alignItems: "center",
          marginBottom: 6,
        }}
      >
        <div style={{ fontWeight: 900 }}>ğŸ“£ ê³µì§€ì‚¬í•­</div>
        <div style={{ fontSize: 12, color: "var(--stu-text-muted)" }}>
          {formatYmd(first.created_at ?? null)}
        </div>
      </div>

      <div style={{ fontSize: 14, fontWeight: 700 }}>{first.title}</div>
    </div>
  );
}


==========================================================================================
# FILE: dashboard/components/QuickActionGrid.tsx
==========================================================================================
// PATH: src/student/domains/dashboard/components/QuickActionGrid.tsx

import { Link } from "react-router-dom";

type Item = {
  label: string;
  to: string;
};

const items: Item[] = [
  { label: "ì‹œí—˜ Â· ì„±ì ", to: "/student/exams" },
  { label: "ìë£Œì‹¤", to: "/student/materials" },
  { label: "ê³¼ì œ ì œì¶œ", to: "/student/assignments" },
  { label: "ì„±ì  ê´€ë¦¬", to: "/student/grades" },
];

export default function QuickActionGrid() {
  return (
    <div className="stu-card">
      <div style={{ fontWeight: 900, marginBottom: 10 }}>ë°”ë¡œê°€ê¸°</div>

      <div
        style={{
          display: "grid",
          gridTemplateColumns: "1fr 1fr",
          gap: 10,
        }}
      >
        {items.map((it) => (
          <Link key={it.to} to={it.to} className="stu-quick-btn">
            {it.label}
          </Link>
        ))}
      </div>
    </div>
  );
}


==========================================================================================
# FILE: dashboard/components/TodaySessionsCard.tsx
==========================================================================================
// PATH: src/student/domains/dashboard/components/TodaySessionsCard.tsx

import { Link } from "react-router-dom";
import { DashboardSession } from "../api/dashboard";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import SectionHeader from "@/student/shared/ui/layout/SectionHeader";
import { formatYmd } from "@/student/shared/utils/date";

export default function TodaySessionsCard({
  sessions,
}: {
  sessions: DashboardSession[];
}) {
  return (
    <div className="stu-card">
      <SectionHeader title="ì˜¤ëŠ˜ í•  ì¼" />

      {(!sessions || sessions.length === 0) && (
        <EmptyState title="ì˜¤ëŠ˜ í•  ì°¨ì‹œê°€ ì—†ìŠµë‹ˆë‹¤." />
      )}

      {sessions && sessions.length > 0 && (
        <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
          {sessions.map((s) => (
            <Link
              key={s.id}
              to={`/student/sessions/${s.id}`}
              className="stu-list-item"
            >
              <div>
                <div style={{ fontWeight: 800 }}>{s.title}</div>
                <div className="stu-muted" style={{ fontSize: 12 }}>
                  {formatYmd(s.date ?? null)}
                  {s.status ? ` Â· ${s.status}` : ""}
                </div>
              </div>
              <div style={{ opacity: 0.6 }}>â€º</div>
            </Link>
          ))}
        </div>
      )}
    </div>
  );
}


==========================================================================================
# FILE: dashboard/hooks/useStudentDashboard.ts
==========================================================================================
// PATH: src/student/domains/dashboard/hooks/useStudentDashboard.ts

import { useQuery } from "@tanstack/react-query";
import { fetchStudentDashboard } from "../api/dashboard";

export function useStudentDashboard() {
  return useQuery({
    queryKey: ["student-dashboard"],
    queryFn: fetchStudentDashboard,
  });
}


==========================================================================================
# FILE: dashboard/pages/DashboardPage.tsx
==========================================================================================
/**
 * í™ˆ â€” ì˜¤ëŠ˜ ì¼ì •, ë¹ ë¥¸ ë©”ë‰´(ì˜ìƒÂ·ì‹œí—˜Â·ì„±ì Â·ì¼ì •), ê³µì§€
 */
import { Link } from "react-router-dom";
import { useStudentDashboard } from "../hooks/useStudentDashboard";
import { useMySessions } from "@/student/domains/sessions/hooks/useStudentSessions";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import { IconPlay, IconCalendar, IconGrade, IconExam, IconNotice } from "@/student/shared/ui/icons/Icons";
import { formatYmd } from "@/student/shared/utils/date";

export default function DashboardPage() {
  const { data: dashboard, isLoading: dashLoading } = useStudentDashboard();
  const { data: sessions, isLoading: sessionsLoading } = useMySessions();

  const today = new Date().toISOString().slice(0, 10);
  const todaySessions = (sessions ?? []).filter((s) => (s.date ?? "").slice(0, 10) === today);

  if (dashLoading && sessionsLoading) {
    return (
      <div style={{ padding: "var(--stu-space-4) 0" }}>
        <div className="stu-skel" style={{ height: 100, borderRadius: "var(--stu-radius-md)" }} />
        <div className="stu-skel" style={{ height: 120, marginTop: 12, borderRadius: "var(--stu-radius-md)" }} />
      </div>
    );
  }

  return (
    <div style={{ padding: "var(--stu-space-2) 0" }}>
      <h1 style={{ fontSize: 20, fontWeight: 800, marginBottom: "var(--stu-space-6)", paddingLeft: "var(--stu-space-2)" }}>
        í™ˆ
      </h1>

      {/* ê³µì§€ */}
      <Link
        to="/student/qna"
        className="stu-card stu-card--pressable"
        style={{
          display: "flex",
          alignItems: "center",
          gap: "var(--stu-space-4)",
          marginBottom: "var(--stu-space-6)",
          textDecoration: "none",
          color: "inherit",
        }}
      >
        <div style={{ width: 44, height: 44, borderRadius: 12, background: "var(--stu-surface-soft)", display: "grid", placeItems: "center" }}>
          <IconNotice style={{ width: 24, height: 24, color: "var(--stu-primary)" }} />
        </div>
        <div style={{ flex: 1, minWidth: 0 }}>
          <div style={{ fontWeight: 800, fontSize: 15 }}>ê³µì§€Â·Q&A</div>
          <div className="stu-muted" style={{ fontSize: 13, marginTop: 2 }}>ì†Œí†µ ê²Œì‹œíŒì—ì„œ í™•ì¸í•˜ì„¸ìš”</div>
        </div>
        <span className="stu-cta-link" style={{ fontSize: 13 }}>ë³´ê¸°</span>
      </Link>

      {/* ì˜¤ëŠ˜ ì¼ì • */}
      <section style={{ marginBottom: "var(--stu-space-8)" }}>
        <h2 className="stu-muted" style={{ fontSize: 12, fontWeight: 800, marginBottom: "var(--stu-space-3)", paddingLeft: 4 }}>
          ì˜¤ëŠ˜ ì¼ì •
        </h2>
        {todaySessions.length === 0 ? (
          <div className="stu-card stu-card--soft" style={{ padding: "var(--stu-space-6)" }}>
            <div className="stu-muted" style={{ fontSize: 14 }}>ì˜¤ëŠ˜ ì˜ˆì •ëœ ìˆ˜ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</div>
            <Link to="/student/sessions" className="stu-cta-link" style={{ marginTop: 8 }}>
                ì „ì²´ ì¼ì • ë³´ê¸°
            </Link>
          </div>
        ) : (
          <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-2)" }}>
            {todaySessions.slice(0, 3).map((s) => (
              <Link
                key={s.id}
                to={`/student/sessions/${s.id}`}
                className="stu-card stu-card--pressable"
                style={{ display: "flex", alignItems: "center", gap: 12, textDecoration: "none", color: "inherit" }}
              >
                <div style={{ width: 40, height: 40, borderRadius: 10, background: "var(--stu-primary)", opacity: 0.9, display: "grid", placeItems: "center" }}>
                  <IconCalendar style={{ width: 20, height: 20, color: "var(--stu-primary-contrast)" }} />
                </div>
                <div style={{ flex: 1, minWidth: 0 }}>
                  <div style={{ fontWeight: 700, fontSize: 14 }}>{s.title}</div>
                  <div className="stu-muted" style={{ fontSize: 12 }}>{formatYmd(s.date ?? null)}</div>
                </div>
              </Link>
            ))}
            {todaySessions.length > 3 && (
              <Link to="/student/sessions" className="stu-cta-link" style={{ fontSize: 13, paddingLeft: 4 }}>
                ë”ë³´ê¸°
              </Link>
            )}
          </div>
        )}
      </section>

      {/* ë¹ ë¥¸ ë©”ë‰´ */}
      <section>
        <h2 className="stu-muted" style={{ fontSize: 12, fontWeight: 800, marginBottom: "var(--stu-space-3)", paddingLeft: 4 }}>
          ë¹ ë¥¸ ë©”ë‰´
        </h2>
        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "var(--stu-space-4)" }}>
          <Link
            to="/student/video"
            className="stu-card stu-card--pressable"
            style={{ padding: "var(--stu-space-6)", textAlign: "center", textDecoration: "none", color: "inherit" }}
          >
            <IconPlay style={{ width: 28, height: 28, margin: "0 auto 8px", color: "var(--stu-primary)" }} />
            <div style={{ fontWeight: 800, fontSize: 14 }}>ì˜ìƒ</div>
          </Link>
          <Link
            to="/student/exams"
            className="stu-card stu-card--pressable"
            style={{ padding: "var(--stu-space-6)", textAlign: "center", textDecoration: "none", color: "inherit" }}
          >
            <IconExam style={{ width: 28, height: 28, margin: "0 auto 8px", color: "var(--stu-primary)" }} />
            <div style={{ fontWeight: 800, fontSize: 14 }}>ì‹œí—˜</div>
          </Link>
          <Link
            to="/student/grades"
            className="stu-card stu-card--pressable"
            style={{ padding: "var(--stu-space-6)", textAlign: "center", textDecoration: "none", color: "inherit" }}
          >
            <IconGrade style={{ width: 28, height: 28, margin: "0 auto 8px", color: "var(--stu-primary)" }} />
            <div style={{ fontWeight: 800, fontSize: 14 }}>ì„±ì </div>
          </Link>
          <Link
            to="/student/sessions"
            className="stu-card stu-card--pressable"
            style={{ padding: "var(--stu-space-6)", textAlign: "center", textDecoration: "none", color: "inherit" }}
          >
            <IconCalendar style={{ width: 28, height: 28, margin: "0 auto 8px", color: "var(--stu-primary)" }} />
            <div style={{ fontWeight: 800, fontSize: 14 }}>ì¼ì •</div>
          </Link>
        </div>
      </section>
    </div>
  );
}


==========================================================================================
# FILE: exams/api/assets.ts
==========================================================================================
// src/student/domains/exams/api/assets.ts
/**
 * âœ… Student Exam Assets API (LOCK v1)
 * - í•™ìƒì€ downloadë§Œ (ì—…ë¡œë“œëŠ” ê´€ë¦¬ì/êµì‚¬)
 * - asset_type ì˜ë¯¸ í•´ì„ âŒ
 */

import api from "@/student/shared/api/studentApi";

export type ExamAsset = {
  id: number;
  asset_type: string;
  download_url: string;
};

export async function fetchExamAssets(examId: number): Promise<ExamAsset[]> {
  const res = await api.get(`/exams/${examId}/assets/`);
  const data = res.data;
  if (Array.isArray(data?.items)) return data.items as ExamAsset[];
  if (Array.isArray(data)) return data as ExamAsset[];
  return [];
}


==========================================================================================
# FILE: exams/api/exams.ts
==========================================================================================
// PATH: src/student/domains/exams/api/exams.ts

import api from "@/student/shared/api/studentApi";

export type StudentExam = {
  id: number;
  title: string;
  open_at: string | null;
  close_at: string | null;
  allow_retake: boolean;
  max_attempts: number;
  pass_score: number;
  description?: string | null;
  session_id?: number | null;
};

export type ExamsListResponse = {
  items: StudentExam[];
};

export async function fetchStudentExams(): Promise<ExamsListResponse> {
  const res = await api.get("/student/exams/");
  const data = res.data;
  if (data?.items && Array.isArray(data.items)) return data as ExamsListResponse;
  if (Array.isArray(data)) return { items: data as StudentExam[] };
  return { items: [] };
}

export async function fetchStudentExam(examId: number): Promise<StudentExam> {
  const res = await api.get(`/student/exams/${examId}/`);
  return res.data as StudentExam;
}


==========================================================================================
# FILE: exams/api/results.ts
==========================================================================================
// PATH: src/student/domains/exams/api/results.ts

import api from "@/student/shared/api/studentApi";

export type MyExamResult = {
  exam_id: number;
  attempt_id: number;
  total_score: number;
  max_score: number;
  is_pass: boolean;
  submitted_at: string | null;
  can_retake: boolean;
};

export type MyExamResultItem = {
  question_id: number;
  question_number: number;
  student_answer: string | null;
  correct_answer: string | null;
  score: number;
  max_score: number;
  is_correct: boolean;
  meta?: Record<string, any>;
};

export async function fetchMyExamResult(examId: number): Promise<MyExamResult> {
  const res = await api.get(`/student/results/me/exams/${examId}/`);
  return res.data as MyExamResult;
}

export async function fetchMyExamResultItems(
  examId: number
): Promise<MyExamResultItem[]> {
  const res = await api.get(`/student/results/me/exams/${examId}/items/`);
  const data = res.data;
  if (Array.isArray(data?.items)) return data.items as MyExamResultItem[];
  if (Array.isArray(data)) return data as MyExamResultItem[];
  return [];
}


==========================================================================================
# FILE: exams/components/ExamActionButton.tsx
==========================================================================================
// PATH: src/student/domains/exams/components/ExamActionButton.tsx

import { Link } from "react-router-dom";

export type ExamActionButtonProps = {
  to: string;
  label: string;
  disabled?: boolean;
};

export default function ExamActionButton({
  to,
  label,
  disabled,
}: ExamActionButtonProps) {
  if (disabled) {
    return (
      <div className="stu-muted" style={{ fontSize: 14 }}>
        {label}
      </div>
    );
  }

  return (
    <Link to={to} className="stu-cta-link">
      {label}
    </Link>
  );
}


==========================================================================================
# FILE: exams/components/ExamCard.tsx
==========================================================================================
// PATH: src/student/domains/exams/components/ExamActionButton.tsx

import { Link } from "react-router-dom";

export type ExamActionButtonProps = {
  to: string;
  label: string;
  disabled?: boolean;
};

export default function ExamActionButton({
  to,
  label,
  disabled,
}: ExamActionButtonProps) {
  if (disabled) {
    return (
      <div
        style={{
          padding: "10px 14px",
          borderRadius: 12,
          border: "1px solid var(--stu-border)",
          background: "var(--stu-surface)",
          color: "var(--stu-text-muted)",
          fontWeight: 800,
          opacity: 0.5,
        }}
      >
        {label}
      </div>
    );
  }

  return (
    <Link
      to={to}
      style={{
        padding: "10px 14px",
        borderRadius: 12,
        border: "1px solid var(--stu-border)",
        background: "var(--stu-primary, #111)",
        color: "#fff",
        fontWeight: 900,
        textDecoration: "none",
        display: "inline-block",
      }}
    >
      {label}
    </Link>
  );
}


==========================================================================================
# FILE: exams/components/ExamResultItems.tsx
==========================================================================================
// PATH: src/student/domains/exams/components/ExamResultItems.tsx

import { MyExamResultItem } from "../api/results";

export default function ExamResultItems({
  items,
}: {
  items: MyExamResultItem[];
}) {
  return (
    <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
      {items.map((it) => (
        <div
          key={`${it.question_id}-${it.question_number}`}
          style={{
            border: "1px solid var(--stu-border)",
            borderRadius: 12,
            padding: 12,
            background: "var(--stu-surface)",
          }}
        >
          <div style={{ fontWeight: 900 }}>
            Q{it.question_number}
          </div>

          <div
            style={{
              fontSize: 13,
              marginTop: 6,
              color: it.is_correct ? "#087443" : "#b00020",
              fontWeight: 800,
            }}
          >
            {it.is_correct ? "ì •ë‹µ" : "ì˜¤ë‹µ"} Â· {it.score}/{it.max_score}
          </div>

          <div
            style={{
              fontSize: 12,
              marginTop: 6,
              color: "var(--stu-text-muted)",
            }}
          >
            ë‚´ ë‹µ: {it.student_answer ?? "-"} / ì •ë‹µ:{" "}
            {it.correct_answer ?? "-"}
          </div>
        </div>
      ))}
    </div>
  );
}


==========================================================================================
# FILE: exams/components/ExamResultSummary.tsx
==========================================================================================
// PATH: src/student/domains/exams/components/ExamResultSummary.tsx

import { MyExamResult } from "../api/results";

export default function ExamResultSummary({
  result,
}: {
  result: MyExamResult;
}) {
  const pass = result.is_pass;

  return (
    <div
      className="stu-card"
      style={{
        display: "flex",
        justifyContent: "space-between",
        alignItems: "center",
        gap: 12,
      }}
    >
      <div>
        <div style={{ fontSize: 22, fontWeight: 900 }}>
          {result.total_score} / {result.max_score}
        </div>
        <div style={{ fontSize: 12, color: "var(--stu-text-muted)" }}>
          attempt #{result.attempt_id}
        </div>
      </div>

      <div
        style={{
          padding: "6px 12px",
          borderRadius: 999,
          fontWeight: 900,
          fontSize: 13,
          background: pass ? "#e7fff1" : "#ffecec",
          color: pass ? "#087443" : "#b00020",
        }}
      >
        {pass ? "PASS" : "FAIL"}
      </div>
    </div>
  );
}


==========================================================================================
# FILE: exams/hooks/useMyExamResult.ts
==========================================================================================
// src/student/domains/exams/hooks/useMyExamResult.ts
/**
 * âœ… useMyExamResult (LOCK v1)
 */

import { useQuery } from "@tanstack/react-query";
import { fetchMyExamResult } from "@/student/domains/exams/api/results";

export function useMyExamResult(examId?: number) {
  const safeId = Number(examId);

  return useQuery({
    queryKey: ["my-exam-result", safeId],
    queryFn: () => fetchMyExamResult(safeId),
    enabled: Number.isFinite(safeId),
  });
}


==========================================================================================
# FILE: exams/hooks/useMyExamResultItems.ts
==========================================================================================
// src/student/domains/exams/hooks/useMyExamResultItems.ts
/**
 * âœ… useMyExamResultItems (LOCK v1)
 */

import { useQuery } from "@tanstack/react-query";
import { fetchMyExamResultItems } from "@/student/domains/exams/api/results";

export function useMyExamResultItems(examId?: number) {
  const safeId = Number(examId);

  return useQuery({
    queryKey: ["my-exam-result-items", safeId],
    queryFn: () => fetchMyExamResultItems(safeId),
    enabled: Number.isFinite(safeId),
  });
}


==========================================================================================
# FILE: exams/hooks/useStudentExams.ts
==========================================================================================
// src/student/domains/exams/hooks/useStudentExams.ts
/**
 * âœ… useStudentExams / useStudentExam
 */

import { useQuery } from "@tanstack/react-query";
import { fetchStudentExam, fetchStudentExams } from "@/student/domains/exams/api/exams";

export function useStudentExams(params?: { session_id?: number }) {
  const sessionId = params?.session_id;
  const enabled = sessionId == null ? true : Number.isFinite(Number(sessionId));

  return useQuery({
    queryKey: ["student-exams", params ?? {}],
    queryFn: () => fetchStudentExams(params),
    enabled,
  });
}

export function useStudentExam(examId?: number) {
  const safeId = Number(examId);
  return useQuery({
    queryKey: ["student-exam", safeId],
    queryFn: () => fetchStudentExam(safeId),
    enabled: Number.isFinite(safeId),
  });
}


==========================================================================================
# FILE: exams/pages/ExamDetailPage.tsx
==========================================================================================
// src/student/domains/exams/pages/ExamDetailPage.tsx
/**
 * âœ… ExamDetailPage (í•™ìƒ)
 * - ìì‚° ë‹¤ìš´ë¡œë“œ + ê²°ê³¼/ì œì¶œ ì§„ì…
 *
 * ì›ì¹™:
 * - ì‘ì‹œ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ í”„ë¡ íŠ¸ì—ì„œ íŒë‹¨ âŒ
 * - "ì¬ì‹œí—˜ ë²„íŠ¼" íŒë‹¨ì€ Result APIì˜ can_retakeë§Œ ì‹ ë¢° âœ…
 */

import { Link, useParams } from "react-router-dom";
import StudentPageShell from "../../../shared/ui/pages/StudentPageShell";
import EmptyState from "../../../shared/ui/layout/EmptyState";
import { useStudentExam } from "@/student/domains/exams/hooks/useStudentExams";
import { useMyExamResult } from "@/student/domains/exams/hooks/useMyExamResult";
import { useQuery } from "@tanstack/react-query";
import { fetchExamAssets } from "@/student/domains/exams/api/assets";

export default function ExamDetailPage() {
  const { examId } = useParams();
  const safeId = Number(examId);

  const examQ = useStudentExam(Number.isFinite(safeId) ? safeId : undefined);

  // âœ… ê²°ê³¼ëŠ” "ë‹¨ì¼ ì§„ì‹¤": can_retake í¬í•¨
  const resultQ = useMyExamResult(Number.isFinite(safeId) ? safeId : undefined);

  // âœ… ìì‚° ëª©ë¡
  const assetsQ = useQuery({
    queryKey: ["student-exam-assets", safeId],
    queryFn: () => fetchExamAssets(safeId),
    enabled: Number.isFinite(safeId),
  });

  if (!Number.isFinite(safeId)) {
    return (
      <StudentPageShell title="ì‹œí—˜" description="ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.">
        <EmptyState title="ì‹œí—˜ IDê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  if (examQ.isLoading) {
    return (
      <StudentPageShell title="ì‹œí—˜" description="ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...">
        <div style={{ fontSize: 14, color: "#666" }}>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </StudentPageShell>
    );
  }

  if (examQ.isError || !examQ.data) {
    return (
      <StudentPageShell title="ì‹œí—˜" description="ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.">
        <EmptyState title="ì‹œí—˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  const exam = examQ.data;
  const canRetake = typeof resultQ.data?.can_retake === "boolean" ? resultQ.data.can_retake : true;

  return (
    <StudentPageShell
      title={exam.title}
      description="ì œì¶œ / ê²°ê³¼ ì¡°íšŒ"
      actions={
        <Link to="/student/exams" className="stu-cta-link">
          ëª©ë¡
        </Link>
      }
    >
      <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
        {/* ===== Assets ===== */}
        {/* ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ ì œê±°ë¨ (ì˜ë„ì ìœ¼ë¡œ ë¯¸ì œê³µ) */}

        {/* ===== Actions ===== */}
        <div className="stu-section">
          <div className="stu-section-header" style={{ fontWeight: 700, fontSize: 15 }}>
            ì‘ì‹œ / ê²°ê³¼
          </div>

          <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-4)" }}>
            <Link to={`/student/exams/${exam.id}/result`} className="stu-cta-link">
              ê²°ê³¼ ë³´ê¸°
            </Link>

            {/* âœ… can_retakeë§Œ ì‹ ë¢° */}
            {canRetake ? (
              <Link to={`/student/exams/${exam.id}/submit`} className="stu-cta-link">
                ì œì¶œí•˜ê¸°
              </Link>
            ) : (
              <div className="stu-muted" style={{ fontSize: 13 }}>
                ì¬ì‹œí—˜ ë¶ˆê°€
              </div>
            )}
          </div>

          <div style={{ marginTop: "var(--stu-space-6)", fontSize: 12, color: "var(--stu-text-muted)" }}>
            â€» ì¬ì‹œí—˜ ê°€ëŠ¥ ì—¬ë¶€ëŠ” ê²°ê³¼ APIì˜ <b>can_retake</b>ë§Œ ì‹ ë¢°í•©ë‹ˆë‹¤.
          </div>
        </div>
      </div>
    </StudentPageShell>
  );
}

// ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ ì œê±°ë¨ (ì˜ë„ì ìœ¼ë¡œ ë¯¸ì œê³µ)
// Surface ê¸°ë°˜ ìŠ¤íƒ€ì¼ì€ base.cssì˜ .stu-section ì‚¬ìš©


==========================================================================================
# FILE: exams/pages/ExamListPage.tsx
==========================================================================================
// PATH: src/student/domains/exams/pages/ExamListPage.tsx
import StudentPageShell from "@/student/shared/ui/pages/StudentPageShell";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import { useStudentExams } from "../hooks/useStudentExams";
import ExamCard from "../components/ExamCard";

export default function ExamListPage() {
  const { data, isLoading, isError } = useStudentExams();
  const items = data?.items ?? [];

  return (
    <StudentPageShell title="ì‹œí—˜">
      {isLoading && <div>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>}
      {isError && <EmptyState title="ì‹œí—˜ ëª©ë¡ ì˜¤ë¥˜" />}

      {items.length === 0 && (
        <EmptyState title="ì‹œí—˜ì´ ì—†ìŠµë‹ˆë‹¤." />
      )}

      <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
        {items.map((e) => (
          <ExamCard key={e.id} exam={e} />
        ))}
      </div>
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: exams/pages/ExamResultPage.tsx
==========================================================================================
// src/student/domains/exams/pages/ExamResultPage.tsx
/**
 * âœ… ExamResultPage (í•™ìƒ ê²°ê³¼)
 * - ëŒ€í‘œ Result + ResultItem(ë¬¸í•­ë³„) ë Œë”ë§
 * - íŒë‹¨/ê³„ì‚° âŒ
 * - can_retake / is_pass ê·¸ëŒ€ë¡œ ì‚¬ìš© âœ…
 */

import { Link, useParams } from "react-router-dom";
import StudentPageShell from "../../../shared/ui/pages/StudentPageShell";
import EmptyState from "../../../shared/ui/layout/EmptyState";
import { useMyExamResult } from "@/student/domains/exams/hooks/useMyExamResult";
import { useMyExamResultItems } from "@/student/domains/exams/hooks/useMyExamResultItems";

export default function ExamResultPage() {
  const { examId } = useParams();
  const safeId = Number(examId);

  const resultQ = useMyExamResult(Number.isFinite(safeId) ? safeId : undefined);
  const itemsQ = useMyExamResultItems(Number.isFinite(safeId) ? safeId : undefined);

  if (!Number.isFinite(safeId)) {
    return (
      <StudentPageShell title="ì‹œí—˜ ê²°ê³¼" description="ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.">
        <EmptyState title="ì‹œí—˜ IDê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  if (resultQ.isLoading) {
    return (
      <StudentPageShell title="ì‹œí—˜ ê²°ê³¼" description="ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...">
        <div style={{ fontSize: 14, color: "#666" }}>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </StudentPageShell>
    );
  }

  if (resultQ.isError || !resultQ.data) {
    return (
      <StudentPageShell title="ì‹œí—˜ ê²°ê³¼" description="ì¡°íšŒ ì‹¤íŒ¨">
        <EmptyState
          title="ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤."
          description="ì•„ì§ ì±„ì  ì „ì´ê±°ë‚˜ ê¶Œí•œ/ë°ì´í„°ê°€ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
        />
      </StudentPageShell>
    );
  }

  const r = resultQ.data;

  return (
    <StudentPageShell
      title="ì‹œí—˜ ê²°ê³¼"
      description={`exam_id: ${r.exam_id} Â· attempt_id: ${r.attempt_id}`}
      actions={
        <Link to={`/student/exams/${safeId}`} style={linkBtn}>
          ì‹œí—˜ìœ¼ë¡œ
        </Link>
      }
    >
      <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
        {/* ===== Summary ===== */}
        <div style={card}>
          <div style={{ fontWeight: 900 }}>ìš”ì•½</div>

          <div style={{ marginTop: 8, display: "flex", gap: 10, alignItems: "center" }}>
            <div style={{ fontSize: 22, fontWeight: 900 }}>
              {r.total_score} / {r.max_score}
            </div>

            <span
              style={{
                padding: "4px 8px",
                borderRadius: 999,
                fontSize: 12,
                fontWeight: 900,
                background: r.is_pass ? "#e8fff0" : "#ffecec",
                color: r.is_pass ? "#0a7a38" : "#b10000",
              }}
            >
              {r.is_pass ? "í†µê³¼" : "ë¯¸í†µê³¼"}
            </span>
          </div>

          <div style={{ marginTop: 8, fontSize: 13, color: "#666" }}>
            submitted_at: {r.submitted_at ?? "-"}
          </div>

          <div style={{ marginTop: 8, fontSize: 13, color: "#666" }}>
            can_retake: <b>{String(r.can_retake)}</b>
          </div>
        </div>

        {/* ===== Items ===== */}
        <div style={card}>
          <div style={{ fontWeight: 900, marginBottom: 8 }}>ë¬¸í•­ë³„ ê²°ê³¼</div>

          {itemsQ.isLoading && <div style={{ fontSize: 13, color: "#666" }}>ë¬¸í•­ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>}
          {itemsQ.isError && <div style={{ fontSize: 13, color: "#c00" }}>ë¬¸í•­ ì¡°íšŒ ì‹¤íŒ¨</div>}

          {itemsQ.data && itemsQ.data.length === 0 && (
            <div style={{ fontSize: 13, color: "#777" }}>ë¬¸í•­ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
          )}

          {itemsQ.data && itemsQ.data.length > 0 && (
            <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
              {itemsQ.data.map((it) => (
                <div
                  key={`${it.question_id}-${it.question_number}`}
                  style={{
                    border: "1px solid #eee",
                    borderRadius: 10,
                    padding: 10,
                    background: "#fafafa",
                  }}
                >
                  <div style={{ fontWeight: 900 }}>
                    Q{it.question_number} (id:{it.question_id})
                  </div>
                  <div style={{ marginTop: 6, fontSize: 13, color: "#444" }}>
                    ì •ì˜¤: <b>{it.is_correct ? "ì •ë‹µ" : "ì˜¤ë‹µ"}</b>
                    {" Â· "}
                    ì ìˆ˜: <b>{it.score}</b> / {it.max_score}
                  </div>
                  <div style={{ marginTop: 6, fontSize: 13, color: "#666" }}>
                    ë‚´ ë‹µ: {it.student_answer ?? "-"} / ì •ë‹µ: {it.correct_answer ?? "-"}
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    </StudentPageShell>
  );
}

const card: React.CSSProperties = {
  border: "1px solid #eee",
  borderRadius: 12,
  padding: 14,
  background: "#fff",
};

const linkBtn: React.CSSProperties = {
  display: "inline-block",
  padding: "10px 12px",
  borderRadius: 10,
  border: "1px solid #ddd",
  textDecoration: "none",
  background: "#fafafa",
  color: "#111",
  fontWeight: 800,
};


==========================================================================================
# FILE: exams/pages/ExamSubmitPage.tsx
==========================================================================================
// src/student/domains/exams/pages/ExamSubmitPage.tsx
/**
 * âœ… ExamSubmitPage (í•™ìƒ ì œì¶œ)
 *
 * âš ï¸ ì¤‘ìš”:
 * - Submission feature ì¬ì‚¬ìš©ì´ ì›ì¹™(C)
 * - ë‹¤ë§Œ ì´ í”„ë¡œì íŠ¸ëŠ” submissions êµ¬í˜„ì´ ì—¬ëŸ¬ ë²„ì „ì´ ì„ì—¬ìˆì„ ìˆ˜ ìˆì–´,
 *   "ì»´íŒŒì¼ ì•ˆì • + ìµœì†Œ UX" ê¸°ì¤€ìœ¼ë¡œ í™”ë©´ ê³¨ê²©ë§Œ ì œê³µí•œë‹¤.
 *
 * ì—¬ê¸°ì„œëŠ”:
 * - ì œì¶œì€ /features/submissions ë¡œ ì´ì‹/ì—°ê²°í•˜ê¸° ì‰¬ìš´ í˜•íƒœë¡œë§Œ ë‘”ë‹¤.
 * - í”„ë¡ íŠ¸ì—ì„œ ìƒíƒœ íŒë‹¨/ê³„ì‚° âŒ
 * - ì œì¶œ ì™„ë£Œ í›„: Result refetch/ì´ë™ âœ…
 */

import { Link, useNavigate, useParams } from "react-router-dom";
import StudentPageShell from "../../../shared/ui/pages/StudentPageShell";
import EmptyState from "../../../shared/ui/layout/EmptyState";

export default function ExamSubmitPage() {
  const { examId } = useParams();
  const safeId = Number(examId);
  const nav = useNavigate();

  if (!Number.isFinite(safeId)) {
    return (
      <StudentPageShell title="ì œì¶œ" description="ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.">
        <EmptyState title="ì‹œí—˜ IDê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  return (
    <StudentPageShell
      title="ì‹œí—˜ ì œì¶œ"
      description="OMR/ë‹µì•ˆ ì œì¶œì€ submissions featureë¡œ ì—°ê²°ë©ë‹ˆë‹¤."
      actions={
        <Link to={`/student/exams/${safeId}`} style={linkBtn}>
          ë’¤ë¡œ
        </Link>
      }
    >
      <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
        <div style={card}>
          <div style={{ fontWeight: 900 }}>ì œì¶œ UX (MVP)</div>
          <div style={{ marginTop: 8, fontSize: 13, color: "#666" }}>
            âœ… ì´ í™”ë©´ì€ â€œì œì¶œå…¥å£â€ë§Œ ë‹´ë‹¹í•©ë‹ˆë‹¤. ì‹¤ì œ ì—…ë¡œë“œ/í´ë§ì€
            <code>features/submissions</code>ë¥¼ ì¬ì‚¬ìš©í•´ì„œ ë¶™ì´ì„¸ìš”.
          </div>

          <div style={{ marginTop: 12, fontSize: 13, color: "#666" }}>
            - ì—…ë¡œë“œ ì„±ê³µ â†’ í´ë§ DONE â†’ ê²°ê³¼ í˜ì´ì§€ ì´ë™
            <br />- FAILED â†’ ì¬ì—…ë¡œë“œ ìœ ë„
          </div>

          <div style={{ marginTop: 12 }}>
            <button
              type="button"
              style={btnStyle}
              onClick={() => {
                // âœ… ì‹¤ì œ êµ¬í˜„ì€ submissionsë¡œ ë¶™ì´ë©´ ë¨
                // ì§€ê¸ˆì€ ë„¤ë¹„ UXë§Œ
                nav(`/student/exams/${safeId}/result`);
              }}
            >
              (ì„ì‹œ) ì œì¶œ ì™„ë£Œ ì²˜ë¦¬
            </button>
          </div>
        </div>

        <div style={{ fontSize: 12, color: "#777" }}>
          â€» ì—¬ê¸°ì„œ ì •ì±…/ì±„ì /ê²°ê³¼ íŒë‹¨ì„ í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤. ë°±ì—”ë“œê°€ ë‹¨ì¼ ì§„ì‹¤ì…ë‹ˆë‹¤.
        </div>
      </div>
    </StudentPageShell>
  );
}

const card: React.CSSProperties = {
  border: "1px solid #eee",
  borderRadius: 12,
  padding: 14,
  background: "#fff",
};

const linkBtn: React.CSSProperties = {
  display: "inline-block",
  padding: "10px 12px",
  borderRadius: 10,
  border: "1px solid #ddd",
  textDecoration: "none",
  background: "#fafafa",
  color: "#111",
  fontWeight: 800,
};

const btnStyle: React.CSSProperties = {
  padding: "10px 12px",
  borderRadius: 10,
  border: "1px solid #ddd",
  background: "#111",
  color: "#fff",
  fontWeight: 800,
};


==========================================================================================
# FILE: grades/api/grades.ts
==========================================================================================



==========================================================================================
# FILE: grades/components/GradeBadge.tsx
==========================================================================================



==========================================================================================
# FILE: grades/components/GradeRow.tsx
==========================================================================================



==========================================================================================
# FILE: grades/pages/GradeDetailPage.tsx
==========================================================================================



==========================================================================================
# FILE: grades/pages/GradeListPage.tsx
==========================================================================================



==========================================================================================
# FILE: grades/pages/GradesPage.tsx
==========================================================================================
/**
 * ì„±ì  â€” ì‹œí—˜Â·ê³¼ì œ ê²°ê³¼ í—ˆë¸Œ (ëŒ€í˜•í•™ì› SaaS)
 */
import { Link } from "react-router-dom";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import { IconGrade, IconExam, IconChevronRight } from "@/student/shared/ui/icons/Icons";

export default function GradesPage() {
  return (
    <div style={{ padding: "var(--stu-space-2) 0" }}>
      <h1 style={{ fontSize: 20, fontWeight: 800, marginBottom: "var(--stu-space-6)", paddingLeft: "var(--stu-space-2)" }}>
        ì„±ì 
      </h1>

      <Link
        to="/student/exams"
        className="stu-card stu-card--pressable"
        style={{
          display: "flex",
          alignItems: "center",
          gap: "var(--stu-space-4)",
          marginBottom: "var(--stu-space-4)",
          textDecoration: "none",
          color: "inherit",
        }}
      >
        <div style={{ width: 44, height: 44, borderRadius: 12, background: "var(--stu-surface-soft)", display: "grid", placeItems: "center" }}>
          <IconExam style={{ width: 24, height: 24, color: "var(--stu-primary)" }} />
        </div>
        <div style={{ flex: 1, minWidth: 0 }}>
          <div style={{ fontWeight: 800, fontSize: 15 }}>ì‹œí—˜ ê²°ê³¼</div>
          <div className="stu-muted" style={{ fontSize: 13, marginTop: 2 }}>ì‘ì‹œí•œ ì‹œí—˜ì˜ ì±„ì  ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”</div>
        </div>
        <IconChevronRight style={{ width: 20, height: 20, color: "var(--stu-text-muted)" }} />
      </Link>

      <div className="stu-section stu-section--nested">
        <EmptyState
          title="ì„±ì  ìš”ì•½"
          description="ì‹œí—˜ ê²°ê³¼ëŠ” ìœ„ 'ì‹œí—˜ ê²°ê³¼'ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³¼ì œÂ·ì¶œê²° ì¢…í•© ì„±ì ì€ ì¶”í›„ ì œê³µë©ë‹ˆë‹¤."
        />
      </div>
    </div>
  );
}


==========================================================================================
# FILE: media/api/media.ts
==========================================================================================
// PATH: C:\academyfront\src\student\domains\media\api\media.ts
import api from "@/student/shared/api/studentApi";
import type { AccessMode, VideoRule } from "@/features/videos/types/access-mode";

export type StudentVideoRule = VideoRule; // Legacy type

/** GET /student/video/me/ ì‘ë‹µ â€” ì˜ìƒ íƒ­ìš© */
export type StudentVideoMeSession = {
  id: number;
  title: string;
  order: number;
  date: string | null;
};
export type StudentVideoMeLecture = {
  id: number;
  title: string;
  sessions: StudentVideoMeSession[];
};
export type StudentVideoMePublic = {
  session_id: number;
  lecture_id: number;
} | null;
export type StudentVideoMeResponse = {
  public: StudentVideoMePublic;
  lectures: StudentVideoMeLecture[];
};

export async function fetchVideoMe(): Promise<StudentVideoMeResponse> {
  const res = await api.get<StudentVideoMeResponse>("/student/video/me/");
  const d = res.data;
  return {
    public: d?.public ?? null,
    lectures: Array.isArray(d?.lectures) ? d.lectures : [],
  };
}

export type StudentVideoListItem = {
  id: number;
  session_id: number;
  title: string;
  status: string;
  thumbnail_url?: string | null;
  duration?: number | null;

  allow_skip: boolean;
  max_speed: number;
  show_watermark: boolean;
  effective_rule: StudentVideoRule; // Legacy field
  access_mode?: AccessMode; // New field
};

export type StudentSessionVideosResponse = {
  items: StudentVideoListItem[];
};

export type StudentVideoPlayback = {
  video: StudentVideoListItem;
  hls_url?: string | null;
  mp4_url?: string | null;
  policy: {
    allow_seek?: boolean;
    seek?: {
      mode?: "free" | "blocked" | "bounded_forward";
      forward_limit?: "max_watched" | null;
      grace_seconds?: number;
    };
    playback_rate?: {
      max?: number;
      ui_control?: boolean;
    };
    watermark?: {
      enabled?: boolean;
      mode?: "overlay";
      fields?: string[];
    };
    concurrency?: {
      max_sessions?: number;
      max_devices?: number;
    };
    access_mode?: AccessMode; // New field
  };
};

export async function fetchStudentSessionVideos(
  sessionId: number,
  enrollmentId?: number | null
): Promise<StudentSessionVideosResponse> {
  const res = await api.get(`/student/video/sessions/${sessionId}/videos/`, {
    params: enrollmentId ? { enrollment: enrollmentId } : undefined,
  });
  const d = res.data;
  return {
    items: Array.isArray(d?.items) ? d.items : [],
  };
}

export async function fetchStudentVideoPlayback(
  videoId: number,
  enrollmentId?: number | null
): Promise<StudentVideoPlayback> {
  const params: Record<string, string> = {};
  if (enrollmentId) {
    params.enrollment = String(enrollmentId);
  }
  const res = await api.get(`/student/video/videos/${videoId}/playback/`, {
    params: Object.keys(params).length > 0 ? params : undefined,
  });
  return res.data as StudentVideoPlayback;
}


==========================================================================================
# FILE: media/components/CourseCard.tsx
==========================================================================================
// PATH: src/student/domains/media/components/CourseCard.tsx
// í”„ë¦¬ë¯¸ì—„ SaaS ì¸ê°• ëŠë‚Œì˜ ì½”ìŠ¤ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸

import { Link } from "react-router-dom";
import { IconPlay, IconChevronRight } from "@/student/shared/ui/icons/Icons";

type CourseCardProps = {
  title: string;
  thumbnailUrl?: string | null;
  videoCount?: number;
  totalDuration?: number; // seconds
  progress?: number; // 0-100
  isNew?: boolean;
  isContinue?: boolean;
  isCompleted?: boolean;
  to: string;
  onClick?: () => void;
};

function formatDuration(sec: number | null | undefined): string {
  if (sec == null || sec <= 0) return "0ë¶„";
  const h = Math.floor(sec / 3600);
  const m = Math.floor((sec % 3600) / 60);
  if (h > 0) return `${h}ì‹œê°„ ${m}ë¶„`;
  return `${m}ë¶„`;
}

export default function CourseCard({
  title,
  thumbnailUrl,
  videoCount = 0,
  totalDuration,
  progress = 0,
  isNew = false,
  isContinue = false,
  isCompleted = false,
  to,
  onClick,
}: CourseCardProps) {
  const Component = onClick ? "button" : Link;
  const props = onClick
    ? { onClick, type: "button" as const }
    : { to, style: { textDecoration: "none", color: "inherit" } };

  return (
    <Component
      {...props}
      className="course-card stu-section stu-section--pressable"
      style={{
        display: "block",
        width: "100%",
        borderRadius: "var(--stu-radius-md)",
        overflow: "hidden",
        padding: 0,
        textAlign: "left",
      }}
    >
      {/* ì¸ë„¤ì¼ ì˜ì—­ */}
      <div
        style={{
          position: "relative",
          width: "100%",
          aspectRatio: "16/9",
          background: "var(--stu-surface-soft)",
          overflow: "hidden",
        }}
      >
        {thumbnailUrl ? (
          <img
            src={thumbnailUrl}
            alt={title}
            style={{
              width: "100%",
              height: "100%",
              objectFit: "cover",
            }}
          />
        ) : (
          <div
            style={{
              width: "100%",
              height: "100%",
              display: "grid",
              placeItems: "center",
              background: "linear-gradient(135deg, var(--stu-surface-soft) 0%, var(--stu-surface) 100%)",
            }}
          >
            <IconPlay style={{ width: 48, height: 48, color: "var(--stu-text-muted)", opacity: 0.5 }} />
          </div>
        )}
        
        {/* ì¬ìƒ ì˜¤ë²„ë ˆì´ */}
        <div
          style={{
            position: "absolute",
            inset: 0,
            display: "grid",
            placeItems: "center",
            background: "rgba(0,0,0,0.3)",
            opacity: 0,
            transition: "opacity 0.2s ease",
          }}
          onMouseEnter={(e) => {
            e.currentTarget.style.opacity = "1";
          }}
          onMouseLeave={(e) => {
            e.currentTarget.style.opacity = "0";
          }}
        >
          <div
            style={{
              width: 64,
              height: 64,
              borderRadius: "50%",
              background: "rgba(255,255,255,0.9)",
              display: "grid",
              placeItems: "center",
              transform: "scale(0.9)",
              transition: "transform 0.2s ease",
            }}
          >
            <IconPlay style={{ width: 28, height: 28, color: "#000", marginLeft: 2 }} />
          </div>
        </div>

        {/* ì§„í–‰ë¥  ë°” */}
        {progress > 0 && (
          <div
            style={{
              position: "absolute",
              bottom: 0,
              left: 0,
              right: 0,
              height: 4,
              background: "rgba(0,0,0,0.3)",
            }}
          >
            <div
              style={{
                height: "100%",
                width: `${progress}%`,
                background: "var(--stu-primary)",
                transition: "width 0.3s ease",
              }}
            />
          </div>
        )}

        {/* ë±ƒì§€ */}
        {(isNew || isContinue || isCompleted) && (
          <div
            style={{
              position: "absolute",
              top: 8,
              right: 8,
              display: "flex",
              gap: 4,
            }}
          >
            {isNew && (
              <span
                style={{
                  padding: "4px 8px",
                  borderRadius: 4,
                  background: "#ef4444",
                  color: "#fff",
                  fontSize: 10,
                  fontWeight: 700,
                  textTransform: "uppercase",
                }}
              >
                NEW
              </span>
            )}
            {isContinue && (
              <span
                style={{
                  padding: "4px 8px",
                  borderRadius: 4,
                  background: "var(--stu-primary)",
                  color: "#fff",
                  fontSize: 10,
                  fontWeight: 700,
                }}
              >
                ì´ì–´ë³´ê¸°
              </span>
            )}
            {isCompleted && (
              <span
                style={{
                  padding: "4px 8px",
                  borderRadius: 4,
                  background: "#22c55e",
                  color: "#fff",
                  fontSize: 10,
                  fontWeight: 700,
                }}
              >
                ì™„ë£Œ
              </span>
            )}
          </div>
        )}
      </div>

      {/* ì •ë³´ ì˜ì—­ */}
      <div style={{ padding: "var(--stu-space-6)" }}>
        <h3
          style={{
            fontSize: 16,
            fontWeight: 700,
            margin: 0,
            marginBottom: "var(--stu-space-2)",
            overflow: "hidden",
            textOverflow: "ellipsis",
            whiteSpace: "nowrap",
            color: "var(--stu-text)",
          }}
        >
          {title}
        </h3>
        <div
          style={{
            display: "flex",
            alignItems: "center",
            gap: "var(--stu-space-2)",
            fontSize: 13,
            color: "var(--stu-text-muted)",
          }}
        >
          {videoCount > 0 && <span>ì´ {videoCount}ê°•</span>}
          {videoCount > 0 && totalDuration && <span>Â·</span>}
          {totalDuration && <span>{formatDuration(totalDuration)}</span>}
          {progress > 0 && (
            <>
              <span>Â·</span>
              <span>ì§„í–‰ë¥  {Math.round(progress)}%</span>
            </>
          )}
        </div>
      </div>
    </Component>
  );
}


==========================================================================================
# FILE: media/pages/MediaDemoPage.tsx
==========================================================================================
// PATH: src/student/domains/media/pages/MediaDemoPage.tsx
/**
 * ğŸš‘ MediaDemoPage (TEMP / DEMO ONLY)
 *
 * - ëª¨ë°”ì¼ í•™ìƒ ì˜ìƒ í™”ë©´ ë°ëª¨
 * - í™ë³´ / ìº¡ì³ / ê¸°íš ê²€ì¦ ì „ìš©
 * - ì „ì—­ ë””ìì¸, í† í°, í…Œë§ˆ ì „ë¶€ ë¬´ì‹œ
 * - "ëŒ€ê¸°ì—… í•™ìƒ ì•±" ëŠë‚Œìœ¼ë¡œ ì‹œê°ì  ì™„ì„±ë„ë§Œ ì§‘ì¤‘
 *
 * âš  ì‹¤ì œ ê¸°ëŠ¥ ì—†ìŒ
 */

export default function MediaDemoPage() {
  return (
    <div
      style={{
        minHeight: "100vh",
        background:
          "linear-gradient(180deg, #0b1220 0%, #0e1628 100%)",
        display: "flex",
        justifyContent: "center",
        padding: "24px 0",
        boxSizing: "border-box",
      }}
    >
      {/* ğŸ“± Mobile Frame */}
      <div
        style={{
          width: 390, // iPhone 14 Pro ê¸°ì¤€
          background: "#0f172a",
          borderRadius: 28,
          overflow: "hidden",
          boxShadow: "0 40px 80px rgba(0,0,0,0.45)",
          color: "#e5e7eb",
        }}
      >
        {/* ìƒë‹¨ í—¤ë” */}
        <div
          style={{
            padding: "16px 18px",
            display: "flex",
            alignItems: "center",
            justifyContent: "space-between",
            borderBottom: "1px solid rgba(255,255,255,0.08)",
            background: "rgba(15,23,42,0.9)",
            backdropFilter: "blur(8px)",
          }}
        >
          <div>
            <div style={{ fontSize: 14, fontWeight: 700 }}>
              ê³¼í•™ ì‹¬í™” Â· ìƒëª…ê³¼í•™
            </div>
            <div style={{ fontSize: 12, opacity: 0.6 }}>
              1ê°• Â· ìƒëª… ê³¼í•™ì˜ ì´í•´ (OT)
            </div>
          </div>
          <div
            style={{
              fontSize: 12,
              padding: "4px 10px",
              borderRadius: 999,
              background: "rgba(255,255,255,0.08)",
            }}
          >
            Q&A
          </div>
        </div>

        {/* â–¶ ì˜ìƒ ì˜ì—­ */}
        <div
          style={{
            background: "#000",
            aspectRatio: "16 / 9",
            position: "relative",
          }}
        >
          {/* í”Œë ˆì´ ë²„íŠ¼ */}
          <div
            style={{
              position: "absolute",
              inset: 0,
              display: "flex",
              alignItems: "center",
              justifyContent: "center",
              fontSize: 52,
              color: "#fff",
              opacity: 0.9,
            }}
          >
            â–¶
          </div>

          {/* ì§„í–‰ë°” */}
          <div
            style={{
              position: "absolute",
              left: 12,
              right: 12,
              bottom: 12,
              height: 4,
              background: "rgba(255,255,255,0.25)",
              borderRadius: 999,
            }}
          >
            <div
              style={{
                width: "27%",
                height: "100%",
                background:
                  "linear-gradient(90deg, #38bdf8, #60a5fa)",
                borderRadius: 999,
              }}
            />
          </div>
        </div>

        {/* ë³¸ë¬¸ */}
        <div style={{ padding: 18, display: "flex", flexDirection: "column", gap: 14 }}>
          {/* ì‹œì²­ ìƒíƒœ ì¹´ë“œ */}
          <Card>
            <Row label="ì‹œì²­ ì§„í–‰ë¥ " value="27%" />
            <Row label="ëˆ„ì  ì‹œì²­" value="5ë¶„ 12ì´ˆ" />
            <Row label="ì™„ë£Œ ì—¬ë¶€" value="ë¯¸ì™„ë£Œ" highlight />
          </Card>

          {/* ê°•ì˜ ëª©ë¡ */}
          <Card title="ê°•ì˜ ëª©ë¡">
            <ListItem active>1ê°• Â· ìƒëª…ê³¼í•™ì˜ ì´í•´ (OT)</ListItem>
            <ListItem>2ê°• Â· ì‚¬ëŒì˜ ë¬¼ì§ˆëŒ€ì‚¬</ListItem>
            <ListItem>3ê°• Â· í•­ìƒì„±ê³¼ ëª¸ì˜ ì¡°ì ˆ</ListItem>
            <ListItem>4ê°• Â· ìœ ì „</ListItem>
          </Card>

          {/* ì œí•œ ì•ˆë‚´ */}
          <Card title="ì‹œì²­ ì œí•œ">
            <Bullet>ê±´ë„ˆë›°ê¸° ì œí•œ</Bullet>
            <Bullet>ìµœëŒ€ ë°°ì† 1.0x</Bullet>
            <Bullet>ì›Œí„°ë§ˆí¬ ìë™ ì ìš©</Bullet>
          </Card>
        </div>

        {/* í•˜ë‹¨ ë„¤ë¹„ ë”ë¯¸ */}
        <div
          style={{
            borderTop: "1px solid rgba(255,255,255,0.08)",
            padding: "10px 0",
            display: "flex",
            justifyContent: "space-around",
            fontSize: 11,
            opacity: 0.8,
          }}
        >
          <NavItem label="í™ˆ" />
          <NavItem label="ê°•ì˜" active />
          <NavItem label="ê³¼ì œ" />
          <NavItem label="ë§ˆì´" />
        </div>
      </div>
    </div>
  );
}

/* ------------------------------------------------------------------ */
/* UI íŒŒì¸  (ì „ì—­ ì˜í–¥ ì—†ìŒ) */

function Card({
  title,
  children,
}: {
  title?: string;
  children: React.ReactNode;
}) {
  return (
    <div
      style={{
        background: "rgba(255,255,255,0.06)",
        borderRadius: 16,
        padding: 14,
      }}
    >
      {title && (
        <div
          style={{
            fontSize: 13,
            fontWeight: 700,
            marginBottom: 8,
            color: "#e5e7eb",
          }}
        >
          {title}
        </div>
      )}
      {children}
    </div>
  );
}

function Row({
  label,
  value,
  highlight,
}: {
  label: string;
  value: string;
  highlight?: boolean;
}) {
  return (
    <div
      style={{
        display: "flex",
        justifyContent: "space-between",
        fontSize: 13,
        marginBottom: 6,
        color: highlight ? "#38bdf8" : "#cbd5f5",
      }}
    >
      <span>{label}</span>
      <strong>{value}</strong>
    </div>
  );
}

function ListItem({
  children,
  active,
}: {
  children: React.ReactNode;
  active?: boolean;
}) {
  return (
    <div
      style={{
        padding: "8px 0",
        fontSize: 13,
        color: active ? "#38bdf8" : "#cbd5f5",
        borderBottom: "1px solid rgba(255,255,255,0.08)",
      }}
    >
      {children}
    </div>
  );
}

function Bullet({ children }: { children: React.ReactNode }) {
  return (
    <div style={{ fontSize: 13, opacity: 0.85, marginBottom: 4 }}>
      â€¢ {children}
    </div>
  );
}

function NavItem({
  label,
  active,
}: {
  label: string;
  active?: boolean;
}) {
  return (
    <div style={{ color: active ? "#38bdf8" : "#94a3b8" }}>
      {label}
    </div>
  );
}


==========================================================================================
# FILE: media/pages/MediaPlayerPage.tsx
==========================================================================================
// PATH: src/student/domains/media/pages/MediaPlayerPage.tsx
import { useEffect, useMemo, useState } from "react";
import { useLocation, useNavigate, useParams } from "react-router-dom";

import StudentPageShell from "../../../shared/ui/pages/StudentPageShell";
import EmptyState from "../../../shared/ui/layout/EmptyState";
import studentApi from "@/student/shared/api/studentApi";

import StudentVideoPlayer, {
  PlaybackBootstrap,
  VideoMetaLite,
} from "../playback/player/StudentVideoPlayer";
import { safeParseInt, getOrCreateDeviceId } from "../playback/player/design/utils";

function useQuery() {
  const { search } = useLocation();
  return useMemo(() => new URLSearchParams(search), [search]);
}

async function fetchVideo(videoId: number): Promise<VideoMetaLite> {
  // âœ… backend: apps/support/video/urls.py router videos -> /api/v1/videos/videos/{id}/
  const res = await studentApi.get(`/api/v1/videos/videos/${videoId}/`);
  const v = res?.data || {};
  return {
    id: Number(v.id),
    title: String(v.title ?? "ì˜ìƒ"),
    duration: v.duration == null ? null : Number(v.duration),
    status: String(v.status ?? ""),
    thumbnail_url: v.thumbnail_url ?? null,
    hls_url: v.hls_url ?? null,
  };
}

async function startPlayback(params: {
  videoId: number;
  enrollmentId?: number | null;
  deviceId: string;
}): Promise<PlaybackBootstrap> {
  const body: any = {
    video_id: params.videoId,
    device_id: params.deviceId,
  };
  if (params.enrollmentId) {
    body.enrollment_id = params.enrollmentId;
  }
  const res = await studentApi.post(`/api/v1/videos/playback/start/`, body);
  const d = res?.data || {};
  const policy = d.policy || {};
  return {
    token: String(d.token || ""),
    session_id: d.session_id != null ? String(d.session_id) : null,
    expires_at: d.expires_at != null ? Number(d.expires_at) : null,
    access_mode: (d.access_mode ?? policy.access_mode) || "FREE_REVIEW",
    monitoring_enabled: d.monitoring_enabled ?? policy.monitoring_enabled ?? false,
    policy,
    play_url: String(d.play_url || ""),
  };
}

export default function MediaPlayerPage() {
  const nav = useNavigate();
  const q = useQuery();
  const params = useParams();

  const videoId =
    safeParseInt(params.videoId) ??
    safeParseInt(q.get("video")) ??
    safeParseInt(q.get("video_id"));

  const enrollmentId =
    safeParseInt(q.get("enrollment")) ??
    safeParseInt(q.get("enrollment_id")) ??
    safeParseInt(params.enrollmentId);

  const [loading, setLoading] = useState(true);
  const [err, setErr] = useState<string | null>(null);
  const [video, setVideo] = useState<VideoMetaLite | null>(null);
  const [boot, setBoot] = useState<PlaybackBootstrap | null>(null);

  useEffect(() => {
    let alive = true;

    async function run() {
      setLoading(true);
      setErr(null);

      if (!videoId) {
        setLoading(false);
        setErr("video_idê°€ í•„ìš”í•©ë‹ˆë‹¤.");
        return;
      }

      try {
        const deviceId = getOrCreateDeviceId();
        // ì „ì²´ê³µê°œì˜ìƒì¸ì§€ í™•ì¸ (enrollmentId ì—†ì´ë„ ì¬ìƒ ê°€ëŠ¥)
        const v = await fetchVideo(videoId);
        const isPublicVideo = !enrollmentId; // ì „ì²´ê³µê°œì˜ìƒì€ enrollmentIdê°€ ì—†ì„ ìˆ˜ ìˆìŒ
        
        const b = await startPlayback({ 
          videoId, 
          enrollmentId: enrollmentId || undefined, 
          deviceId 
        });

        if (!alive) return;

        if (!b.token || !b.play_url) {
          setErr("ì¬ìƒ ì„¸ì…˜ ìƒì„± ì‹¤íŒ¨");
          setLoading(false);
          return;
        }

        // For FREE_REVIEW mode, session_id and expires_at may be null (expected)

        setVideo(v);
        setBoot(b);
        setLoading(false);
      } catch (e: any) {
        if (!alive) return;
        const msg =
          e?.response?.data?.detail ||
          e?.message ||
          "ì¬ìƒ í˜ì´ì§€ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
        setErr(String(msg));
        setLoading(false);
      }
    }

    run();

    return () => {
      alive = false;
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [videoId, enrollmentId]);

  return (
    <div style={{ background: "#000", minHeight: "100vh", padding: "var(--stu-space-4)" }}>
      <div style={{ maxWidth: 1400, margin: "0 auto" }}>
        <div style={{ marginBottom: "var(--stu-space-4)", display: "flex", alignItems: "center", justifyContent: "space-between" }}>
          <button
            type="button"
            onClick={() => nav(-1)}
            style={{
              padding: "8px 16px",
              borderRadius: 8,
              border: "1px solid rgba(255,255,255,0.2)",
              background: "rgba(255,255,255,0.1)",
              color: "#fff",
              fontWeight: 600,
              cursor: "pointer",
              fontSize: 14,
            }}
          >
            â† ë’¤ë¡œ
          </button>
          {video && (
            <h1 style={{ fontSize: 18, fontWeight: 700, color: "#fff", margin: 0 }}>
              {video.title}
            </h1>
          )}
          <div style={{ width: 80 }} />
        </div>
      {loading ? (
        <div style={{ padding: 8 }}>
          <div
            style={{
              height: 520,
              borderRadius: 14,
              border: "1px solid #eee",
              background:
                "linear-gradient(90deg, #f3f3f3, #fafafa, #f3f3f3)",
              backgroundSize: "200% 100%",
              animation: "mediaShimmer 1.1s ease-in-out infinite",
            }}
          />
          <style>{`
            @keyframes mediaShimmer {
              0% { background-position: 200% 0; }
              100% { background-position: -200% 0; }
            }
          `}</style>
        </div>
      ) : err ? (
        <EmptyState
          title="ì¬ìƒì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
          description={err}
        />
      ) : video && boot ? (
        <StudentVideoPlayer
          video={video}
          bootstrap={boot}
          enrollmentId={enrollmentId ? Number(enrollmentId) : 0}
          onFatal={(reason) => setErr(reason)}
        />
      ) : (
        <EmptyState title="ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤" description="ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”." />
      )}
      </div>
    </div>
  );
}


==========================================================================================
# FILE: media/pages/VideoHomePage.tsx
==========================================================================================
/**
 * ì˜ìƒ í™ˆ â€” í”„ë¦¬ë¯¸ì—„ SaaS ì¸ê°• ëŠë‚Œì˜ ì½”ìŠ¤ ì¹´ë“œ UI
 * ì „ì²´ê³µê°œì˜ìƒ(ë§¨ìœ„) + ê°•ì˜ë³„ ì½”ìŠ¤ ì¹´ë“œ
 */
import { useMemo } from "react";
import { useQuery } from "@tanstack/react-query";
import { fetchVideoMe, fetchStudentSessionVideos } from "../api/media";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import CourseCard from "../components/CourseCard";

// ì „ì²´ê³µê°œì˜ìƒ ì„¸ì…˜ìš© ì½”ìŠ¤ ì¹´ë“œ ë°ì´í„° ê³„ì‚°
function usePublicCourseCard(publicSession: { session_id: number } | null) {
  const { data: videosData } = useQuery({
    queryKey: ["student-session-videos", publicSession?.session_id, null],
    queryFn: () => fetchStudentSessionVideos(publicSession!.session_id, null),
    enabled: !!publicSession?.session_id,
  });

  return useMemo(() => {
    if (!videosData?.items || videosData.items.length === 0) return null;
    
    const videos = videosData.items;
    const totalDuration = videos.reduce((sum, v) => sum + ((v as { duration?: number }).duration ?? 0), 0);
    const firstVideo = videos[0];
    
    return {
      title: "ì „ì²´ê³µê°œì˜ìƒ",
      thumbnailUrl: firstVideo.thumbnail_url,
      videoCount: videos.length,
      totalDuration,
      progress: 0, // TODO: ì§„í–‰ë¥  ê³„ì‚°
      isNew: false,
      isContinue: false,
      isCompleted: false,
      to: `/student/video/play?video=${firstVideo.id}`,
    };
  }, [videosData]);
}

// ê°•ì˜ë³„ ì½”ìŠ¤ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸ (hookì„ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ í˜¸ì¶œ)
function LectureCourseCard({ lecture }: { lecture: { id: number; title: string; sessions: Array<{ id: number }> } }) {
  const sessionIds = lecture.sessions.map((s) => s.id);
  const sessionQueries = useQuery({
    queryKey: ["student-lecture-videos", lecture.id],
    queryFn: async () => {
      const allVideos: Array<{ duration?: number; thumbnail_url?: string | null; id: number }> = [];
      for (const sessionId of sessionIds) {
        const res = await fetchStudentSessionVideos(sessionId, null);
        allVideos.push(...res.items);
      }
      return allVideos;
    },
    enabled: sessionIds.length > 0,
  });

  const cardData = useMemo(() => {
    if (!sessionQueries.data || sessionQueries.data.length === 0) return null;
    
    const videos = sessionQueries.data;
    const totalDuration = videos.reduce((sum, v) => sum + (v.duration ?? 0), 0);
    const firstVideo = videos[0];
    
    return {
      title: lecture.title,
      thumbnailUrl: firstVideo.thumbnail_url,
      videoCount: videos.length,
      totalDuration,
      progress: 0, // TODO: ì§„í–‰ë¥  ê³„ì‚°
      isNew: false,
      isContinue: false,
      isCompleted: false,
      to: `/student/video/play?video=${firstVideo.id}`,
    };
  }, [lecture, sessionQueries.data]);

  if (!cardData) return null;

  return (
    <CourseCard
      title={cardData.title}
      thumbnailUrl={cardData.thumbnailUrl}
      videoCount={cardData.videoCount}
      totalDuration={cardData.totalDuration}
      progress={cardData.progress}
      isNew={cardData.isNew}
      isContinue={cardData.isContinue}
      isCompleted={cardData.isCompleted}
      to={cardData.to}
    />
  );
}

export default function VideoHomePage() {
  const { data: videoMe, isLoading, isError } = useQuery({
    queryKey: ["student-video-me"],
    queryFn: fetchVideoMe,
  });

  const publicCard = usePublicCourseCard(videoMe?.public ?? null);

  const hasPublic = !!videoMe?.public?.session_id;
  const hasLectures = (videoMe?.lectures?.length ?? 0) > 0;
  const hasAny = hasPublic || hasLectures;

  if (isLoading) {
    return (
      <div style={{ padding: "var(--stu-space-4)" }}>
        <div className="stu-skel" style={{ height: 200, borderRadius: "var(--stu-radius-lg)" }} />
        <div className="stu-skel" style={{ height: 200, marginTop: 16, borderRadius: "var(--stu-radius-lg)" }} />
      </div>
    );
  }

  if (isError || !hasAny) {
    return (
      <div style={{ padding: "var(--stu-space-4)" }}>
        <EmptyState
          title="ë“±ë¡ëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤"
          description="ì „ì²´ê³µê°œ ì˜ìƒì´ë‚˜ ìˆ˜ê°• ì¤‘ì¸ ê°•ì˜ì˜ ì°¨ì‹œ ì˜ìƒì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."
        />
      </div>
    );
  }

  return (
    <div style={{ padding: "var(--stu-space-4)" }}>
      <h1
        style={{
          fontSize: 24,
          fontWeight: 800,
          marginBottom: "var(--stu-space-6)",
          color: "var(--stu-text)",
        }}
      >
        ìˆ˜ê°• ê°€ëŠ¥í•œ ê°•ì˜
      </h1>

      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fill, minmax(280px, 1fr))",
          gap: "var(--stu-space-4)",
        }}
      >
        {/* ì „ì²´ê³µê°œì˜ìƒ ì½”ìŠ¤ ì¹´ë“œ */}
        {publicCard && (
          <CourseCard
            title={publicCard.title}
            thumbnailUrl={publicCard.thumbnailUrl}
            videoCount={publicCard.videoCount}
            totalDuration={publicCard.totalDuration}
            progress={publicCard.progress}
            isNew={publicCard.isNew}
            isContinue={publicCard.isContinue}
            isCompleted={publicCard.isCompleted}
            to={publicCard.to}
          />
        )}

        {/* ê°•ì˜ë³„ ì½”ìŠ¤ ì¹´ë“œ */}
        {(videoMe?.lectures ?? []).map((lec) => (
          <LectureCourseCard key={lec.id} lecture={lec} />
        ))}
      </div>
    </div>
  );
}


==========================================================================================
# FILE: media/playback/player/StudentVideoPlayer.tsx
==========================================================================================
// PATH: src/student/domains/media/playback/player/StudentVideoPlayer.tsx
import { useCallback, useEffect, useMemo, useRef, useState } from "react";
import studentApi from "@/student/shared/api/studentApi";

import "./player.css";

import {
  clamp,
  formatClock,
  formatDateTimeKorean,
  getEpochSec,
  getOrCreateDeviceId,
  safeParseFloat,
  safeParseInt,
} from "./design/utils";
import {
  IconButton,
  KebabMenu,
  MenuItem,
  Pill,
  PlayerToast,
  RangeSlider,
} from "./design/ui";

/**
 * âœ… SSOT: Backend playback/start returns policy + play_url
 * - FrontendëŠ” ì†Œë¹„ë§Œ í•œë‹¤ (íŒë‹¨/ê³„ì‚° ìµœì†Œ)
 * - ë‹¨, "ì •ì±… ê°•ì œ"ëŠ” í”Œë ˆì´ì–´ UXì˜ ì¼ë¶€ë¡œì„œ clientì—ì„œ ë§‰ëŠ”ë‹¤ (íƒìƒ‰/ë°°ì†/í‘œì‹œ)
 */

export type VideoMetaLite = {
  id: number;
  title: string;
  duration: number | null;
  status?: string;
  thumbnail_url?: string | null;
  hls_url?: string | null;
};

export type PlaybackBootstrap = {
  token: string;
  session_id: string | null;  // null for FREE_REVIEW
  expires_at: number | null;  // null for FREE_REVIEW
  access_mode: "FREE_REVIEW" | "PROCTORED_CLASS";
  monitoring_enabled: boolean;
  policy: any;
  play_url: string;
};

type Props = {
  video: VideoMetaLite;
  bootstrap: PlaybackBootstrap;
  enrollmentId: number;
  onFatal?: (reason: string) => void;
};

import type { AccessMode } from "@/features/videos/types/access-mode";

type Policy = {
  access_mode?: AccessMode;
  monitoring_enabled?: boolean;  // true only for PROCTORED_CLASS
  allow_seek?: boolean;
  seek?: {
    mode?: "free" | "blocked" | "bounded_forward";
    forward_limit?: "max_watched" | null;
    grace_seconds?: number;
  };
  playback_rate?: {
    max?: number;
    ui_control?: boolean;
  };
  watermark?: {
    enabled?: boolean;
    mode?: "overlay";
    fields?: string[];
  };
  concurrency?: {
    max_sessions?: number;
    max_devices?: number;
  };
};

type EventType =
  | "VISIBILITY_HIDDEN"
  | "VISIBILITY_VISIBLE"
  | "FOCUS_LOST"
  | "FOCUS_GAINED"
  | "SEEK_ATTEMPT"
  | "SPEED_CHANGE_ATTEMPT"
  | "FULLSCREEN_ENTER"
  | "FULLSCREEN_EXIT"
  | "PLAYER_ERROR";

function normalizePolicy(p: any): Policy {
  const policy = (p || {}) as Policy;
  policy.seek = (policy.seek || {}) as any;
  policy.playback_rate = (policy.playback_rate || {}) as any;
  policy.watermark = (policy.watermark || {}) as any;

  if (policy.monitoring_enabled == null) {
    policy.monitoring_enabled = policy.access_mode === "PROCTORED_CLASS";
  }
  if (policy.allow_seek == null) policy.allow_seek = true;
  if (!policy.seek) policy.seek = { mode: "free", grace_seconds: 3 };
  if (!policy.seek?.mode) policy.seek!.mode = "free";
  if (policy.seek?.grace_seconds == null) policy.seek!.grace_seconds = 3;

  if (policy.playback_rate?.max == null) policy.playback_rate = { ...policy.playback_rate, max: 16 };
  if (policy.playback_rate?.ui_control == null) policy.playback_rate = { ...policy.playback_rate, ui_control: true };

  if (policy.watermark?.enabled == null) policy.watermark = { ...policy.watermark, enabled: false };

  return policy;
}

async function postHeartbeat(token: string) {
  await studentApi.post(`/api/v1/videos/playback/heartbeat/`, { token });
}

async function postRefresh(token: string) {
  await studentApi.post(`/api/v1/videos/playback/refresh/`, { token });
}

async function postEnd(token: string) {
  await studentApi.post(`/api/v1/videos/playback/end/`, { token });
}

async function postEvents(
  token: string,
  events: Array<{ type: EventType; occurred_at: number; payload?: any }>,
  videoId: number,
  enrollmentId: number
) {
  if (!events.length) return;
  await studentApi.post(`/api/v1/videos/playback/events/`, {
    token,
    video_id: videoId,
    enrollment_id: enrollmentId,
    events: events.map((e) => ({
      type: e.type,
      occurred_at: e.occurred_at,
      payload: e.payload || {},
    })),
  });
}

function useStableInterval(cb: () => void, ms: number, enabled: boolean) {
  const ref = useRef(cb);
  ref.current = cb;

  useEffect(() => {
    if (!enabled) return;
    const id = window.setInterval(() => ref.current(), ms);
    return () => window.clearInterval(id);
  }, [ms, enabled]);
}

export default function StudentVideoPlayer({ video, bootstrap, enrollmentId, onFatal }: Props) {
  const policy = useMemo(() => normalizePolicy(bootstrap.policy), [bootstrap.policy]);

  const allowSeek = !!policy.allow_seek && policy.seek?.mode !== "blocked";
  const seekMode = policy.seek?.mode || "free";
  const grace = Math.max(0, Number(policy.seek?.grace_seconds ?? 3));
  const boundedForward = seekMode === "bounded_forward";

  const speedUi = policy.playback_rate?.ui_control !== false;
  const maxRate = Math.max(1, safeParseFloat(policy.playback_rate?.max, 1) || 1);
  const speedLocked = !speedUi || maxRate <= 1.0001;

  const watermarkEnabled = !!policy.watermark?.enabled;

  // UI State
  const videoEl = useRef<HTMLVideoElement | null>(null);
  const wrapEl = useRef<HTMLDivElement | null>(null);

  const [ready, setReady] = useState(false);
  const [playing, setPlaying] = useState(false);
  const [buffering, setBuffering] = useState(false);

  const [duration, setDuration] = useState<number>(video.duration ?? 0);
  const [current, setCurrent] = useState<number>(0);

  const [volume, setVolume] = useState<number>(1);
  const [muted, setMuted] = useState<boolean>(false);

  const [rate, setRate] = useState<number>(1);
  const [theater, setTheater] = useState<boolean>(false);

  const [toast, setToast] = useState<{ text: string; kind?: "info" | "warn" | "danger" } | null>(null);

  const maxWatchedRef = useRef<number>(0); // seconds
  const lastTimeRef = useRef<number>(0);
  const seekGuardRef = useRef<{ blocking: boolean; lastWarnAt: number }>({ blocking: false, lastWarnAt: 0 });

  const eventQueueRef = useRef<Array<{ type: EventType; occurred_at: number; payload?: any }>>([]);

  const tokenRef = useRef(bootstrap.token);
  useEffect(() => {
    tokenRef.current = bootstrap.token;
  }, [bootstrap.token]);

  // ---------------------------------------------------------------------------
  // HLS attach
  // ---------------------------------------------------------------------------
  const attachSource = useCallback(async () => {
    const el = videoEl.current;
    if (!el) return;

    // reset
    try {
      el.pause();
    } catch {}
    el.src = "";

    const url = bootstrap.play_url || video.hls_url || "";
    if (!url) {
      onFatal?.("play_url_not_provided");
      return;
    }

    // Native HLS (Safari)
    const canNative =
      el.canPlayType("application/vnd.apple.mpegurl") ||
      el.canPlayType("application/x-mpegURL");

    if (canNative) {
      el.src = url;
      return;
    }

    // Hls.js
    try {
      const mod: any = await import("hls.js");
      const Hls = mod.default;

      if (Hls && Hls.isSupported()) {
        const hls = new Hls({
          lowLatencyMode: true,
          backBufferLength: 30,
          maxBufferLength: 60,
          maxMaxBufferLength: 120,
        });

        (el as any).__hls = hls;

        hls.on(Hls.Events.ERROR, (_: any, data: any) => {
          try {
            queueEvent("PLAYER_ERROR", {
              fatal: !!data?.fatal,
              details: data?.details || "",
              type: data?.type || "",
            });
          } catch {}

          if (data?.fatal) {
            setToast({ text: "ì¬ìƒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.", kind: "danger" });
          }
        });

        hls.loadSource(url);
        hls.attachMedia(el);
        return;
      }

      // fallback
      el.src = url;
    } catch (e) {
      // fallback
      el.src = url;
    }
  }, [bootstrap.play_url, video.hls_url, onFatal]);

  // ---------------------------------------------------------------------------
  // Events batching (anti-spam)
  // ---------------------------------------------------------------------------
  const queueEvent = useCallback((type: EventType, payload?: any) => {
    const policy = normalizePolicy(bootstrap.policy);
    const monitoringEnabled = policy.monitoring_enabled ?? false;
    
    // If monitoring is disabled (FREE_REVIEW), skip all event logging
    if (!monitoringEnabled) {
      return;
    }
    
    // Only send violation-relevant events in PROCTORED_CLASS mode
    // FREE_REVIEW mode: minimal logging (no violation events)
    const violationEvents: EventType[] = ["SEEK_ATTEMPT", "SPEED_CHANGE_ATTEMPT"];
    const isViolationEvent = violationEvents.includes(type);
    const accessMode = policy.access_mode;
    
    if (accessMode === "FREE_REVIEW" && isViolationEvent) {
      // Don't send violation events in FREE_REVIEW mode
      return;
    }
    
    const now = getEpochSec();
    eventQueueRef.current.push({ type, occurred_at: now, payload: payload || {} });

    // small cap (memory safety)
    if (eventQueueRef.current.length > 300) {
      eventQueueRef.current.splice(0, eventQueueRef.current.length - 300);
    }
  }, [bootstrap.policy]);

  const flushEvents = useCallback(async () => {
    const token = tokenRef.current;
    if (!token) return;
    const batch = eventQueueRef.current.splice(0, eventQueueRef.current.length);
    if (!batch.length) return;

    try {
      await postEvents(token, batch, video.id, enrollmentId);
    } catch (e: any) {
      // session revoked / inactive -> stop
      const msg = e?.response?.data?.detail || e?.message || "";
      if (String(msg).includes("session_inactive") || e?.response?.status === 409) {
        setToast({ text: "ì¬ìƒ ì„¸ì…˜ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.", kind: "danger" });
        onFatal?.("session_inactive");
      }
    }
  }, [onFatal, video.id, enrollmentId]);

  const monitoringEnabled = policy.monitoring_enabled ?? false;

  // Events: only when monitoring_enabled (FREE_REVIEW sends nothing)
  useStableInterval(
    () => {
      flushEvents();
    },
    2200,
    monitoringEnabled
  );

  // Heartbeat: only for PROCTORED_CLASS
  useStableInterval(
    () => {
      const token = tokenRef.current;
      if (!token) return;

      postHeartbeat(token).catch((e: any) => {
        const msg = e?.response?.data?.detail || e?.message || "";
        if (String(msg).includes("policy_changed")) {
          setToast({ text: "ì •ì±…ì´ ë³€ê²½ë˜ì–´ ì¬ìƒì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.", kind: "danger" });
          onFatal?.("policy_changed");
          return;
        }
        if (String(msg).includes("session_inactive") || e?.response?.status === 409) {
          setToast({ text: "ì¬ìƒ ì„¸ì…˜ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.", kind: "danger" });
          onFatal?.("session_inactive");
          return;
        }
      });
    },
    30000,
    monitoringEnabled
  );

  // ---------------------------------------------------------------------------
  // Mount/Unmount lifecycle
  // ---------------------------------------------------------------------------
  useEffect(() => {
    attachSource();

    return () => {
      // cleanup hls
      const el = videoEl.current as any;
      const hls = el?.__hls;
      if (hls && typeof hls.destroy === "function") {
        try {
          hls.destroy();
        } catch {}
      }

      // end session (best-effort, only for PROCTORED_CLASS)
      const policy = normalizePolicy(bootstrap.policy);
      const monitoringEnabled = policy.monitoring_enabled ?? false;
      
      if (monitoringEnabled) {
        const token = tokenRef.current;
        if (token) {
          postEnd(token).catch(() => {});
        }

        // flush last events
        try {
          flushEvents();
        } catch {}
      }
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  // ---------------------------------------------------------------------------
  // Visibility / Focus events
  // ---------------------------------------------------------------------------
  useEffect(() => {
    const onVis = () => {
      if (document.hidden) {
        queueEvent("VISIBILITY_HIDDEN", { hidden: true });
      } else {
        queueEvent("VISIBILITY_VISIBLE", { hidden: false });
        if (monitoringEnabled) {
          const token = tokenRef.current;
          if (token) postRefresh(token).catch(() => {});
        }
      }
    };
    const onBlur = () => queueEvent("FOCUS_LOST", {});
    const onFocus = () => queueEvent("FOCUS_GAINED", {});

    document.addEventListener("visibilitychange", onVis);
    window.addEventListener("blur", onBlur);
    window.addEventListener("focus", onFocus);

    return () => {
      document.removeEventListener("visibilitychange", onVis);
      window.removeEventListener("blur", onBlur);
      window.removeEventListener("focus", onFocus);
    };
  }, [queueEvent, monitoringEnabled]);

  // ---------------------------------------------------------------------------
  // Video event binding
  // ---------------------------------------------------------------------------
  useEffect(() => {
    const el = videoEl.current;
    if (!el) return;

    const onLoadedMeta = () => {
      const d = Number(el.duration || 0);
      if (d && Number.isFinite(d)) setDuration(d);
      setReady(true);
      setBuffering(false);
    };

    const onTime = () => {
      const t = Number(el.currentTime || 0);
      setCurrent(t);

      // "watched" = monotonic forward progress (safety against seek)
      const prev = lastTimeRef.current;
      lastTimeRef.current = t;

      if (t > maxWatchedRef.current) {
        maxWatchedRef.current = t;
      } else if (t + 0.15 < prev) {
        // user moved backward OR the stream jumped
        // don't treat as watched
      }
    };

    const onPlay = () => {
      setPlaying(true);
      setBuffering(false);
    };
    const onPause = () => setPlaying(false);
    const onWaiting = () => setBuffering(true);
    const onPlaying = () => setBuffering(false);

    const onRateChange = () => {
      const r = Number(el.playbackRate || 1);
      setRate(r);

      // enforce speed lock
      if (speedLocked) {
        if (Math.abs(r - 1) > 0.001) {
          try {
            el.playbackRate = 1;
          } catch {}
          setToast({ text: "ë°°ì† ë³€ê²½ì´ ì œí•œë˜ì–´ ìˆìŠµë‹ˆë‹¤.", kind: "warn" });
          queueEvent("SPEED_CHANGE_ATTEMPT", { attempted: r, enforced: 1 });
        }
        return;
      }

      if (r > maxRate + 0.0001) {
        try {
          el.playbackRate = maxRate;
        } catch {}
        setToast({ text: `ìµœëŒ€ ë°°ì†ì€ ${maxRate}x ì…ë‹ˆë‹¤.`, kind: "warn" });
        queueEvent("SPEED_CHANGE_ATTEMPT", { attempted: r, enforced: maxRate });
      }
    };

    const onSeeking = () => {
      if (allowSeek && !boundedForward) return;

      const now = Date.now();
      const guard = seekGuardRef.current;

      const target = Number(el.currentTime || 0);
      const maxWatched = Number(maxWatchedRef.current || 0);
      const allowedMax = boundedForward ? maxWatched + grace : maxWatched; // blocked -> no forward
      const isForwardBeyond = target > allowedMax + 0.001;

      // blocked seek -> any seek considered attempt
      if (!allowSeek || seekMode === "blocked") {
        // snap back
        guard.blocking = true;
        try {
          el.currentTime = maxWatched;
        } catch {}
        guard.blocking = false;

        if (now - guard.lastWarnAt > 900) {
          guard.lastWarnAt = now;
          setToast({ text: "íƒìƒ‰ì´ ì œí•œëœ ì˜ìƒì…ë‹ˆë‹¤.", kind: "warn" });
        }

        queueEvent("SEEK_ATTEMPT", {
          mode: "blocked",
          target,
          max_watched: maxWatched,
        });
        return;
      }

      if (boundedForward && isForwardBeyond) {
        // snap back to allowed
        guard.blocking = true;
        try {
          el.currentTime = allowedMax;
        } catch {}
        guard.blocking = false;

        if (now - guard.lastWarnAt > 900) {
          guard.lastWarnAt = now;
          setToast({ text: "ì•„ì§ ì‹œì²­í•˜ì§€ ì•Šì€ êµ¬ê°„ìœ¼ë¡œ ì´ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", kind: "warn" });
        }

        queueEvent("SEEK_ATTEMPT", {
          mode: "bounded_forward",
          target,
          max_watched: maxWatched,
          grace,
        });
      }
    };

    const onError = () => {
      queueEvent("PLAYER_ERROR", {
        code: (el.error as any)?.code || 0,
        message: (el.error as any)?.message || "",
      });
      setToast({ text: "ì¬ìƒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", kind: "danger" });
    };

    el.addEventListener("loadedmetadata", onLoadedMeta);
    el.addEventListener("timeupdate", onTime);
    el.addEventListener("play", onPlay);
    el.addEventListener("pause", onPause);
    el.addEventListener("waiting", onWaiting);
    el.addEventListener("playing", onPlaying);
    el.addEventListener("ratechange", onRateChange);
    el.addEventListener("seeking", onSeeking);
    el.addEventListener("error", onError);

    // initial constraints
    try {
      if (speedLocked) el.playbackRate = 1;
      if (maxRate < 1) el.playbackRate = 1;
    } catch {}

    return () => {
      el.removeEventListener("loadedmetadata", onLoadedMeta);
      el.removeEventListener("timeupdate", onTime);
      el.removeEventListener("play", onPlay);
      el.removeEventListener("pause", onPause);
      el.removeEventListener("waiting", onWaiting);
      el.removeEventListener("playing", onPlaying);
      el.removeEventListener("ratechange", onRateChange);
      el.removeEventListener("seeking", onSeeking);
      el.removeEventListener("error", onError);
    };
  }, [allowSeek, boundedForward, grace, maxRate, queueEvent, seekMode, speedLocked]);

  // ---------------------------------------------------------------------------
  // Controls actions
  // ---------------------------------------------------------------------------
  const togglePlay = useCallback(() => {
    const el = videoEl.current;
    if (!el) return;
    if (el.paused) {
      el.play().catch(() => {});
    } else {
      el.pause();
    }
  }, []);

  const requestFullscreen = useCallback(async () => {
    const wrap = wrapEl.current;
    if (!wrap) return;

    const isFs =
      document.fullscreenElement ||
      (document as any).webkitFullscreenElement ||
      (document as any).mozFullScreenElement;

    try {
      if (!isFs) {
        queueEvent("FULLSCREEN_ENTER", {});
        if (wrap.requestFullscreen) return await wrap.requestFullscreen();
        if ((wrap as any).webkitRequestFullscreen) return await (wrap as any).webkitRequestFullscreen();
      } else {
        queueEvent("FULLSCREEN_EXIT", {});
        if (document.exitFullscreen) return await document.exitFullscreen();
        if ((document as any).webkitExitFullscreen) return await (document as any).webkitExitFullscreen();
      }
    } catch {}
  }, [queueEvent]);

  const setTime = useCallback((t: number) => {
    const el = videoEl.current;
    if (!el) return;

    const safe = clamp(t, 0, Math.max(0, duration || 0));
    try {
      el.currentTime = safe;
    } catch {}
  }, [duration]);

  const onScrub = useCallback((v: number) => {
    // UX: slider is always moveable, but policy guards actual seeking
    setTime(v);
  }, [setTime]);

  const onVolume = useCallback((v: number) => {
    const el = videoEl.current;
    if (!el) return;
    const vv = clamp(v, 0, 1);
    setVolume(vv);
    try {
      el.volume = vv;
    } catch {}
    if (vv <= 0.0001) setMuted(true);
    else setMuted(false);
  }, []);

  const toggleMute = useCallback(() => {
    const el = videoEl.current;
    if (!el) return;
    const m = !muted;
    setMuted(m);
    try {
      el.muted = m;
    } catch {}
  }, [muted]);

  const setPlaybackRate = useCallback((r: number) => {
    const el = videoEl.current;
    if (!el) return;

    if (speedLocked) {
      setToast({ text: "ë°°ì† ë³€ê²½ì´ ì œí•œë˜ì–´ ìˆìŠµë‹ˆë‹¤.", kind: "warn" });
      queueEvent("SPEED_CHANGE_ATTEMPT", { attempted: r, enforced: 1 });
      try {
        el.playbackRate = 1;
      } catch {}
      setRate(1);
      return;
    }

    const rr = clamp(r, 0.25, maxRate);
    try {
      el.playbackRate = rr;
    } catch {}
    setRate(rr);
  }, [maxRate, queueEvent, speedLocked]);

  const skip = useCallback((delta: number) => {
    const el = videoEl.current;
    if (!el) return;
    const t = Number(el.currentTime || 0) + Number(delta || 0);
    setTime(t);
  }, [setTime]);

  // Hotkeys (YouTube-like)
  useEffect(() => {
    const onKey = (e: KeyboardEvent) => {
      // ignore typing
      const tag = (e.target as any)?.tagName?.toLowerCase?.();
      if (tag === "input" || tag === "textarea" || (e.target as any)?.isContentEditable) return;

      if (e.code === "Space") {
        e.preventDefault();
        togglePlay();
        return;
      }

      if (e.key === "k" || e.key === "K") {
        togglePlay();
        return;
      }

      if (e.key === "f" || e.key === "F") {
        requestFullscreen();
        return;
      }

      if (e.key === "m" || e.key === "M") {
        toggleMute();
        return;
      }

      if (e.key === "t" || e.key === "T") {
        setTheater((v) => !v);
        return;
      }

      if (e.key === "ArrowLeft") {
        skip(-5);
        return;
      }
      if (e.key === "ArrowRight") {
        skip(5);
        return;
      }
      if (e.key === "j" || e.key === "J") {
        skip(-10);
        return;
      }
      if (e.key === "l" || e.key === "L") {
        skip(10);
        return;
      }
    };

    window.addEventListener("keydown", onKey);
    return () => window.removeEventListener("keydown", onKey);
  }, [requestFullscreen, skip, toggleMute, togglePlay]);

  // Prime audio config
  useEffect(() => {
    const el = videoEl.current;
    if (!el) return;
    try {
      el.volume = volume;
      el.muted = muted;
    } catch {}
  }, [muted, volume]);

  const policyPills = useMemo(() => {
    const pills: Array<{ text: string; tone?: "neutral" | "warn" | "danger" }> = [];
    const accessMode = policy.access_mode;
    if (accessMode === "PROCTORED_CLASS") {
      pills.push({ text: "ì˜¨ë¼ì¸ ìˆ˜ì—… ëŒ€ì²´", tone: "warn" });
    } else if (accessMode === "FREE_REVIEW") {
      pills.push({
        text: monitoringEnabled ? "ë³µìŠµ" : "ë³µìŠµ ëª¨ë“œ (ëª¨ë‹ˆí„°ë§ ì—†ìŒ)",
        tone: "neutral",
      });
    }

    if (!allowSeek || seekMode === "blocked") pills.push({ text: "íƒìƒ‰ ì œí•œ", tone: "warn" });
    else if (boundedForward) pills.push({ text: "ì•ìœ¼ë¡œ íƒìƒ‰ ì œí•œ", tone: "warn" });

    if (speedLocked) pills.push({ text: "ë°°ì† ì œí•œ", tone: "warn" });

    if (watermarkEnabled) pills.push({ text: "ì›Œí„°ë§ˆí¬", tone: "neutral" });

    return pills;
  }, [policy.access_mode, monitoringEnabled, allowSeek, boundedForward, seekMode, speedLocked, watermarkEnabled]);

  const deviceId = useMemo(() => getOrCreateDeviceId(), []);

  const shareText = useMemo(() => {
    const policy = normalizePolicy(bootstrap.policy);
    const monitoringEnabled = policy.monitoring_enabled ?? false;
    
    if (!monitoringEnabled) {
      return `ê¸°ê¸°: ${deviceId.slice(0, 8)}â€¦ Â· ëª¨ë‹ˆí„°ë§ ì—†ìŒ (ë³µìŠµ ëª¨ë“œ)`;
    }
    
    const expires = bootstrap.expires_at ? formatDateTimeKorean(bootstrap.expires_at * 1000) : "";
    return `ê¸°ê¸°: ${deviceId.slice(0, 8)}â€¦ Â· ì„¸ì…˜ ë§Œë£Œ: ${expires || "-"}`;
  }, [bootstrap.expires_at, bootstrap.policy, deviceId]);

  const rateMenu = useMemo(() => {
    const common = [0.5, 0.75, 1, 1.25, 1.5, 2];
    const extra = [2.5, 3, 4, 5, 8, 10, 16];
    const list = [...common, ...extra].filter((x) => x <= maxRate + 0.0001);
    // always include 1
    if (!list.includes(1)) list.push(1);
    list.sort((a, b) => a - b);
    return list;
  }, [maxRate]);

  // ---------------------------------------------------------------------------
  // Render
  // ---------------------------------------------------------------------------
  return (
    <div className={`svpRoot ${theater ? "svpTheater" : ""}`}>
      <div className="svpLayout">
        <div className="svpPlayerCol">
          <div className="svpPlayerWrap" ref={wrapEl}>
            <div className="svpTopBar">
              <div className="svpTopLeft">
                <div className="svpTitle" title={video.title}>
                  {video.title}
                </div>
                <div className="svpMeta">
                  <span className="svpMetaItem">video#{video.id}</span>
                  <span className="svpDot">â€¢</span>
                  <span className="svpMetaItem">enrollment#{enrollmentId}</span>
                </div>
              </div>

              <div className="svpTopRight">
                <div className="svpPills">
                  {policyPills.map((p, idx) => (
                    <Pill key={idx} tone={p.tone}>
                      {p.text}
                    </Pill>
                  ))}
                </div>

                <KebabMenu
                  align="right"
                  label="ë©”ë‰´"
                  items={[
                    {
                      label: "ì„¸ì…˜ ìƒˆë¡œê³ ì¹¨",
                      onClick: async () => {
                        const token = tokenRef.current;
                        if (!token) return;
                        try {
                          await postRefresh(token);
                          setToast({ text: "ì„¸ì…˜ í™•ì¸ ì™„ë£Œ", kind: "info" });
                        } catch {
                          setToast({ text: "ì„¸ì…˜ í™•ì¸ ì‹¤íŒ¨", kind: "warn" });
                        }
                      },
                    },
                    {
                      label: "ì´ ì˜ìƒ ì •ë³´",
                      onClick: () => {
                        setToast({ text: shareText, kind: "info" });
                      },
                    },
                  ]}
                />
              </div>
            </div>

            <div className="svpVideoStage">
              <video
                ref={videoEl}
                className="svpVideo"
                playsInline
                controls={false}
                preload="metadata"
                poster={video.thumbnail_url || undefined}
              />

              {!ready && (
                <div className="svpOverlayCenter">
                  <div className="svpSpinner" />
                  <div className="svpOverlayText">ë¡œë”© ì¤‘â€¦</div>
                </div>
              )}

              {ready && !playing && (
                <button className="svpBigPlay" type="button" onClick={togglePlay}>
                  <span className="svpBigPlayIcon">â–¶</span>
                  <span className="svpBigPlayText">ì¬ìƒ</span>
                </button>
              )}

              {buffering && ready && (
                <div className="svpOverlayCorner">
                  <div className="svpSpinnerMini" />
                  <div className="svpOverlayTextMini">ë²„í¼ë§â€¦</div>
                </div>
              )}

              {watermarkEnabled && (
                <div className="svpWatermark">
                  <div className="svpWatermarkInner">
                    <div className="svpWatermarkTop">hakwonplus</div>
                    <div className="svpWatermarkBottom">{deviceId.slice(0, 8)}â€¦</div>
                  </div>
                </div>
              )}

              <div className="svpControls">
                <div className="svpProgressRow">
                  <RangeSlider
                    value={current}
                    min={0}
                    max={Math.max(0.1, duration || 0)}
                    step={0.1}
                    onChange={(v) => onScrub(v)}
                    ariaLabel="ì§„í–‰ ë°”"
                  />
                  <div className="svpTime">
                    <span className="svpTimeCur">{formatClock(current)}</span>
                    <span className="svpTimeSep">/</span>
                    <span className="svpTimeDur">{formatClock(duration)}</span>
                  </div>
                </div>

                <div className="svpControlRow">
                  <div className="svpLeftControls">
                    <IconButton
                      icon={playing ? "pause" : "play"}
                      label={playing ? "ì¼ì‹œì •ì§€" : "ì¬ìƒ"}
                      onClick={togglePlay}
                    />

                    <IconButton icon="replay10" label="-10ì´ˆ" onClick={() => skip(-10)} />
                    <IconButton icon="forward10" label="+10ì´ˆ" onClick={() => skip(10)} />

                    <div className="svpVolume">
                      <IconButton
                        icon={muted || volume <= 0.0001 ? "mute" : "volume"}
                        label="ìŒì†Œê±°"
                        onClick={toggleMute}
                      />
                      <div className="svpVolumeSlider">
                        <RangeSlider
                          value={muted ? 0 : volume}
                          min={0}
                          max={1}
                          step={0.01}
                          onChange={(v) => onVolume(v)}
                          ariaLabel="ë³¼ë¥¨"
                        />
                      </div>
                    </div>
                  </div>

                  <div className="svpRightControls">
                    <div className="svpRate">
                      <KebabMenu
                        align="right"
                        label={speedLocked ? "ë°°ì† ì œí•œ" : `ë°°ì† ${rate.toFixed(2)}x`}
                        disabled={speedLocked}
                        items={rateMenu.map((r) => ({
                          label: `${r}x${Math.abs(r - rate) < 0.001 ? " âœ“" : ""}`,
                          onClick: () => setPlaybackRate(r),
                        }))}
                        buttonClassName={speedLocked ? "svpRateDisabled" : ""}
                      />
                    </div>

                    <IconButton
                      icon={theater ? "shrink" : "theater"}
                      label={theater ? "ê¸°ë³¸ ë³´ê¸°" : "ê·¹ì¥ ëª¨ë“œ"}
                      onClick={() => setTheater((v) => !v)}
                    />
                    <IconButton icon="fullscreen" label="ì „ì²´í™”ë©´" onClick={requestFullscreen} />
                  </div>
                </div>

                {!allowSeek || speedLocked ? (
                  <div className="svpPolicyHint">
                    {!allowSeek || seekMode === "blocked" ? (
                      <span className="svpPolicyHintItem">
                        â€¢ íƒìƒ‰ì´ ì œí•œë©ë‹ˆë‹¤{boundedForward ? " (ì‹œì²­í•œ êµ¬ê°„ë§Œ ì´ë™ ê°€ëŠ¥)" : ""}
                      </span>
                    ) : boundedForward ? (
                      <span className="svpPolicyHintItem">â€¢ ì•ìœ¼ë¡œ íƒìƒ‰ì´ ì œí•œë©ë‹ˆë‹¤</span>
                    ) : null}
                    {speedLocked ? (
                      <span className="svpPolicyHintItem">â€¢ ë°°ì† ë³€ê²½ì´ ì œí•œë©ë‹ˆë‹¤</span>
                    ) : null}
                  </div>
                ) : (
                  <div className="svpPolicyHint svpPolicyHintMuted">
                    í‚¤ë³´ë“œ: Space/K(ì¬ìƒ), J/L(Â±10s), â†/â†’(Â±5s), F(ì „ì²´í™”ë©´), M(ìŒì†Œê±°), T(ê·¹ì¥)
                  </div>
                )}
              </div>
            </div>
          </div>

          <PlayerToast toast={toast} onClose={() => setToast(null)} />
        </div>

        <aside className="svpSide">
          <div className="svpSideCard">
            <div className="svpSideTitle">ì‹œì²­ ë„ìš°ë¯¸</div>

            {policy.monitoring_enabled ? (
              <>
                <div className="svpSideRow">
                  <div className="svpSideLabel">ì„¸ì…˜</div>
                  <div className="svpSideValue">{bootstrap.session_id?.slice(0, 8) || "-"}â€¦</div>
                </div>

                <div className="svpSideRow">
                  <div className="svpSideLabel">ë§Œë£Œ</div>
                  <div className="svpSideValue">
                    {bootstrap.expires_at ? formatDateTimeKorean(bootstrap.expires_at * 1000) : "-"}
                  </div>
                </div>
              </>
            ) : (
              <div className="svpSideRow">
                <div className="svpSideLabel">ëª¨ë‹ˆí„°ë§</div>
                <div className="svpSideValue">ë¹„í™œì„± (ë³µìŠµ ëª¨ë“œ)</div>
              </div>
            )}

            <div className="svpSideRow">
              <div className="svpSideLabel">ê¸°ê¸°</div>
              <div className="svpSideValue">{deviceId.slice(0, 10)}â€¦</div>
            </div>

            <div className="svpSideDivider" />

            <div className="svpSideTitle2">ì •ì±… ì ìš©</div>
            <div className="svpSideBullets">
              <div className="svpSideBullet">
                <span className="svpSideDot" />
                <span className="svpSideTxt">
                  {allowSeek
                    ? boundedForward
                      ? "ì‹œì²­í•œ êµ¬ê°„ê¹Œì§€ë§Œ ì´ë™ ê°€ëŠ¥"
                      : "íƒìƒ‰ ê°€ëŠ¥"
                    : "íƒìƒ‰ ì°¨ë‹¨"}
                </span>
              </div>

              <div className="svpSideBullet">
                <span className="svpSideDot" />
                <span className="svpSideTxt">
                  {speedLocked ? "ë°°ì† ì°¨ë‹¨" : `ìµœëŒ€ ë°°ì† ${maxRate}x`}
                </span>
              </div>

              <div className="svpSideBullet">
                <span className="svpSideDot" />
                <span className="svpSideTxt">{watermarkEnabled ? "ì›Œí„°ë§ˆí¬ í‘œì‹œ" : "ì›Œí„°ë§ˆí¬ ì—†ìŒ"}</span>
              </div>
            </div>

            <div className="svpSideDivider" />

            <button
              type="button"
              className="svpSideButton"
              onClick={() => {
                setToast({
                  text: `í˜„ì¬ ${formatClock(current)} / ${formatClock(duration)} (ì•½ ${Math.round(
                    (current / Math.max(1, duration)) * 100
                  )}%)`,
                  kind: "info",
                });
              }}
            >
              ì§„í–‰ë¥  ë³´ê¸°
            </button>

            {monitoringEnabled && (
              <button
                type="button"
                className="svpSideButton svpSideButtonGhost"
                onClick={() => {
                  const token = tokenRef.current;
                  if (!token) return;
                  postRefresh(token)
                    .then(() => setToast({ text: "ì„¸ì…˜ í™•ì¸ ì™„ë£Œ", kind: "info" }))
                    .catch(() => setToast({ text: "ì„¸ì…˜ í™•ì¸ ì‹¤íŒ¨", kind: "warn" }));
                }}
              >
                ì„¸ì…˜ ì ê²€
              </button>
            )}
          </div>
        </aside>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: media/playback/player/player.css
==========================================================================================
/* PATH: src/student/domains/media/playback/player/player.css */
:root {
  --svp-bg: #0f0f10;
  --svp-card: #151517;
  --svp-card2: #101012;
  --svp-line: rgba(255, 255, 255, 0.08);
  --svp-line2: rgba(255, 255, 255, 0.14);
  --svp-text: rgba(255, 255, 255, 0.92);
  --svp-text2: rgba(255, 255, 255, 0.68);
  --svp-text3: rgba(255, 255, 255, 0.48);
  --svp-accent: #ffffff;
  --svp-warn: #ffcf5a;
  --svp-danger: #ff5a6e;
  --svp-shadow: 0 14px 60px rgba(0, 0, 0, 0.48);
  --svp-radius: 16px;
  --svp-radius2: 18px;
  --svp-font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple SD Gothic Neo",
    "Noto Sans KR", "Malgun Gothic", "ë§‘ì€ ê³ ë”•", sans-serif;
}

.svpRoot {
  font-family: var(--svp-font);
  color: var(--svp-text);
}

.svpLayout {
  display: grid;
  grid-template-columns: minmax(0, 1fr) 320px;
  gap: 14px;
}

@media (max-width: 1080px) {
  .svpLayout {
    grid-template-columns: 1fr;
  }
  .svpSide {
    display: none;
  }
}

.svpPlayerCol {
  min-width: 0;
}

.svpPlayerWrap {
  border-radius: var(--svp-radius2);
  overflow: hidden;
  box-shadow: var(--svp-shadow);
  background: var(--svp-bg);
  border: 1px solid rgba(0, 0, 0, 0.5);
}

.svpTopBar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 14px 14px 10px 14px;
  background: linear-gradient(180deg, rgba(0, 0, 0, 0.66), rgba(0, 0, 0, 0));
}

.svpTopLeft {
  min-width: 0;
}

.svpTitle {
  font-weight: 900;
  font-size: 15px;
  letter-spacing: -0.2px;
  line-height: 1.2;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.svpMeta {
  margin-top: 4px;
  display: flex;
  align-items: center;
  gap: 6px;
  color: var(--svp-text3);
  font-size: 12px;
}

.svpDot {
  opacity: 0.65;
}

.svpTopRight {
  display: flex;
  align-items: center;
  gap: 10px;
}

.svpPills {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  justify-content: flex-end;
}

.svpVideoStage {
  position: relative;
  background: #000;
}

.svpVideo {
  display: block;
  width: 100%;
  height: auto;
  aspect-ratio: 16 / 9;
  background: #000;
}

.svpTheater .svpPlayerWrap {
  border-radius: 0;
}

.svpTheater .svpVideo {
  aspect-ratio: 21 / 9;
}

.svpOverlayCenter {
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  pointer-events: none;
  gap: 8px;
}

.svpOverlayText {
  font-size: 13px;
  color: var(--svp-text2);
}

.svpSpinner {
  width: 42px;
  height: 42px;
  border-radius: 999px;
  border: 4px solid rgba(255, 255, 255, 0.14);
  border-top-color: rgba(255, 255, 255, 0.9);
  animation: svpSpin 0.9s linear infinite;
}

.svpOverlayCorner {
  position: absolute;
  left: 12px;
  top: 12px;
  padding: 8px 10px;
  border-radius: 12px;
  background: rgba(0, 0, 0, 0.55);
  border: 1px solid rgba(255, 255, 255, 0.08);
  display: inline-flex;
  align-items: center;
  gap: 8px;
  pointer-events: none;
}

.svpSpinnerMini {
  width: 14px;
  height: 14px;
  border-radius: 999px;
  border: 2px solid rgba(255, 255, 255, 0.14);
  border-top-color: rgba(255, 255, 255, 0.85);
  animation: svpSpin 0.9s linear infinite;
}

.svpOverlayTextMini {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.85);
}

@keyframes svpSpin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.svpBigPlay {
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  background: radial-gradient(circle at center, rgba(0, 0, 0, 0.15), rgba(0, 0, 0, 0.55));
  border: 0;
  cursor: pointer;
  color: #fff;
}

.svpBigPlay:hover .svpBigPlayIcon {
  transform: translateY(-1px) scale(1.03);
}

.svpBigPlayIcon {
  width: 74px;
  height: 74px;
  border-radius: 999px;
  display: grid;
  place-items: center;
  font-size: 26px;
  font-weight: 900;
  background: rgba(255, 255, 255, 0.14);
  border: 1px solid rgba(255, 255, 255, 0.22);
  backdrop-filter: blur(10px);
  transition: transform 140ms ease, background 140ms ease;
}

.svpBigPlayText {
  margin-top: 10px;
  font-size: 12px;
  color: rgba(255, 255, 255, 0.78);
}

.svpControls {
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  padding: 10px 12px 12px 12px;
  background: linear-gradient(180deg, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.62) 50%, rgba(0, 0, 0, 0.85));
}

.svpProgressRow {
  display: grid;
  grid-template-columns: 1fr auto;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}

.svpTime {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.86);
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 8px;
  border-radius: 10px;
  background: rgba(255, 255, 255, 0.07);
  border: 1px solid rgba(255, 255, 255, 0.08);
}

.svpTimeSep {
  color: rgba(255, 255, 255, 0.55);
}

.svpControlRow {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.svpLeftControls,
.svpRightControls {
  display: flex;
  align-items: center;
  gap: 8px;
}

.svpVolume {
  display: flex;
  align-items: center;
  gap: 10px;
}

.svpVolumeSlider {
  width: 110px;
}

.svpRateDisabled {
  opacity: 0.75;
}

.svpPolicyHint {
  margin-top: 10px;
  font-size: 12px;
  color: rgba(255, 255, 255, 0.72);
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.svpPolicyHintMuted {
  color: rgba(255, 255, 255, 0.5);
}

.svpPolicyHintItem {
  opacity: 0.92;
}

.svpWatermark {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

.svpWatermarkInner {
  position: absolute;
  right: 12px;
  bottom: 80px;
  padding: 10px 12px;
  border-radius: 14px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  background: rgba(0, 0, 0, 0.28);
  backdrop-filter: blur(10px);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  opacity: 0.82;
}

.svpWatermarkTop {
  font-size: 11px;
  font-weight: 900;
  color: rgba(255, 255, 255, 0.9);
}

.svpWatermarkBottom {
  margin-top: 2px;
  font-size: 11px;
  color: rgba(255, 255, 255, 0.65);
  font-weight: 800;
}

.svpSide {
  min-width: 0;
}

.svpSideCard {
  border-radius: var(--svp-radius);
  padding: 14px;
  background: linear-gradient(180deg, #121214, #0e0e10);
  border: 1px solid rgba(0, 0, 0, 0.48);
  box-shadow: 0 12px 42px rgba(0, 0, 0, 0.28);
}

.svpSideTitle {
  font-weight: 900;
  font-size: 14px;
  letter-spacing: -0.2px;
  margin-bottom: 12px;
}

.svpSideRow {
  display: flex;
  justify-content: space-between;
  gap: 10px;
  padding: 8px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.06);
}

.svpSideRow:last-of-type {
  border-bottom: 0;
}

.svpSideLabel {
  color: rgba(255, 255, 255, 0.62);
  font-size: 12px;
  font-weight: 800;
}

.svpSideValue {
  color: rgba(255, 255, 255, 0.92);
  font-size: 12px;
  font-weight: 900;
}

.svpSideDivider {
  height: 1px;
  background: rgba(255, 255, 255, 0.08);
  margin: 12px 0;
}

.svpSideTitle2 {
  font-weight: 900;
  font-size: 12px;
  color: rgba(255, 255, 255, 0.86);
  margin-bottom: 10px;
}

.svpSideBullets {
  display: grid;
  gap: 8px;
}

.svpSideBullet {
  display: grid;
  grid-template-columns: 10px 1fr;
  gap: 10px;
  align-items: center;
}

.svpSideDot {
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: rgba(255, 255, 255, 0.55);
}

.svpSideTxt {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.72);
  font-weight: 700;
}

.svpSideButton {
  margin-top: 12px;
  width: 100%;
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.14);
  background: rgba(255, 255, 255, 0.1);
  color: rgba(255, 255, 255, 0.92);
  font-weight: 900;
  cursor: pointer;
  transition: transform 120ms ease, background 120ms ease;
}

.svpSideButton:hover {
  transform: translateY(-1px);
  background: rgba(255, 255, 255, 0.13);
}

.svpSideButton:active {
  transform: translateY(0px);
}

.svpSideButtonGhost {
  background: rgba(0, 0, 0, 0.35);
}

.svpSideButtonGhost:hover {
  background: rgba(0, 0, 0, 0.45);
}


==========================================================================================
# FILE: media/playback/player/design/index.ts
==========================================================================================
// PATH: src/student/domains/media/playback/player/design/index.ts
import "./ui.css";

export * from "./ui";
export * from "./utils";


==========================================================================================
# FILE: media/playback/player/design/ui.css
==========================================================================================
/* PATH: src/student/domains/media/playback/player/design/ui.css */
.svpPill {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 9px;
  border-radius: 999px;
  font-size: 11px;
  font-weight: 900;
  color: rgba(255, 255, 255, 0.92);
  background: rgba(255, 255, 255, 0.09);
  border: 1px solid rgba(255, 255, 255, 0.12);
}

.svpPillWarn {
  color: rgba(0, 0, 0, 0.86);
  background: rgba(255, 207, 90, 0.9);
  border-color: rgba(255, 207, 90, 0.75);
}

.svpPillDanger {
  color: rgba(0, 0, 0, 0.86);
  background: rgba(255, 90, 110, 0.92);
  border-color: rgba(255, 90, 110, 0.78);
}

.svpBtn {
  width: 38px;
  height: 38px;
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.14);
  background: rgba(255, 255, 255, 0.08);
  color: rgba(255, 255, 255, 0.92);
  cursor: pointer;
  display: grid;
  place-items: center;
  transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
}

.svpBtn:hover {
  transform: translateY(-1px);
  background: rgba(255, 255, 255, 0.11);
  border-color: rgba(255, 255, 255, 0.2);
}

.svpBtn:active {
  transform: translateY(0px);
}

.svpBtn:disabled {
  cursor: not-allowed;
  opacity: 0.6;
}

.svpBtnIcon {
  font-weight: 900;
  font-size: 12px;
  letter-spacing: -0.2px;
}

.svpBtnKebab .svpBtnIcon {
  font-size: 16px;
  transform: translateY(-1px);
}

.svpRange {
  width: 100%;
  accent-color: rgba(255, 255, 255, 0.92);
  cursor: pointer;
}

.svpMenu {
  position: relative;
}

.svpMenuPanel {
  position: absolute;
  top: 44px;
  left: 0;
  width: 220px;
  border-radius: 14px;
  padding: 6px;
  background: rgba(12, 12, 14, 0.92);
  border: 1px solid rgba(255, 255, 255, 0.12);
  box-shadow: 0 18px 60px rgba(0, 0, 0, 0.48);
  backdrop-filter: blur(12px);
  z-index: 50;
}

.svpMenuRight {
  left: auto;
  right: 0;
}

.svpMenuItem {
  width: 100%;
  text-align: left;
  padding: 10px 10px;
  border: 0;
  border-radius: 10px;
  background: transparent;
  color: rgba(255, 255, 255, 0.88);
  font-weight: 900;
  cursor: pointer;
  font-size: 12px;
}

.svpMenuItem:hover {
  background: rgba(255, 255, 255, 0.08);
}

.svpToast {
  position: fixed;
  left: 50%;
  bottom: 18px;
  transform: translateX(-50%);
  z-index: 1000;

  display: flex;
  align-items: center;
  gap: 10px;

  padding: 10px 12px;
  border-radius: 14px;
  background: rgba(15, 15, 18, 0.92);
  border: 1px solid rgba(255, 255, 255, 0.16);
  box-shadow: 0 18px 70px rgba(0, 0, 0, 0.55);
  backdrop-filter: blur(12px);
}

.svpToastWarn {
  border-color: rgba(255, 207, 90, 0.35);
}

.svpToastDanger {
  border-color: rgba(255, 90, 110, 0.35);
}

.svpToastText {
  font-size: 12px;
  font-weight: 900;
  color: rgba(255, 255, 255, 0.92);
  max-width: min(680px, 86vw);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.svpToastClose {
  width: 30px;
  height: 30px;
  border-radius: 10px;
  border: 1px solid rgba(255, 255, 255, 0.12);
  background: rgba(255, 255, 255, 0.06);
  color: rgba(255, 255, 255, 0.9);
  cursor: pointer;
  display: grid;
  place-items: center;
  font-weight: 900;
}


==========================================================================================
# FILE: media/playback/player/design/ui.tsx
==========================================================================================
// PATH: src/student/domains/media/playback/player/design/ui.tsx
import { useEffect, useMemo, useRef, useState } from "react";
import { clamp } from "./utils";

export function Pill({
  children,
  tone = "neutral",
}: {
  children: any;
  tone?: "neutral" | "warn" | "danger";
}) {
  const cls =
    tone === "danger"
      ? "svpPill svpPillDanger"
      : tone === "warn"
        ? "svpPill svpPillWarn"
        : "svpPill";
  return <span className={cls}>{children}</span>;
}

export function IconButton({
  icon,
  label,
  onClick,
}: {
  icon:
    | "play"
    | "pause"
    | "replay10"
    | "forward10"
    | "volume"
    | "mute"
    | "fullscreen"
    | "theater"
    | "shrink";
  label: string;
  onClick: () => void;
}) {
  return (
    <button type="button" className="svpBtn" onClick={onClick} aria-label={label} title={label}>
      <span className="svpBtnIcon" aria-hidden="true">
        {icon === "play" ? "â–¶" : null}
        {icon === "pause" ? "âšâš" : null}
        {icon === "replay10" ? "â†º10" : null}
        {icon === "forward10" ? "10â†»" : null}
        {icon === "volume" ? "ğŸ”Š" : null}
        {icon === "mute" ? "ğŸ”‡" : null}
        {icon === "fullscreen" ? "â›¶" : null}
        {icon === "theater" ? "â–­" : null}
        {icon === "shrink" ? "â–¢" : null}
      </span>
    </button>
  );
}

export function RangeSlider({
  value,
  min,
  max,
  step,
  onChange,
  ariaLabel,
}: {
  value: number;
  min: number;
  max: number;
  step?: number;
  onChange: (v: number) => void;
  ariaLabel?: string;
}) {
  const v = Number(value || 0);
  const mn = Number(min || 0);
  const mx = Math.max(mn + 0.0001, Number(max || 0));
  const st = Number(step || 0.01);

  return (
    <input
      className="svpRange"
      type="range"
      value={clamp(v, mn, mx)}
      min={mn}
      max={mx}
      step={st}
      onChange={(e) => onChange(Number(e.target.value))}
      aria-label={ariaLabel || "range"}
    />
  );
}

export type MenuItem = {
  label: string;
  onClick: () => void;
};

export function KebabMenu({
  label,
  items,
  align = "left",
  disabled,
  buttonClassName,
}: {
  label: string;
  items: MenuItem[];
  align?: "left" | "right";
  disabled?: boolean;
  buttonClassName?: string;
}) {
  const [open, setOpen] = useState(false);
  const root = useRef<HTMLDivElement | null>(null);

  useEffect(() => {
    const onDown = (e: any) => {
      if (!root.current) return;
      if (!root.current.contains(e.target)) setOpen(false);
    };
    window.addEventListener("mousedown", onDown);
    return () => window.removeEventListener("mousedown", onDown);
  }, []);

  return (
    <div className="svpMenu" ref={root}>
      <button
        type="button"
        className={`svpBtn svpBtnKebab ${buttonClassName || ""}`}
        onClick={() => !disabled && setOpen((v) => !v)}
        aria-label={label}
        title={label}
        disabled={!!disabled}
      >
        <span className="svpBtnIcon" aria-hidden="true">
          â‹®
        </span>
      </button>

      {open && !disabled && (
        <div className={`svpMenuPanel ${align === "right" ? "svpMenuRight" : ""}`}>
          {items.map((it, idx) => (
            <button
              key={idx}
              type="button"
              className="svpMenuItem"
              onClick={() => {
                setOpen(false);
                it.onClick();
              }}
            >
              {it.label}
            </button>
          ))}
        </div>
      )}
    </div>
  );
}

export function PlayerToast({
  toast,
  onClose,
}: {
  toast: { text: string; kind?: "info" | "warn" | "danger" } | null;
  onClose: () => void;
}) {
  const t = toast;
  const [show, setShow] = useState(!!t);

  useEffect(() => {
    if (!t) {
      setShow(false);
      return;
    }
    setShow(true);
    const id = window.setTimeout(() => onClose(), 2600);
    return () => window.clearTimeout(id);
  }, [t, onClose]);

  if (!t || !show) return null;

  const cls =
    t.kind === "danger" ? "svpToast svpToastDanger" : t.kind === "warn" ? "svpToast svpToastWarn" : "svpToast";

  return (
    <div className={cls} role="status" aria-live="polite">
      <div className="svpToastText">{t.text}</div>
      <button type="button" className="svpToastClose" onClick={onClose} aria-label="ë‹«ê¸°">
        âœ•
      </button>
    </div>
  );
}


==========================================================================================
# FILE: media/playback/player/design/utils.ts
==========================================================================================
// PATH: src/student/domains/media/playback/player/design/utils.ts
export function clamp(v: number, min: number, max: number) {
  const n = Number(v);
  if (!Number.isFinite(n)) return min;
  return Math.max(min, Math.min(max, n));
}

export function safeParseInt(v: any, fallback?: number): number | null {
  if (v == null) return fallback ?? null;
  const n = Number.parseInt(String(v), 10);
  if (Number.isNaN(n)) return fallback ?? null;
  return n;
}

export function safeParseFloat(v: any, fallback?: number): number | null {
  if (v == null) return fallback ?? null;
  const n = Number.parseFloat(String(v));
  if (Number.isNaN(n)) return fallback ?? null;
  return n;
}

export function formatClock(sec: number) {
  const s = Math.max(0, Math.floor(Number(sec) || 0));
  const h = Math.floor(s / 3600);
  const m = Math.floor((s % 3600) / 60);
  const ss = s % 60;

  if (h > 0) {
    return `${h}:${String(m).padStart(2, "0")}:${String(ss).padStart(2, "0")}`;
  }
  return `${m}:${String(ss).padStart(2, "0")}`;
}

export function getEpochSec() {
  return Math.floor(Date.now() / 1000);
}

export function formatDateTimeKorean(ms: number) {
  if (!ms) return "-";
  const d = new Date(ms);
  if (Number.isNaN(d.getTime())) return "-";
  const y = d.getFullYear();
  const m = String(d.getMonth() + 1).padStart(2, "0");
  const day = String(d.getDate()).padStart(2, "0");
  const hh = String(d.getHours()).padStart(2, "0");
  const mm = String(d.getMinutes()).padStart(2, "0");
  return `${y}-${m}-${day} ${hh}:${mm}`;
}

export function getOrCreateDeviceId() {
  const key = "student_device_id_v1";
  let v = "";
  try {
    v = String(localStorage.getItem(key) || "");
  } catch {
    v = "";
  }
  if (v && v.length >= 12) return v;

  const seed = Math.random().toString(16).slice(2);
  const now = Date.now().toString(16);
  v = `dev_${now}_${seed}`.replace(/[^a-zA-Z0-9_]/g, "").slice(0, 42);

  try {
    localStorage.setItem(key, v);
  } catch {}

  return v;
}


==========================================================================================
# FILE: more/pages/MorePage.tsx
==========================================================================================
/**
 * ë”ë³´ê¸° â€” í”„ë¡œí•„, ê²Œì‹œíŒ, ì¶œê²°, í´ë¦¬ë‹‰ ì¸ì¦ ë“±
 */
import { Link } from "react-router-dom";
import { logout } from "@/features/auth/api/auth";
import {
  IconUser,
  IconBoard,
  IconClipboard,
  IconCheck,
  IconExam,
  IconGrade,
  IconLogout,
} from "@/student/shared/ui/icons/Icons";

const linkStyle: React.CSSProperties = {
  display: "flex",
  alignItems: "center",
  gap: "var(--stu-space-4)",
  padding: "var(--stu-space-4) var(--stu-space-4)",
  borderRadius: "var(--stu-radius-md)",
  background: "var(--stu-surface)",
  border: "1px solid var(--stu-border)",
  color: "var(--stu-text)",
  textDecoration: "none",
  fontWeight: 700,
  fontSize: 15,
  marginBottom: "var(--stu-space-2)",
};

export default function MorePage() {
  return (
    <div style={{ padding: "var(--stu-space-2) 0" }}>
      <h1 style={{ fontSize: 20, fontWeight: 800, marginBottom: "var(--stu-space-6)", paddingLeft: "var(--stu-space-2)" }}>
        ë”ë³´ê¸°
      </h1>

      <section style={{ marginBottom: "var(--stu-space-8)" }}>
        <h2 className="stu-muted" style={{ fontSize: 12, fontWeight: 800, marginBottom: "var(--stu-space-3)", paddingLeft: 4 }}>
          í•™ìŠµ
        </h2>
        <Link to="/student/exams" style={linkStyle}>
          <IconExam style={{ width: 22, height: 22, flexShrink: 0 }} />
          ì‹œí—˜
        </Link>
        <Link to="/student/grades" style={linkStyle}>
          <IconGrade style={{ width: 22, height: 22, flexShrink: 0 }} />
          ì„±ì 
        </Link>
      </section>

      <section style={{ marginBottom: "var(--stu-space-8)" }}>
        <h2 className="stu-muted" style={{ fontSize: 12, fontWeight: 800, marginBottom: "var(--stu-space-3)", paddingLeft: 4 }}>
          ì†Œí†µ
        </h2>
        <Link to="/student/qna" style={linkStyle}>
          <IconBoard style={{ width: 22, height: 22, flexShrink: 0 }} />
          Q&amp;A ê²Œì‹œíŒ
        </Link>
      </section>

      <section style={{ marginBottom: "var(--stu-space-8)" }}>
        <h2 className="stu-muted" style={{ fontSize: 12, fontWeight: 800, marginBottom: "var(--stu-space-3)", paddingLeft: 4 }}>
          ê¸°íƒ€
        </h2>
        <Link to="/student/attendance" style={linkStyle}>
          <IconClipboard style={{ width: 22, height: 22, flexShrink: 0 }} />
          ì¶œê²° í˜„í™©
        </Link>
        <Link to="/student/idcard" style={linkStyle}>
          <IconCheck style={{ width: 22, height: 22, flexShrink: 0 }} />
          í´ë¦¬ë‹‰ ì¸ì¦
        </Link>
        <Link to="/student/profile" style={linkStyle}>
          <IconUser style={{ width: 22, height: 22, flexShrink: 0 }} />
          í”„ë¡œí•„
        </Link>
      </section>

      <section>
        <button
          type="button"
          className="stu-btn stu-btn--danger"
          style={{
            width: "100%",
            marginBottom: 0,
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            gap: "var(--stu-space-4)",
            padding: "var(--stu-space-4)",
            fontSize: 15,
            fontWeight: 700,
          }}
          onClick={() => logout()}
        >
          <IconLogout style={{ width: 22, height: 22 }} />
          ë¡œê·¸ì•„ì›ƒ
        </button>
      </section>
    </div>
  );
}


==========================================================================================
# FILE: profile/api/profile.ts
==========================================================================================
// PATH: src/student/domains/profile/api/profile.ts
import api from "@/student/shared/api/studentApi";

export type MyProfile = {
  id: number;
  name: string;
  profile_photo_url: string | null;
};

export async function fetchMyProfile(): Promise<MyProfile> {
  const res = await api.get<MyProfile>("/student/me/");
  return res.data;
}

export async function updateMyProfilePhoto(file: File): Promise<MyProfile> {
  const form = new FormData();
  form.append("profile_photo", file);
  const res = await api.patch<MyProfile>("/student/me/", form);
  return res.data;
}


==========================================================================================
# FILE: profile/pages/ProfilePage.tsx
==========================================================================================
// PATH: src/student/domains/profile/pages/ProfilePage.tsx
// í•™ìƒì´ ë³¸ì¸ í”„ë¡œí•„ ì‚¬ì§„ë§Œ ì—…ë¡œë“œ (ê´€ë¦¬ì í¸ì§‘ ë¶ˆê°€)

import { useRef } from "react";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import StudentPageShell from "@/student/shared/ui/pages/StudentPageShell";
import { fetchMyProfile, updateMyProfilePhoto } from "../api/profile";
import EmptyState from "@/student/shared/ui/layout/EmptyState";

export default function ProfilePage() {
  const inputRef = useRef<HTMLInputElement>(null);
  const qc = useQueryClient();

  const { data: profile, isLoading, isError } = useQuery({
    queryKey: ["student", "me"],
    queryFn: fetchMyProfile,
  });

  const uploadMutation = useMutation({
    mutationFn: (file: File) => updateMyProfilePhoto(file),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["student", "me"] });
    },
  });

  const handleFile = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file && file.type.startsWith("image/")) {
      uploadMutation.mutate(file);
    }
    e.target.value = "";
  };

  if (isLoading) {
    return (
      <StudentPageShell title="ë‚´ ì •ë³´">
        <div className="stu-muted">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </StudentPageShell>
    );
  }

  if (isError || !profile) {
    return (
      <StudentPageShell title="ë‚´ ì •ë³´">
        <EmptyState
          title="í”„ë¡œí•„ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤."
          description="ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
        />
      </StudentPageShell>
    );
  }

  return (
    <StudentPageShell title="ë‚´ ì •ë³´" description="í”„ë¡œí•„ ì‚¬ì§„ê³¼ ì´ë¦„ì´ í—¤ë”ì— í‘œì‹œë©ë‹ˆë‹¤.">
      <div className="stu-section stu-section--nested">
        <div
          style={{
            display: "flex",
            flexDirection: "column",
            alignItems: "center",
            gap: "var(--stu-space-6)",
          }}
        >
          <div
            style={{
              width: 96,
              height: 96,
              borderRadius: 16,
              overflow: "hidden",
              background: "var(--stu-surface-soft)",
              border: "2px solid var(--stu-border)",
              display: "grid",
              placeItems: "center",
              fontSize: 36,
              fontWeight: 800,
              color: "var(--stu-primary)",
            }}
          >
            {profile.profile_photo_url ? (
              <img
                src={profile.profile_photo_url}
                alt="í”„ë¡œí•„"
                style={{ width: "100%", height: "100%", objectFit: "cover" }}
              />
            ) : (
              (profile.name || "?")[0]
            )}
          </div>
          <div style={{ fontWeight: 800, fontSize: 18 }}>{profile.name}</div>
          <input
            ref={inputRef}
            type="file"
            accept="image/*"
            onChange={handleFile}
            style={{ display: "none" }}
            aria-label="í”„ë¡œí•„ ì‚¬ì§„ ì„ íƒ"
          />
          <button
            type="button"
            className="stu-btn stu-btn--primary stu-btn--sm"
            disabled={uploadMutation.isPending}
            onClick={() => inputRef.current?.click()}
          >
            {uploadMutation.isPending ? "ì—…ë¡œë“œ ì¤‘â€¦" : "ì‚¬ì§„ ë³€ê²½"}
          </button>
          {uploadMutation.isError && (
            <div className="stu-muted" style={{ fontSize: 13 }}>
              ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì„ íƒí•´ ì£¼ì„¸ìš”.
            </div>
          )}
        </div>
      </div>
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: qna/pages/QnaPage.tsx
==========================================================================================
/**
 * í•™ìƒ Q&A â€” ë©”ì¼ ë³´ë‚´ê¸°ì²˜ëŸ¼ ì§ˆë¬¸ + ì‚¬ì§„/íŒŒì¼ ì²¨ë¶€ ì „ì†¡
 * ì •ë ¬Â·ëª©ë¡Â·ìƒì„¸ëŠ” ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì²˜ë¦¬
 */
import { useState, useRef } from "react";
import { useMutation, useQuery, useQueryClient } from "@tanstack/react-query";
import StudentPageShell from "@/student/shared/ui/pages/StudentPageShell";
import { fetchBlockTypes, createPost } from "@/features/community/api/community.api";

const QNA_BLOCK_CODE = "qna";
const MAX_FILES = 5;
const MAX_SIZE_MB = 10;

export default function QnaPage() {
  const qc = useQueryClient();
  const [title, setTitle] = useState("");
  const [content, setContent] = useState("");
  const [files, setFiles] = useState<File[]>([]);
  const fileInputRef = useRef<HTMLInputElement>(null);

  const { data: blockTypes = [] } = useQuery({
    queryKey: ["community-block-types"],
    queryFn: () => fetchBlockTypes(),
  });

  const qnaBlockType =
    blockTypes.find((b) => (b.code || "").toLowerCase() === QNA_BLOCK_CODE) ?? blockTypes[0];
  const effectiveBlockTypeId = qnaBlockType?.id ?? blockTypes[0]?.id;

  const createMut = useMutation({
    mutationFn: () =>
      createPost({
        block_type: effectiveBlockTypeId!,
        title: title.trim(),
        content: content.trim(),
        node_ids: [],
      }),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["student-community-posts"] });
      setTitle("");
      setContent("");
      setFiles([]);
    },
  });

  const canSubmit =
    title.trim().length > 0 && content.trim().length > 0 && effectiveBlockTypeId != null;

  const addFiles = (e: React.ChangeEvent<HTMLInputElement>) => {
    const chosen = Array.from(e.target.files || []);
    const ok: File[] = [];
    for (const f of chosen) {
      if (f.size > MAX_SIZE_MB * 1024 * 1024) continue;
      if (ok.length + files.length >= MAX_FILES) break;
      ok.push(f);
    }
    setFiles((prev) => [...prev, ...ok].slice(0, MAX_FILES));
    e.target.value = "";
  };
  const removeFile = (index: number) => setFiles((prev) => prev.filter((_, i) => i !== index));

  return (
    <StudentPageShell
      title="ì§ˆë¬¸ ë³´ë‚´ê¸°"
      description="ê¶ê¸ˆí•œ ì ì„ ì ì–´ ë³´ë‚´ë©´ ì„ ìƒë‹˜ì´ í™•ì¸í•´ ì£¼ì„¸ìš”."
    >
      <div
        className="stu-section stu-section--nested"
        style={{
          display: "flex",
          flexDirection: "column",
          gap: "var(--stu-space-4)",
        }}
      >
        <label style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-2)" }}>
          <span style={{ fontSize: 14, fontWeight: 600, color: "var(--stu-text-muted)" }}>
            ì œëª©
          </span>
          <input
            type="text"
            placeholder="ì§ˆë¬¸ ì œëª©"
            value={title}
            onChange={(e) => setTitle(e.target.value)}
            className="stu-input"
            style={{ width: "100%" }}
          />
        </label>
        <label style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-2)", flex: 1 }}>
          <span style={{ fontSize: 14, fontWeight: 600, color: "var(--stu-text-muted)" }}>
            ë‚´ìš©
          </span>
          <textarea
            placeholder="ì§ˆë¬¸ ë‚´ìš©ì„ ì ì–´ ì£¼ì„¸ìš”."
            value={content}
            onChange={(e) => setContent(e.target.value)}
            rows={8}
            className="stu-textarea"
            style={{ width: "100%", resize: "vertical", minHeight: 160 }}
          />
        </label>
        <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-2)" }}>
          <span style={{ fontSize: 14, fontWeight: 600, color: "var(--stu-text-muted)" }}>
            ì‚¬ì§„Â·íŒŒì¼ (ì„ íƒ, ìµœëŒ€ {MAX_FILES}ê°œ, ê°œë‹¹ {MAX_SIZE_MB}MB)
          </span>
          <input
            ref={fileInputRef}
            type="file"
            accept="image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt"
            multiple
            onChange={addFiles}
            style={{ display: "none" }}
          />
          <button
            type="button"
            className="stu-btn stu-btn--secondary stu-btn--sm"
            onClick={() => fileInputRef.current?.click()}
            style={{ alignSelf: "flex-start" }}
          >
            íŒŒì¼ ì„ íƒ
          </button>
          {files.length > 0 && (
            <ul style={{ listStyle: "none", padding: 0, margin: 0, display: "flex", flexDirection: "column", gap: "var(--stu-space-2)" }}>
              {files.map((f, i) => (
                <li
                  key={`${f.name}-${i}`}
                  style={{
                    display: "flex",
                    alignItems: "center",
                    justifyContent: "space-between",
                    padding: "var(--stu-space-2) var(--stu-space-3)",
                    background: "var(--stu-surface)",
                    border: "1px solid var(--stu-border)",
                    borderRadius: "var(--stu-radius)",
                    fontSize: 13,
                    color: "var(--stu-text)",
                  }}
                >
                  <span style={{ overflow: "hidden", textOverflow: "ellipsis", whiteSpace: "nowrap", flex: 1, minWidth: 0 }}>
                    {f.name} ({(f.size / 1024).toFixed(1)}KB)
                  </span>
                  <button
                    type="button"
                    className="stu-btn stu-btn--ghost stu-btn--sm"
                    onClick={() => removeFile(i)}
                    style={{ flexShrink: 0, padding: "var(--stu-space-1) var(--stu-space-2)" }}
                  >
                    ì‚­ì œ
                  </button>
                </li>
              ))}
            </ul>
          )}
        </div>
        {createMut.isSuccess && (
          <div
            style={{
              padding: "var(--stu-space-3)",
              background: "var(--stu-success-bg)",
              borderRadius: "var(--stu-radius)",
              fontSize: 14,
              color: "var(--stu-success-text)",
            }}
          >
            ì§ˆë¬¸ì´ ì „ë‹¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì„ ìƒë‹˜ì´ í™•ì¸ í›„ ë‹µë³€í•´ ì£¼ì‹¤ ê±°ì˜ˆìš”.
          </div>
        )}
        {createMut.isError && (
          <div style={{ fontSize: 13, color: "var(--stu-danger)" }}>
            {createMut.error instanceof Error ? createMut.error.message : "ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."}
          </div>
        )}
        <button
          type="button"
          className="stu-btn stu-btn--primary"
          disabled={!canSubmit || createMut.isPending}
          onClick={() => createMut.mutate()}
          style={{ alignSelf: "flex-end" }}
        >
          {createMut.isPending ? "ë³´ë‚´ëŠ” ì¤‘â€¦" : "ì§ˆë¬¸ ë³´ë‚´ê¸°"}
        </button>
      </div>
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: sessions/api/sessions.ts
==========================================================================================
// PATH: src/student/domains/sessions/api/sessions.ts

import api from "@/student/shared/api/studentApi";

export type StudentSession = {
  id: number;
  title: string;
  date?: string | null;
  status?: string | null;
  exam_ids?: number[] | null;
};

export async function fetchMySessions(): Promise<StudentSession[]> {
  const res = await api.get("/student/sessions/me/");
  const data = res.data;
  if (Array.isArray(data)) return data as StudentSession[];
  if (Array.isArray(data?.items)) return data.items as StudentSession[];
  return [];
}

export async function fetchSessionDetail(sessionId: number): Promise<StudentSession> {
  const res = await api.get(`/student/sessions/${sessionId}/`);
  return res.data as StudentSession;
}


==========================================================================================
# FILE: sessions/components/SessionAssignmentAction.tsx
==========================================================================================



==========================================================================================
# FILE: sessions/components/SessionExamAction.tsx
==========================================================================================



==========================================================================================
# FILE: sessions/components/SessionInfoCard.tsx
==========================================================================================



==========================================================================================
# FILE: sessions/components/SessionVideoAction.tsx
==========================================================================================



==========================================================================================
# FILE: sessions/hooks/useStudentSessions.ts
==========================================================================================
// src/student/domains/sessions/hooks/useStudentSessions.ts
/**
 * âœ… useStudentSessions
 */

import { useQuery } from "@tanstack/react-query";
import { fetchMySessions, fetchSessionDetail } from "@/student/domains/sessions/api/sessions";

export function useMySessions() {
  return useQuery({
    queryKey: ["student-sessions"],
    queryFn: fetchMySessions,
  });
}

export function useSessionDetail(sessionId?: number) {
  const safeId = Number(sessionId);
  return useQuery({
    queryKey: ["student-session", safeId],
    queryFn: () => fetchSessionDetail(safeId),
    enabled: Number.isFinite(safeId),
  });
}


==========================================================================================
# FILE: sessions/pages/SessionDetailPage.tsx
==========================================================================================
// src/student/domains/sessions/pages/SessionDetailPage.tsx
/**
 * âœ… SessionDetailPage (í—ˆë¸Œ)
 * - í•™ìƒ ì•±ì˜ "í–‰ë™ ì¤‘ì‹¬ í—ˆë¸Œ"
 * - ì˜ìƒ/ì‹œí—˜/ê³¼ì œ/ìë£Œ ë§í¬ë§Œ ì œê³µ (íŒë‹¨/ê³„ì‚° âŒ)
 *
 * ì£¼ì˜:
 * - session â†’ exam ì—°ê²° ì¶”ë¡  âŒ
 * - ë°±ì—”ë“œê°€ exam_ids ë“±ì„ ë‚´ë ¤ì£¼ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
 * - ì—†ìœ¼ë©´ "ì‹œí—˜ìœ¼ë¡œ ì´ë™" ê°™ì€ ë²”ìš© ë§í¬ë§Œ ì œê³µ
 */

import { Link, useParams } from "react-router-dom";
import StudentPageShell from "../../../shared/ui/pages/StudentPageShell";
import EmptyState from "../../../shared/ui/layout/EmptyState";
import { useSessionDetail } from "@/student/domains/sessions/hooks/useStudentSessions";
import { formatYmd } from "@/student/shared/utils/date";

export default function SessionDetailPage() {
  const { sessionId } = useParams();
  const safeId = Number(sessionId);

  const { data, isLoading, isError } = useSessionDetail(
    Number.isFinite(safeId) ? safeId : undefined
  );

  if (!Number.isFinite(safeId)) {
    return (
      <StudentPageShell title="ì°¨ì‹œ" description="ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.">
        <EmptyState title="ì„¸ì…˜ IDê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  if (isLoading) {
    return (
      <StudentPageShell title="ì°¨ì‹œ" description="ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...">
        <div style={{ fontSize: 14, color: "#666" }}>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </StudentPageShell>
    );
  }

  if (isError || !data) {
    return (
      <StudentPageShell title="ì°¨ì‹œ" description="ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.">
        <EmptyState title="ì°¨ì‹œ ìƒì„¸ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  return (
    <StudentPageShell title={data.title} description={`ë‚ ì§œ: ${formatYmd(data.date ?? null)}`}>
      <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
        {/* ===== Actions ===== */}
        <ActionCard title="ì˜ìƒ ë³´ê¸°" desc="ë¯¸ë””ì–´ ë„ë©”ì¸ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.">
          {/* media ì´ì‹ ì „ì´ë©´ ë§í¬ë§Œ ìë¦¬ í™•ë³´ */}
          <Link to={`/student/video?session=${data.id}`} className="stu-cta-link">
            ì˜ìƒìœ¼ë¡œ ì´ë™
          </Link>
        </ActionCard>

        <ActionCard title="ì‹œí—˜/í‰ê°€" desc="ì‹œí—˜ ëª©ë¡ ë˜ëŠ” í•´ë‹¹ ì‹œí—˜ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.">
          {/* âœ… ë°±ì—”ë“œê°€ exam_ids ë‚´ë ¤ì£¼ëŠ” ê²½ìš°: ì§ì ‘ ë§í¬ */}
          {Array.isArray(data.exam_ids) && data.exam_ids.length > 0 ? (
            <div style={{ display: "flex", gap: 8, flexWrap: "wrap" }}>
              {data.exam_ids.map((eid) => (
                <Link key={eid} to={`/student/exams/${eid}`} className="stu-cta-link">
                  ì‹œí—˜ #{eid}
                </Link>
              ))}
            </div>
          ) : (
            <Link to="/student/exams" className="stu-cta-link">
              ì‹œí—˜ ëª©ë¡ ë³´ê¸°
            </Link>
          )}
        </ActionCard>

        <ActionCard title="ì„±ì " desc="ê²°ê³¼ ìš”ì•½ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.">
          <Link to="/student/grades" className="stu-cta-link">
            ì„±ì  ë³´ê¸°
          </Link>
        </ActionCard>

        <div className="stu-muted" style={{ fontSize: 12 }}>
          â€» ì´ í˜ì´ì§€ëŠ” â€œí–‰ë™ í—ˆë¸Œâ€ì…ë‹ˆë‹¤. ì •ì±…/ìƒíƒœ íŒë‹¨ì€ ë°±ì—”ë“œê°€ ì±…ì„ì§‘ë‹ˆë‹¤.
        </div>
      </div>
    </StudentPageShell>
  );
}

function ActionCard({
  title,
  desc,
  children,
}: {
  title: string;
  desc: string;
  children: React.ReactNode;
}) {
  return (
    <div className="stu-section">
      <div className="stu-section-header" style={{ fontWeight: 700, fontSize: 15 }}>
        {title}
      </div>
      <div className="stu-muted" style={{ fontSize: 13, marginBottom: "var(--stu-space-4)" }}>{desc}</div>
      <div>{children}</div>
    </div>
  );
}


==========================================================================================
# FILE: sessions/pages/SessionListPage.tsx
==========================================================================================
/**
 * ì¼ì • â€” ë‚´ ì°¨ì‹œ ëª©ë¡, ìœ íŠœë¸Œí˜• ì¹´ë“œ
 */
import { Link } from "react-router-dom";
import { useMySessions } from "@/student/domains/sessions/hooks/useStudentSessions";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import { formatYmd } from "@/student/shared/utils/date";
import { IconCalendar, IconChevronRight } from "@/student/shared/ui/icons/Icons";

export default function SessionListPage() {
  const { data, isLoading, isError } = useMySessions();

  if (isLoading) {
    return (
      <div style={{ padding: "var(--stu-space-4) 0" }}>
        <div className="stu-skel" style={{ height: 72, borderRadius: "var(--stu-radius-md)", marginBottom: 8 }} />
        <div className="stu-skel" style={{ height: 72, borderRadius: "var(--stu-radius-md)" }} />
      </div>
    );
  }

  if (isError || !data) {
    return (
      <div style={{ padding: "var(--stu-space-4) 0" }}>
        <h1 style={{ fontSize: 20, fontWeight: 800, marginBottom: "var(--stu-space-6)" }}>ì¼ì •</h1>
        <EmptyState title="ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤." description="ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”." />
      </div>
    );
  }

  if (data.length === 0) {
    return (
      <div style={{ padding: "var(--stu-space-4) 0" }}>
        <h1 style={{ fontSize: 20, fontWeight: 800, marginBottom: "var(--stu-space-6)" }}>ì¼ì •</h1>
        <EmptyState title="ë“±ë¡ëœ ì°¨ì‹œê°€ ì—†ìŠµë‹ˆë‹¤." description="ìˆ˜ê°• ì¤‘ì¸ ê°•ì˜/ì°¨ì‹œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”." />
      </div>
    );
  }

  return (
    <div style={{ padding: "var(--stu-space-2) 0" }}>
      <h1 style={{ fontSize: 20, fontWeight: 800, marginBottom: "var(--stu-space-6)", paddingLeft: "var(--stu-space-2)" }}>
        ì¼ì •
      </h1>
      <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-3)" }}>
        {data.map((s) => (
          <Link
            key={s.id}
            to={`/student/sessions/${s.id}`}
            className="stu-card stu-card--pressable"
            style={{
              display: "flex",
              alignItems: "center",
              gap: "var(--stu-space-4)",
              textDecoration: "none",
              color: "inherit",
            }}
          >
            <div style={{ width: 44, height: 44, borderRadius: 12, background: "var(--stu-surface-soft)", display: "grid", placeItems: "center" }}>
              <IconCalendar style={{ width: 22, height: 22, color: "var(--stu-primary)" }} />
            </div>
            <div style={{ flex: 1, minWidth: 0 }}>
              <div style={{ fontWeight: 800, fontSize: 15 }}>{s.title}</div>
              <div className="stu-muted" style={{ fontSize: 13, marginTop: 2 }}>
                {formatYmd(s.date ?? null)}
                {s.status ? ` Â· ${s.status}` : ""}
              </div>
            </div>
            <IconChevronRight style={{ width: 20, height: 20, color: "var(--stu-text-muted)" }} />
          </Link>
        ))}
      </div>
    </div>
  );
}
