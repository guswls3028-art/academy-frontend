====================================================================================================
# FRONTEND FOLDER: student__domains
# ROOT PATH: C:\academyfront\src\student\domains
====================================================================================================


==========================================================================================
# FILE: attendance/pages/AttendancePage.tsx
==========================================================================================
/**
 * ì¶œê²° í˜„í™© â€” ëŒ€í˜•í•™ì› SaaS ê¸°ì¤€ placeholder
 */
import EmptyState from "@/student/shared/ui/layout/EmptyState";

export default function AttendancePage() {
  return (
    <div style={{ padding: "var(--stu-space-4) 0" }}>
      <h1 style={{ fontSize: 20, fontWeight: 800, marginBottom: "var(--stu-space-6)" }}>
        ì¶œê²° í˜„í™©
      </h1>
      <EmptyState
        title="ì¶œê²° ì •ë³´"
        description="ìˆ˜ì—…ë³„ ì¶œì„ í˜„í™©ì€ ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ í™•ì¸í•œ ë’¤ ì•ˆë‚´ë©ë‹ˆë‹¤. API ì—°ë™ ì‹œ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."
      />
    </div>
  );
}


==========================================================================================
# FILE: clinic/IMPLEMENTATION_SUMMARY.md
==========================================================================================
# í´ë¦¬ë‹‰ ì˜ˆì•½ ê¸°ëŠ¥ êµ¬í˜„ ì™„ë£Œ ìš”ì•½

## âœ… ì™„ë£Œëœ ì‘ì—…

### ë°±ì—”ë“œ ìˆ˜ì • ì‚¬í•­

1. **ëª¨ë¸ í™•ì¥** (`apps/domains/clinic/models.py`)
   - `SessionParticipant.Status`ì— `PENDING`, `REJECTED` ì¶”ê°€
   - `SessionParticipant.Source`ì— `STUDENT_REQUEST` ì¶”ê°€
   - ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„± ë° ì ìš© ì™„ë£Œ

2. **API í™•ì¥** (`apps/domains/clinic/views.py`)
   - `ParticipantViewSet.get_queryset()`: í•™ìƒì´ ì¡°íšŒí•  ë•Œ ìì‹ ì˜ ì˜ˆì•½ë§Œ ë°˜í™˜
   - `ParticipantViewSet.create()`: í•™ìƒì´ ì‹ ì²­í•  ë•Œ ìë™ìœ¼ë¡œ student, source, status, enrollment_id ì„¤ì •
   - `ParticipantViewSet.set_status()`: í•™ìƒ ê¶Œí•œ ì²´í¬ ì¶”ê°€ (ìì‹ ì˜ pending ì˜ˆì•½ë§Œ ì·¨ì†Œ ê°€ëŠ¥)
   - `SessionViewSet.get_queryset()`: `booked_count`ì— `PENDING` ìƒíƒœë„ í¬í•¨

3. **Serializer ìˆ˜ì •** (`apps/domains/clinic/serializers.py`)
   - `ClinicSessionParticipantCreateSerializer`: `student` í•„ë“œë¥¼ `required=False`ë¡œ ì„¤ì •

### í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„ ì‚¬í•­

1. **API ë ˆì´ì–´** (`src/student/domains/clinic/api/clinicBooking.api.ts`)
   - `fetchAvailableClinicSessions()`: ì˜ˆì•½ ê°€ëŠ¥í•œ ì„¸ì…˜ ëª©ë¡ ì¡°íšŒ
   - `fetchMyClinicBookingRequests()`: í•™ìƒì˜ ì˜ˆì•½ ì‹ ì²­ ëª©ë¡ ì¡°íšŒ
   - `createClinicBookingRequest()`: ì˜ˆì•½ ì‹ ì²­ ìƒì„±
   - `cancelClinicBookingRequest()`: ì˜ˆì•½ ì‹ ì²­ ì·¨ì†Œ

2. **UI ì»´í¬ë„ŒíŠ¸** (`src/student/domains/clinic/pages/ClinicBookingPage.tsx`)
   - ì˜ˆì•½ ê°€ëŠ¥í•œ í´ë¦¬ë‹‰ ì„¸ì…˜ ëª©ë¡ í‘œì‹œ
   - ë‚´ ì˜ˆì•½ ì‹ ì²­ í˜„í™© í‘œì‹œ (ìŠ¹ì¸ ëŒ€ê¸°, ìŠ¹ì¸ë¨, ê±°ë¶€ë¨, ì·¨ì†Œë¨)
   - ì„¸ì…˜ ì„ íƒ ë° ì˜ˆì•½ ì‹ ì²­ ê¸°ëŠ¥
   - ë©”ëª¨ ì…ë ¥ ê¸°ëŠ¥
   - ì˜ˆì•½ ì‹ ì²­ ì·¨ì†Œ ê¸°ëŠ¥

3. **ë¼ìš°í„° ì—°ê²°** (`src/student/app/StudentRouter.tsx`)
   - `/student/clinic/booking` ê²½ë¡œ ì¶”ê°€

4. **ëŒ€ì‹œë³´ë“œ ì—°ê²°** (`src/student/domains/dashboard/pages/DashboardPage.tsx`)
   - "í´ë¦¬ë‹‰" ë° "í´ë¦¬ë‹‰ ì˜ˆì•½í•˜ê¸°" ë¹ ë¥¸ ë©”ë‰´ ì¶”ê°€

## ğŸ”„ ë™ì‘ íë¦„

1. **í•™ìƒì´ ì˜ˆì•½ ì‹ ì²­**
   ```
   í•™ìƒ â†’ í´ë¦¬ë‹‰ ì˜ˆì•½í•˜ê¸° í˜ì´ì§€ ì ‘ì†
   â†’ ì˜ˆì•½ ê°€ëŠ¥í•œ ì„¸ì…˜ ëª©ë¡ ì¡°íšŒ (GET /clinic/sessions/)
   â†’ ì„¸ì…˜ ì„ íƒ ë° ì˜ˆì•½ ì‹ ì²­ (POST /clinic/participants/)
   â†’ ë°±ì—”ë“œì—ì„œ ìë™ìœ¼ë¡œ student, source="student_request", status="pending" ì„¤ì •
   â†’ ì˜ˆì•½ ì‹ ì²­ ì™„ë£Œ (ìŠ¹ì¸ ëŒ€ê¸° ìƒíƒœ)
   ```

2. **í•™ìƒì´ ì˜ˆì•½ ì‹ ì²­ í™•ì¸**
   ```
   í•™ìƒ â†’ ë‚´ ì˜ˆì•½ ì‹ ì²­ í˜„í™© ì¡°íšŒ (GET /clinic/participants/)
   â†’ ë°±ì—”ë“œì—ì„œ ìë™ìœ¼ë¡œ ìì‹ ì˜ ì˜ˆì•½ë§Œ ë°˜í™˜
   â†’ ìƒíƒœ í‘œì‹œ: pending (ìŠ¹ì¸ ëŒ€ê¸°), booked (ìŠ¹ì¸ë¨), rejected (ê±°ë¶€ë¨)
   ```

3. **í•™ìƒì´ ì˜ˆì•½ ì·¨ì†Œ**
   ```
   í•™ìƒ â†’ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ì˜ˆì•½ ì„ íƒ
   â†’ ì·¨ì†Œ ë²„íŠ¼ í´ë¦­ (PATCH /clinic/participants/{id}/set_status/)
   â†’ ë°±ì—”ë“œì—ì„œ ê¶Œí•œ ì²´í¬: ìì‹ ì˜ pending ì˜ˆì•½ë§Œ ì·¨ì†Œ ê°€ëŠ¥
   â†’ ìƒíƒœ ë³€ê²½: pending â†’ cancelled
   ```

4. **ì„ ìƒì´ ì˜ˆì•½ ìŠ¹ì¸/ê±°ë¶€**
   ```
   ì„ ìƒ â†’ í´ë¦¬ë‹‰ ê´€ë¦¬ í˜ì´ì§€ ì ‘ì† (/admin/clinic/bookings)
   â†’ í•™ìƒì˜ ì˜ˆì•½ ì‹ ì²­ ëª©ë¡ í™•ì¸ (status="pending")
   â†’ ìŠ¹ì¸/ê±°ë¶€ ë²„íŠ¼ í´ë¦­ (PATCH /clinic/participants/{id}/set_status/)
   â†’ ìƒíƒœ ë³€ê²½: pending â†’ booked (ìŠ¹ì¸) ë˜ëŠ” pending â†’ rejected (ê±°ë¶€)
   ```

## ğŸ“‹ í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

### í•™ìƒ ì•± í…ŒìŠ¤íŠ¸
- [ ] `/student/clinic/booking` í˜ì´ì§€ ì ‘ì† ê°€ëŠ¥
- [ ] ì˜ˆì•½ ê°€ëŠ¥í•œ í´ë¦¬ë‹‰ ì„¸ì…˜ ëª©ë¡ì´ í‘œì‹œë¨
- [ ] ì„¸ì…˜ ì„ íƒ í›„ ì˜ˆì•½ ì‹ ì²­ ê°€ëŠ¥
- [ ] ì˜ˆì•½ ì‹ ì²­ í›„ "ìŠ¹ì¸ ëŒ€ê¸°" ìƒíƒœë¡œ í‘œì‹œë¨
- [ ] ë‚´ ì˜ˆì•½ ì‹ ì²­ í˜„í™©ì— ì‹ ì²­í•œ ì˜ˆì•½ì´ í‘œì‹œë¨
- [ ] ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ì˜ˆì•½ ì·¨ì†Œ ê°€ëŠ¥
- [ ] ì´ë¯¸ ì‹ ì²­í•œ ì„¸ì…˜ì€ ì˜ˆì•½ ê°€ëŠ¥ ëª©ë¡ì—ì„œ ì œì™¸ë¨
- [ ] ì •ì›ì´ ë§ˆê°ëœ ì„¸ì…˜ì€ í‘œì‹œë˜ì§€ ì•ŠìŒ

### ì„ ìƒ ì•± í…ŒìŠ¤íŠ¸
- [ ] í•™ìƒì˜ ì˜ˆì•½ ì‹ ì²­(`status: "pending"`)ì´ í‘œì‹œë¨
- [ ] ì˜ˆì•½ ì‹ ì²­ì„ ìŠ¹ì¸í•  ìˆ˜ ìˆìŒ (`pending` â†’ `booked`)
- [ ] ì˜ˆì•½ ì‹ ì²­ì„ ê±°ë¶€í•  ìˆ˜ ìˆìŒ (`pending` â†’ `rejected`)

## ğŸ”§ ë°±ì—”ë“œ API ì—”ë“œí¬ì¸íŠ¸

### í•™ìƒìš©
- `GET /api/v1/clinic/sessions/?date_from=YYYY-MM-DD&date_to=YYYY-MM-DD`
  - ì˜ˆì•½ ê°€ëŠ¥í•œ í´ë¦¬ë‹‰ ì„¸ì…˜ ëª©ë¡ ì¡°íšŒ
  - í•™ìƒë„ ì ‘ê·¼ ê°€ëŠ¥ (ê¶Œí•œ ì²´í¬ ì™„ë£Œ)

- `GET /api/v1/clinic/participants/`
  - í•™ìƒì˜ ì˜ˆì•½ ì‹ ì²­ ëª©ë¡ ì¡°íšŒ
  - ë°±ì—”ë“œì—ì„œ ìë™ìœ¼ë¡œ ìì‹ ì˜ ì˜ˆì•½ë§Œ ë°˜í™˜

- `POST /api/v1/clinic/participants/`
  - ì˜ˆì•½ ì‹ ì²­ ìƒì„±
  - í•™ìƒì´ í˜¸ì¶œ ì‹œ: student, source, status, enrollment_id ìë™ ì„¤ì •

- `PATCH /api/v1/clinic/participants/{id}/set_status/`
  - ì˜ˆì•½ ì‹ ì²­ ì·¨ì†Œ
  - í•™ìƒì€ ìì‹ ì˜ pending ì˜ˆì•½ë§Œ ì·¨ì†Œ ê°€ëŠ¥

### ì„ ìƒìš© (ê¸°ì¡´)
- `GET /api/v1/clinic/participants/`
  - ëª¨ë“  ì°¸ê°€ì ëª©ë¡ ì¡°íšŒ (í•™ìƒ ì œì™¸)

- `PATCH /api/v1/clinic/participants/{id}/set_status/`
  - ì˜ˆì•½ ìŠ¹ì¸/ê±°ë¶€
  - ì„ ìƒì€ ëª¨ë“  ìƒíƒœ ë³€ê²½ ê°€ëŠ¥

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ì •ì› ê³„ì‚°**: `booked_count`ì— `pending` ìƒíƒœë„ í¬í•¨ë˜ë¯€ë¡œ, ì •ì› ì²´í¬ ì‹œ `max_participants`ì™€ ë¹„êµí•´ì•¼ í•¨
2. **ê¶Œí•œ ì²´í¬**: í•™ìƒì€ ìì‹ ì˜ ì˜ˆì•½ë§Œ ì¡°íšŒ/ì·¨ì†Œ ê°€ëŠ¥
3. **ìƒíƒœ ì „ì´**: 
   - í•™ìƒ ì‹ ì²­: `pending` â†’ (ì„ ìƒ ìŠ¹ì¸) â†’ `booked`
   - í•™ìƒ ì‹ ì²­: `pending` â†’ (í•™ìƒ ì·¨ì†Œ) â†’ `cancelled`
   - í•™ìƒ ì‹ ì²­: `pending` â†’ (ì„ ìƒ ê±°ë¶€) â†’ `rejected`
4. **ì¤‘ë³µ ì˜ˆì•½ ë°©ì§€**: ê°™ì€ ì„¸ì…˜ì— ì´ë¯¸ ì˜ˆì•½ëœ ê²½ìš° 409 Conflict ë°˜í™˜

## ğŸš€ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥

ëª¨ë“  êµ¬í˜„ì´ ì™„ë£Œë˜ì—ˆìœ¼ë©°, ë°±ì—”ë“œ ë§ˆì´ê·¸ë ˆì´ì…˜ë„ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.
í•™ìƒ ì•±ì—ì„œ `/student/clinic/booking` í˜ì´ì§€ë¡œ ì ‘ì†í•˜ì—¬ ì¦‰ì‹œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


==========================================================================================
# FILE: clinic/README.md
==========================================================================================
# í•™ìƒ ì•± í´ë¦¬ë‹‰ ì˜ˆì•½ ê¸°ëŠ¥

## êµ¬ì¡°

1. **í•™ìƒì´ ì˜ˆì•½ ì‹ ì²­**: í•™ìƒì´ ì˜ˆì•½ ê°€ëŠ¥í•œ í´ë¦¬ë‹‰ ì„¸ì…˜ì„ ì„ íƒí•˜ê³  ì‹ ì²­ (status: "pending")
2. **ì„ ìƒì´ ìŠ¹ì¸**: ì„ ìƒì´ ì˜ˆì•½ ì‹ ì²­ì„ í™•ì¸í•˜ê³  ìŠ¹ì¸ (status: "pending" â†’ "booked")

## ë°±ì—”ë“œ API í™•ì¥ í•„ìš” ì‚¬í•­

### 1. í´ë¦¬ë‹‰ ì„¸ì…˜ ì¡°íšŒ API í™•ì¥

**ê¸°ì¡´ API**: `GET /clinic/sessions/`
- í˜„ì¬: ì„ ìƒë§Œ ì¡°íšŒ ê°€ëŠ¥
- **í™•ì¥ í•„ìš”**: í•™ìƒë„ ì¡°íšŒ ê°€ëŠ¥í•˜ë„ë¡ ê¶Œí•œ ì¶”ê°€

**íŒŒë¼ë¯¸í„°**:
- `date_from`: ì‹œì‘ ë‚ ì§œ (YYYY-MM-DD)
- `date_to`: ì¢…ë£Œ ë‚ ì§œ (YYYY-MM-DD)
- `available`: trueì¼ ê²½ìš° ì˜ˆì•½ ê°€ëŠ¥í•œ ì„¸ì…˜ë§Œ (ì •ì›ì´ ë‚¨ì€ ì„¸ì…˜)

**ì‘ë‹µ**: ê¸°ì¡´ê³¼ ë™ì¼
```json
{
  "id": 1,
  "date": "2026-02-20",
  "start_time": "14:00:00",
  "end_time": "15:00:00",
  "location": "101í˜¸",
  "participant_count": 5,
  "booked_count": 3,
  "max_participants": 10
}
```

### 2. í´ë¦¬ë‹‰ ì°¸ê°€ì ìƒì„± API í™•ì¥

**ê¸°ì¡´ API**: `POST /clinic/participants/`
- í˜„ì¬: ì„ ìƒì´ ì§ì ‘ ì¶”ê°€ (source: "manual", status: "booked")
- **í™•ì¥ í•„ìš”**: í•™ìƒì´ ì‹ ì²­ ê°€ëŠ¥í•˜ë„ë¡ í™•ì¥

**ìš”ì²­ ë³¸ë¬¸**:
```json
{
  "session": 1,
  "source": "student_request",  // ì‹ ê·œ í•„ë“œ: í•™ìƒ ì‹ ì²­ êµ¬ë¶„
  "status": "pending",          // ì‹ ê·œ: ìŠ¹ì¸ ëŒ€ê¸° ìƒíƒœ
  "memo": "ì°¸ê³ ì‚¬í•­"            // ì„ íƒ
}
```

**ì£¼ì˜ì‚¬í•­**:
- `enrollment_id`ëŠ” í˜„ì¬ ë¡œê·¸ì¸í•œ í•™ìƒì˜ enrollment_idë¡œ ìë™ ì„¤ì •
- `source: "student_request"`ì¸ ê²½ìš° `status`ëŠ” ë°˜ë“œì‹œ `"pending"`ì´ì–´ì•¼ í•¨
- ì„ ìƒì´ ì§ì ‘ ì¶”ê°€í•  ë•ŒëŠ” `source: "manual"`, `status: "booked"` ì‚¬ìš©

### 3. í•™ìƒì˜ ì˜ˆì•½ ì‹ ì²­ ì¡°íšŒ API

**ê¸°ì¡´ API**: `GET /clinic/participants/`
- í˜„ì¬: ì„ ìƒì´ ëª¨ë“  ì°¸ê°€ì ì¡°íšŒ
- **í™•ì¥ í•„ìš”**: í•™ìƒì´ ìì‹ ì˜ ì˜ˆì•½ ì‹ ì²­ë§Œ ì¡°íšŒ ê°€ëŠ¥

**íŒŒë¼ë¯¸í„°**:
- `student: "me"`: í˜„ì¬ ë¡œê·¸ì¸í•œ í•™ìƒì˜ ì˜ˆì•½ ì‹ ì²­ë§Œ ì¡°íšŒ

**ì‘ë‹µ**: ê¸°ì¡´ê³¼ ë™ì¼í•˜ì§€ë§Œ, í•™ìƒì€ ìì‹ ì˜ ì˜ˆì•½ ì‹ ì²­ë§Œ ì¡°íšŒ ê°€ëŠ¥

### 4. ì˜ˆì•½ ì‹ ì²­ ì·¨ì†Œ API

**ê¸°ì¡´ API**: `PATCH /clinic/participants/{id}/set_status/`
- í˜„ì¬: ì„ ìƒì´ ìƒíƒœ ë³€ê²½
- **í™•ì¥ í•„ìš”**: í•™ìƒì´ ìì‹ ì˜ ì˜ˆì•½ ì‹ ì²­(status: "pending")ë§Œ ì·¨ì†Œ ê°€ëŠ¥

**ìš”ì²­ ë³¸ë¬¸**:
```json
{
  "status": "cancelled"
}
```

**ê¶Œí•œ ì²´í¬**:
- í•™ìƒì€ ìì‹ ì˜ ì˜ˆì•½ ì‹ ì²­ë§Œ ì·¨ì†Œ ê°€ëŠ¥
- `status`ê°€ `"pending"`ì¸ ê²½ìš°ì—ë§Œ ì·¨ì†Œ ê°€ëŠ¥
- ì´ë¯¸ `"booked"`ë¡œ ìŠ¹ì¸ëœ ê²½ìš° ì·¨ì†Œ ë¶ˆê°€ (ì„ ìƒì—ê²Œ ë¬¸ì˜ í•„ìš”)

### 5. ì„ ìƒì˜ ì˜ˆì•½ ì‹ ì²­ ìŠ¹ì¸/ê±°ë¶€ API

**ê¸°ì¡´ API**: `PATCH /clinic/participants/{id}/set_status/`
- í˜„ì¬: ì„ ìƒì´ ìƒíƒœ ë³€ê²½ ê°€ëŠ¥
- **í™•ì¥ í•„ìš”**: `status: "pending"`ì¸ ì˜ˆì•½ ì‹ ì²­ì„ `"booked"`ë¡œ ìŠ¹ì¸í•˜ê±°ë‚˜ `"rejected"`ë¡œ ê±°ë¶€

**ìš”ì²­ ë³¸ë¬¸**:
```json
{
  "status": "booked"  // ë˜ëŠ” "rejected"
}
```

**ê¶Œí•œ ì²´í¬**:
- ì„ ìƒë§Œ ìŠ¹ì¸/ê±°ë¶€ ê°€ëŠ¥
- `status`ê°€ `"pending"`ì¸ ê²½ìš°ì—ë§Œ ìŠ¹ì¸/ê±°ë¶€ ê°€ëŠ¥

## ì„ ìƒì•±ì—ì„œ ìŠ¹ì¸í•˜ëŠ” ë°©ë²•

ì„ ìƒì•±ì˜ í´ë¦¬ë‹‰ ê´€ë¦¬ í˜ì´ì§€(`/admin/clinic/bookings`)ì—ì„œ:
1. ì˜ˆì•½ ì‹ ì²­ì ëª©ë¡ í™•ì¸ (status: "pending")
2. ê° ì‹ ì²­ì— ëŒ€í•´ ìŠ¹ì¸/ê±°ë¶€ ë²„íŠ¼ í´ë¦­
3. ìŠ¹ì¸ ì‹œ `PATCH /clinic/participants/{id}/set_status/` í˜¸ì¶œí•˜ì—¬ `status: "booked"`ë¡œ ë³€ê²½

## ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ í™•ì¸ ì‚¬í•­

1. `clinic_participants` í…Œì´ë¸”ì— `source` í•„ë“œ ì¶”ê°€ í•„ìš” (ë˜ëŠ” í™•ì¸)
   - ê°’: `"manual"` (ì„ ìƒ ì§ì ‘ ì¶”ê°€), `"student_request"` (í•™ìƒ ì‹ ì²­)

2. `clinic_participants` í…Œì´ë¸”ì˜ `status` í•„ë“œì— `"pending"` ìƒíƒœ ì¶”ê°€ í•„ìš” (ë˜ëŠ” í™•ì¸)
   - ê¸°ì¡´: `"booked"`, `"attended"`, `"no_show"`, `"cancelled"`
   - ì¶”ê°€: `"pending"` (ìŠ¹ì¸ ëŒ€ê¸°), `"rejected"` (ê±°ë¶€)

3. ê¶Œí•œ ì²´í¬ ë¡œì§ ì¶”ê°€ í•„ìš”
   - í•™ìƒ: ìì‹ ì˜ ì˜ˆì•½ ì‹ ì²­ë§Œ ì¡°íšŒ/ì·¨ì†Œ ê°€ëŠ¥
   - ì„ ìƒ: ëª¨ë“  ì°¸ê°€ì ì¡°íšŒ ë° ìƒíƒœ ë³€ê²½ ê°€ëŠ¥


==========================================================================================
# FILE: clinic/TEST.md
==========================================================================================
# í´ë¦¬ë‹‰ ì˜ˆì•½ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

## ë°±ì—”ë“œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ
- âœ… `SessionParticipant.Status`ì— `PENDING`, `REJECTED` ì¶”ê°€
- âœ… `SessionParticipant.Source`ì— `STUDENT_REQUEST` ì¶”ê°€
- âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš© ì™„ë£Œ

## í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 1. í•™ìƒì´ ì˜ˆì•½ ê°€ëŠ¥í•œ í´ë¦¬ë‹‰ ì„¸ì…˜ ì¡°íšŒ
**ì—”ë“œí¬ì¸íŠ¸**: `GET /api/v1/clinic/sessions/?date_from=YYYY-MM-DD&date_to=YYYY-MM-DD`
**ê¶Œí•œ**: í•™ìƒ ë¡œê·¸ì¸ í•„ìš”
**ì˜ˆìƒ ê²°ê³¼**: 
- í˜„ì¬ ë‚ ì§œë¶€í„° 2ì£¼ í›„ê¹Œì§€ì˜ í´ë¦¬ë‹‰ ì„¸ì…˜ ëª©ë¡ ë°˜í™˜
- `booked_count`ì— `pending` ìƒíƒœë„ í¬í•¨ë¨

**í…ŒìŠ¤íŠ¸ ë°©ë²•**:
```bash
# í•™ìƒìœ¼ë¡œ ë¡œê·¸ì¸ í›„
curl -H "Authorization: Bearer {í•™ìƒ_í† í°}" \
  "http://localhost:8000/api/v1/clinic/sessions/?date_from=2026-02-19&date_to=2026-03-05"
```

### 2. í•™ìƒì´ í´ë¦¬ë‹‰ ì˜ˆì•½ ì‹ ì²­
**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/v1/clinic/participants/`
**ìš”ì²­ ë³¸ë¬¸**:
```json
{
  "session": 1,
  "source": "student_request",
  "status": "pending",
  "memo": "ì°¸ê³ ì‚¬í•­"
}
```
**ì˜ˆìƒ ê²°ê³¼**:
- `student`ëŠ” ìë™ìœ¼ë¡œ í˜„ì¬ ë¡œê·¸ì¸í•œ í•™ìƒìœ¼ë¡œ ì„¤ì •ë¨
- `enrollment_id`ëŠ” ìë™ìœ¼ë¡œ í™œì„± enrollmentë¡œ ì„¤ì •ë¨
- `status`ëŠ” `pending`ìœ¼ë¡œ ì„¤ì •ë¨
- `source`ëŠ” `student_request`ë¡œ ì„¤ì •ë¨

**í…ŒìŠ¤íŠ¸ ë°©ë²•**:
```bash
curl -X POST \
  -H "Authorization: Bearer {í•™ìƒ_í† í°}" \
  -H "Content-Type: application/json" \
  -d '{"session": 1, "source": "student_request", "status": "pending", "memo": "í…ŒìŠ¤íŠ¸"}' \
  "http://localhost:8000/api/v1/clinic/participants/"
```

### 3. í•™ìƒì´ ìì‹ ì˜ ì˜ˆì•½ ì‹ ì²­ ëª©ë¡ ì¡°íšŒ
**ì—”ë“œí¬ì¸íŠ¸**: `GET /api/v1/clinic/participants/`
**ê¶Œí•œ**: í•™ìƒ ë¡œê·¸ì¸ í•„ìš”
**ì˜ˆìƒ ê²°ê³¼**: 
- í˜„ì¬ ë¡œê·¸ì¸í•œ í•™ìƒì˜ ì˜ˆì•½ ì‹ ì²­ë§Œ ë°˜í™˜
- `status`ê°€ `pending`, `booked`, `rejected`ì¸ ê²ƒë§Œ í‘œì‹œ

**í…ŒìŠ¤íŠ¸ ë°©ë²•**:
```bash
curl -H "Authorization: Bearer {í•™ìƒ_í† í°}" \
  "http://localhost:8000/api/v1/clinic/participants/"
```

### 4. í•™ìƒì´ ì˜ˆì•½ ì‹ ì²­ ì·¨ì†Œ
**ì—”ë“œí¬ì¸íŠ¸**: `PATCH /api/v1/clinic/participants/{id}/set_status/`
**ìš”ì²­ ë³¸ë¬¸**:
```json
{
  "status": "cancelled"
}
```
**ì˜ˆìƒ ê²°ê³¼**:
- `status`ê°€ `pending`ì¸ ê²½ìš°ì—ë§Œ ì·¨ì†Œ ê°€ëŠ¥
- ìì‹ ì˜ ì˜ˆì•½ ì‹ ì²­ë§Œ ì·¨ì†Œ ê°€ëŠ¥

**í…ŒìŠ¤íŠ¸ ë°©ë²•**:
```bash
curl -X PATCH \
  -H "Authorization: Bearer {í•™ìƒ_í† í°}" \
  -H "Content-Type: application/json" \
  -d '{"status": "cancelled"}' \
  "http://localhost:8000/api/v1/clinic/participants/1/set_status/"
```

### 5. ì„ ìƒì´ ì˜ˆì•½ ì‹ ì²­ ìŠ¹ì¸/ê±°ë¶€
**ì—”ë“œí¬ì¸íŠ¸**: `PATCH /api/v1/clinic/participants/{id}/set_status/`
**ìš”ì²­ ë³¸ë¬¸** (ìŠ¹ì¸):
```json
{
  "status": "booked"
}
```
**ìš”ì²­ ë³¸ë¬¸** (ê±°ë¶€):
```json
{
  "status": "rejected"
}
```
**ì˜ˆìƒ ê²°ê³¼**:
- ì„ ìƒë§Œ ìŠ¹ì¸/ê±°ë¶€ ê°€ëŠ¥
- `status`ê°€ `pending`ì¸ ê²½ìš°ì—ë§Œ ìŠ¹ì¸/ê±°ë¶€ ê°€ëŠ¥

**í…ŒìŠ¤íŠ¸ ë°©ë²•**:
```bash
# ìŠ¹ì¸
curl -X PATCH \
  -H "Authorization: Bearer {ì„ ìƒ_í† í°}" \
  -H "Content-Type: application/json" \
  -d '{"status": "booked"}' \
  "http://localhost:8000/api/v1/clinic/participants/1/set_status/"

# ê±°ë¶€
curl -X PATCH \
  -H "Authorization: Bearer {ì„ ìƒ_í† í°}" \
  -H "Content-Type: application/json" \
  -d '{"status": "rejected"}' \
  "http://localhost:8000/api/v1/clinic/participants/1/set_status/"
```

## í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

### í•™ìƒ ì•± (`/student/clinic/booking`)
- [ ] ì˜ˆì•½ ê°€ëŠ¥í•œ í´ë¦¬ë‹‰ ì„¸ì…˜ ëª©ë¡ì´ í‘œì‹œë˜ëŠ”ê°€?
- [ ] ì„¸ì…˜ì„ ì„ íƒí•˜ê³  ì˜ˆì•½ ì‹ ì²­í•  ìˆ˜ ìˆëŠ”ê°€?
- [ ] ì˜ˆì•½ ì‹ ì²­ í›„ "ìŠ¹ì¸ ëŒ€ê¸°" ìƒíƒœë¡œ í‘œì‹œë˜ëŠ”ê°€?
- [ ] ë‚´ ì˜ˆì•½ ì‹ ì²­ í˜„í™©ì— ì‹ ì²­í•œ ì˜ˆì•½ì´ í‘œì‹œë˜ëŠ”ê°€?
- [ ] ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ì˜ˆì•½ì„ ì·¨ì†Œí•  ìˆ˜ ìˆëŠ”ê°€?
- [ ] ì´ë¯¸ ì‹ ì²­í•œ ì„¸ì…˜ì€ ì˜ˆì•½ ê°€ëŠ¥ ëª©ë¡ì—ì„œ ì œì™¸ë˜ëŠ”ê°€?
- [ ] ì •ì›ì´ ë§ˆê°ëœ ì„¸ì…˜ì€ í‘œì‹œë˜ì§€ ì•ŠëŠ”ê°€?

### ì„ ìƒ ì•± (`/admin/clinic/bookings`)
- [ ] í•™ìƒì˜ ì˜ˆì•½ ì‹ ì²­(`status: "pending"`)ì´ í‘œì‹œë˜ëŠ”ê°€?
- [ ] ì˜ˆì•½ ì‹ ì²­ì„ ìŠ¹ì¸(`status: "pending"` â†’ `status: "booked"`)í•  ìˆ˜ ìˆëŠ”ê°€?
- [ ] ì˜ˆì•½ ì‹ ì²­ì„ ê±°ë¶€(`status: "pending"` â†’ `status: "rejected"`)í•  ìˆ˜ ìˆëŠ”ê°€?

## ì£¼ì˜ì‚¬í•­

1. **ê¶Œí•œ ì²´í¬**: í•™ìƒì€ ìì‹ ì˜ ì˜ˆì•½ë§Œ ì¡°íšŒ/ì·¨ì†Œ ê°€ëŠ¥
2. **ìƒíƒœ ì „ì´**: 
   - í•™ìƒ ì‹ ì²­: `pending` â†’ (ì„ ìƒ ìŠ¹ì¸) â†’ `booked`
   - í•™ìƒ ì‹ ì²­: `pending` â†’ (í•™ìƒ ì·¨ì†Œ) â†’ `cancelled`
   - í•™ìƒ ì‹ ì²­: `pending` â†’ (ì„ ìƒ ê±°ë¶€) â†’ `rejected`
3. **ì •ì› ê³„ì‚°**: `booked_count`ì— `pending` ìƒíƒœë„ í¬í•¨ë˜ë¯€ë¡œ ì •ì› ì²´í¬ ì‹œ ì£¼ì˜


==========================================================================================
# FILE: clinic/api/clinicBooking.api.ts
==========================================================================================
// PATH: src/student/domains/clinic/api/clinicBooking.api.ts
// í•™ìƒ ì•± í´ë¦¬ë‹‰ ì˜ˆì•½ API

import api from "@/student/shared/api/studentApi";

/**
 * í´ë¦¬ë‹‰ ì„¸ì…˜ ì •ë³´
 */
export type ClinicSession = {
  id: number;
  date: string; // YYYY-MM-DD
  start_time: string; // HH:MM:SS or HH:MM
  end_time?: string;
  location: string;
  participant_count: number;
  booked_count: number;
  max_participants?: number;
};

/**
 * í•™ìƒì˜ í´ë¦¬ë‹‰ ì˜ˆì•½ ì‹ ì²­ ì •ë³´
 */
export type ClinicBookingRequest = {
  id: number;
  session: number | null; // âœ… ì„¸ì…˜ì´ ì—†ì„ ìˆ˜ ìˆìŒ
  session_date: string;
  session_start_time: string;
  session_location: string | null; // âœ… ì„¸ì…˜ì´ ì—†ìœ¼ë©´ null
  status: "pending" | "approved" | "rejected" | "cancelled" | "booked";
  memo?: string;
  created_at: string;
  updated_at?: string;
  status_changed_at?: string;
};

/**
 * ì˜ˆì•½ ê°€ëŠ¥í•œ í´ë¦¬ë‹‰ ì„¸ì…˜ ëª©ë¡ ì¡°íšŒ
 * GET /clinic/sessions/?date_from=YYYY-MM-DD&date_to=YYYY-MM-DD
 * ë°±ì—”ë“œì—ì„œ í•™ìƒë„ ì¡°íšŒ ê°€ëŠ¥í•˜ë„ë¡ ê¶Œí•œ ì„¤ì •ë¨
 */
export async function fetchAvailableClinicSessions(params?: {
  date_from?: string;
  date_to?: string;
}): Promise<ClinicSession[]> {
  try {
    const today = new Date();
    const nextWeek = new Date(today);
    nextWeek.setDate(today.getDate() + 14); // 2ì£¼ í›„ê¹Œì§€

    const dateFrom = params?.date_from || today.toISOString().slice(0, 10);
    const dateTo = params?.date_to || nextWeek.toISOString().slice(0, 10);

    const res = await api.get("/clinic/sessions/", {
      params: {
        date_from: dateFrom,
        date_to: dateTo,
      },
    });

    const sessions = Array.isArray(res.data)
      ? res.data
      : Array.isArray(res.data?.results)
      ? res.data.results
      : [];

    // booked_countì— pendingë„ í¬í•¨ë˜ë¯€ë¡œ, max_participantsì™€ ë¹„êµí•˜ì—¬ ì˜ˆì•½ ê°€ëŠ¥ ì—¬ë¶€ íŒë‹¨
    return sessions.filter((s: any) => {
      if (!s.max_participants) return true; // ì •ì› ì œí•œ ì—†ìœ¼ë©´ ì˜ˆì•½ ê°€ëŠ¥
      const booked = s.booked_count || 0;
      return booked < s.max_participants;
    }) as ClinicSession[];
  } catch (error) {
    console.error("ì˜ˆì•½ ê°€ëŠ¥ ì„¸ì…˜ ì¡°íšŒ ì‹¤íŒ¨:", error);
    return [];
  }
}

/**
 * í•™ìƒì˜ í´ë¦¬ë‹‰ ì˜ˆì•½ ì‹ ì²­ ëª©ë¡ ì¡°íšŒ
 * GET /clinic/participants/
 * ë°±ì—”ë“œì—ì„œ ìë™ìœ¼ë¡œ í˜„ì¬ ë¡œê·¸ì¸í•œ í•™ìƒì˜ ì˜ˆì•½ë§Œ ë°˜í™˜
 */
export async function fetchMyClinicBookingRequests(): Promise<ClinicBookingRequest[]> {
  try {
    const res = await api.get("/clinic/participants/");

    const participants = Array.isArray(res.data)
      ? res.data
      : Array.isArray(res.data?.results)
      ? res.data.results
      : [];

    // ì˜ˆì•½ ì‹ ì²­ ìƒíƒœì¸ ê²ƒë§Œ í•„í„°ë§ (pending, booked ë“±)
    return participants
      .filter((p: any) => 
        p.status === "pending" || 
        p.status === "booked" || 
        p.status === "approved" ||
        p.status === "rejected"
      )
      .map((p: any) => ({
        id: p.id,
        session: p.session || null, // âœ… ì„¸ì…˜ì´ ì—†ì„ ìˆ˜ ìˆìŒ
        session_date: p.session_date,
        session_start_time: p.session_start_time,
        session_location: p.session_location || null, // âœ… ì„¸ì…˜ì´ ì—†ìœ¼ë©´ null
        status: p.status === "approved" ? "booked" : p.status, // approvedëŠ” bookedë¡œ ë§¤í•‘
        memo: p.memo,
        created_at: p.created_at,
        updated_at: p.updated_at,
        status_changed_at: p.status_changed_at,
      }));
  } catch (error) {
    console.error("ë‚´ ì˜ˆì•½ ì‹ ì²­ ì¡°íšŒ ì‹¤íŒ¨:", error);
    return [];
  }
}

/**
 * í´ë¦¬ë‹‰ ì˜ˆì•½ ì‹ ì²­
 * POST /clinic/participants/
 * 
 * ë°±ì—”ë“œì—ì„œ ìë™ ì²˜ë¦¬:
 * - student: í˜„ì¬ ë¡œê·¸ì¸í•œ í•™ìƒ ìë™ ì„¤ì •
 * - source: "student_request" ìë™ ì„¤ì •
 * - status: "pending" ìë™ ì„¤ì •
 * - enrollment_id: í™œì„± enrollment ìë™ ì¡°íšŒ
 */
export async function createClinicBookingRequest(data: {
  session?: number;
  date?: string; // YYYY-MM-DD (ì„¸ì…˜ì´ ì—†ì„ ë•Œ)
  start_time?: string; // HH:MM (ì„¸ì…˜ì´ ì—†ì„ ë•Œ)
  memo?: string;
}): Promise<ClinicBookingRequest> {
  const payload: any = {
    source: "student_request",
    status: "pending",
    memo: data.memo,
  };

  if (data.session) {
    // ê¸°ì¡´ ì„¸ì…˜ ì„ íƒ ë°©ì‹
    payload.session = data.session;
  } else if (data.date && data.start_time) {
    // ì‹œê°„ ì§ì ‘ ì„ íƒ ë°©ì‹ (ì„¸ì…˜ì´ ì—†ì„ ë•Œ)
    payload.requested_date = data.date;
    payload.requested_start_time = data.start_time;
  } else {
    throw new Error("session ë˜ëŠ” (date + start_time) ì¤‘ í•˜ë‚˜ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.");
  }

  const res = await api.post("/clinic/participants/", payload);

  return {
    id: res.data.id,
    session: res.data.session,
    session_date: res.data.session_date,
    session_start_time: res.data.session_start_time,
    session_location: res.data.session_location || null,
    status: res.data.status,
    memo: res.data.memo,
    created_at: res.data.created_at,
  };
}

/**
 * í´ë¦¬ë‹‰ ì˜ˆì•½ ì‹ ì²­ ì·¨ì†Œ
 * PATCH /clinic/participants/{id}/set_status/
 */
export async function cancelClinicBookingRequest(id: number): Promise<void> {
  await api.patch(`/clinic/participants/${id}/set_status/`, {
    status: "cancelled",
  });
}


==========================================================================================
# FILE: clinic/pages/ClinicPage.tsx
==========================================================================================
/**
 * í´ë¦¬ë‹‰ í™ˆ â€” íŒ¨ìŠ¤ì¹´ë“œ(ë¦¬ëª¨ì½˜ ì—°ë™) + ë‚´ ì˜ˆì•½ í˜„í™© + ì¼ì •/ì˜ˆì•½
 *
 * - ì‹¤ì‹œê°„ íŒ¨ìŠ¤ì¹´ë“œ: ì„ ìƒ ì•± ë¦¬ëª¨ì½˜ ìƒ‰ìƒ ì—°ë™, í´ë¦¬ë‹‰ ì¸ì¦ìš©
 * - ë‚´ ì˜ˆì•½ í˜„í™©: ìŠ¹ì¸ ëŒ€ê¸° / ìŠ¹ì¸ë¨ ì‹¤ë°ì´í„°
 * - ìº˜ë¦°ë” + ì˜ˆì•½ ì‹ ì²­
 */
import { useState, useMemo } from "react";
import { Link } from "react-router-dom";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import StudentPageShell from "@/student/shared/ui/pages/StudentPageShell";
import ClinicCalendar from "@/student/shared/ui/components/ClinicCalendar";
import {
  fetchMyClinicBookingRequests,
  fetchAvailableClinicSessions,
  createClinicBookingRequest,
  cancelClinicBookingRequest,
  type ClinicBookingRequest,
} from "../api/clinicBooking.api";
import { formatYmd } from "@/student/shared/utils/date";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import { useNotificationCounts } from "@/student/domains/notifications/hooks/useNotificationCounts";

function formatTime(time: string): string {
  return time.slice(0, 5);
}

export default function ClinicPage() {
  const qc = useQueryClient();
  const [selectedDate, setSelectedDate] = useState<string | null>(null);
  const [selectedSessionId, setSelectedSessionId] = useState<number | null>(null);
  const [selectedTime, setSelectedTime] = useState<string | null>(null); // HH:MM í˜•ì‹
  const [memo, setMemo] = useState("");
  const [showSuccessMessage, setShowSuccessMessage] = useState(false);

  // ì•Œë¦¼ ì¹´ìš´íŠ¸ ê°±ì‹ ì„ ìœ„í•œ í›…
  const { refetch: refetchNotifications } = useNotificationCounts();

  // ë‚´ ì˜ˆì•½ ì‹ ì²­ ëª©ë¡ ì¡°íšŒ (ì•Œë¦¼Â·í´ë¦¬ë‹‰ ê³µí†µ í‚¤ë¡œ ìºì‹œ ê³µìœ )
  const { data: myRequests = [], isLoading: requestsLoading } = useQuery({
    queryKey: ["student", "clinic", "bookings"],
    queryFn: fetchMyClinicBookingRequests,
  });

  // ì˜ˆì•½ ê°€ëŠ¥í•œ ì„¸ì…˜ ëª©ë¡ ì¡°íšŒ
  const { data: sessions = [], isLoading: sessionsLoading } = useQuery({
    queryKey: ["student", "clinic", "available-sessions"],
    queryFn: () => {
      const today = new Date();
      const twoWeeksLater = new Date(today);
      twoWeeksLater.setDate(today.getDate() + 14);
      return fetchAvailableClinicSessions({
        date_from: today.toISOString().slice(0, 10),
        date_to: twoWeeksLater.toISOString().slice(0, 10),
      });
    },
  });

  // ì˜ˆì•½ ì‹ ì²­ mutation
  const bookingMutation = useMutation({
    mutationFn: (data: { session: number; memo?: string }) =>
      createClinicBookingRequest(data),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["student", "clinic", "available-sessions"] });
      qc.invalidateQueries({ queryKey: ["student", "clinic", "bookings"] });
      qc.invalidateQueries({ queryKey: ["clinic-idcard"] });
      qc.invalidateQueries({ queryKey: ["student", "notifications", "counts"] });
      refetchNotifications();
      setSelectedSessionId(null);
      setMemo("");
      setShowSuccessMessage(true);
      setTimeout(() => setShowSuccessMessage(false), 3000);
    },
    onError: (error: any) => {
      const message =
        error?.response?.data?.detail ||
        error?.response?.data?.message ||
        "ì˜ˆì•½ ì‹ ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
      alert(message);
    },
  });

  // ì˜ˆì•½ ì·¨ì†Œ mutation
  const cancelMutation = useMutation({
    mutationFn: (id: number) => cancelClinicBookingRequest(id),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["student", "clinic", "bookings"] });
      qc.invalidateQueries({ queryKey: ["student", "clinic", "available-sessions"] });
      qc.invalidateQueries({ queryKey: ["student", "notifications", "counts"] });
      refetchNotifications();
      alert("ì˜ˆì•½ ì‹ ì²­ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.");
    },
    onError: (error: any) => {
      alert(error?.response?.data?.detail || "ì·¨ì†Œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
    },
  });

  // ë‚ ì§œ ì„ íƒ í•¸ë“¤ëŸ¬
  const handleDateSelect = (date: string) => {
    setSelectedDate(date);
    setSelectedSessionId(null);
    setSelectedTime(null);
    setShowSuccessMessage(false);

    // í•´ë‹¹ ë‚ ì§œì˜ ì˜ˆì•½ì´ ìˆëŠ”ì§€ í™•ì¸
    const existingBooking = myRequests.find((r) => r.session_date === date);
    if (existingBooking && (existingBooking.status === "pending" || existingBooking.status === "booked" || existingBooking.status === "approved")) {
      // ì¼ì • ë³€ê²½ ëª¨ë“œ
      setSelectedSessionId(existingBooking.session);
      setSelectedTime(existingBooking.session_start_time.slice(0, 5)); // HH:MM í˜•ì‹
    }
  };

  // ì˜ˆì•½ ì‹ ì²­ í•¸ë“¤ëŸ¬
  const handleBooking = () => {
    if (!selectedSessionId && !selectedTime) {
      alert("ì˜ˆì•½í•  ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
      return;
    }
    
    if (selectedSessionId) {
      // ê¸°ì¡´ ì„¸ì…˜ ì„ íƒ ë°©ì‹
      bookingMutation.mutate({
        session: selectedSessionId,
        memo: memo.trim() || undefined,
      });
    } else if (selectedTime && selectedDate) {
      // ì‹œê°„ ì§ì ‘ ì„ íƒ ë°©ì‹ - ì„¸ì…˜ì´ ì—†ì–´ë„ ì˜ˆì•½ ì‹ ì²­ ê°€ëŠ¥
      bookingMutation.mutate({
        date: selectedDate,
        start_time: selectedTime,
        memo: memo.trim() || undefined,
      });
    }
  };

  // ì¼ì • ë³€ê²½ ì‹ ì²­ í•¸ë“¤ëŸ¬
  const handleChangeRequest = () => {
    if (!selectedDate) {
      alert("ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
      return;
    }

    const existingBooking = myRequests.find((r) => r.session_date === selectedDate);
    if (!existingBooking) {
      alert("ë³€ê²½í•  ì˜ˆì•½ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
      return;
    }

    // ê¸°ì¡´ ì˜ˆì•½ ì·¨ì†Œ í›„ ìƒˆ ì˜ˆì•½ ì‹ ì²­
    if (confirm("ê¸°ì¡´ ì˜ˆì•½ì„ ì·¨ì†Œí•˜ê³  ìƒˆë¡œ ì‹ ì²­í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
      cancelMutation.mutate(existingBooking.id, {
        onSuccess: () => {
          if (selectedSessionId) {
            // ì„¸ì…˜ ì„ íƒ ë°©ì‹
            bookingMutation.mutate({
              session: selectedSessionId,
              memo: memo.trim() || undefined,
            });
          } else if (selectedTime) {
            // ì‹œê°„ ì§ì ‘ ì„ íƒ ë°©ì‹
            bookingMutation.mutate({
              date: selectedDate,
              start_time: selectedTime,
              memo: memo.trim() || undefined,
            });
          }
        },
      });
    }
  };

  const isLoading = requestsLoading || sessionsLoading;

  // ì˜ˆì•½ ìƒíƒœë³„ ë¶„ë¥˜
  const pendingBookings = useMemo(
    () => myRequests.filter((r) => r.status === "pending"),
    [myRequests]
  );
  const approvedBookings = useMemo(
    () => myRequests.filter((r) => r.status === "booked" || r.status === "approved"),
    [myRequests]
  );

  // ì˜ˆì•½ ê°€ëŠ¥í•œ ë‚ ì§œ ëª©ë¡
  const availableDates = useMemo(() => {
    const dates = new Set<string>();
    sessions.forEach((s) => {
      dates.add(s.date);
    });
    myRequests.forEach((r) => {
      if (r.status === "pending" || r.status === "booked" || r.status === "approved") {
        dates.add(r.session_date);
      }
    });
    return Array.from(dates);
  }, [sessions, myRequests]);

  // ì„ íƒí•œ ë‚ ì§œì˜ ì˜ˆì•½ ì •ë³´
  const selectedDateBooking = useMemo(() => {
    if (!selectedDate) return null;
    return myRequests.find((r) => r.session_date === selectedDate);
  }, [selectedDate, myRequests]);

  // ì„ íƒí•œ ë‚ ì§œì˜ ì„¸ì…˜ ì •ë³´
  const selectedDateSessions = useMemo(() => {
    if (!selectedDate) return [];
    return sessions.filter((s) => s.date === selectedDate);
  }, [selectedDate, sessions]);

  // ì„ íƒí•œ ë‚ ì§œì˜ ê¸°ì¡´ ì˜ˆì•½
  const existingBookingForDate = useMemo(() => {
    if (!selectedDate) return null;
    return myRequests.find(
      (r) =>
        r.session_date === selectedDate &&
        (r.status === "pending" || r.status === "booked" || r.status === "approved")
    );
  }, [selectedDate, myRequests]);

  const isChangeMode = existingBookingForDate != null;

  if (isLoading) {
    return (
      <StudentPageShell title="í´ë¦¬ë‹‰">
        <div className="stu-muted">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </StudentPageShell>
    );
  }

  return (
    <StudentPageShell title="í´ë¦¬ë‹‰">
      <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-6)" }}>
        {/* ì‹¤ì‹œê°„ íŒ¨ìŠ¤ì¹´ë“œ (ì„ ìƒ ë¦¬ëª¨ì½˜ ì—°ë™) */}
        <Link
          to="/student/idcard"
          className="stu-panel stu-panel--pressable"
          style={{
            display: "block",
            textDecoration: "none",
            color: "inherit",
            padding: "var(--stu-space-4)",
            background: "linear-gradient(135deg, var(--stu-surface-soft) 0%, var(--stu-surface) 100%)",
            border: "1px solid var(--stu-border)",
          }}
        >
          <div style={{ fontWeight: 700, fontSize: 16, marginBottom: 4 }}>í´ë¦¬ë‹‰ ì¸ì¦ íŒ¨ìŠ¤</div>
          <div className="stu-muted" style={{ fontSize: 13 }}>
            í´ë¦¬ë‹‰ ì°¸ì—¬ ì‹œ ì¸ì¦ìš© íŒ¨ìŠ¤ì¹´ë“œë¥¼ ë³´ì—¬ì£¼ì„¸ìš”. ì„ ìƒë‹˜ì´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì„¤ì •í•œ í™”ë©´ì´ ë°˜ì˜ë©ë‹ˆë‹¤.
          </div>
          <div style={{ marginTop: "var(--stu-space-2)", fontSize: 13, color: "var(--stu-primary)", fontWeight: 600 }}>
            íŒ¨ìŠ¤ì¹´ë“œ ë³´ê¸° â†’
          </div>
        </Link>

        {/* ì„±ê³µ ë©”ì‹œì§€ */}
        {showSuccessMessage && (
          <div
            className="stu-panel"
            style={{
              padding: "var(--stu-space-4)",
              background: "var(--stu-success-bg)",
              border: "1px solid var(--stu-success)",
              borderRadius: "var(--stu-radius-md)",
              textAlign: "center",
            }}
          >
            <div style={{ fontWeight: 600, fontSize: 15, color: "var(--stu-success-text)" }}>
              ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
            </div>
          </div>
        )}

        {/* ë‹¬ë ¥ */}
        <ClinicCalendar
          selectedDate={selectedDate}
          onDateSelect={handleDateSelect}
          bookings={myRequests}
          availableDates={availableDates}
        />

        {/* ì„ íƒí•œ ë‚ ì§œì˜ ì˜ˆì•½ í•„ë“œ */}
        {selectedDate && (
          <div className="stu-section stu-section--nested">
            <div style={{ fontWeight: 700, fontSize: 15, marginBottom: "var(--stu-space-4)" }}>
              {formatYmd(selectedDate)} {isChangeMode ? "ì¼ì • ë³€ê²½" : "ì˜ˆì•½í•˜ê¸°"}
            </div>

            {existingBookingForDate && (
              <div
                className="stu-panel"
                style={{
                  marginBottom: "var(--stu-space-4)",
                  padding: "var(--stu-space-4)",
                  background:
                    existingBookingForDate.status === "booked" || existingBookingForDate.status === "approved"
                      ? "var(--stu-success-bg)"
                      : "var(--stu-surface-soft)",
                  border:
                    existingBookingForDate.status === "booked" || existingBookingForDate.status === "approved"
                      ? "1px solid var(--stu-success)"
                      : "1px solid var(--stu-border)",
                }}
              >
                <div style={{ fontWeight: 600, fontSize: 14, marginBottom: 4 }}>
                  í˜„ì¬ ì˜ˆì•½: {formatTime(existingBookingForDate.session_start_time)}
                  {existingBookingForDate.session_location && ` @ ${existingBookingForDate.session_location}`}
                </div>
                <div className="stu-muted" style={{ fontSize: 12 }}>
                  ìƒíƒœ:{" "}
                  {existingBookingForDate.status === "booked" || existingBookingForDate.status === "approved"
                    ? "ìŠ¹ì¸ë¨"
                    : "ìŠ¹ì¸ ëŒ€ê¸°"}
                </div>
              </div>
            )}

            <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-4)" }}>
              {/* ì‹œê°„ ì„ íƒ */}
              <div>
                <label style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-2)" }}>
                  <span style={{ fontSize: 14, fontWeight: 600, color: "var(--stu-text-muted)" }}>
                    ì‹œê°„
                  </span>
                  
                  {/* ê¸°ì¡´ ì„¸ì…˜ì´ ìˆëŠ” ê²½ìš° ì„¸ì…˜ ì„ íƒ */}
                  {selectedDateSessions.length > 0 && (
                    <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-2)", marginBottom: "var(--stu-space-3)" }}>
                      {selectedDateSessions.map((session) => {
                        const isSelected = selectedSessionId === session.id;
                        const remaining =
                          session.max_participants != null
                            ? session.max_participants - session.booked_count
                            : null;

                        return (
                          <button
                            key={session.id}
                            type="button"
                            className={`stu-panel stu-panel--pressable ${isSelected ? "stu-panel--accent" : ""}`}
                            onClick={() => {
                              setSelectedSessionId(session.id);
                              setSelectedTime(session.start_time.slice(0, 5));
                            }}
                            style={{
                              textAlign: "left",
                              padding: "var(--stu-space-3)",
                              border: isSelected
                                ? "2px solid var(--stu-primary)"
                                : "1px solid var(--stu-border)",
                            }}
                          >
                            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
                              <div>
                                <div style={{ fontWeight: 600, fontSize: 14 }}>
                                  {formatTime(session.start_time)}
                                </div>
                                <div className="stu-muted" style={{ fontSize: 12, marginTop: 2 }}>
                                  {session.location}
                                </div>
                              </div>
                              {remaining != null && remaining > 0 && (
                                <div className="stu-muted" style={{ fontSize: 12 }}>
                                  ì”ì—¬ {remaining}ëª…
                                </div>
                              )}
                            </div>
                          </button>
                        );
                      })}
                    </div>
                  )}
                  
                  {/* ì‹œê°„ ì§ì ‘ ì„ íƒ (1ì‹œê°„ ë‹¨ìœ„) - ì„¸ì…˜ì´ ì—†ì„ ë•Œë§Œ í‘œì‹œ */}
                  {selectedDateSessions.length === 0 && (
                    <div style={{ display: "grid", gridTemplateColumns: "repeat(4, 1fr)", gap: "var(--stu-space-2)" }}>
                      {Array.from({ length: 12 }, (_, i) => {
                        const hour = 9 + i; // 09:00 ~ 20:00
                        const timeStr = `${hour.toString().padStart(2, "0")}:00`;
                        const isSelected = selectedTime === timeStr;
                        
                        return (
                          <button
                            key={timeStr}
                            type="button"
                            className={`stu-panel stu-panel--pressable ${isSelected ? "stu-panel--accent" : ""}`}
                            onClick={() => {
                              setSelectedTime(timeStr);
                              setSelectedSessionId(null);
                            }}
                            style={{
                              padding: "var(--stu-space-3)",
                              textAlign: "center",
                              border: isSelected
                                ? "2px solid var(--stu-primary)"
                                : "1px solid var(--stu-border)",
                            }}
                          >
                            <div style={{ fontWeight: 600, fontSize: 14 }}>{timeStr}</div>
                          </button>
                        );
                      })}
                    </div>
                  )}
                </label>
              </div>

                {/* ë©”ëª¨ ì…ë ¥ */}
                <div>
                  <label style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-2)" }}>
                    <span style={{ fontSize: 14, fontWeight: 600, color: "var(--stu-text-muted)" }}>
                      ë©”ëª¨ (ì„ íƒ)
                    </span>
                    <textarea
                      value={memo}
                      onChange={(e) => setMemo(e.target.value)}
                      placeholder="ì˜ˆì•½ ì‹œ ì°¸ê³ ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."
                      className="stu-textarea"
                      rows={3}
                      style={{ width: "100%" }}
                    />
                  </label>
                </div>

              {/* ì˜ˆì•½ ì‹ ì²­ / ì¼ì • ë³€ê²½ ë²„íŠ¼ */}
              {!existingBookingForDate && (
                <button
                  type="button"
                  className="stu-btn stu-btn--primary"
                  disabled={(!selectedSessionId && !selectedTime) || bookingMutation.isPending || cancelMutation.isPending}
                  onClick={handleBooking}
                  style={{ width: "100%" }}
                >
                  {bookingMutation.isPending ? "ì²˜ë¦¬ ì¤‘â€¦" : "ì˜ˆì•½ ì‹ ì²­í•˜ê¸°"}
                </button>
              )}

              {existingBookingForDate && (
                <button
                  type="button"
                  className="stu-btn stu-btn--secondary"
                  disabled={!selectedSessionId || bookingMutation.isPending || cancelMutation.isPending || selectedDateSessions.length === 0}
                  onClick={handleChangeRequest}
                  style={{ width: "100%" }}
                >
                  {cancelMutation.isPending || bookingMutation.isPending
                    ? "ì²˜ë¦¬ ì¤‘â€¦"
                    : "ì¼ì • ë³€ê²½ ì‹ ì²­í•˜ê¸°"}
                </button>
              )}

              {(bookingMutation.isError || cancelMutation.isError) && (
                <div className="stu-muted" style={{ fontSize: 13, color: "var(--stu-danger)" }}>
                  {isChangeMode ? "ì¼ì • ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤." : "ì˜ˆì•½ ì‹ ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."} ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
                </div>
              )}
            </div>
          </div>
        )}

        {/* ë‚´ ì˜ˆì•½ í˜„í™© (í´ë¦¬ë‹‰ ì‹ ì²­ì ì‹¤ë°ì´í„°) */}
        <div className="stu-section stu-section--nested">
          <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: "var(--stu-space-4)", flexWrap: "wrap", gap: 8 }}>
            <div style={{ fontWeight: 700, fontSize: 15 }}>ë‚´ ì˜ˆì•½ í˜„í™©</div>
            {(pendingBookings.length > 0 || approvedBookings.length > 0) && (
              <span className="stu-muted" style={{ fontSize: 13 }}>
                ìŠ¹ì¸ ëŒ€ê¸° {pendingBookings.length}ê±´ Â· ìŠ¹ì¸ë¨ {approvedBookings.length}ê±´
              </span>
            )}
          </div>

          {/* ìŠ¹ì¸ ëŒ€ê¸° */}
          {pendingBookings.length > 0 && (
            <div style={{ marginBottom: "var(--stu-space-4)" }}>
              <div style={{ fontSize: 13, fontWeight: 600, color: "var(--stu-text-muted)", marginBottom: "var(--stu-space-2)" }}>
                ìŠ¹ì¸ ëŒ€ê¸° ({pendingBookings.length})
              </div>
              <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-2)" }}>
                {pendingBookings.map((request) => (
                  <div key={request.id} className="stu-panel" style={{ padding: "var(--stu-space-3)" }}>
                    <div style={{ fontWeight: 600, fontSize: 14, marginBottom: 4 }}>
                      {formatYmd(request.session_date)} {formatTime(request.session_start_time)}
                    </div>
                    <div className="stu-muted" style={{ fontSize: 12 }}>
                      {request.session_location}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* ìŠ¹ì¸ë¨ */}
          {approvedBookings.length > 0 && (
            <div>
              <div style={{ fontSize: 13, fontWeight: 600, color: "var(--stu-text-muted)", marginBottom: "var(--stu-space-2)" }}>
                ìŠ¹ì¸ë¨ ({approvedBookings.length})
              </div>
              <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-2)" }}>
                {approvedBookings.map((request) => (
                  <div
                    key={request.id}
                    className="stu-panel"
                    style={{
                      padding: "var(--stu-space-3)",
                      background: "var(--stu-success-bg)",
                      border: "1px solid var(--stu-success)",
                    }}
                  >
                    <div style={{ fontWeight: 600, fontSize: 14, marginBottom: 4 }}>
                      {formatYmd(request.session_date)} {formatTime(request.session_start_time)}
                    </div>
                    <div className="stu-muted" style={{ fontSize: 12 }}>
                      {request.session_location}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {pendingBookings.length === 0 && approvedBookings.length === 0 && (
            <EmptyState
              title="ì˜ˆì•½ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤"
              description="ë‹¬ë ¥ì—ì„œ ë‚ ì§œë¥¼ ì„ íƒí•˜ì—¬ ì˜ˆì•½ì„ ì‹ ì²­í•˜ì„¸ìš”."
            />
          )}
        </div>
      </div>
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: clinic-idcard/api/idcard.ts
==========================================================================================
// PATH: src/student/domains/clinic-idcard/api/idcard.ts
// ì‹¤ì œ API: GET /api/v1/clinic/idcard/ (ì°¨ì‹œë³„ í•©ë¶ˆ ë‹¨ì¼ ì§„ì‹¤: progress.ClinicLink)

import api from "@/student/shared/api/studentApi";

export type ClinicIdcardResult = "SUCCESS" | "FAIL";

export type ClinicIdcardHistoryItem = {
  session_order: number;
  passed: boolean;
  clinic_required: boolean;
};

export type ClinicIdcardData = {
  student_name: string;
  profile_photo_url: string | null;
  background_colors: [string, string, string];  // ìœ„ì¡° ë°©ì§€ìš© ë°°ê²½ ê·¸ë¼ë°ì´ì…˜ ìƒ‰ìƒ 3ê°œ
  server_date: string;
  server_datetime: string;
  histories: ClinicIdcardHistoryItem[];
  current_result: ClinicIdcardResult;
};

export async function fetchClinicIdcard(): Promise<ClinicIdcardData> {
  const res = await api.get("/clinic/idcard/");
  const data = res.data as ClinicIdcardData;
  const defaultColors: [string, string, string] = ["#ef4444", "#3b82f6", "#22c55e"];
  const bgColors = Array.isArray(data.background_colors) && data.background_colors.length >= 3
    ? [data.background_colors[0], data.background_colors[1], data.background_colors[2]] as [string, string, string]
    : defaultColors;
  
  return {
    student_name: data.student_name ?? "",
    profile_photo_url: data.profile_photo_url ?? null,
    background_colors: bgColors,
    server_date: data.server_date ?? "",
    server_datetime: data.server_datetime ?? "",
    histories: Array.isArray(data.histories) ? data.histories : [],
    current_result: data.current_result === "FAIL" ? "FAIL" : "SUCCESS",
  };
}


==========================================================================================
# FILE: clinic-idcard/components/HistoryStrip.tsx
==========================================================================================
// PATH: src/student/domains/clinic-idcard/components/HistoryStrip.tsx

import { ClinicHistoryItem } from "../pages/ClinicIDCardPage";

export default function HistoryStrip({
  histories,
}: {
  histories: ClinicHistoryItem[];
}) {
  return (
    <div className="history-strip">
      {histories.map((h, idx) => (
        <div
          key={idx}
          className={`history-item ${h.result.toLowerCase()}`}
        >
          {h.week}ì°¨
        </div>
      ))}
    </div>
  );
}


==========================================================================================
# FILE: clinic-idcard/components/LiveStamp.tsx
==========================================================================================
// PATH: src/student/domains/clinic-idcard/components/LiveStamp.tsx

import { useEffect, useState } from "react";

export default function LiveStamp() {
  const [now, setNow] = useState(new Date());

  useEffect(() => {
    const t = setInterval(() => setNow(new Date()), 1000);
    return () => clearInterval(t);
  }, []);

  return (
    <div className="live-stamp">
      <span className="live-dot" />
      {now.toLocaleDateString()} {now.toLocaleTimeString()}
    </div>
  );
}


==========================================================================================
# FILE: clinic-idcard/components/ResultBanner.tsx
==========================================================================================
// PATH: src/student/domains/clinic-idcard/components/ResultBanner.tsx

import { ClinicResult } from "../pages/ClinicIDCardPage";

export default function ResultBanner({ result }: { result: ClinicResult }) {
  return (
    <div className={`result-banner ${result.toLowerCase()}`}>
      {result === "SUCCESS" ? "í•©ê²©" : "í´ë¦¬ë‹‰ ëŒ€ìƒ"}
    </div>
  );
}


==========================================================================================
# FILE: clinic-idcard/pages/ClinicIDCardPage.tsx
==========================================================================================
/**
 * í´ë¦¬ë‹‰ ì¸ì¦(íŒ¨ìŠ¤ì¹´ë“œ) â€” ì‹¤ë¬´: ì¡°êµ 1ëª…ì´ 100ëª…ê°€ëŸ‰ ë¹ ë¥´ê²Œ ì‹œê° í™•ì¸
 * - ê¹¡ë¸”ë™ ë°°ê²½ + ëˆˆì— ë„ëŠ” ìƒ‰/ì• ë‹ˆë©”ì´ì…˜
 * - ì‹¤ì‹œê°„ ì‹œê³„(ì´ˆ ë‹¨ìœ„ ê°±ì‹ )ë¡œ ìœ„ì¡°Â·ìŠ¤í¬ë¦°ìƒ· ì¦‰ì‹œ íŒë³„
 */
import { useState, useEffect } from "react";
import { useQuery } from "@tanstack/react-query";
import { fetchClinicIdcard } from "../api/idcard";
import "../styles/idcard.css";

/** ì‹¤ì‹œê°„ ì‹œê° ë¬¸ìì—´ (ì´ˆ ë‹¨ìœ„) â€” ìœ„ì¡°/ìŠ¤í¬ë¦°ìƒ· ì‹œ ì´ˆê°€ ë©ˆì¶° ë³´ì´ë¯€ë¡œ íŒë³„ìš© */
function useLiveClock() {
  const [now, setNow] = useState(() => new Date());
  useEffect(() => {
    const id = setInterval(() => setNow(new Date()), 1000);
    return () => clearInterval(id);
  }, []);
  return now;
}

function formatLiveTime(d: Date): string {
  const h = d.getHours();
  const ampm = h < 12 ? "ì˜¤ì „" : "ì˜¤í›„";
  const h12 = h % 12 || 12;
  const m = d.getMinutes();
  const s = d.getSeconds();
  return `${ampm} ${h12}:${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;
}

/** ì´ˆ ë‹¨ìœ„ ìƒ‰ ë³€í™” (ì§ìˆ˜/í™€ìˆ˜ ì´ˆ) â€” ë…¹í™” ì˜ìƒ ë°©ì§€ */
function getTimeColor(seconds: number): string {
  return seconds % 2 === 0 ? "#22c55e" : "#60efff";
}


function formatLiveDate(d: Date): string {
  const y = d.getFullYear();
  const m = d.getMonth() + 1;
  const day = d.getDate();
  const weekdays = ["ì¼ìš”ì¼", "ì›”ìš”ì¼", "í™”ìš”ì¼", "ìˆ˜ìš”ì¼", "ëª©ìš”ì¼", "ê¸ˆìš”ì¼", "í† ìš”ì¼"];
  const w = weekdays[d.getDay()];
  return `${y}ë…„ ${m}ì›” ${day}ì¼ ${w}`;
}

export default function ClinicIDCardPage() {
  const liveNow = useLiveClock();
  const { data, isLoading, error } = useQuery({
    queryKey: ["clinic-idcard"],
    queryFn: fetchClinicIdcard,
    refetchInterval: 2000, // 2ì´ˆë§ˆë‹¤ ìë™ ê°±ì‹  (ì„ ìƒë‹˜ì´ ìƒ‰ìƒ ë³€ê²½ ì‹œ ì¦‰ì‹œ ë°˜ì˜)
  });

  if (isLoading) {
    return (
      <div className="idcard-page idcard-page--black">
        <div className="idcard-page__loading">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
      </div>
    );
  }

  if (error || !data) {
    return (
      <div className="idcard-page idcard-page--black">
        <div className="idcard-page__error">
          {error instanceof Error ? error.message : "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."}
        </div>
      </div>
    );
  }

  const isClinicTarget = data.current_result === "FAIL";
  const bgColors = data.background_colors || ["#ef4444", "#3b82f6", "#22c55e"];
  // ë¶ˆí•©ê²©(í´ë¦¬ë‹‰ ëŒ€ìƒ)ì¼ ë•ŒëŠ” ê²€ì •ìƒ‰ ë°°ê²½ ê³ ì •
  const bgGradient = isClinicTarget
    ? "#000000"
    : `linear-gradient(135deg, ${bgColors[0]} 0%, ${bgColors[1]} 50%, ${bgColors[2]} 100%)`;

  const seconds = liveNow.getSeconds();
  const timeColor = getTimeColor(seconds);

  return (
    <div
      className="idcard-page idcard-page--black"
      style={{
        background: bgGradient,
        backgroundSize: isClinicTarget ? "100% 100%" : "200% 200%",
        animation: isClinicTarget ? "none" : "idcard-background-flow 8s ease infinite",
      }}
    >
      {/* LIVE ë±ƒì§€ + ì‹¤ì‹œê°„ ì‹œê³„ (ì´ˆ ë‹¨ìœ„) â€” ìœ„ì¡° íŒë³„ìš© */}
      <div className="idcard-page__live-badge">
        <span className="idcard-page__live-dot" aria-hidden />
        <span>LIVE</span>
      </div>


      <div className="idcard-page__label">ì¡°íšŒ ì¼ì‹œ</div>
      <div className="idcard-page__date">{formatLiveDate(liveNow)}</div>
      <div
        className="idcard-page__time"
        aria-live="polite"
        style={{ color: timeColor }}
      >
        {formatLiveTime(liveNow)}
      </div>

      {/* í•™ìƒ ì´ë¦„ */}
      <div className="idcard-page__name">{data.student_name || "-"}</div>

      {/* íŒ¨ìŠ¤ì¹´ë“œ: í•©ê²© / í´ë¦¬ë‹‰ ì˜ˆì•½ ëŒ€ìƒì â€” í¼ì§€ë§‰í•˜ê²Œ í•œ ì¤„ë¡œ */}
      <div
        className={`idcard-page__pass-card ${isClinicTarget ? "idcard-page__pass-card--clinic" : "idcard-page__pass-card--pass"}`}
      >
        <div className="idcard-page__pass-card-title">
          {isClinicTarget ? "í´ë¦¬ë‹‰ ì˜ˆì•½ ëŒ€ìƒì" : "í•©ê²©"}
        </div>
      </div>

      {/* ì°¨ì‹œë³„ ì´ë ¥ (1~n) â€” ì½ê¸° ì „ìš© */}
      <div className="idcard-page__history-label">ì°¨ì‹œë³„ ì´ë ¥ (í•©ê²©/í´ë¦¬ë‹‰ ëŒ€ìƒ)</div>
      <div className="idcard-page__history-grid">
        {data.histories.length === 0 ? (
          <div className="idcard-page__history-empty">ì°¨ì‹œ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</div>
        ) : (
          data.histories.map((h) => (
            <div
              key={h.session_order}
              className={`idcard-page__history-item ${h.clinic_required ? "idcard-page__history-item--clinic" : "idcard-page__history-item--pass"}`}
            >
              {h.session_order}ì°¨ì‹œ
              <div className="idcard-page__history-item-sub">
                {h.clinic_required ? "í´ë¦¬ë‹‰ ëŒ€ìƒ" : "í•©ê²©"}
              </div>
            </div>
          ))
        )}
      </div>

      {isClinicTarget && (
        <div className="idcard-page__clinic-notice">
          ì„ ìƒë‹˜ ì•ˆë‚´ì— ë”°ë¼ í´ë¦¬ë‹‰ ì°¸ì—¬í•´ ì£¼ì„¸ìš”.
        </div>
      )}
    </div>
  );
}


==========================================================================================
# FILE: clinic-idcard/styles/idcard.css
==========================================================================================
/* PATH: src/student/domains/clinic-idcard/styles/idcard.css
 * íŒ¨ìŠ¤ì¹´ë“œ: ê¹¡ë¸”ë™ ë°°ê²½, ì‹¤ì‹œê°„ ì‹œê³„(ìœ„ì¡° íŒë³„), ëˆˆì— ë„ëŠ” ì• ë‹ˆë©”ì´ì…˜
 */

html,
body {
  margin: 0;
  padding: 0;
}

/* ---------- í˜ì´ì§€ ê³µí†µ: ê¹¡ë¸”ë™ ---------- */
.idcard-page {
  position: relative;
  min-height: 100dvh;
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: var(--stu-space-6, 24px) var(--stu-space-4, 16px);
  padding-top: max(var(--stu-safe-top, 0px), 24px);
  font-family: system-ui, -apple-system, sans-serif;
}

.idcard-page--black {
  background: #000;
  background-size: 200% 200%;
  animation: idcard-background-flow 8s ease infinite;
}

.idcard-page__loading,
.idcard-page__error {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  flex: 1;
  padding: 24px;
}

.idcard-page__loading {
  font-size: 18px;
  color: #94a3b8;
}

.idcard-page__error {
  font-size: 16px;
  color: #f87171;
}

/* ---------- LIVE ë±ƒì§€ + ì‹¤ì‹œê°„ ì‹œê³„ (ì´ˆ ë‹¨ìœ„) ---------- */
.idcard-page__live-badge {
  position: absolute;
  top: max(var(--stu-safe-top, 0px), 16px);
  right: 16px;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  font-weight: 800;
  letter-spacing: 0.05em;
  color: #22c55e;
}

.idcard-page__live-dot {
  width: 8px;
  height: 8px;
  background: #22c55e;
  border-radius: 50%;
  animation: idcard-pulse 1.2s ease-in-out infinite;
}

.idcard-page__label {
  font-size: clamp(1.25rem, 5vw, 1.75rem);
  font-weight: 800;
  letter-spacing: -0.02em;
  margin-bottom: 8px;
  color: #94a3b8;
}

.idcard-page__date {
  font-size: clamp(1.5rem, 6vw, 2.25rem);
  font-weight: 900;
  letter-spacing: -0.02em;
  margin-bottom: 8px;
  color: #e2e8f0;
}

.idcard-page__time {
  font-size: clamp(1.5rem, 6vw, 2.5rem);
  font-weight: 900;
  letter-spacing: 0.02em;
  margin-bottom: 32px;
  font-variant-numeric: tabular-nums;
  transition: color 0.3s ease;
}

.idcard-page__name {
  font-size: clamp(1.25rem, 5vw, 1.5rem);
  font-weight: 800;
  margin-bottom: 28px;
  color: #fff;
}

/* ---------- í”„ë¡œí•„ ì‚¬ì§„ (ì‹ ì› í™•ì¸ìš©) â€” ì¢Œì¸¡ ìƒë‹¨ ---------- */
.idcard-page__profile-photo {
  position: absolute;
  top: max(var(--stu-safe-top, 0px), 16px);
  left: 16px;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  overflow: hidden;
  border: 3px solid #fff;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
  z-index: 10;
}

.idcard-page__profile-photo img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.idcard-page__profile-initials {
  position: absolute;
  top: max(var(--stu-safe-top, 0px), 16px);
  left: 16px;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
  border: 3px solid #fff;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: 900;
  color: #fff;
  z-index: 10;
}

/* ---------- íŒ¨ìŠ¤ì¹´ë“œ: íë¥´ëŠ” ê·¸ë¼ë°ì´ì…˜ + ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ ìƒë™ê°Â·ìœ„ì¡° íŒë³„ ---------- */
.idcard-page__pass-card {
  width: 100%;
  max-width: 420px;
  padding: 36px 24px;
  border-radius: 16px;
  text-align: center;
  margin-bottom: 32px;
  color: #fff;
  position: relative;
  overflow: hidden;
  animation: idcard-card-glow 2.5s ease-in-out infinite;
}

.idcard-page__pass-card::before {
  content: "";
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(
    120deg,
    transparent,
    rgba(255, 255, 255, 0.1),
    transparent
  );
  animation: idcard-shimmer 3s linear infinite;
  pointer-events: none;
}

.idcard-page__pass-card--pass {
  background: linear-gradient(135deg, #22c55e 0%, #15803d 50%, #14532d 100%);
  background-size: 200% 200%;
  animation: idcard-card-glow 2.5s ease-in-out infinite, idcard-gradient-flow 4s ease infinite;
  box-shadow: 0 0 24px rgba(34, 197, 94, 0.4), 0 8px 32px rgba(21, 128, 61, 0.35);
}

.idcard-page__pass-card--clinic {
  background: linear-gradient(135deg, #ef4444 0%, #b91c1c 50%, #7f1d1d 100%);
  background-size: 200% 200%;
  animation: idcard-card-glow 2.5s ease-in-out infinite, idcard-gradient-flow 4s ease infinite;
  box-shadow: 0 0 24px rgba(239, 68, 68, 0.4), 0 8px 32px rgba(185, 28, 28, 0.35);
}

.idcard-page__pass-card-title {
  font-size: clamp(2rem, 10vw, 3.5rem);
  font-weight: 900;
  letter-spacing: -0.03em;
  line-height: 1.15;
  position: relative;
  z-index: 1;
}

/* ---------- ì°¨ì‹œ ì´ë ¥ ---------- */
.idcard-page__history-label {
  font-size: 12px;
  font-weight: 700;
  color: #64748b;
  margin-bottom: 12px;
  align-self: flex-start;
  max-width: 420px;
  width: 100%;
}

.idcard-page__history-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(72px, 1fr));
  gap: 10px;
  width: 100%;
  max-width: 420px;
}

.idcard-page__history-empty {
  grid-column: 1 / -1;
  text-align: center;
  color: #64748b;
  font-size: 14px;
}

.idcard-page__history-item {
  padding: 14px 8px;
  border-radius: 12px;
  text-align: center;
  font-weight: 800;
  font-size: 14px;
  color: #fff;
  pointer-events: none;
  user-select: none;
}

.idcard-page__history-item--pass {
  background: #14532d;
}

.idcard-page__history-item--clinic {
  background: #7f1d1d;
}

.idcard-page__history-item-sub {
  margin-top: 6px;
  font-size: 12px;
  opacity: 0.95;
}

.idcard-page__clinic-notice {
  margin-top: 28px;
  color: #fca5a5;
  font-size: 15px;
  font-weight: 700;
  text-align: center;
}

/* ---------- ë ˆê±°ì‹œ í´ë˜ìŠ¤ (í˜¸í™˜) ---------- */
.idcard-root {
  min-height: 100vh;
  padding: 24px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-family: system-ui, sans-serif;
  color: #fff;
  animation: fadeIn 0.3s ease;
}

.idcard-root.fail {
  background: #7f1d1d;
  animation: shake 0.4s ease;
}

.idcard-root.success {
  background: #14532d;
}

.idcard-name {
  font-size: 28px;
  font-weight: 900;
  margin: 12px 0;
}

.result-banner {
  font-size: 64px;
  font-weight: 900;
  margin: 24px 0;
  letter-spacing: 2px;
}

.result-banner.fail {
  color: #fecaca;
}

.result-banner.success {
  color: #bbf7d0;
}

.live-stamp {
  position: absolute;
  top: 16px;
  right: 16px;
  font-size: 14px;
  opacity: 0.9;
}

.live-dot {
  display: inline-block;
  width: 8px;
  height: 8px;
  background: #22c55e;
  border-radius: 50%;
  margin-right: 6px;
  animation: idcard-pulse 1s infinite;
}

.history-strip {
  display: flex;
  gap: 8px;
  margin-top: 24px;
}

.history-item {
  padding: 10px 14px;
  border-radius: 8px;
  font-weight: 800;
}

.history-item.success {
  background: #16a34a;
}

.history-item.fail {
  background: #dc2626;
}

/* ---------- í‚¤í”„ë ˆì„ ---------- */
@keyframes idcard-pulse {
  0%,
  100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.5;
    transform: scale(1.1);
  }
}

@keyframes idcard-card-glow {
  0%,
  100% {
    filter: brightness(1);
  }
  50% {
    filter: brightness(1.08);
  }
}

@keyframes idcard-gradient-flow {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

@keyframes idcard-shimmer {
  0% {
    transform: translateX(-100%) translateY(-100%) rotate(45deg);
  }
  100% {
    transform: translateX(100%) translateY(100%) rotate(45deg);
  }
}

@keyframes idcard-background-flow {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: 0.4; }
  100% { opacity: 1; }
}

@keyframes shake {
  0% { transform: translateX(0); }
  25% { transform: translateX(-6px); }
  50% { transform: translateX(6px); }
  75% { transform: translateX(-4px); }
  100% { transform: translateX(0); }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}


==========================================================================================
# FILE: dashboard/api/dashboard.ts
==========================================================================================
// PATH: src/student/domains/dashboard/api/dashboard.ts

import api from "@/student/shared/api/studentApi";

/**
 * âœ… Student Dashboard API (HOME ì „ìš©)
 *
 * ì›ì¹™:
 * - í™ˆì—ì„œëŠ” "í–‰ë™ ìœ ë„ ì •ë³´"ë§Œ ì‚¬ìš©
 * - ê³µì§€ / ì¼ì • ìƒì„¸ëŠ” ê° ë„ë©”ì¸ì—ì„œë§Œ ë…¸ì¶œ
 */

export type StudentDashboardBadges = {
  clinic_upcoming?: boolean;
  counseling_upcoming?: boolean;
  [key: string]: any;
};

export type StudentDashboardResponse = {
  badges: StudentDashboardBadges;
};

export async function fetchStudentDashboard(): Promise<StudentDashboardResponse> {
  const res = await api.get("/student/dashboard/");
  const data = res.data ?? {};

  return {
    badges:
      typeof data.badges === "object" && data.badges
        ? data.badges
        : {},
  };
}


==========================================================================================
# FILE: dashboard/components/DashboardScheduleCard.tsx
==========================================================================================
// PATH: src/student/domains/dashboard/components/DashboardScheduleCard.tsx
/**
 * âœ… DashboardScheduleCard
 * - í´ë¦¬ë‹‰ / ìƒë‹´ ì¼ì •
 */

import EmptyState from "@/student/shared/ui/layout/EmptyState";
import { formatYmd } from "@/student/shared/utils/date";
import { DashboardScheduleItem } from "../api/dashboard";

export default function DashboardScheduleCard({
  items,
}: {
  items: DashboardScheduleItem[];
}) {
  return (
    <div className="stu-section">
      <div style={{ fontWeight: 900, marginBottom: 12 }}>
        í´ë¦¬ë‹‰ Â· ìƒë‹´ ì¼ì •
      </div>

      {items.length === 0 && (
        <EmptyState title="ì˜ˆì •ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤." />
      )}

      {items.length > 0 && (
        <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
          {items.map((it) => (
            <div
              key={`${it.type}-${it.id}`}
              style={{
                padding: 12,
                borderRadius: "var(--stu-radius-md)",
                background: "var(--stu-surface-2)",
                display: "flex",
                justifyContent: "space-between",
                alignItems: "center",
              }}
            >
              <div>
                <div style={{ fontWeight: 800 }}>{it.title}</div>
                <div
                  style={{
                    fontSize: 12,
                    color: "var(--stu-text-muted)",
                    marginTop: 4,
                  }}
                >
                  {formatYmd(it.date)} Â·{" "}
                  {it.type === "CLINIC" ? "í´ë¦¬ë‹‰" : "ìƒë‹´"}
                </div>
              </div>
              <span style={{ opacity: 0.4 }}>â€º</span>
            </div>
          ))}
        </div>
      )}
    </div>
  );
}


==========================================================================================
# FILE: dashboard/components/NoticeBanner.tsx
==========================================================================================
// PATH: src/student/domains/dashboard/components/NoticeBanner.tsx

import { DashboardNotice } from "../api/dashboard";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import { formatYmd } from "@/student/shared/utils/date";

export default function NoticeBanner({
  notices,
}: {
  notices: DashboardNotice[];
}) {
  if (!notices || notices.length === 0) {
    return <EmptyState title="ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤." />;
  }

  const first = notices[0];

  return (
    <div className="stu-card">
      <div
        style={{
          display: "flex",
          justifyContent: "space-between",
          alignItems: "center",
          marginBottom: 6,
        }}
      >
        <div style={{ fontWeight: 900 }}>ğŸ“£ ê³µì§€ì‚¬í•­</div>
        <div style={{ fontSize: 12, color: "var(--stu-text-muted)" }}>
          {formatYmd(first.created_at ?? null)}
        </div>
      </div>

      <div style={{ fontSize: 14, fontWeight: 700 }}>{first.title}</div>
    </div>
  );
}


==========================================================================================
# FILE: dashboard/components/QuickActionGrid.tsx
==========================================================================================
// PATH: src/student/domains/dashboard/components/QuickActionGrid.tsx

import { Link } from "react-router-dom";

type Item = {
  label: string;
  to: string;
};

const items: Item[] = [
  { label: "ì‹œí—˜ Â· ì„±ì ", to: "/student/exams" },
  { label: "ìë£Œì‹¤", to: "/student/materials" },
  { label: "ê³¼ì œ ì œì¶œ", to: "/student/assignments" },
  { label: "ì„±ì  ê´€ë¦¬", to: "/student/grades" },
];

export default function QuickActionGrid() {
  return (
    <div className="stu-card">
      <div style={{ fontWeight: 900, marginBottom: 10 }}>ë°”ë¡œê°€ê¸°</div>

      <div
        style={{
          display: "grid",
          gridTemplateColumns: "1fr 1fr",
          gap: 10,
        }}
      >
        {items.map((it) => (
          <Link key={it.to} to={it.to} className="stu-quick-btn">
            {it.label}
          </Link>
        ))}
      </div>
    </div>
  );
}


==========================================================================================
# FILE: dashboard/components/TodaySessionsCard.tsx
==========================================================================================
// PATH: src/student/domains/dashboard/components/TodaySessionsCard.tsx

import { Link } from "react-router-dom";
import { DashboardSession } from "../api/dashboard";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import SectionHeader from "@/student/shared/ui/layout/SectionHeader";
import { formatYmd } from "@/student/shared/utils/date";

export default function TodaySessionsCard({
  sessions,
}: {
  sessions: DashboardSession[];
}) {
  return (
    <div className="stu-card">
      <SectionHeader title="ì˜¤ëŠ˜ í•  ì¼" />

      {(!sessions || sessions.length === 0) && (
        <EmptyState title="ì˜¤ëŠ˜ í•  ì°¨ì‹œê°€ ì—†ìŠµë‹ˆë‹¤." />
      )}

      {sessions && sessions.length > 0 && (
        <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
          {sessions.map((s) => (
            <Link
              key={s.id}
              to={`/student/sessions/${s.id}`}
              className="stu-list-item"
            >
              <div>
                <div style={{ fontWeight: 800 }}>{s.title}</div>
                <div className="stu-muted" style={{ fontSize: 12 }}>
                  {formatYmd(s.date ?? null)}
                  {s.status ? ` Â· ${s.status}` : ""}
                </div>
              </div>
              <div style={{ opacity: 0.6 }}>â€º</div>
            </Link>
          ))}
        </div>
      )}
    </div>
  );
}


==========================================================================================
# FILE: dashboard/hooks/useStudentDashboard.ts
==========================================================================================
// PATH: src/student/domains/dashboard/hooks/useStudentDashboard.ts

import { useQuery } from "@tanstack/react-query";
import { fetchStudentDashboard } from "../api/dashboard";

export function useStudentDashboard() {
  return useQuery({
    queryKey: ["student-dashboard"],
    queryFn: fetchStudentDashboard,
  });
}


==========================================================================================
# FILE: dashboard/pages/DashboardPage.tsx
==========================================================================================
/**
 * í™ˆ â€” ì˜¤ëŠ˜ ì¼ì •, ë¹ ë¥¸ ë©”ë‰´(ì˜ìƒÂ·ì‹œí—˜Â·ì„±ì Â·ì¼ì •), ê³µì§€
 */
import { Link } from "react-router-dom";
import { useStudentDashboard } from "../hooks/useStudentDashboard";
import { useMySessions } from "@/student/domains/sessions/hooks/useStudentSessions";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import { IconPlay, IconCalendar, IconGrade, IconExam, IconNotice, IconClipboard, IconClinic } from "@/student/shared/ui/icons/Icons";
import { formatYmd } from "@/student/shared/utils/date";
import { useNotificationCounts } from "@/student/domains/notifications/hooks/useNotificationCounts";
import NotificationBadge from "@/student/shared/ui/components/NotificationBadge";

export default function DashboardPage() {
  const { data: dashboard, isLoading: dashLoading } = useStudentDashboard();
  const { data: sessions, isLoading: sessionsLoading } = useMySessions();
  const { data: notificationCounts, isLoading: countsLoading } = useNotificationCounts();

  const today = new Date().toISOString().slice(0, 10);
  const todaySessions = (sessions ?? []).filter((s) => (s.date ?? "").slice(0, 10) === today);

  if (dashLoading && sessionsLoading) {
    return (
      <div style={{ padding: "var(--stu-space-4) 0" }}>
        <div className="stu-skel" style={{ height: 100, borderRadius: "var(--stu-radius-md)" }} />
        <div className="stu-skel" style={{ height: 120, marginTop: 12, borderRadius: "var(--stu-radius-md)" }} />
      </div>
    );
  }

  return (
    <div style={{ padding: "var(--stu-space-2) 0" }}>
      {/* ê³µì§€ */}
      <Link
        to="/student/notices"
        className="stu-panel stu-panel--pressable stu-panel--accent"
        style={{
          display: "flex",
          alignItems: "center",
          gap: "var(--stu-space-4)",
          marginBottom: "var(--stu-space-6)",
          textDecoration: "none",
          color: "inherit",
        }}
      >
        <div style={{ width: 44, height: 44, borderRadius: 12, background: "var(--stu-surface-soft)", display: "grid", placeItems: "center" }}>
          <IconNotice style={{ width: 24, height: 24, color: "var(--stu-primary)" }} />
        </div>
        <div style={{ flex: 1, minWidth: 0 }}>
          <div style={{ fontWeight: 700, fontSize: 15 }}>ê³µì§€ì‚¬í•­</div>
          <div className="stu-muted" style={{ fontSize: 13, marginTop: 2 }}>ì¤‘ìš”í•œ ê³µì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”</div>
        </div>
        <span className="stu-cta-link" style={{ fontSize: 13 }}>ë³´ê¸°</span>
      </Link>

      {/* ì˜¤ëŠ˜ ì¼ì • â†’ ì „ì²´ ì¼ì • ë³´ê¸° (ìš°ì¸¡ ì¼ì • ì•„ì´ì½˜) */}
      <section style={{ marginBottom: "var(--stu-space-8)" }}>
        {todaySessions.length === 0 ? (
          <Link
            to="/student/sessions"
            className="stu-status-surface stu-panel--pressable"
            style={{
              display: "flex",
              alignItems: "center",
              justifyContent: "space-between",
              gap: "var(--stu-space-4)",
              textDecoration: "none",
              color: "inherit",
            }}
          >
            <div>
              <div className="stu-status-eyebrow">TODAY</div>
              <div className="stu-status-title">ì˜ˆì •ëœ ìˆ˜ì—…ì´ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
            <div style={{ display: "flex", alignItems: "center", gap: "var(--stu-space-2)", flexShrink: 0 }}>
              <IconCalendar style={{ width: 24, height: 24, color: "var(--stu-primary)" }} />
              <span className="stu-cta-link" style={{ fontSize: 13 }}>ì „ì²´ ì¼ì • ë³´ê¸°</span>
            </div>
          </Link>
        ) : (
          <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-2)" }}>
            {todaySessions.slice(0, 3).map((s) => (
              <Link
                key={s.id}
                to={`/student/sessions/${s.id}`}
                className="stu-panel stu-panel--pressable stu-panel--accent stu-panel--action"
                style={{ display: "flex", alignItems: "center", gap: 12, textDecoration: "none", color: "inherit" }}
              >
                <div style={{ width: 40, height: 40, borderRadius: 10, background: "var(--stu-primary)", opacity: 0.9, display: "grid", placeItems: "center" }}>
                  <IconCalendar style={{ width: 20, height: 20, color: "var(--stu-primary-contrast)" }} />
                </div>
                <div style={{ flex: 1, minWidth: 0 }}>
                  <div style={{ fontWeight: 600, fontSize: 14 }}>{s.title}</div>
                  <div className="stu-muted" style={{ fontSize: 12 }}>{formatYmd(s.date ?? null)}</div>
                </div>
              </Link>
            ))}
            <Link
              to="/student/sessions"
              className="stu-panel stu-panel--pressable"
              style={{
                display: "flex",
                alignItems: "center",
                justifyContent: "flex-end",
                gap: "var(--stu-space-2)",
                textDecoration: "none",
                color: "inherit",
                padding: "var(--stu-space-3)",
              }}
            >
              <IconCalendar style={{ width: 20, height: 20, color: "var(--stu-primary)", flexShrink: 0 }} />
              <span className="stu-cta-link" style={{ fontSize: 13 }}>ì „ì²´ ì¼ì • ë³´ê¸°</span>
            </Link>
          </div>
        )}
      </section>

      {/* ë¹ ë¥¸ ë©”ë‰´ */}
      <section>
        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 }}>
          <Link
            to="/student/video"
            className="stu-action-tile"
            style={{ position: "relative" }}
          >
            <div className="stu-action-tile__icon" style={{ position: "relative" }}>
              <IconPlay style={{ width: 20, height: 20, color: "var(--stu-primary)" }} />
              {!countsLoading && notificationCounts && notificationCounts.video > 0 && (
                <NotificationBadge count={notificationCounts.video} />
              )}
            </div>
            <div className="stu-action-tile__label">ì˜ìƒ</div>
          </Link>
          <Link
            to="/student/exams"
            className="stu-action-tile"
          >
            <div className="stu-action-tile__icon">
              <IconExam style={{ width: 20, height: 20, color: "var(--stu-primary)" }} />
            </div>
            <div className="stu-action-tile__label">ì‹œí—˜</div>
          </Link>
          <Link
            to="/student/qna"
            className="stu-action-tile"
          >
            <div className="stu-action-tile__icon">
              <IconNotice style={{ width: 20, height: 20, color: "var(--stu-primary)" }} />
            </div>
            <div className="stu-action-tile__label">QnA</div>
          </Link>
          <Link
            to="/student/submit"
            className="stu-action-tile"
          >
            <div className="stu-action-tile__icon">
              <IconClipboard style={{ width: 20, height: 20, color: "var(--stu-primary)" }} />
            </div>
            <div className="stu-action-tile__label">ì œì¶œ</div>
          </Link>
          <Link
            to="/student/grades"
            className="stu-action-tile"
            style={{ position: "relative" }}
          >
            <div className="stu-action-tile__icon" style={{ position: "relative" }}>
              <IconGrade style={{ width: 20, height: 20, color: "var(--stu-primary)" }} />
              {!countsLoading && notificationCounts && notificationCounts.grade > 0 && (
                <NotificationBadge count={notificationCounts.grade} />
              )}
            </div>
            <div className="stu-action-tile__label">ì„±ì </div>
          </Link>
          <Link
            to="/student/clinic"
            className="stu-action-tile"
            style={{ position: "relative" }}
          >
            <div className="stu-action-tile__icon" style={{ position: "relative" }}>
              <IconClinic style={{ width: 20, height: 20, color: "var(--stu-primary)" }} />
              {!countsLoading && notificationCounts && notificationCounts.clinic > 0 && (
                <NotificationBadge count={notificationCounts.clinic} />
              )}
            </div>
            <div className="stu-action-tile__label">í´ë¦¬ë‹‰</div>
          </Link>
        </div>
      </section>
    </div>
  );
}


==========================================================================================
# FILE: exams/api/assets.ts
==========================================================================================
// src/student/domains/exams/api/assets.ts
/**
 * âœ… Student Exam Assets API (LOCK v1)
 * - í•™ìƒì€ downloadë§Œ (ì—…ë¡œë“œëŠ” ê´€ë¦¬ì/êµì‚¬)
 * - asset_type ì˜ë¯¸ í•´ì„ âŒ
 */

import api from "@/student/shared/api/studentApi";

export type ExamAsset = {
  id: number;
  asset_type: string;
  download_url: string;
};

export async function fetchExamAssets(examId: number): Promise<ExamAsset[]> {
  const res = await api.get(`/exams/${examId}/assets/`);
  const data = res.data;
  if (Array.isArray(data?.items)) return data.items as ExamAsset[];
  if (Array.isArray(data)) return data as ExamAsset[];
  return [];
}


==========================================================================================
# FILE: exams/api/exams.ts
==========================================================================================
// PATH: src/student/domains/exams/api/exams.ts

import api from "@/student/shared/api/studentApi";

export type StudentExam = {
  id: number;
  title: string;
  open_at: string | null;
  close_at: string | null;
  allow_retake: boolean;
  max_attempts: number;
  pass_score: number;
  description?: string | null;
  session_id?: number | null;
};

export type ExamsListResponse = {
  items: StudentExam[];
};

export async function fetchStudentExams(): Promise<ExamsListResponse> {
  const res = await api.get("/student/exams/");
  const data = res.data;
  if (data?.items && Array.isArray(data.items)) return data as ExamsListResponse;
  if (Array.isArray(data)) return { items: data as StudentExam[] };
  return { items: [] };
}

export async function fetchStudentExam(examId: number): Promise<StudentExam> {
  const res = await api.get(`/student/exams/${examId}/`);
  return res.data as StudentExam;
}


==========================================================================================
# FILE: exams/api/results.ts
==========================================================================================
// PATH: src/student/domains/exams/api/results.ts

import api from "@/student/shared/api/studentApi";

export type MyExamResult = {
  exam_id: number;
  attempt_id: number;
  total_score: number;
  max_score: number;
  is_pass: boolean;
  submitted_at: string | null;
  can_retake: boolean;
};

export type MyExamResultItem = {
  question_id: number;
  question_number: number;
  student_answer: string | null;
  correct_answer: string | null;
  score: number;
  max_score: number;
  is_correct: boolean;
  meta?: Record<string, any>;
};

export async function fetchMyExamResult(examId: number): Promise<MyExamResult> {
  const res = await api.get(`/student/results/me/exams/${examId}/`);
  return res.data as MyExamResult;
}

export async function fetchMyExamResultItems(
  examId: number
): Promise<MyExamResultItem[]> {
  const res = await api.get(`/student/results/me/exams/${examId}/items/`);
  const data = res.data;
  if (Array.isArray(data?.items)) return data.items as MyExamResultItem[];
  if (Array.isArray(data)) return data as MyExamResultItem[];
  return [];
}


==========================================================================================
# FILE: exams/components/ExamActionButton.tsx
==========================================================================================
// PATH: src/student/domains/exams/components/ExamActionButton.tsx

import { Link } from "react-router-dom";

export type ExamActionButtonProps = {
  to: string;
  label: string;
  disabled?: boolean;
};

export default function ExamActionButton({
  to,
  label,
  disabled,
}: ExamActionButtonProps) {
  if (disabled) {
    return (
      <div className="stu-muted" style={{ fontSize: 14 }}>
        {label}
      </div>
    );
  }

  return (
    <Link to={to} className="stu-cta-link">
      {label}
    </Link>
  );
}


==========================================================================================
# FILE: exams/components/ExamCard.tsx
==========================================================================================
// PATH: src/student/domains/exams/components/ExamActionButton.tsx

import { Link } from "react-router-dom";

export type ExamActionButtonProps = {
  to: string;
  label: string;
  disabled?: boolean;
};

export default function ExamActionButton({
  to,
  label,
  disabled,
}: ExamActionButtonProps) {
  if (disabled) {
    return (
      <div
        style={{
          padding: "10px 14px",
          borderRadius: 12,
          border: "1px solid var(--stu-border)",
          background: "var(--stu-surface)",
          color: "var(--stu-text-muted)",
          fontWeight: 800,
          opacity: 0.5,
        }}
      >
        {label}
      </div>
    );
  }

  return (
    <Link
      to={to}
      style={{
        padding: "10px 14px",
        borderRadius: 12,
        border: "1px solid var(--stu-border)",
        background: "var(--stu-primary, #111)",
        color: "#fff",
        fontWeight: 900,
        textDecoration: "none",
        display: "inline-block",
      }}
    >
      {label}
    </Link>
  );
}


==========================================================================================
# FILE: exams/components/ExamResultItems.tsx
==========================================================================================
// PATH: src/student/domains/exams/components/ExamResultItems.tsx

import { MyExamResultItem } from "../api/results";

export default function ExamResultItems({
  items,
}: {
  items: MyExamResultItem[];
}) {
  return (
    <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
      {items.map((it) => (
        <div
          key={`${it.question_id}-${it.question_number}`}
          style={{
            border: "1px solid var(--stu-border)",
            borderRadius: 12,
            padding: 12,
            background: "var(--stu-surface)",
          }}
        >
          <div style={{ fontWeight: 900 }}>
            Q{it.question_number}
          </div>

          <div
            style={{
              fontSize: 13,
              marginTop: 6,
              color: it.is_correct ? "#087443" : "#b00020",
              fontWeight: 800,
            }}
          >
            {it.is_correct ? "ì •ë‹µ" : "ì˜¤ë‹µ"} Â· {it.score}/{it.max_score}
          </div>

          <div
            style={{
              fontSize: 12,
              marginTop: 6,
              color: "var(--stu-text-muted)",
            }}
          >
            ë‚´ ë‹µ: {it.student_answer ?? "-"} / ì •ë‹µ:{" "}
            {it.correct_answer ?? "-"}
          </div>
        </div>
      ))}
    </div>
  );
}


==========================================================================================
# FILE: exams/components/ExamResultSummary.tsx
==========================================================================================
// PATH: src/student/domains/exams/components/ExamResultSummary.tsx

import { MyExamResult } from "../api/results";

export default function ExamResultSummary({
  result,
}: {
  result: MyExamResult;
}) {
  const pass = result.is_pass;

  return (
    <div
      className="stu-card"
      style={{
        display: "flex",
        justifyContent: "space-between",
        alignItems: "center",
        gap: 12,
      }}
    >
      <div>
        <div style={{ fontSize: 22, fontWeight: 900 }}>
          {result.total_score} / {result.max_score}
        </div>
        <div style={{ fontSize: 12, color: "var(--stu-text-muted)" }}>
          attempt #{result.attempt_id}
        </div>
      </div>

      <div
        style={{
          padding: "6px 12px",
          borderRadius: 999,
          fontWeight: 900,
          fontSize: 13,
          background: pass ? "#e7fff1" : "#ffecec",
          color: pass ? "#087443" : "#b00020",
        }}
      >
        {pass ? "PASS" : "FAIL"}
      </div>
    </div>
  );
}


==========================================================================================
# FILE: exams/hooks/useMyExamResult.ts
==========================================================================================
// src/student/domains/exams/hooks/useMyExamResult.ts
/**
 * âœ… useMyExamResult (LOCK v1)
 */

import { useQuery } from "@tanstack/react-query";
import { fetchMyExamResult } from "@/student/domains/exams/api/results";

export function useMyExamResult(examId?: number) {
  const safeId = Number(examId);

  return useQuery({
    queryKey: ["my-exam-result", safeId],
    queryFn: () => fetchMyExamResult(safeId),
    enabled: Number.isFinite(safeId),
  });
}


==========================================================================================
# FILE: exams/hooks/useMyExamResultItems.ts
==========================================================================================
// src/student/domains/exams/hooks/useMyExamResultItems.ts
/**
 * âœ… useMyExamResultItems (LOCK v1)
 */

import { useQuery } from "@tanstack/react-query";
import { fetchMyExamResultItems } from "@/student/domains/exams/api/results";

export function useMyExamResultItems(examId?: number) {
  const safeId = Number(examId);

  return useQuery({
    queryKey: ["my-exam-result-items", safeId],
    queryFn: () => fetchMyExamResultItems(safeId),
    enabled: Number.isFinite(safeId),
  });
}


==========================================================================================
# FILE: exams/hooks/useStudentExams.ts
==========================================================================================
// src/student/domains/exams/hooks/useStudentExams.ts
/**
 * âœ… useStudentExams / useStudentExam
 */

import { useQuery } from "@tanstack/react-query";
import { fetchStudentExam, fetchStudentExams } from "@/student/domains/exams/api/exams";

export function useStudentExams(params?: { session_id?: number }) {
  const sessionId = params?.session_id;
  const enabled = sessionId == null ? true : Number.isFinite(Number(sessionId));

  return useQuery({
    queryKey: ["student-exams", params ?? {}],
    queryFn: () => fetchStudentExams(params),
    enabled,
  });
}

export function useStudentExam(examId?: number) {
  const safeId = Number(examId);
  return useQuery({
    queryKey: ["student-exam", safeId],
    queryFn: () => fetchStudentExam(safeId),
    enabled: Number.isFinite(safeId),
  });
}


==========================================================================================
# FILE: exams/pages/ExamDetailPage.tsx
==========================================================================================
// src/student/domains/exams/pages/ExamDetailPage.tsx
/**
 * âœ… ExamDetailPage (í•™ìƒ)
 * - ìì‚° ë‹¤ìš´ë¡œë“œ + ê²°ê³¼/ì œì¶œ ì§„ì…
 *
 * ì›ì¹™:
 * - ì‘ì‹œ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ í”„ë¡ íŠ¸ì—ì„œ íŒë‹¨ âŒ
 * - "ì¬ì‹œí—˜ ë²„íŠ¼" íŒë‹¨ì€ Result APIì˜ can_retakeë§Œ ì‹ ë¢° âœ…
 */

import { Link, useParams } from "react-router-dom";
import StudentPageShell from "../../../shared/ui/pages/StudentPageShell";
import EmptyState from "../../../shared/ui/layout/EmptyState";
import { useStudentExam } from "@/student/domains/exams/hooks/useStudentExams";
import { useMyExamResult } from "@/student/domains/exams/hooks/useMyExamResult";
import { useQuery } from "@tanstack/react-query";
import { fetchExamAssets } from "@/student/domains/exams/api/assets";

export default function ExamDetailPage() {
  const { examId } = useParams();
  const safeId = Number(examId);

  const examQ = useStudentExam(Number.isFinite(safeId) ? safeId : undefined);

  // âœ… ê²°ê³¼ëŠ” "ë‹¨ì¼ ì§„ì‹¤": can_retake í¬í•¨
  const resultQ = useMyExamResult(Number.isFinite(safeId) ? safeId : undefined);

  // âœ… ìì‚° ëª©ë¡
  const assetsQ = useQuery({
    queryKey: ["student-exam-assets", safeId],
    queryFn: () => fetchExamAssets(safeId),
    enabled: Number.isFinite(safeId),
  });

  if (!Number.isFinite(safeId)) {
    return (
      <StudentPageShell title="ì‹œí—˜" description="ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.">
        <EmptyState title="ì‹œí—˜ IDê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  if (examQ.isLoading) {
    return (
      <StudentPageShell title="ì‹œí—˜" description="ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...">
        <div style={{ fontSize: 14, color: "#666" }}>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </StudentPageShell>
    );
  }

  if (examQ.isError || !examQ.data) {
    return (
      <StudentPageShell title="ì‹œí—˜" description="ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.">
        <EmptyState title="ì‹œí—˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  const exam = examQ.data;
  const canRetake = typeof resultQ.data?.can_retake === "boolean" ? resultQ.data.can_retake : true;

  return (
    <StudentPageShell
      title={exam.title}
      description="ì œì¶œ / ê²°ê³¼ ì¡°íšŒ"
      actions={
        <Link to="/student/exams" className="stu-cta-link">
          ëª©ë¡
        </Link>
      }
    >
      <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
        {/* ===== Assets ===== */}
        {/* ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ ì œê±°ë¨ (ì˜ë„ì ìœ¼ë¡œ ë¯¸ì œê³µ) */}

        {/* ===== Actions ===== */}
        <div className="stu-section">
          <div className="stu-section-header" style={{ fontWeight: 700, fontSize: 15 }}>
            ì‘ì‹œ / ê²°ê³¼
          </div>

          <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-4)" }}>
            <Link to={`/student/exams/${exam.id}/result`} className="stu-cta-link">
              ê²°ê³¼ ë³´ê¸°
            </Link>

            {/* âœ… can_retakeë§Œ ì‹ ë¢° */}
            {canRetake ? (
              <Link to={`/student/exams/${exam.id}/submit`} className="stu-cta-link">
                ì œì¶œí•˜ê¸°
              </Link>
            ) : (
              <div className="stu-muted" style={{ fontSize: 13 }}>
                ì¬ì‹œí—˜ ë¶ˆê°€
              </div>
            )}
          </div>

          <div style={{ marginTop: "var(--stu-space-6)", fontSize: 12, color: "var(--stu-text-muted)" }}>
            â€» ì¬ì‹œí—˜ ê°€ëŠ¥ ì—¬ë¶€ëŠ” ê²°ê³¼ APIì˜ <b>can_retake</b>ë§Œ ì‹ ë¢°í•©ë‹ˆë‹¤.
          </div>
        </div>
      </div>
    </StudentPageShell>
  );
}

// ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ ì œê±°ë¨ (ì˜ë„ì ìœ¼ë¡œ ë¯¸ì œê³µ)
// Surface ê¸°ë°˜ ìŠ¤íƒ€ì¼ì€ base.cssì˜ .stu-section ì‚¬ìš©


==========================================================================================
# FILE: exams/pages/ExamListPage.tsx
==========================================================================================
// PATH: src/student/domains/exams/pages/ExamListPage.tsx
import { Link } from "react-router-dom";
import StudentPageShell from "@/student/shared/ui/pages/StudentPageShell";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import { useStudentExams } from "../hooks/useStudentExams";
import { StudentExam } from "../api/exams";
import { IconExam, IconChevronRight } from "@/student/shared/ui/icons/Icons";

export default function ExamListPage() {
  const { data, isLoading, isError } = useStudentExams();
  const items = data?.items ?? [];

  // ìƒíƒœ ê¸°ë°˜ Panel variant ê²°ì • (deadline ê¸°ë°˜)
  const getExamPanelVariant = (exam: StudentExam): string => {
    const now = new Date();
    const closeAt = exam.close_at ? new Date(exam.close_at) : null;
    
    if (!closeAt) {
      return "stu-panel--nav";
    }

    const hoursUntilClose = (closeAt.getTime() - now.getTime()) / (1000 * 60 * 60);
    
    // ë§ˆê° ì„ë°• (24ì‹œê°„ ì´ë‚´)
    if (hoursUntilClose > 0 && hoursUntilClose <= 24) {
      return "stu-panel--danger";
    }
    
    // ë§ˆê° ì§€ë‚¨
    if (hoursUntilClose <= 0) {
      return "stu-panel--complete";
    }
    
    // ì‘ì‹œ ê°€ëŠ¥ (24ì‹œê°„ ì´ìƒ ë‚¨ìŒ)
    const openAt = exam.open_at ? new Date(exam.open_at) : null;
    if (openAt && now >= openAt) {
      return "stu-panel--action";
    }
    
    return "stu-panel--nav";
  };

  // ì‹œê°„ ì••ë°•ë„ ê²°ì • (6ì‹œê°„ ì´ë‚´)
  const getUrgency = (exam: StudentExam): string | undefined => {
    const now = new Date();
    const closeAt = exam.close_at ? new Date(exam.close_at) : null;
    
    if (!closeAt) {
      return undefined;
    }

    const hoursUntilClose = (closeAt.getTime() - now.getTime()) / (1000 * 60 * 60);
    
    // 6ì‹œê°„ ì´ë‚´ â†’ high urgency
    if (hoursUntilClose > 0 && hoursUntilClose <= 6) {
      return "high";
    }
    
    return undefined;
  };

  return (
    <StudentPageShell title="ì‹œí—˜">
      {isLoading && <div>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>}
      {isError && <EmptyState title="ì‹œí—˜ ëª©ë¡ ì˜¤ë¥˜" />}

      {items.length === 0 && (
        <EmptyState title="ì‹œí—˜ì´ ì—†ìŠµë‹ˆë‹¤." />
      )}

      <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-3)" }}>
        {items.map((e) => {
          const variant = getExamPanelVariant(e);
          const urgency = getUrgency(e);
          
          return (
            <Link
              key={e.id}
              to={`/student/exams/${e.id}`}
              className={`stu-panel stu-panel--pressable stu-panel--accent ${variant}`}
              data-urgency={urgency}
              style={{
                display: "flex",
                alignItems: "center",
                gap: "var(--stu-space-4)",
                textDecoration: "none",
                color: "inherit",
              }}
            >
            <div style={{ width: 44, height: 44, borderRadius: 12, background: "var(--stu-surface-soft)", display: "grid", placeItems: "center" }}>
              <IconExam style={{ width: 22, height: 22, color: "var(--stu-primary)" }} />
            </div>
            <div style={{ flex: 1, minWidth: 0 }}>
              <div style={{ fontWeight: 700, fontSize: 15 }}>{e.title}</div>
              <div className="stu-muted" style={{ fontSize: 13, marginTop: 2 }}>
                {e.close_at ? `ë§ˆê°: ${new Date(e.close_at).toLocaleDateString()}` : "ë§ˆê°ì¼ ë¯¸ì •"}
              </div>
            </div>
            <IconChevronRight style={{ width: 20, height: 20, color: "var(--stu-text-muted)" }} />
            </Link>
          );
        })}
      </div>
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: exams/pages/ExamResultPage.tsx
==========================================================================================
// src/student/domains/exams/pages/ExamResultPage.tsx
/**
 * âœ… ExamResultPage (í•™ìƒ ê²°ê³¼)
 * - ëŒ€í‘œ Result + ResultItem(ë¬¸í•­ë³„) ë Œë”ë§
 * - íŒë‹¨/ê³„ì‚° âŒ
 * - can_retake / is_pass ê·¸ëŒ€ë¡œ ì‚¬ìš© âœ…
 */

import { Link, useParams } from "react-router-dom";
import StudentPageShell from "../../../shared/ui/pages/StudentPageShell";
import EmptyState from "../../../shared/ui/layout/EmptyState";
import { useMyExamResult } from "@/student/domains/exams/hooks/useMyExamResult";
import { useMyExamResultItems } from "@/student/domains/exams/hooks/useMyExamResultItems";

export default function ExamResultPage() {
  const { examId } = useParams();
  const safeId = Number(examId);

  const resultQ = useMyExamResult(Number.isFinite(safeId) ? safeId : undefined);
  const itemsQ = useMyExamResultItems(Number.isFinite(safeId) ? safeId : undefined);

  if (!Number.isFinite(safeId)) {
    return (
      <StudentPageShell title="ì‹œí—˜ ê²°ê³¼" description="ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.">
        <EmptyState title="ì‹œí—˜ IDê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  if (resultQ.isLoading) {
    return (
      <StudentPageShell title="ì‹œí—˜ ê²°ê³¼" description="ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...">
        <div style={{ fontSize: 14, color: "#666" }}>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </StudentPageShell>
    );
  }

  if (resultQ.isError || !resultQ.data) {
    return (
      <StudentPageShell title="ì‹œí—˜ ê²°ê³¼" description="ì¡°íšŒ ì‹¤íŒ¨">
        <EmptyState
          title="ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤."
          description="ì•„ì§ ì±„ì  ì „ì´ê±°ë‚˜ ê¶Œí•œ/ë°ì´í„°ê°€ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
        />
      </StudentPageShell>
    );
  }

  const r = resultQ.data;

  return (
    <StudentPageShell
      title="ì‹œí—˜ ê²°ê³¼"
      description={`exam_id: ${r.exam_id} Â· attempt_id: ${r.attempt_id}`}
      actions={
        <Link to={`/student/exams/${safeId}`} style={linkBtn}>
          ì‹œí—˜ìœ¼ë¡œ
        </Link>
      }
    >
      <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
        {/* ===== Summary ===== */}
        <div style={card}>
          <div style={{ fontWeight: 900 }}>ìš”ì•½</div>

          <div style={{ marginTop: 8, display: "flex", gap: 10, alignItems: "center" }}>
            <div style={{ fontSize: 22, fontWeight: 900 }}>
              {r.total_score} / {r.max_score}
            </div>

            <span
              style={{
                padding: "4px 8px",
                borderRadius: 999,
                fontSize: 12,
                fontWeight: 900,
                background: r.is_pass ? "#e8fff0" : "#ffecec",
                color: r.is_pass ? "#0a7a38" : "#b10000",
              }}
            >
              {r.is_pass ? "í†µê³¼" : "ë¯¸í†µê³¼"}
            </span>
          </div>

          <div style={{ marginTop: 8, fontSize: 13, color: "#666" }}>
            submitted_at: {r.submitted_at ?? "-"}
          </div>

          <div style={{ marginTop: 8, fontSize: 13, color: "#666" }}>
            can_retake: <b>{String(r.can_retake)}</b>
          </div>
        </div>

        {/* ===== Items ===== */}
        <div style={card}>
          <div style={{ fontWeight: 900, marginBottom: 8 }}>ë¬¸í•­ë³„ ê²°ê³¼</div>

          {itemsQ.isLoading && <div style={{ fontSize: 13, color: "#666" }}>ë¬¸í•­ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>}
          {itemsQ.isError && <div style={{ fontSize: 13, color: "#c00" }}>ë¬¸í•­ ì¡°íšŒ ì‹¤íŒ¨</div>}

          {itemsQ.data && itemsQ.data.length === 0 && (
            <div style={{ fontSize: 13, color: "#777" }}>ë¬¸í•­ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
          )}

          {itemsQ.data && itemsQ.data.length > 0 && (
            <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
              {itemsQ.data.map((it) => (
                <div
                  key={`${it.question_id}-${it.question_number}`}
                  style={{
                    border: "1px solid #eee",
                    borderRadius: 10,
                    padding: 10,
                    background: "#fafafa",
                  }}
                >
                  <div style={{ fontWeight: 900 }}>
                    Q{it.question_number} (id:{it.question_id})
                  </div>
                  <div style={{ marginTop: 6, fontSize: 13, color: "#444" }}>
                    ì •ì˜¤: <b>{it.is_correct ? "ì •ë‹µ" : "ì˜¤ë‹µ"}</b>
                    {" Â· "}
                    ì ìˆ˜: <b>{it.score}</b> / {it.max_score}
                  </div>
                  <div style={{ marginTop: 6, fontSize: 13, color: "#666" }}>
                    ë‚´ ë‹µ: {it.student_answer ?? "-"} / ì •ë‹µ: {it.correct_answer ?? "-"}
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    </StudentPageShell>
  );
}

const card: React.CSSProperties = {
  border: "1px solid #eee",
  borderRadius: 12,
  padding: 14,
  background: "#fff",
};

const linkBtn: React.CSSProperties = {
  display: "inline-block",
  padding: "10px 12px",
  borderRadius: 10,
  border: "1px solid #ddd",
  textDecoration: "none",
  background: "#fafafa",
  color: "#111",
  fontWeight: 800,
};


==========================================================================================
# FILE: exams/pages/ExamSubmitPage.tsx
==========================================================================================
// src/student/domains/exams/pages/ExamSubmitPage.tsx
/**
 * âœ… ExamSubmitPage (í•™ìƒ ì œì¶œ)
 *
 * âš ï¸ ì¤‘ìš”:
 * - Submission feature ì¬ì‚¬ìš©ì´ ì›ì¹™(C)
 * - ë‹¤ë§Œ ì´ í”„ë¡œì íŠ¸ëŠ” submissions êµ¬í˜„ì´ ì—¬ëŸ¬ ë²„ì „ì´ ì„ì—¬ìˆì„ ìˆ˜ ìˆì–´,
 *   "ì»´íŒŒì¼ ì•ˆì • + ìµœì†Œ UX" ê¸°ì¤€ìœ¼ë¡œ í™”ë©´ ê³¨ê²©ë§Œ ì œê³µí•œë‹¤.
 *
 * ì—¬ê¸°ì„œëŠ”:
 * - ì œì¶œì€ /features/submissions ë¡œ ì´ì‹/ì—°ê²°í•˜ê¸° ì‰¬ìš´ í˜•íƒœë¡œë§Œ ë‘”ë‹¤.
 * - í”„ë¡ íŠ¸ì—ì„œ ìƒíƒœ íŒë‹¨/ê³„ì‚° âŒ
 * - ì œì¶œ ì™„ë£Œ í›„: Result refetch/ì´ë™ âœ…
 */

import { Link, useNavigate, useParams } from "react-router-dom";
import StudentPageShell from "../../../shared/ui/pages/StudentPageShell";
import EmptyState from "../../../shared/ui/layout/EmptyState";

export default function ExamSubmitPage() {
  const { examId } = useParams();
  const safeId = Number(examId);
  const nav = useNavigate();

  if (!Number.isFinite(safeId)) {
    return (
      <StudentPageShell title="ì œì¶œ" description="ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.">
        <EmptyState title="ì‹œí—˜ IDê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  return (
    <StudentPageShell
      title="ì‹œí—˜ ì œì¶œ"
      description="OMR/ë‹µì•ˆ ì œì¶œì€ submissions featureë¡œ ì—°ê²°ë©ë‹ˆë‹¤."
      actions={
        <Link to={`/student/exams/${safeId}`} style={linkBtn}>
          ë’¤ë¡œ
        </Link>
      }
    >
      <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
        <div style={card}>
          <div style={{ fontWeight: 900 }}>ì œì¶œ UX (MVP)</div>
          <div style={{ marginTop: 8, fontSize: 13, color: "#666" }}>
            âœ… ì´ í™”ë©´ì€ â€œì œì¶œå…¥å£â€ë§Œ ë‹´ë‹¹í•©ë‹ˆë‹¤. ì‹¤ì œ ì—…ë¡œë“œ/í´ë§ì€
            <code>features/submissions</code>ë¥¼ ì¬ì‚¬ìš©í•´ì„œ ë¶™ì´ì„¸ìš”.
          </div>

          <div style={{ marginTop: 12, fontSize: 13, color: "#666" }}>
            - ì—…ë¡œë“œ ì„±ê³µ â†’ í´ë§ DONE â†’ ê²°ê³¼ í˜ì´ì§€ ì´ë™
            <br />- FAILED â†’ ì¬ì—…ë¡œë“œ ìœ ë„
          </div>

          <div style={{ marginTop: 12 }}>
            <button
              type="button"
              style={btnStyle}
              onClick={() => {
                // âœ… ì‹¤ì œ êµ¬í˜„ì€ submissionsë¡œ ë¶™ì´ë©´ ë¨
                // ì§€ê¸ˆì€ ë„¤ë¹„ UXë§Œ
                nav(`/student/exams/${safeId}/result`);
              }}
            >
              (ì„ì‹œ) ì œì¶œ ì™„ë£Œ ì²˜ë¦¬
            </button>
          </div>
        </div>

        <div style={{ fontSize: 12, color: "#777" }}>
          â€» ì—¬ê¸°ì„œ ì •ì±…/ì±„ì /ê²°ê³¼ íŒë‹¨ì„ í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤. ë°±ì—”ë“œê°€ ë‹¨ì¼ ì§„ì‹¤ì…ë‹ˆë‹¤.
        </div>
      </div>
    </StudentPageShell>
  );
}

const card: React.CSSProperties = {
  border: "1px solid #eee",
  borderRadius: 12,
  padding: 14,
  background: "#fff",
};

const linkBtn: React.CSSProperties = {
  display: "inline-block",
  padding: "10px 12px",
  borderRadius: 10,
  border: "1px solid #ddd",
  textDecoration: "none",
  background: "#fafafa",
  color: "#111",
  fontWeight: 800,
};

const btnStyle: React.CSSProperties = {
  padding: "10px 12px",
  borderRadius: 10,
  border: "1px solid #ddd",
  background: "#111",
  color: "#fff",
  fontWeight: 800,
};


==========================================================================================
# FILE: grades/api/grades.ts
==========================================================================================



==========================================================================================
# FILE: grades/components/GradeBadge.tsx
==========================================================================================



==========================================================================================
# FILE: grades/components/GradeRow.tsx
==========================================================================================



==========================================================================================
# FILE: grades/pages/GradeDetailPage.tsx
==========================================================================================



==========================================================================================
# FILE: grades/pages/GradeListPage.tsx
==========================================================================================



==========================================================================================
# FILE: grades/pages/GradesPage.tsx
==========================================================================================
/**
 * ì„±ì  â€” ì‹œí—˜Â·ê³¼ì œ ê²°ê³¼ í—ˆë¸Œ (ëŒ€í˜•í•™ì› SaaS)
 */
import { Link } from "react-router-dom";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import { IconGrade, IconExam, IconChevronRight } from "@/student/shared/ui/icons/Icons";

export default function GradesPage() {
  return (
    <div style={{ padding: "var(--stu-space-2) 0" }}>
      <Link
        to="/student/exams"
        className="stu-card stu-card--pressable"
        style={{
          display: "flex",
          alignItems: "center",
          gap: "var(--stu-space-4)",
          marginBottom: "var(--stu-space-4)",
          textDecoration: "none",
          color: "inherit",
        }}
      >
        <div style={{ width: 44, height: 44, borderRadius: 12, background: "var(--stu-surface-soft)", display: "grid", placeItems: "center" }}>
          <IconExam style={{ width: 24, height: 24, color: "var(--stu-primary)" }} />
        </div>
        <div style={{ flex: 1, minWidth: 0 }}>
          <div style={{ fontWeight: 800, fontSize: 15 }}>ì‹œí—˜ ê²°ê³¼</div>
          <div className="stu-muted" style={{ fontSize: 13, marginTop: 2 }}>ì‘ì‹œí•œ ì‹œí—˜ì˜ ì±„ì  ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”</div>
        </div>
        <IconChevronRight style={{ width: 20, height: 20, color: "var(--stu-text-muted)" }} />
      </Link>

      <div className="stu-section stu-section--nested">
        <EmptyState
          title="ì„±ì  ìš”ì•½"
          description="ì‹œí—˜ ê²°ê³¼ëŠ” ìœ„ 'ì‹œí—˜ ê²°ê³¼'ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³¼ì œÂ·ì¶œê²° ì¢…í•© ì„±ì ì€ ì¶”í›„ ì œê³µë©ë‹ˆë‹¤."
        />
      </div>
    </div>
  );
}


==========================================================================================
# FILE: more/pages/MorePage.tsx
==========================================================================================
/**
 * ë”ë³´ê¸° â€” ì¹´í…Œê³ ë¦¬ë³„ ë©”ë‰´ ë‹¨ì¼ ëª©ë¡ + ë¡œê·¸ì•„ì›ƒ
 */
import { Link } from "react-router-dom";
import { logout } from "@/features/auth/api/auth";
import {
  IconUser,
  IconBoard,
  IconClipboard,
  IconCheck,
  IconExam,
  IconGrade,
  IconLogout,
  IconClinic,
} from "@/student/shared/ui/icons/Icons";
import type { ReactNode } from "react";

const linkStyle: React.CSSProperties = {
  display: "flex",
  alignItems: "center",
  gap: "var(--stu-space-4)",
  padding: "var(--stu-space-4) var(--stu-space-4)",
  borderRadius: "var(--stu-radius-md)",
  background: "var(--stu-surface)",
  border: "1px solid var(--stu-border)",
  color: "var(--stu-text)",
  textDecoration: "none",
  fontWeight: 700,
  fontSize: 15,
  marginBottom: "var(--stu-space-2)",
};

/** ë¼ìš°í„° ê¸°ì¤€ ì „ì²´ ë©”ë‰´ ëŒ€ì¥ â€” ì¹´í…Œê³ ë¦¬ë³„ ë„¤ë¹„ê²Œì´ì…˜ (í™ˆÂ·ì˜ìƒÂ·ì¼ì •Â·ì•Œë¦¼Â·ê³µì§€ ì œì™¸) */
const FULL_NAV: { category: string; items: { label: string; to: string; icon: ReactNode }[] }[] = [
  {
    category: "í•™ìŠµ",
    items: [
      { label: "ì‹œí—˜", to: "/student/exams", icon: <IconExam style={{ width: 22, height: 22, flexShrink: 0 }} /> },
      { label: "ì œì¶œ", to: "/student/submit", icon: <IconClipboard style={{ width: 22, height: 22, flexShrink: 0 }} /> },
      { label: "ì„±ì ", to: "/student/grades", icon: <IconGrade style={{ width: 22, height: 22, flexShrink: 0 }} /> },
    ],
  },
  {
    category: "ì†Œí†µ",
    items: [{ label: "QnA", to: "/student/qna", icon: <IconBoard style={{ width: 22, height: 22, flexShrink: 0 }} /> }],
  },
  {
    category: "í´ë¦¬ë‹‰",
    items: [
      { label: "í´ë¦¬ë‹‰", to: "/student/clinic", icon: <IconClinic style={{ width: 22, height: 22, flexShrink: 0 }} /> },
      { label: "í´ë¦¬ë‹‰ ì¸ì¦ íŒ¨ìŠ¤", to: "/student/idcard", icon: <IconCheck style={{ width: 22, height: 22, flexShrink: 0 }} /> },
    ],
  },
  {
    category: "ê¸°íƒ€",
    items: [
      { label: "ì¶œê²° í˜„í™©", to: "/student/attendance", icon: <IconClipboard style={{ width: 22, height: 22, flexShrink: 0 }} /> },
      { label: "í”„ë¡œí•„", to: "/student/profile", icon: <IconUser style={{ width: 22, height: 22, flexShrink: 0 }} /> },
    ],
  },
];

function Section({
  title,
  children,
}: {
  title: string;
  children: React.ReactNode;
}) {
  return (
    <section style={{ marginBottom: "var(--stu-space-8)" }}>
      <h2 className="stu-muted" style={{ fontSize: 12, fontWeight: 800, marginBottom: "var(--stu-space-3)", paddingLeft: 4 }}>
        {title}
      </h2>
      {children}
    </section>
  );
}

export default function MorePage() {
  return (
    <div style={{ padding: "var(--stu-space-2) 0" }}>
      {/* ì „ì²´ ë©”ë‰´ ëŒ€ì¥ â€” ì¹´í…Œê³ ë¦¬ë³„ ëª¨ë“  ë¼ìš°íŠ¸ */}
      <Section title="ì „ì²´ ë©”ë‰´">
        {FULL_NAV.map((group) => (
          <div key={group.category} style={{ marginBottom: "var(--stu-space-6)" }}>
            <h3 className="stu-muted" style={{ fontSize: 11, fontWeight: 700, marginBottom: "var(--stu-space-2)", paddingLeft: 4 }}>
              {group.category}
            </h3>
            {group.items.map((item) => (
              <Link key={item.to} to={item.to} style={linkStyle}>
                {item.icon}
                {item.label}
              </Link>
            ))}
          </div>
        ))}
      </Section>

      {/* ë¡œê·¸ì•„ì›ƒ */}
      <section>
        <button
          type="button"
          className="stu-btn stu-btn--danger"
          style={{
            width: "100%",
            marginBottom: 0,
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            gap: "var(--stu-space-4)",
            padding: "var(--stu-space-4)",
            fontSize: 15,
            fontWeight: 700,
          }}
          onClick={() => logout()}
        >
          <IconLogout style={{ width: 22, height: 22 }} />
          ë¡œê·¸ì•„ì›ƒ
        </button>
      </section>
    </div>
  );
}


==========================================================================================
# FILE: notices/api/notices.ts
==========================================================================================
// PATH: src/student/domains/notices/api/notices.ts
// í•™ìƒ ì•± ê³µì§€ API

import { fetchPosts, fetchPost, type PostEntity } from "@/features/community/api/community.api";

/**
 * í•™ìƒì´ ë³¼ ìˆ˜ ìˆëŠ” ëª¨ë“  ê³µì§€ ëª©ë¡ ì¡°íšŒ
 * block_type_labelì— "ê³µì§€" ë˜ëŠ” "notice"ê°€ í¬í•¨ëœ ê²Œì‹œë¬¼ë§Œ í•„í„°ë§
 */
export async function fetchNotices(): Promise<PostEntity[]> {
  try {
    // ì „ì²´ ê²Œì‹œë¬¼ ì¡°íšŒ (í•™ìƒ ì•±ì—ì„œëŠ” tenant ì „ì²´ ê³µì§€)
    // nodeIdë¥¼ nullë¡œ ì „ë‹¬í•˜ë©´ ì „ì²´ ê³µì§€ ì¡°íšŒ
    const allPosts = await fetchPosts({ nodeId: null });
    
    // block_type_labelì— "ê³µì§€" ë˜ëŠ” "notice"ê°€ í¬í•¨ëœ ê²ƒë§Œ í•„í„°ë§
    const notices = allPosts.filter((post) => {
      const label = (post.block_type_label || "").toLowerCase();
      return label.includes("notice") || label.includes("ê³µì§€");
    });
    
    // ìµœì‹ ìˆœ ì •ë ¬
    return notices.sort((a, b) => {
      const dateA = new Date(a.created_at).getTime();
      const dateB = new Date(b.created_at).getTime();
      return dateB - dateA;
    });
  } catch (error) {
    console.error("ê³µì§€ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:", error);
    return [];
  }
}

/**
 * ê³µì§€ ìƒì„¸ ì¡°íšŒ
 */
export async function fetchNoticeDetail(id: number): Promise<PostEntity | null> {
  try {
    return await fetchPost(id);
  } catch (error) {
    console.error("ê³µì§€ ìƒì„¸ ì¡°íšŒ ì‹¤íŒ¨:", error);
    return null;
  }
}


==========================================================================================
# FILE: notices/pages/NoticeDetailPage.tsx
==========================================================================================
/**
 * ê³µì§€ ìƒì„¸ í˜ì´ì§€
 */
import { useParams, Link } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";
import StudentPageShell from "@/student/shared/ui/pages/StudentPageShell";
import { fetchNoticeDetail } from "../api/notices";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import { formatYmd } from "@/student/shared/utils/date";

export default function NoticeDetailPage() {
  const { id } = useParams<{ id: string }>();
  const noticeId = id ? Number(id) : null;

  const { data: notice, isLoading, isError } = useQuery({
    queryKey: ["student-notice", noticeId],
    queryFn: () => (noticeId != null ? fetchNoticeDetail(noticeId) : Promise.resolve(null)),
    enabled: noticeId != null,
  });

  if (isLoading) {
    return (
      <StudentPageShell title="ê³µì§€ì‚¬í•­">
        <div className="stu-muted">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </StudentPageShell>
    );
  }

  if (isError || !notice || noticeId == null) {
    return (
      <StudentPageShell title="ê³µì§€ì‚¬í•­">
        <EmptyState
          title="ê³µì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤."
          description="ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
        />
      </StudentPageShell>
    );
  }

  const firstNode = notice.mappings?.[0]?.node_detail;
  const lectureTitle = firstNode?.lecture_title;

  return (
    <StudentPageShell title="ê³µì§€ì‚¬í•­">
      <div className="stu-section stu-section--nested">
        <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-4)" }}>
          {/* ì œëª© */}
          <div>
            <h1 style={{ fontWeight: 700, fontSize: 20, marginBottom: "var(--stu-space-3)" }}>
              {notice.title}
            </h1>
            <div style={{ display: "flex", gap: "var(--stu-space-2)", alignItems: "center", flexWrap: "wrap" }}>
              {lectureTitle && (
                <span
                  className="stu-muted"
                  style={{
                    fontSize: 12,
                    padding: "4px 10px",
                    borderRadius: 6,
                    background: "var(--stu-surface-soft)",
                  }}
                >
                  {lectureTitle}
                </span>
              )}
              {notice.block_type_label && (
                <span
                  className="stu-muted"
                  style={{
                    fontSize: 12,
                    padding: "4px 10px",
                    borderRadius: 6,
                    background: "var(--stu-surface-soft)",
                  }}
                >
                  {notice.block_type_label}
                </span>
              )}
              <span className="stu-muted" style={{ fontSize: 13 }}>
                {formatYmd(notice.created_at)}
              </span>
            </div>
          </div>

          {/* ë‚´ìš© */}
          <div
            style={{
              fontSize: 15,
              lineHeight: 1.6,
              color: "var(--stu-text)",
              whiteSpace: "pre-wrap",
              wordBreak: "break-word",
            }}
          >
            {notice.content || "ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤."}
          </div>

          {/* ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸° */}
          <div style={{ marginTop: "var(--stu-space-4)", paddingTop: "var(--stu-space-4)", borderTop: "1px solid var(--stu-border)" }}>
            <Link
              to="/student/notices"
              className="stu-btn stu-btn--secondary stu-btn--sm"
              style={{ display: "inline-block" }}
            >
              ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </Link>
          </div>
        </div>
      </div>
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: notices/pages/NoticesPage.tsx
==========================================================================================
/**
 * ê³µì§€ ëª©ë¡ í˜ì´ì§€ â€” í•™ìƒì´ ë³¼ ìˆ˜ ìˆëŠ” ëª¨ë“  ê³µì§€
 */
import { Link } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";
import StudentPageShell from "@/student/shared/ui/pages/StudentPageShell";
import { fetchNotices } from "../api/notices";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import { formatYmd } from "@/student/shared/utils/date";

export default function NoticesPage() {
  const { data: notices, isLoading, isError } = useQuery({
    queryKey: ["student-notices"],
    queryFn: fetchNotices,
  });

  if (isLoading) {
    return (
      <StudentPageShell title="ê³µì§€ì‚¬í•­">
        <div className="stu-muted">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </StudentPageShell>
    );
  }

  if (isError || !notices) {
    return (
      <StudentPageShell title="ê³µì§€ì‚¬í•­">
        <EmptyState
          title="ê³µì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤."
          description="ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
        />
      </StudentPageShell>
    );
  }

  if (notices.length === 0) {
    return (
      <StudentPageShell title="ê³µì§€ì‚¬í•­">
        <EmptyState
          title="ë“±ë¡ëœ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤."
          description="ìƒˆë¡œìš´ ê³µì§€ê°€ ë“±ë¡ë˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."
        />
      </StudentPageShell>
    );
  }

  return (
    <StudentPageShell title="ê³µì§€ì‚¬í•­">
      <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-3)" }}>
        {notices.map((notice) => {
          const firstNode = notice.mappings?.[0]?.node_detail;
          const lectureTitle = firstNode?.lecture_title;
          
          return (
            <Link
              key={notice.id}
              to={`/student/notices/${notice.id}`}
              className="stu-panel stu-panel--pressable stu-panel--accent"
              style={{
                display: "flex",
                flexDirection: "column",
                gap: "var(--stu-space-2)",
                textDecoration: "none",
                color: "inherit",
              }}
            >
              <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", gap: "var(--stu-space-3)" }}>
                <div style={{ flex: 1, minWidth: 0 }}>
                  <div style={{ fontWeight: 700, fontSize: 15, marginBottom: 4 }}>
                    {notice.title}
                  </div>
                  {notice.content && (
                    <div
                      className="stu-muted"
                      style={{
                        fontSize: 13,
                        lineHeight: 1.4,
                        display: "-webkit-box",
                        WebkitLineClamp: 2,
                        WebkitBoxOrient: "vertical",
                        overflow: "hidden",
                        marginTop: 4,
                      }}
                    >
                      {notice.content}
                    </div>
                  )}
                </div>
              </div>
              <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginTop: "var(--stu-space-1)" }}>
                <div style={{ display: "flex", gap: "var(--stu-space-2)", alignItems: "center" }}>
                  {lectureTitle && (
                    <span
                      className="stu-muted"
                      style={{
                        fontSize: 12,
                        padding: "2px 8px",
                        borderRadius: 4,
                        background: "var(--stu-surface-soft)",
                      }}
                    >
                      {lectureTitle}
                    </span>
                  )}
                  {notice.block_type_label && (
                    <span
                      className="stu-muted"
                      style={{
                        fontSize: 12,
                        padding: "2px 8px",
                        borderRadius: 4,
                        background: "var(--stu-surface-soft)",
                      }}
                    >
                      {notice.block_type_label}
                    </span>
                  )}
                </div>
                <span className="stu-muted" style={{ fontSize: 12 }}>
                  {formatYmd(notice.created_at)}
                </span>
              </div>
            </Link>
          );
        })}
      </div>
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: notifications/api/notifications.api.ts
==========================================================================================
/**
 * í•™ìƒ ì•± ì•Œë¦¼ API
 * í´ë¦¬ë‹‰ ì˜ˆì•½ ìŠ¹ì¸, QnA ë‹µë³€, ìƒˆ ì˜ìƒ, ìƒˆ ì„±ì  ë“±ì˜ ì•Œë¦¼ ì¹´ìš´íŠ¸ ì¡°íšŒ
 * ì‹¤ë°ì´í„° ê¸°ë°˜: ë‚´ í´ë¦¬ë‹‰ ì˜ˆì•½, ë‚´ QnA ì§ˆë¬¸ì— ë‹¬ë¦° ë‹µë³€ë§Œ ì§‘ê³„
 */
import { fetchMyClinicBookingRequests } from "@/student/domains/clinic/api/clinicBooking.api";
import { fetchMyQnaQuestions } from "@/student/domains/qna/api/qna.api";

export type NotificationCounts = {
  clinic: number; // í´ë¦¬ë‹‰ ì˜ˆì•½ ìŠ¹ì¸/ê±°ë¶€ ì•Œë¦¼
  qna: number; // QnA ë‹µë³€ ì•Œë¦¼
  video: number; // ìƒˆ ì˜ìƒ ì•Œë¦¼
  grade: number; // ìƒˆ ì„±ì  ì•Œë¦¼
  total: number; // ì „ì²´ ì•Œë¦¼ ìˆ˜
};

/**
 * ì•Œë¦¼ ì¹´ìš´íŠ¸ ì¡°íšŒ
 * ê° ë„ë©”ì¸ë³„ë¡œ ì½ì§€ ì•Šì€ ì•Œë¦¼ ìˆ˜ë¥¼ ì§‘ê³„
 * 
 * ìµœì í™”:
 * - ë³‘ë ¬ API í˜¸ì¶œë¡œ ì„±ëŠ¥ ê°œì„ 
 * - ì—ëŸ¬ ë°œìƒ ì‹œ í•´ë‹¹ ë„ë©”ì¸ë§Œ 0ìœ¼ë¡œ ì²˜ë¦¬
 * - í•™ìƒ í”„ë¡œí•„ì„ ë¨¼ì € ì¡°íšŒí•˜ì—¬ QnA í•„í„°ë§ì— ì‚¬ìš©
 */
export async function fetchNotificationCounts(): Promise<NotificationCounts> {
  const now = Date.now();
  const sevenDaysAgo = now - 7 * 24 * 60 * 60 * 1000;

  try {
    const [clinicBookings, myQnaQuestions] = await Promise.allSettled([
      fetchMyClinicBookingRequests(),
      fetchMyQnaQuestions(), // ë‚´ ì§ˆë¬¸ë§Œ ë°˜í™˜ (ì‹¤ë°ì´í„°)
    ]);

    // í´ë¦¬ë‹‰: ìŠ¹ì¸ëœ ì˜ˆì•½ ì¤‘ ìµœê·¼ 7ì¼ ì´ë‚´ ìƒíƒœ ë³€ê²½ëœ ê²ƒ
    let clinicCount = 0;
    if (clinicBookings.status === "fulfilled") {
      clinicCount = clinicBookings.value.filter((b) => {
        if (b.status !== "booked" && b.status !== "approved") return false;
        const changeDate = b.status_changed_at
          ? new Date(b.status_changed_at).getTime()
          : b.updated_at
            ? new Date(b.updated_at).getTime()
            : new Date(b.created_at).getTime();
        return changeDate > sevenDaysAgo;
      }).length;
    }

    // QnA: ë‚´ ì§ˆë¬¸ì— ë‹µë³€ì´ ë‹¬ë¦° ê²ƒ ì¤‘ ìµœê·¼ 7ì¼ ì´ë‚´
    let qnaCount = 0;
    if (myQnaQuestions.status === "fulfilled") {
      qnaCount = myQnaQuestions.value.filter((p) => {
        if ((p.replies_count || 0) === 0) return false;
        const updatedTime = p.updated_at ? new Date(p.updated_at).getTime() : new Date(p.created_at).getTime();
        return updatedTime > sevenDaysAgo;
      }).length;
    }

    // ì˜ìƒ: ìƒˆ ì˜ìƒ ì•Œë¦¼ (ë°±ì—”ë“œ API í™•ì¥ í•„ìš”, í˜„ì¬ëŠ” 0)
    const videoCount = 0;

    // ì„±ì : ìƒˆ ì„±ì  ì•Œë¦¼ (ë°±ì—”ë“œ API í™•ì¥ í•„ìš”, í˜„ì¬ëŠ” 0)
    const gradeCount = 0;

    const total = clinicCount + qnaCount + videoCount + gradeCount;

    return {
      clinic: clinicCount,
      qna: qnaCount,
      video: videoCount,
      grade: gradeCount,
      total,
    };
  } catch (error) {
    console.error("ì•Œë¦¼ ì¹´ìš´íŠ¸ ì¡°íšŒ ì‹¤íŒ¨:", error);
    // ì—ëŸ¬ ë°œìƒ ì‹œ ì•ˆì „í•œ ê¸°ë³¸ê°’ ë°˜í™˜
    return {
      clinic: 0,
      qna: 0,
      video: 0,
      grade: 0,
      total: 0,
    };
  }
}


==========================================================================================
# FILE: notifications/hooks/useNotificationCounts.ts
==========================================================================================
/**
 * ì•Œë¦¼ ì¹´ìš´íŠ¸ í›…
 * ì£¼ê¸°ì ìœ¼ë¡œ ì•Œë¦¼ ìˆ˜ë¥¼ ê°±ì‹  (30ì´ˆë§ˆë‹¤)
 * 
 * ìµœì í™”:
 * - refetchOnWindowFocus: falseë¡œ ë¶ˆí•„ìš”í•œ ì¬ìš”ì²­ ë°©ì§€
 * - retry: 1ë¡œ ì‹¤íŒ¨ ì‹œ 1íšŒë§Œ ì¬ì‹œë„
 * - staleTimeê³¼ refetchInterval ì¡°ì •ìœ¼ë¡œ ì ì ˆí•œ ê°±ì‹  ì£¼ê¸° ìœ ì§€
 */
import { useQuery } from "@tanstack/react-query";
import { fetchNotificationCounts } from "../api/notifications.api";

export function useNotificationCounts() {
  return useQuery({
    queryKey: ["student", "notifications", "counts"],
    queryFn: fetchNotificationCounts,
    refetchInterval: 30000, // 30ì´ˆë§ˆë‹¤ ê°±ì‹ 
    refetchOnWindowFocus: false, // ì°½ í¬ì»¤ìŠ¤ ì‹œ ìë™ ê°±ì‹  ë¹„í™œì„±í™” (ë°°í„°ë¦¬ ì ˆì•½)
    staleTime: 10000, // 10ì´ˆê°„ ìºì‹œ ìœ ì§€
    retry: 1, // ì‹¤íŒ¨ ì‹œ 1íšŒë§Œ ì¬ì‹œë„
    retryDelay: 2000, // ì¬ì‹œë„ ì „ 2ì´ˆ ëŒ€ê¸°
  });
}


==========================================================================================
# FILE: notifications/pages/NotificationsPage.tsx
==========================================================================================
/**
 * ì•Œë¦¼ í˜ì´ì§€ â€” í´ë¦¬ë‹‰ ì˜ˆì•½ ìŠ¹ì¸, QnA ë‹µë³€, ìƒˆ ì˜ìƒ, ìƒˆ ì„±ì  ë“±
 * 
 * ìµœì í™”:
 * - ì•Œë¦¼ ì¹´ìš´íŠ¸ì™€ ì‹¤ì œ ë°ì´í„°ë¥¼ ë™ì¼í•œ ì¿¼ë¦¬ í‚¤ë¡œ ê³µìœ í•˜ì—¬ ì¤‘ë³µ í˜¸ì¶œ ë°©ì§€
 * - ë¡œë”© ìƒíƒœ ë° ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 
 */
import { Link } from "react-router-dom";
import StudentPageShell from "@/student/shared/ui/pages/StudentPageShell";
import { useNotificationCounts } from "../hooks/useNotificationCounts";
import { fetchMyClinicBookingRequests } from "@/student/domains/clinic/api/clinicBooking.api";
import { fetchMyQnaQuestions } from "@/student/domains/qna/api/qna.api";
import { useQuery } from "@tanstack/react-query";
import { IconClinic, IconNotice } from "@/student/shared/ui/icons/Icons";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import { formatYmd } from "@/student/shared/utils/date";

const SEVEN_DAYS_MS = 7 * 24 * 60 * 60 * 1000;

export default function NotificationsPage() {
  const { data: counts, isLoading: countsLoading } = useNotificationCounts();

  const { data: clinicBookings, isLoading: clinicLoading } = useQuery({
    queryKey: ["student", "clinic", "bookings"],
    queryFn: fetchMyClinicBookingRequests,
    staleTime: 30000,
  });

  const { data: myQnaQuestions = [], isLoading: qnaLoading } = useQuery({
    queryKey: ["student", "qna", "questions"],
    queryFn: fetchMyQnaQuestions,
    staleTime: 30000,
  });

  const isLoading = countsLoading || clinicLoading || qnaLoading;
  const sevenDaysAgo = Date.now() - SEVEN_DAYS_MS;

  const approvedClinicBookings = (clinicBookings || []).filter((b) => {
    if (b.status !== "booked" && b.status !== "approved") return false;
    const changeDate = b.status_changed_at
      ? new Date(b.status_changed_at).getTime()
      : b.updated_at
        ? new Date(b.updated_at).getTime()
        : new Date(b.created_at).getTime();
    return changeDate > sevenDaysAgo;
  });

  const answeredQnaPosts = myQnaQuestions.filter((p) => {
    if ((p.replies_count || 0) === 0) return false;
    const updatedTime = p.updated_at ? new Date(p.updated_at).getTime() : new Date(p.created_at).getTime();
    return updatedTime > sevenDaysAgo;
  });

  const hasNotifications = (counts?.total || 0) > 0;

  if (isLoading) {
    return (
      <StudentPageShell title="ì•Œë¦¼">
        <div style={{ padding: "var(--stu-space-4) 0" }}>
          <div className="stu-skel" style={{ height: 60, borderRadius: "var(--stu-radius-md)", marginBottom: 12 }} />
          <div className="stu-skel" style={{ height: 60, borderRadius: "var(--stu-radius-md)" }} />
        </div>
      </StudentPageShell>
    );
  }

  return (
    <StudentPageShell title="ì•Œë¦¼">
      {!hasNotifications ? (
        <EmptyState
          title="ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤"
          description="ìƒˆë¡œìš´ ì•Œë¦¼ì´ ì˜¤ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."
        />
      ) : (
        <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-4)" }}>
          {/* í´ë¦¬ë‹‰ ì˜ˆì•½ ìŠ¹ì¸ */}
          {approvedClinicBookings.length > 0 && (
            <section>
              <div style={{ display: "flex", alignItems: "center", gap: "var(--stu-space-2)", marginBottom: "var(--stu-space-3)" }}>
                <IconClinic style={{ width: 18, height: 18, color: "var(--stu-primary)" }} />
                <h3 style={{ fontSize: 15, fontWeight: 700 }}>í´ë¦¬ë‹‰ ì˜ˆì•½</h3>
                <span style={{ fontSize: 12, color: "var(--stu-text-muted)" }}>({approvedClinicBookings.length})</span>
              </div>
              <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-2)" }}>
                {approvedClinicBookings.map((booking) => (
                  <Link
                    key={booking.id}
                    to="/student/clinic"
                    className="stu-panel stu-panel--pressable"
                    style={{ textDecoration: "none", color: "inherit" }}
                  >
                    <div style={{ fontWeight: 600, fontSize: 14, marginBottom: 4 }}>
                      í´ë¦¬ë‹‰ ì˜ˆì•½ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤
                    </div>
                    <div className="stu-muted" style={{ fontSize: 12 }}>
                      {formatYmd(booking.session_date)} {booking.session_start_time?.slice(0, 5)} @ {booking.session_location}
                    </div>
                  </Link>
                ))}
              </div>
            </section>
          )}

          {/* QnA ë‹µë³€ */}
          {answeredQnaPosts.length > 0 && (
            <section>
              <div style={{ display: "flex", alignItems: "center", gap: "var(--stu-space-2)", marginBottom: "var(--stu-space-3)" }}>
                <IconNotice style={{ width: 18, height: 18, color: "var(--stu-primary)" }} />
                <h3 style={{ fontSize: 15, fontWeight: 700 }}>ì§ˆë¬¸ ë‹µë³€</h3>
                <span style={{ fontSize: 12, color: "var(--stu-text-muted)" }}>({answeredQnaPosts.length})</span>
              </div>
              <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-2)" }}>
                {answeredQnaPosts.map((post) => (
                  <Link
                    key={post.id}
                    to="/student/qna"
                    state={{ openQuestionId: post.id }}
                    className="stu-panel stu-panel--pressable"
                    style={{ textDecoration: "none", color: "inherit" }}
                  >
                    <div style={{ fontWeight: 600, fontSize: 14, marginBottom: 4 }}>{post.title}</div>
                    <div className="stu-muted" style={{ fontSize: 12 }}>
                      ë‹µë³€ì´ ë‹¬ë ¸ìŠµë‹ˆë‹¤ Â· {post.replies_count ?? 0}ê°œ
                    </div>
                  </Link>
                ))}
              </div>
            </section>
          )}
        </div>
      )}
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: profile/api/profile.ts
==========================================================================================
// PATH: src/student/domains/profile/api/profile.ts
import api from "@/student/shared/api/studentApi";

export type MyProfile = {
  id: number;
  name: string;
  profile_photo_url: string | null;
  /** í•™ìƒ ë²ˆí˜¸(PS ë²ˆí˜¸) â€” í•™ì› í•™ìƒ ID. ì´ë¦„Â·ë¡œê·¸ì¸ ì•„ì´ë””ì™€ ë‹¤ë¦„. */
  ps_number?: string;
  /** ë¡œê·¸ì¸ ì•„ì´ë””(í‘œì‹œìš©). ì´ë¦„Â·PSë²ˆí˜¸ì™€ ë‹¤ë¦„. */
  username?: string;
  /** ë¶€ëª¨ ì „í™”ë²ˆí˜¸(í•„ìˆ˜ í‘œì‹œìš©). */
  parent_phone?: string;
};

export async function fetchMyProfile(): Promise<MyProfile> {
  const res = await api.get<MyProfile>("/student/me/");
  return res.data;
}

export async function updateMyProfilePhoto(file: File): Promise<MyProfile> {
  const form = new FormData();
  form.append("profile_photo", file);
  const res = await api.patch<MyProfile>("/student/me/", form);
  return res.data;
}

/** ì´ë¦„Â·ì•„ì´ë””Â·ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ (JSON PATCH) */
export async function updateMyProfile(data: {
  name?: string;
  username?: string;
  current_password?: string;
  new_password?: string;
}): Promise<MyProfile> {
  const res = await api.patch<MyProfile>("/student/me/", data);
  return res.data;
}


==========================================================================================
# FILE: profile/pages/ProfilePage.tsx
==========================================================================================
/**
 * í”„ë¡œí•„ â€” students ë„ë©”ì¸ ê¸°ì¤€ ì •ë³´ í‘œì‹œ
 * ì´ë¦„ / í•™ìƒ ë²ˆí˜¸(PS) / ë¶€ëª¨ ì „í™”ë²ˆí˜¸ / ë¡œê·¸ì¸ ì•„ì´ë”” êµ¬ë¶„ í‘œì‹œ
 * ìš°ìƒë‹¨ í¸ì§‘ ì•„ì´ì½˜ â†’ ì´ë¦„ ìˆ˜ì • ê°€ëŠ¥
 * ì•„ì´ë””Â·ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì€ ë²„íŠ¼ìœ¼ë¡œ ëˆ„ë¥´ë©´ ì…ë ¥ í•„ë“œ í‘œì‹œ
 */
import { useState } from "react";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import StudentPageShell from "@/student/shared/ui/pages/StudentPageShell";
import { fetchMyProfile, updateMyProfile } from "../api/profile";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import { IconPencil } from "@/student/shared/ui/icons/Icons";

function formatPhone(phone: string | null | undefined): string {
  if (!phone || !phone.trim()) return "-";
  const digits = phone.replace(/\D/g, "");
  if (digits.length === 11 && digits.startsWith("010")) {
    return `${digits.slice(0, 3)}-${digits.slice(3, 7)}-${digits.slice(7)}`;
  }
  if (digits.length === 10) {
    return `${digits.slice(0, 3)}-${digits.slice(3, 6)}-${digits.slice(6)}`;
  }
  return phone;
}

export default function ProfilePage() {
  const qc = useQueryClient();
  const [editing, setEditing] = useState(false);
  const [editName, setEditName] = useState("");
  const [showUsernameForm, setShowUsernameForm] = useState(false);
  const [showPasswordForm, setShowPasswordForm] = useState(false);
  const [username, setUsername] = useState("");
  const [password, setPassword] = useState("");
  const [newPassword, setNewPassword] = useState("");
  const [confirmPassword, setConfirmPassword] = useState("");

  const { data: profile, isLoading, isError } = useQuery({
    queryKey: ["student", "me"],
    queryFn: fetchMyProfile,
  });

  const updateProfileMutation = useMutation({
    mutationFn: (payload: { name?: string; username?: string; current_password?: string; new_password?: string }) =>
      updateMyProfile(payload),
    onSuccess: (_, variables) => {
      qc.invalidateQueries({ queryKey: ["student", "me"] });
      setEditing(false);
      setEditName("");
      if (variables.username !== undefined) {
        setShowUsernameForm(false);
        setUsername("");
      }
      if (variables.new_password !== undefined) {
        setShowPasswordForm(false);
        setPassword("");
        setNewPassword("");
        setConfirmPassword("");
      }
    },
  });

  const startEdit = () => {
    if (profile) {
      setEditName(profile.name || "");
      setEditing(true);
    }
  };

  const saveName = () => {
    const trimmed = editName.trim();
    if (!trimmed) return;
    updateProfileMutation.mutate({ name: trimmed });
  };

  const handleUsernameSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (!username.trim()) return;
    updateProfileMutation.mutate({ username: username.trim() });
  };

  const handlePasswordSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (!password.trim() || !newPassword.trim()) return;
    if (newPassword !== confirmPassword) {
      alert("ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      return;
    }
    updateProfileMutation.mutate({
      current_password: password,
      new_password: newPassword,
    });
  };

  if (isLoading) {
    return (
      <StudentPageShell title="ë‚´ ì •ë³´">
        <div className="stu-muted">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </StudentPageShell>
    );
  }

  if (isError || !profile) {
    return (
      <StudentPageShell title="ë‚´ ì •ë³´">
        <EmptyState
          title="í”„ë¡œí•„ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤."
          description="ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
        />
      </StudentPageShell>
    );
  }

  return (
    <StudentPageShell title="ë‚´ ì •ë³´">
      {/* ê¸°ë³¸ ì •ë³´ ì¹´ë“œ â€” ìš°ìƒë‹¨ í¸ì§‘ ì•„ì´ì½˜, ì´ë¦„/í•™ìƒë²ˆí˜¸/ë¶€ëª¨ë²ˆí˜¸/ë¡œê·¸ì¸ì•„ì´ë”” */}
      <div className="stu-section stu-section--nested" style={{ marginBottom: "var(--stu-space-6)" }}>
        <div style={{ position: "relative", paddingRight: 36 }}>
          <button
            type="button"
            className="stu-btn stu-btn--ghost stu-btn--sm"
            onClick={editing ? () => { setEditing(false); setEditName(""); } : startEdit}
            style={{
              position: "absolute",
              top: 0,
              right: 0,
              padding: "var(--stu-space-2)",
            }}
            title={editing ? "ì·¨ì†Œ" : "í¸ì§‘"}
          >
            <IconPencil style={{ width: 20, height: 20, color: "var(--stu-primary)" }} />
          </button>

          <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-4)" }}>
            <div>
              <div className="stu-muted" style={{ fontSize: 12, marginBottom: 4 }}>ì´ë¦„</div>
              {editing ? (
                <div style={{ display: "flex", gap: "var(--stu-space-2)", alignItems: "center" }}>
                  <input
                    type="text"
                    value={editName}
                    onChange={(e) => setEditName(e.target.value)}
                    className="stu-input"
                    style={{ flex: 1, maxWidth: 200 }}
                    placeholder="ì´ë¦„"
                  />
                  <button
                    type="button"
                    className="stu-btn stu-btn--primary stu-btn--sm"
                    onClick={saveName}
                    disabled={updateProfileMutation.isPending || !editName.trim()}
                  >
                    {updateProfileMutation.isPending ? "ì €ì¥ ì¤‘â€¦" : "ì €ì¥"}
                  </button>
                </div>
              ) : (
                <div style={{ fontWeight: 600, fontSize: 16 }}>{profile.name || "-"}</div>
              )}
            </div>
            <div>
              <div className="stu-muted" style={{ fontSize: 12, marginBottom: 4 }}>í•™ìƒ ë²ˆí˜¸(PS ë²ˆí˜¸)</div>
              <div style={{ fontWeight: 600, fontSize: 16 }}>{profile.ps_number || "-"}</div>
            </div>
            <div>
              <div className="stu-muted" style={{ fontSize: 12, marginBottom: 4 }}>ë¶€ëª¨ ì „í™”ë²ˆí˜¸</div>
              <div style={{ fontWeight: 600, fontSize: 16 }}>{formatPhone(profile.parent_phone)}</div>
            </div>
            <div>
              <div className="stu-muted" style={{ fontSize: 12, marginBottom: 4 }}>ë¡œê·¸ì¸ ì•„ì´ë””</div>
              <div style={{ fontWeight: 600, fontSize: 16 }}>{profile.username || "-"}</div>
            </div>
          </div>
        </div>
      </div>

      {/* ì•„ì´ë”” ë³€ê²½ â€” ë²„íŠ¼ í´ë¦­ ì‹œ ì…ë ¥ í•„ë“œ í‘œì‹œ */}
      <div className="stu-section stu-section--nested" style={{ marginBottom: "var(--stu-space-6)" }}>
        <div style={{ fontWeight: 700, fontSize: 15, marginBottom: "var(--stu-space-4)" }}>ì•„ì´ë”” ë³€ê²½</div>
        {!showUsernameForm ? (
          <button
            type="button"
            className="stu-btn stu-btn--secondary"
            onClick={() => setShowUsernameForm(true)}
          >
            ì•„ì´ë”” ë³€ê²½í•˜ê¸°
          </button>
        ) : (
          <form onSubmit={handleUsernameSubmit} style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-4)" }}>
            <input
              type="text"
              value={username}
              onChange={(e) => setUsername(e.target.value)}
              placeholder="ìƒˆ ì•„ì´ë””"
              className="stu-input"
            />
            <div style={{ display: "flex", gap: "var(--stu-space-2)" }}>
              <button
                type="button"
                className="stu-btn stu-btn--ghost"
                onClick={() => { setShowUsernameForm(false); setUsername(""); }}
              >
                ì·¨ì†Œ
              </button>
              <button
                type="submit"
                className="stu-btn stu-btn--primary"
                disabled={updateProfileMutation.isPending || !username.trim()}
              >
                {updateProfileMutation.isPending ? "ë³€ê²½ ì¤‘â€¦" : "ì•„ì´ë”” ë³€ê²½"}
              </button>
            </div>
            {updateProfileMutation.isError && (
              <div className="stu-muted" style={{ fontSize: 13, color: "var(--stu-danger)" }}>
                {(updateProfileMutation.error as any)?.response?.data?.detail || "ì•„ì´ë”” ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."}
              </div>
            )}
          </form>
        )}
      </div>

      {/* ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ â€” ë²„íŠ¼ í´ë¦­ ì‹œ ì…ë ¥ í•„ë“œ í‘œì‹œ */}
      <div className="stu-section stu-section--nested">
        <div style={{ fontWeight: 700, fontSize: 15, marginBottom: "var(--stu-space-4)" }}>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</div>
        {!showPasswordForm ? (
          <button
            type="button"
            className="stu-btn stu-btn--secondary"
            onClick={() => setShowPasswordForm(true)}
          >
            ë¹„ë°€ë²ˆí˜¸ ë³€ê²½í•˜ê¸°
          </button>
        ) : (
          <form onSubmit={handlePasswordSubmit} style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-4)" }}>
            <input
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸"
              className="stu-input"
            />
            <input
              type="password"
              value={newPassword}
              onChange={(e) => setNewPassword(e.target.value)}
              placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸"
              className="stu-input"
            />
            <input
              type="password"
              value={confirmPassword}
              onChange={(e) => setConfirmPassword(e.target.value)}
              placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸"
              className="stu-input"
            />
            <div style={{ display: "flex", gap: "var(--stu-space-2)" }}>
              <button
                type="button"
                className="stu-btn stu-btn--ghost"
                onClick={() => { setShowPasswordForm(false); setPassword(""); setNewPassword(""); setConfirmPassword(""); }}
              >
                ì·¨ì†Œ
              </button>
              <button
                type="submit"
                className="stu-btn stu-btn--primary"
                disabled={updateProfileMutation.isPending || !password.trim() || !newPassword.trim() || !confirmPassword.trim()}
              >
                {updateProfileMutation.isPending ? "ë³€ê²½ ì¤‘â€¦" : "ë¹„ë°€ë²ˆí˜¸ ë³€ê²½"}
              </button>
            </div>
            {updateProfileMutation.isError && (
              <div className="stu-muted" style={{ fontSize: 13, color: "var(--stu-danger)" }}>
                {(updateProfileMutation.error as any)?.response?.data?.detail || "ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."}
              </div>
            )}
          </form>
        )}
      </div>
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: qna/api/qna.api.ts
==========================================================================================
/**
 * í•™ìƒ QnA API
 * ë¸”ë¡íƒ€ì… code "qna" ê¸°ì¤€ìœ¼ë¡œ ì„ ìƒ ì•±ê³¼ ë™ì¼í•˜ê²Œ ì‹ë³„
 */
import {
  fetchPosts,
  fetchPost,
  getQnaBlockTypeId,
  type PostEntity,
} from "@/features/community/api/community.api";
import { fetchMyProfile } from "@/student/domains/profile/api/profile";

/**
 * í•™ìƒì´ ì‘ì„±í•œ QnA ì§ˆë¬¸ ëª©ë¡ ì¡°íšŒ
 * block_type code "qna" idë¡œ í•„í„° (ì„ ìƒ ì•± ì•Œë¦¼/ëª©ë¡ê³¼ ë™ì¼ ê¸°ì¤€)
 */
export async function fetchMyQnaQuestions(): Promise<PostEntity[]> {
  try {
    const [profile, qnaBlockTypeId, allPosts] = await Promise.all([
      fetchMyProfile(),
      getQnaBlockTypeId(),
      fetchPosts({ nodeId: null }),
    ]);
    const studentId = profile.id;
    const qnaQuestions = allPosts.filter((post) => {
      if (qnaBlockTypeId != null && post.block_type !== qnaBlockTypeId) return false;
      if (qnaBlockTypeId == null) {
        const isQna = (post.block_type_label || "").toLowerCase().includes("qna");
        if (!isQna) return false;
      }
      return Number(post.created_by) === Number(studentId);
    });
    return qnaQuestions.sort((a, b) => {
      const dateA = new Date(a.created_at).getTime();
      const dateB = new Date(b.created_at).getTime();
      return dateB - dateA;
    });
  } catch (error) {
    console.error("QnA ì§ˆë¬¸ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:", error);
    return [];
  }
}

/**
 * QnA ì§ˆë¬¸ ìƒì„¸ ì¡°íšŒ (block_type code "qna" ë˜ëŠ” ë¼ë²¨ fallback)
 */
export async function fetchQnaQuestionDetail(questionId: number): Promise<PostEntity | null> {
  try {
    const [post, qnaBlockTypeId] = await Promise.all([
      fetchPost(questionId),
      getQnaBlockTypeId(),
    ]);
    if (!post) return null;
    const isQnaByType = qnaBlockTypeId != null && post.block_type === qnaBlockTypeId;
    const isQnaByLabel = (post.block_type_label || "").toLowerCase().includes("qna");
    if (!isQnaByType && !isQnaByLabel) return null;
    return post;
  } catch (error) {
    console.error("QnA ì§ˆë¬¸ ìƒì„¸ ì¡°íšŒ ì‹¤íŒ¨:", error);
    return null;
  }
}

/**
 * ì§ˆë¬¸ì— ë‹µë³€ì´ ìˆëŠ”ì§€ í™•ì¸
 */
export function hasAnswer(post: PostEntity): boolean {
  return (post.replies_count || 0) > 0;
}

/**
 * ì§ˆë¬¸ì´ ë‹µë³€ ëŒ€ê¸° ì¤‘ì¸ì§€ í™•ì¸
 */
export function isPendingAnswer(post: PostEntity): boolean {
  return !hasAnswer(post);
}


==========================================================================================
# FILE: qna/pages/QnaPage.tsx
==========================================================================================
/**
 * í•™ìƒ QnA í˜ì´ì§€
 * - ë‚´ê°€ ì‘ì„±í•œ ì§ˆë¬¸ ëª©ë¡ ë³´ê¸°
 * - ì§ˆë¬¸ ìƒì„¸ ë° ë‹µë³€ ë³´ê¸°
 * - ì§ˆë¬¸í•˜ê¸° ê¸°ëŠ¥
 */
import { useState, useRef, useEffect } from "react";
import { useLocation, useNavigate } from "react-router-dom";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import StudentPageShell from "@/student/shared/ui/pages/StudentPageShell";
import { fetchBlockTypes, createPost, fetchPostReplies, type PostEntity, type Answer } from "@/features/community/api/community.api";
import { fetchMyProfile } from "@/student/domains/profile/api/profile";
import { fetchMyQnaQuestions, fetchQnaQuestionDetail, hasAnswer, isPendingAnswer } from "../api/qna.api";
import { formatYmd } from "@/student/shared/utils/date";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import { IconPlus, IconChevronRight } from "@/student/shared/ui/icons/Icons";

const QNA_BLOCK_CODE = "qna";
const MAX_FILES = 5;
const MAX_SIZE_MB = 10;

export default function QnaPage() {
  const location = useLocation();
  const navigate = useNavigate();
  const [showQuestionForm, setShowQuestionForm] = useState(false);
  const [selectedQuestionId, setSelectedQuestionId] = useState<number | null>(null);

  // ì•Œë¦¼ì—ì„œ "ë‹µë³€ ë‹¬ë¦¼" í´ë¦­ ì‹œ í•´ë‹¹ ì§ˆë¬¸ ìƒì„¸ë¡œ ì—´ê¸°
  useEffect(() => {
    const openId = (location.state as { openQuestionId?: number } | null)?.openQuestionId;
    if (openId != null) {
      setSelectedQuestionId(openId);
      navigate(location.pathname, { replace: true, state: {} });
    }
  }, [location.pathname, location.state, navigate]);

  // ë‚´ ì§ˆë¬¸ ëª©ë¡ ì¡°íšŒ
  const { data: questions = [], isLoading: questionsLoading, refetch: refetchQuestions } = useQuery({
    queryKey: ["student", "qna", "questions"],
    queryFn: fetchMyQnaQuestions,
  });

  // ì„ íƒí•œ ì§ˆë¬¸ ìƒì„¸ ì¡°íšŒ
  const { data: questionDetail, isLoading: detailLoading } = useQuery({
    queryKey: ["student", "qna", "question", selectedQuestionId],
    queryFn: () => selectedQuestionId ? fetchQnaQuestionDetail(selectedQuestionId) : null,
    enabled: selectedQuestionId != null,
  });

  // ì„ íƒí•œ ì§ˆë¬¸ì˜ ë‹µë³€ ëª©ë¡ ì¡°íšŒ
  const { data: replies = [], isLoading: repliesLoading } = useQuery<Answer[]>({
    queryKey: ["student", "qna", "replies", selectedQuestionId],
    queryFn: () => selectedQuestionId ? fetchPostReplies(selectedQuestionId) : [],
    enabled: selectedQuestionId != null && questionDetail != null && hasAnswer(questionDetail),
  });

  // ì§ˆë¬¸ ë¶„ë¥˜
  const answeredQuestions = questions.filter((q) => hasAnswer(q));
  const pendingQuestions = questions.filter((q) => isPendingAnswer(q));

  if (showQuestionForm) {
    return (
      <div data-page="qna">
        <QuestionFormPage
          onBack={() => setShowQuestionForm(false)}
          onSuccess={() => {
            setShowQuestionForm(false);
            refetchQuestions();
          }}
        />
      </div>
    );
  }

  if (selectedQuestionId && questionDetail) {
    return (
      <div data-page="qna">
        <QuestionDetailPage
          question={questionDetail}
          onBack={() => setSelectedQuestionId(null)}
        />
      </div>
    );
  }

  return (
    <div data-page="qna">
      <StudentPageShell
        title="QnA"
        description="ë‚´ê°€ ì‘ì„±í•œ ì§ˆë¬¸ê³¼ ë‹µë³€ì„ í™•ì¸í•˜ì„¸ìš”."
      >
      <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-6)" }}>
        {/* ì§ˆë¬¸í•˜ê¸° ë²„íŠ¼ */}
        <button
          type="button"
          className="stu-btn stu-btn--primary"
          onClick={() => setShowQuestionForm(true)}
          style={{
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            gap: "var(--stu-space-2)",
          }}
        >
          <IconPlus style={{ width: 18, height: 18 }} />
          ì§ˆë¬¸í•˜ê¸°
        </button>

        {questionsLoading ? (
          <div className="stu-muted" style={{ textAlign: "center", padding: "var(--stu-space-8)" }}>
            ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
          </div>
        ) : questions.length === 0 ? (
          <EmptyState
            title="ì‘ì„±í•œ ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤"
            description="ì§ˆë¬¸í•˜ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ ì„ ìƒë‹˜ê»˜ ì§ˆë¬¸ì„ ë³´ë‚´ë³´ì„¸ìš”."
          />
        ) : (
          <>
            {/* ë‹µë³€ ëŒ€ê¸° ì§ˆë¬¸ */}
            {pendingQuestions.length > 0 && (
              <div className="stu-section stu-section--nested">
                <div style={{ fontWeight: 700, fontSize: 15, marginBottom: "var(--stu-space-4)" }}>
                  ë‹µë³€ ëŒ€ê¸° ({pendingQuestions.length})
                </div>
                <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-2)" }}>
                  {pendingQuestions.map((question) => (
                    <QuestionItem
                      key={question.id}
                      question={question}
                      onClick={() => setSelectedQuestionId(question.id)}
                    />
                  ))}
                </div>
              </div>
            )}

            {/* ë‹µë³€ ì™„ë£Œ ì§ˆë¬¸ */}
            {answeredQuestions.length > 0 && (
              <div className="stu-section stu-section--nested">
                <div style={{ fontWeight: 700, fontSize: 15, marginBottom: "var(--stu-space-4)" }}>
                  ë‹µë³€ ì™„ë£Œ ({answeredQuestions.length})
                </div>
                <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-2)" }}>
                  {answeredQuestions.map((question) => (
                    <QuestionItem
                      key={question.id}
                      question={question}
                      onClick={() => setSelectedQuestionId(question.id)}
                      isAnswered
                    />
                  ))}
                </div>
              </div>
            )}
          </>
        )}
      </div>
    </StudentPageShell>
    </div>
  );
}

/**
 * ì§ˆë¬¸ ì•„ì´í…œ ì»´í¬ë„ŒíŠ¸
 */
function QuestionItem({
  question,
  onClick,
  isAnswered = false,
}: {
  question: PostEntity;
  onClick: () => void;
  isAnswered?: boolean;
}) {
  return (
    <button
      type="button"
      className="stu-panel stu-panel--pressable"
      onClick={onClick}
      style={{
        textAlign: "left",
        padding: "var(--stu-space-4)",
        display: "flex",
        alignItems: "center",
        justifyContent: "space-between",
        gap: "var(--stu-space-3)",
        background: isAnswered
          ? "var(--stu-success-bg)"
          : undefined,
        border: isAnswered
          ? "1px solid var(--stu-success)"
          : undefined,
      }}
    >
      <div style={{ flex: 1, minWidth: 0 }}>
        <div
          style={{
            fontWeight: 600,
            fontSize: 14,
            marginBottom: 4,
            overflow: "hidden",
            textOverflow: "ellipsis",
            whiteSpace: "nowrap",
          }}
        >
          {question.title}
        </div>
        <div className="stu-muted" style={{ fontSize: 12 }}>
          {formatYmd(question.created_at)}
          {isAnswered && question.replies_count && question.replies_count > 0 && (
            <> Â· ë‹µë³€ {question.replies_count}ê°œ</>
          )}
        </div>
      </div>
      <div
        style={{
          display: "inline-flex",
          alignItems: "center",
          padding: "4px 10px",
          borderRadius: 6,
          fontSize: 12,
          fontWeight: 600,
          background: isAnswered
            ? "var(--stu-success-bg)"
            : "var(--stu-surface-soft)",
          color: isAnswered
            ? "var(--stu-success-text)"
            : "var(--stu-text-muted)",
        }}
      >
        {isAnswered ? "ë‹µë³€ ì™„ë£Œ" : "ë‹µë³€ ëŒ€ê¸°"}
      </div>
      <IconChevronRight style={{ width: 16, height: 16, color: "var(--stu-text-muted)", flexShrink: 0 }} />
    </button>
  );
}

/**
 * ì§ˆë¬¸ ìƒì„¸ í˜ì´ì§€
 */
function QuestionDetailPage({
  question,
  onBack,
}: {
  question: PostEntity;
  onBack: () => void;
}) {
  const hasAnswerValue = hasAnswer(question);
  
  // ë‹µë³€ ëª©ë¡ ì¡°íšŒ
  const { data: replies = [], isLoading: repliesLoading } = useQuery<Answer[]>({
    queryKey: ["student", "qna", "replies", question.id],
    queryFn: () => fetchPostReplies(question.id),
    enabled: hasAnswerValue,
  });

  return (
    <StudentPageShell
      title="ì§ˆë¬¸ ìƒì„¸"
      onBack={onBack}
    >
      <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-6)" }}>
        {/* ì§ˆë¬¸ ì •ë³´ */}
        <div className="stu-section stu-section--nested">
          <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: "var(--stu-space-4)" }}>
            <div style={{ fontWeight: 700, fontSize: 15 }}>{question.title}</div>
            <div
              style={{
                display: "inline-flex",
                alignItems: "center",
                padding: "4px 10px",
                borderRadius: 6,
                fontSize: 12,
                fontWeight: 600,
                background: hasAnswerValue
                  ? "var(--stu-success-bg)"
                  : "var(--stu-surface-soft)",
                color: hasAnswerValue
                  ? "var(--stu-success-text)"
                  : "var(--stu-text-muted)",
              }}
            >
              {hasAnswerValue ? "ë‹µë³€ ì™„ë£Œ" : "ë‹µë³€ ëŒ€ê¸°"}
            </div>
          </div>
          <div className="stu-muted" style={{ fontSize: 12, marginBottom: "var(--stu-space-4)" }}>
            {formatYmd(question.created_at)}
          </div>
          <div
            style={{
              fontSize: 14,
              lineHeight: 1.6,
              whiteSpace: "pre-wrap",
              color: "var(--stu-text)",
            }}
          >
            {question.content}
          </div>
        </div>

        {/* ë‹µë³€ ì˜ì—­ */}
        {hasAnswerValue ? (
          <div className="stu-section stu-section--nested">
            <div style={{ fontWeight: 700, fontSize: 15, marginBottom: "var(--stu-space-4)" }}>
              ë‹µë³€ {replies.length > 0 ? `(${replies.length}ê°œ)` : question.replies_count ? `(${question.replies_count}ê°œ)` : ""}
            </div>
            {repliesLoading ? (
              <div className="stu-muted" style={{ textAlign: "center", padding: "var(--stu-space-4)" }}>
                ë‹µë³€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
              </div>
            ) : replies.length > 0 ? (
              <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-3)" }}>
                {replies.map((reply) => (
                  <div
                    key={reply.id}
                    className="stu-panel"
                    style={{
                      padding: "var(--stu-space-4)",
                      background: "var(--stu-success-bg)",
                      border: "1px solid var(--stu-success)",
                    }}
                  >
                    <div
                      style={{
                        fontSize: 14,
                        lineHeight: 1.6,
                        whiteSpace: "pre-wrap",
                        color: "var(--stu-text)",
                      }}
                    >
                      {reply.content}
                    </div>
                    <div className="stu-muted" style={{ fontSize: 12, marginTop: "var(--stu-space-2)" }}>
                      {formatYmd(reply.created_at)}
                    </div>
                  </div>
                ))}
              </div>
            ) : (
              <div
                className="stu-panel"
                style={{
                  padding: "var(--stu-space-4)",
                  background: "var(--stu-success-bg)",
                  border: "1px solid var(--stu-success)",
                }}
              >
                <div
                  style={{
                    fontSize: 14,
                    lineHeight: 1.6,
                    whiteSpace: "pre-wrap",
                    color: "var(--stu-text)",
                  }}
                >
                  ë‹µë³€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì„ ìƒë‹˜ì˜ ë‹µë³€ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
                  {question.updated_at && (
                    <div className="stu-muted" style={{ fontSize: 12, marginTop: "var(--stu-space-2)" }}>
                      ë‹µë³€ì¼: {formatYmd(question.updated_at)}
                    </div>
                  )}
                </div>
              </div>
            )}
          </div>
        ) : (
          <div className="stu-section stu-section--nested">
            <div className="stu-muted" style={{ textAlign: "center", padding: "var(--stu-space-4)" }}>
              ì•„ì§ ë‹µë³€ì´ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
              <br />
              ì„ ìƒë‹˜ì´ í™•ì¸ í›„ ë‹µë³€í•´ ì£¼ì‹¤ ê±°ì˜ˆìš”.
            </div>
          </div>
        )}
      </div>
    </StudentPageShell>
  );
}

/**
 * ì§ˆë¬¸ ì‘ì„± í˜ì´ì§€
 */
function QuestionFormPage({
  onBack,
  onSuccess,
}: {
  onBack: () => void;
  onSuccess: () => void;
}) {
  const qc = useQueryClient();
  const [title, setTitle] = useState("");
  const [content, setContent] = useState("");
  const [files, setFiles] = useState<File[]>([]);
  const fileInputRef = useRef<HTMLInputElement>(null);
  const hadFilesOnSubmitRef = useRef(false);

  const {
    data: blockTypes = [],
    isLoading: blockTypesLoading,
    isError: blockTypesError,
  } = useQuery({
    queryKey: ["community-block-types"],
    queryFn: () => fetchBlockTypes(),
  });

  const { data: profile } = useQuery({
    queryKey: ["student", "me"],
    queryFn: fetchMyProfile,
  });

  const qnaBlockType =
    blockTypes.find((b) => (b.code || "").toLowerCase() === QNA_BLOCK_CODE) ?? blockTypes[0];
  const effectiveBlockTypeId = qnaBlockType?.id ?? blockTypes[0]?.id;

  const createMut = useMutation({
    mutationFn: () => {
      if (effectiveBlockTypeId == null) {
        throw new Error("ì§ˆë¬¸ ìœ í˜•ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
      }
      hadFilesOnSubmitRef.current = files.length > 0;
      const me = qc.getQueryData<{ id: number }>(["student", "me"]) ?? profile;
      return createPost({
        block_type: effectiveBlockTypeId,
        title: title.trim(),
        content: content.trim(),
        created_by: me?.id ?? undefined,
        node_ids: [],
      });
    },
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["student", "qna", "questions"] });
      qc.invalidateQueries({ queryKey: ["student", "notifications", "counts"] });
      setTitle("");
      setContent("");
      setFiles([]);
      onSuccess();
    },
  });

  const canSubmit =
    !blockTypesLoading &&
    title.trim().length > 0 &&
    content.trim().length > 0 &&
    effectiveBlockTypeId != null;

  const addFiles = (e: React.ChangeEvent<HTMLInputElement>) => {
    const chosen = Array.from(e.target.files || []);
    const ok: File[] = [];
    for (const f of chosen) {
      if (f.size > MAX_SIZE_MB * 1024 * 1024) continue;
      if (ok.length + files.length >= MAX_FILES) break;
      ok.push(f);
    }
    setFiles((prev) => [...prev, ...ok].slice(0, MAX_FILES));
    if (e.target) e.target.value = "";
  };
  const removeFile = (index: number) => setFiles((prev) => prev.filter((_, i) => i !== index));

  const handleSubmit = () => {
    if (!canSubmit || createMut.isPending) return;
    createMut.mutate();
  };

  return (
    <StudentPageShell
      title="ì§ˆë¬¸ ë³´ë‚´ê¸°"
      description="ê¶ê¸ˆí•œ ì ì„ ì ì–´ ë³´ë‚´ë©´ ì„ ìƒë‹˜ì´ í™•ì¸í•´ ì£¼ì„¸ìš”."
      onBack={onBack}
    >
      <div
        className="stu-section stu-section--nested"
        style={{
          display: "flex",
          flexDirection: "column",
          gap: "var(--stu-space-4)",
        }}
      >
        {blockTypesLoading && (
          <div className="stu-muted" style={{ padding: "var(--stu-space-2)", fontSize: 14 }}>
            ì§ˆë¬¸ ìœ í˜•ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦
          </div>
        )}
        {!blockTypesLoading && blockTypesError && (
          <div
            role="alert"
            style={{
              padding: "var(--stu-space-3)",
              background: "var(--stu-warning-bg, #fff8e6)",
              border: "1px solid var(--stu-warning-border, #f0d675)",
              borderRadius: "var(--stu-radius)",
              fontSize: 14,
              color: "var(--stu-text, #333)",
            }}
          >
            ì§ˆë¬¸ ìœ í˜•ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•˜ê±°ë‚˜ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ ì£¼ì„¸ìš”.
          </div>
        )}
        {!blockTypesLoading && !blockTypesError && blockTypes.length === 0 && (
          <div className="stu-muted" style={{ padding: "var(--stu-space-2)", fontSize: 13 }}>
            ë“±ë¡ëœ ì§ˆë¬¸ ìœ í˜•ì´ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ ì£¼ì„¸ìš”.
          </div>
        )}
        {createMut.isError && (
          <div
            role="alert"
            style={{
              padding: "var(--stu-space-3)",
              background: "var(--stu-danger-bg)",
              border: "1px solid var(--stu-danger-border)",
              borderRadius: "var(--stu-radius)",
              fontSize: 14,
              color: "var(--stu-danger-text)",
              fontWeight: 600,
            }}
          >
            {createMut.error instanceof Error ? createMut.error.message : "ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."}
          </div>
        )}
        <label style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-2)" }}>
          <span style={{ fontSize: 14, fontWeight: 600, color: "var(--stu-text-muted)" }}>
            ì œëª©
          </span>
          <input
            type="text"
            placeholder="ì§ˆë¬¸ ì œëª©"
            value={title}
            onChange={(e) => setTitle(e.target.value)}
            className="stu-input"
            style={{ width: "100%" }}
          />
        </label>
        <label style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-2)", flex: 1 }}>
          <span style={{ fontSize: 14, fontWeight: 600, color: "var(--stu-text-muted)" }}>
            ë‚´ìš©
          </span>
          <textarea
            placeholder="ì§ˆë¬¸ ë‚´ìš©ì„ ì ì–´ ì£¼ì„¸ìš”."
            value={content}
            onChange={(e) => setContent(e.target.value)}
            rows={8}
            className="stu-textarea"
            style={{ width: "100%", resize: "vertical", minHeight: 160 }}
          />
        </label>
        <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-2)" }}>
          <span style={{ fontSize: 14, fontWeight: 600, color: "var(--stu-text-muted)" }}>
            ì‚¬ì§„Â·íŒŒì¼ (ì„ íƒ, ìµœëŒ€ {MAX_FILES}ê°œ, ê°œë‹¹ {MAX_SIZE_MB}MB)
          </span>
          <input
            ref={fileInputRef}
            type="file"
            accept="image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt"
            multiple
            onChange={addFiles}
            style={{ display: "none" }}
          />
          <button
            type="button"
            className="stu-btn stu-btn--secondary stu-btn--sm"
            onClick={() => fileInputRef.current?.click()}
            style={{ alignSelf: "flex-start" }}
          >
            íŒŒì¼ ì„ íƒ
          </button>
          {files.length > 0 && (
            <ul style={{ listStyle: "none", padding: 0, margin: 0, display: "flex", flexDirection: "column", gap: "var(--stu-space-2)" }}>
              {files.map((f, i) => (
                <li
                  key={`${f.name}-${i}`}
                  style={{
                    display: "flex",
                    alignItems: "center",
                    justifyContent: "space-between",
                    padding: "var(--stu-space-2) var(--stu-space-3)",
                    background: "var(--stu-surface)",
                    border: "1px solid var(--stu-border)",
                    borderRadius: "var(--stu-radius)",
                    fontSize: 13,
                    color: "var(--stu-text)",
                  }}
                >
                  <span style={{ overflow: "hidden", textOverflow: "ellipsis", whiteSpace: "nowrap", flex: 1, minWidth: 0 }}>
                    {f.name} ({(f.size / 1024).toFixed(1)}KB)
                  </span>
                  <button
                    type="button"
                    className="stu-btn stu-btn--ghost stu-btn--sm"
                    onClick={() => removeFile(i)}
                    style={{ flexShrink: 0, padding: "var(--stu-space-1) var(--stu-space-2)" }}
                  >
                    ì‚­ì œ
                  </button>
                </li>
              ))}
            </ul>
          )}
        </div>
        {createMut.isSuccess && (
          <div
            style={{
              padding: "var(--stu-space-3)",
              background: "var(--stu-success-bg)",
              borderRadius: "var(--stu-radius)",
              fontSize: 14,
              color: "var(--stu-success-text)",
            }}
          >
            ì§ˆë¬¸ì´ ì „ë‹¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì„ ìƒë‹˜ì´ í™•ì¸ í›„ ë‹µë³€í•´ ì£¼ì‹¤ ê±°ì˜ˆìš”.
            {hadFilesOnSubmitRef.current && (
              <div style={{ marginTop: "var(--stu-space-2)", fontSize: 12, opacity: 0.9 }}>
                â€» ì²¨ë¶€íŒŒì¼ì€ í˜„ì¬ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì œëª©ê³¼ ë‚´ìš©ë§Œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.
              </div>
            )}
          </div>
        )}
        <button
          type="button"
          className="stu-btn stu-btn--primary"
          disabled={!canSubmit || createMut.isPending}
          title={
            createMut.isPending
              ? "ë³´ë‚´ëŠ” ì¤‘â€¦"
              : !effectiveBlockTypeId
                ? "ì§ˆë¬¸ ìœ í˜•ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
                : !title.trim() || !content.trim()
                  ? "ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”."
                  : undefined
          }
          onClick={handleSubmit}
          onPointerDown={(e) => {
            if (e.pointerType === "touch" && canSubmit && !createMut.isPending) {
              e.preventDefault();
              handleSubmit();
            }
          }}
          style={{
            alignSelf: "flex-end",
            minHeight: 44,
            minWidth: 140,
          }}
        >
          {createMut.isPending ? "ë³´ë‚´ëŠ” ì¤‘â€¦" : "ì§ˆë¬¸ ë³´ë‚´ê¸°"}
        </button>
      </div>
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: sessions/api/sessions.ts
==========================================================================================
// PATH: src/student/domains/sessions/api/sessions.ts

import api from "@/student/shared/api/studentApi";

export type StudentSession = {
  id: number;
  title: string;
  date?: string | null;
  status?: string | null;
  exam_ids?: number[] | null;
};

export async function fetchMySessions(): Promise<StudentSession[]> {
  const res = await api.get("/student/sessions/me/");
  const data = res.data;
  if (Array.isArray(data)) return data as StudentSession[];
  if (Array.isArray(data?.items)) return data.items as StudentSession[];
  return [];
}

export async function fetchSessionDetail(sessionId: number): Promise<StudentSession> {
  const res = await api.get(`/student/sessions/${sessionId}/`);
  return res.data as StudentSession;
}


==========================================================================================
# FILE: sessions/components/SessionAssignmentAction.tsx
==========================================================================================



==========================================================================================
# FILE: sessions/components/SessionExamAction.tsx
==========================================================================================



==========================================================================================
# FILE: sessions/components/SessionInfoCard.tsx
==========================================================================================



==========================================================================================
# FILE: sessions/components/SessionVideoAction.tsx
==========================================================================================



==========================================================================================
# FILE: sessions/hooks/useStudentSessions.ts
==========================================================================================
// src/student/domains/sessions/hooks/useStudentSessions.ts
/**
 * âœ… useStudentSessions
 */

import { useQuery } from "@tanstack/react-query";
import { fetchMySessions, fetchSessionDetail } from "@/student/domains/sessions/api/sessions";

export function useMySessions() {
  return useQuery({
    queryKey: ["student-sessions"],
    queryFn: fetchMySessions,
  });
}

export function useSessionDetail(sessionId?: number) {
  const safeId = Number(sessionId);
  return useQuery({
    queryKey: ["student-session", safeId],
    queryFn: () => fetchSessionDetail(safeId),
    enabled: Number.isFinite(safeId),
  });
}


==========================================================================================
# FILE: sessions/pages/SessionDetailPage.tsx
==========================================================================================
// src/student/domains/sessions/pages/SessionDetailPage.tsx
/**
 * âœ… SessionDetailPage (í—ˆë¸Œ)
 * - í•™ìƒ ì•±ì˜ "í–‰ë™ ì¤‘ì‹¬ í—ˆë¸Œ"
 * - ì˜ìƒ/ì‹œí—˜/ê³¼ì œ/ìë£Œ ë§í¬ë§Œ ì œê³µ (íŒë‹¨/ê³„ì‚° âŒ)
 *
 * ì£¼ì˜:
 * - session â†’ exam ì—°ê²° ì¶”ë¡  âŒ
 * - ë°±ì—”ë“œê°€ exam_ids ë“±ì„ ë‚´ë ¤ì£¼ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
 * - ì—†ìœ¼ë©´ "ì‹œí—˜ìœ¼ë¡œ ì´ë™" ê°™ì€ ë²”ìš© ë§í¬ë§Œ ì œê³µ
 */

import { Link, useParams } from "react-router-dom";
import StudentPageShell from "../../../shared/ui/pages/StudentPageShell";
import EmptyState from "../../../shared/ui/layout/EmptyState";
import { useSessionDetail } from "@/student/domains/sessions/hooks/useStudentSessions";
import { formatYmd } from "@/student/shared/utils/date";

export default function SessionDetailPage() {
  const { sessionId } = useParams();
  const safeId = Number(sessionId);

  const { data, isLoading, isError } = useSessionDetail(
    Number.isFinite(safeId) ? safeId : undefined
  );

  if (!Number.isFinite(safeId)) {
    return (
      <StudentPageShell title="ì°¨ì‹œ" description="ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.">
        <EmptyState title="ì„¸ì…˜ IDê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  if (isLoading) {
    return (
      <StudentPageShell title="ì°¨ì‹œ" description="ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...">
        <div style={{ fontSize: 14, color: "#666" }}>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </StudentPageShell>
    );
  }

  if (isError || !data) {
    return (
      <StudentPageShell title="ì°¨ì‹œ" description="ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.">
        <EmptyState title="ì°¨ì‹œ ìƒì„¸ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  return (
    <StudentPageShell title={data.title} description={`ë‚ ì§œ: ${formatYmd(data.date ?? null)}`}>
      <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
        {/* ===== Actions ===== */}
        <ActionCard title="ì˜ìƒ ë³´ê¸°" desc="ë¯¸ë””ì–´ ë„ë©”ì¸ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.">
          {/* media ì´ì‹ ì „ì´ë©´ ë§í¬ë§Œ ìë¦¬ í™•ë³´ */}
          <Link to={`/student/video?session=${data.id}`} className="stu-cta-link">
            ì˜ìƒìœ¼ë¡œ ì´ë™
          </Link>
        </ActionCard>

        <ActionCard title="ì‹œí—˜/í‰ê°€" desc="ì‹œí—˜ ëª©ë¡ ë˜ëŠ” í•´ë‹¹ ì‹œí—˜ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.">
          {/* âœ… ë°±ì—”ë“œê°€ exam_ids ë‚´ë ¤ì£¼ëŠ” ê²½ìš°: ì§ì ‘ ë§í¬ */}
          {Array.isArray(data.exam_ids) && data.exam_ids.length > 0 ? (
            <div style={{ display: "flex", gap: 8, flexWrap: "wrap" }}>
              {data.exam_ids.map((eid) => (
                <Link key={eid} to={`/student/exams/${eid}`} className="stu-cta-link">
                  ì‹œí—˜ #{eid}
                </Link>
              ))}
            </div>
          ) : (
            <Link to="/student/exams" className="stu-cta-link">
              ì‹œí—˜ ëª©ë¡ ë³´ê¸°
            </Link>
          )}
        </ActionCard>

        <ActionCard title="ì„±ì " desc="ê²°ê³¼ ìš”ì•½ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.">
          <Link to="/student/grades" className="stu-cta-link">
            ì„±ì  ë³´ê¸°
          </Link>
        </ActionCard>

        <div className="stu-muted" style={{ fontSize: 12 }}>
          â€» ì´ í˜ì´ì§€ëŠ” â€œí–‰ë™ í—ˆë¸Œâ€ì…ë‹ˆë‹¤. ì •ì±…/ìƒíƒœ íŒë‹¨ì€ ë°±ì—”ë“œê°€ ì±…ì„ì§‘ë‹ˆë‹¤.
        </div>
      </div>
    </StudentPageShell>
  );
}

function ActionCard({
  title,
  desc,
  children,
}: {
  title: string;
  desc: string;
  children: React.ReactNode;
}) {
  return (
    <div className="stu-section">
      <div className="stu-section-header" style={{ fontWeight: 700, fontSize: 15 }}>
        {title}
      </div>
      <div className="stu-muted" style={{ fontSize: 13, marginBottom: "var(--stu-space-4)" }}>{desc}</div>
      <div>{children}</div>
    </div>
  );
}


==========================================================================================
# FILE: sessions/pages/SessionListPage.tsx
==========================================================================================
/**
 * ì¼ì • â€” í´ë¦¬ë‹‰ì²˜ëŸ¼ ë‹¬ë ¥ ì œê³µ, ë‚ ì§œ í´ë¦­ ì‹œ ê·¸ë‚  ìƒì„¸ ì¼ì • í‘œì‹œ
 * ë‹¬ë ¥ì€ ì˜ì—­ì´ ì‘ìœ¼ë¯€ë¡œ ìš”ì•½ë§Œ(ë‚ ì§œ+ì¼ì • ìˆìœ¼ë©´ ì ), ìƒì„¸ëŠ” ì•„ë˜ ì˜ì—­ì— í‘œì‹œ
 */
import { useState, useMemo } from "react";
import { Link } from "react-router-dom";
import StudentPageShell from "@/student/shared/ui/pages/StudentPageShell";
import ScheduleCalendar from "@/student/shared/ui/components/ScheduleCalendar";
import { useMySessions } from "@/student/domains/sessions/hooks/useStudentSessions";
import type { StudentSession } from "@/student/domains/sessions/api/sessions";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import { formatYmd } from "@/student/shared/utils/date";
import { IconCalendar, IconChevronRight } from "@/student/shared/ui/icons/Icons";

function toDateKey(d: string | null | undefined): string | null {
  if (!d) return null;
  return d.slice(0, 10);
}

export default function SessionListPage() {
  const [selectedDate, setSelectedDate] = useState<string | null>(null);
  const { data: sessions = [], isLoading, isError } = useMySessions();

  const datesWithSessions = useMemo(() => {
    const set = new Set<string>();
    sessions.forEach((s) => {
      const key = toDateKey(s.date);
      if (key) set.add(key);
    });
    return Array.from(set);
  }, [sessions]);

  const sessionsByDate = useMemo(() => {
    const map = new Map<string, StudentSession[]>();
    sessions.forEach((s) => {
      const key = toDateKey(s.date);
      if (!key) return;
      if (!map.has(key)) map.set(key, []);
      map.get(key)!.push(s);
    });
    map.forEach((arr) => arr.sort((a, b) => (a.date || "").localeCompare(b.date || "")));
    return map;
  }, [sessions]);

  const selectedDaySessions = useMemo(() => {
    if (!selectedDate) return [];
    return sessionsByDate.get(selectedDate) ?? [];
  }, [selectedDate, sessionsByDate]);

  const handleDateSelect = (date: string) => {
    setSelectedDate(date);
  };

  if (isLoading) {
    return (
      <StudentPageShell title="ì¼ì •" description="ë‚´ ì°¨ì‹œ ì¼ì •">
        <div className="stu-skel" style={{ height: 200, borderRadius: "var(--stu-radius-md)", marginBottom: "var(--stu-space-4)" }} />
        <div className="stu-skel" style={{ height: 72, borderRadius: "var(--stu-radius-md)" }} />
      </StudentPageShell>
    );
  }

  if (isError || !sessions) {
    return (
      <StudentPageShell title="ì¼ì •">
        <EmptyState title="ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤." description="ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”." />
      </StudentPageShell>
    );
  }

  return (
    <StudentPageShell title="ì¼ì •" description="ë‚ ì§œë¥¼ ëˆ„ë¥´ë©´ í•´ë‹¹ ë‚ ì˜ ì¼ì •ì„ ë³¼ ìˆ˜ ìˆì–´ìš”.">
      <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-5)" }}>
        {/* ì†Œí˜• ë‹¬ë ¥ (ìš”ì•½ë§Œ) */}
        <ScheduleCalendar
          selectedDate={selectedDate}
          onDateSelect={handleDateSelect}
          datesWithSessions={datesWithSessions}
        />

        {/* ì„ íƒí•œ ë‚ ì§œì˜ ìƒì„¸ ì¼ì • */}
        {selectedDate ? (
          <div className="stu-section stu-section--nested">
            <div style={{ fontWeight: 700, fontSize: 15, marginBottom: "var(--stu-space-4)" }}>
              {formatYmd(selectedDate)} ì¼ì •
            </div>
            {selectedDaySessions.length === 0 ? (
              <EmptyState
                title="í•´ë‹¹ ë‚ ì§œì— ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤."
                description="ë‹¤ë¥¸ ë‚ ì§œë¥¼ ì„ íƒí•´ ë³´ì„¸ìš”."
                compact
              />
            ) : (
              <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-2)" }}>
                {selectedDaySessions.map((s) => {
                  const status = (s.status ?? "").toLowerCase();
                  const panelVariant =
                    status.includes("ì™„ë£Œ") || status.includes("ì¢…ë£Œ")
                      ? "stu-panel--complete"
                      : status.includes("ì„ë°•") || status.includes("ë§ˆê°")
                        ? "stu-panel--danger"
                        : status.includes("ì˜ˆì •") || status.includes("ì§„í–‰")
                          ? "stu-panel--action"
                          : "stu-panel--nav";
                  return (
                    <Link
                      key={s.id}
                      to={`/student/sessions/${s.id}`}
                      className={`stu-panel stu-panel--pressable stu-panel--accent ${panelVariant}`}
                      style={{
                        display: "flex",
                        alignItems: "center",
                        gap: "var(--stu-space-4)",
                        textDecoration: "none",
                        color: "inherit",
                      }}
                    >
                      <div
                        style={{
                          width: 44,
                          height: 44,
                          borderRadius: 12,
                          background: "var(--stu-surface-soft)",
                          display: "grid",
                          placeItems: "center",
                        }}
                      >
                        <IconCalendar style={{ width: 22, height: 22, color: "var(--stu-primary)" }} />
                      </div>
                      <div style={{ flex: 1, minWidth: 0 }}>
                        <div style={{ fontWeight: 800, fontSize: 15 }}>{s.title}</div>
                        <div className="stu-muted" style={{ fontSize: 13, marginTop: 2 }}>
                          {s.status ? ` Â· ${s.status}` : ""}
                        </div>
                      </div>
                      <IconChevronRight style={{ width: 20, height: 20, color: "var(--stu-text-muted)" }} />
                    </Link>
                  );
                })}
              </div>
            )}
          </div>
        ) : (
          <div className="stu-muted" style={{ textAlign: "center", padding: "var(--stu-space-6)", fontSize: 14 }}>
            ë‚ ì§œë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ ë‚ ì˜ ì¼ì •ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
          </div>
        )}
      </div>
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: submit/pages/SubmitAssignmentPage.tsx
==========================================================================================
/**
 * ê³¼ì œ ì œì¶œ â€” ë™ì˜ìƒÂ·ì‚¬ì§„ ì—…ë¡œë“œ â†’ í•™ìƒ ì¸ë²¤í† ë¦¬(ì„ ìƒ ì¸ë²¤í† ë¦¬ì™€ ë™ì¼)
 */
import { useState, useRef } from "react";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import StudentPageShell from "@/student/shared/ui/pages/StudentPageShell";
import { fetchMyProfile } from "@/student/domains/profile/api/profile";
import { uploadFile } from "@/features/storage/api/storage.api";

const ACCEPT = "image/*,video/*";
const MAX_SIZE_MB = 100;

export default function SubmitAssignmentPage() {
  const qc = useQueryClient();
  const fileInputRef = useRef<HTMLInputElement>(null);
  const [selectedFile, setSelectedFile] = useState<File | null>(null);
  const [error, setError] = useState<string | null>(null);

  const { data: profile, isLoading: profileLoading } = useQuery({
    queryKey: ["student-profile"],
    queryFn: fetchMyProfile,
  });

  const uploadMut = useMutation({
    mutationFn: async () => {
      if (!profile?.ps_number) throw new Error("í”„ë¡œí•„ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤.");
      if (!selectedFile) throw new Error("íŒŒì¼ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.");
      if (selectedFile.size > MAX_SIZE_MB * 1024 * 1024) {
        throw new Error(`íŒŒì¼ í¬ê¸°ëŠ” ${MAX_SIZE_MB}MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.`);
      }
      return uploadFile({
        scope: "student",
        studentPs: profile.ps_number,
        folderId: null,
        displayName: selectedFile.name,
        description: "ê³¼ì œ ì œì¶œ",
        icon: selectedFile.type.startsWith("video/") ? "video" : "image",
        file: selectedFile,
      });
    },
    onSuccess: () => {
      setSelectedFile(null);
      setError(null);
      if (fileInputRef.current) fileInputRef.current.value = "";
      qc.invalidateQueries({ queryKey: ["storage-inventory", "student", profile?.ps_number] });
    },
    onError: (e: Error) => {
      setError(e.message || "ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
    },
  });

  const onFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    setError(null);
    if (!file) {
      setSelectedFile(null);
      return;
    }
    if (file.size > MAX_SIZE_MB * 1024 * 1024) {
      setError(`íŒŒì¼ í¬ê¸°ëŠ” ${MAX_SIZE_MB}MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.`);
      setSelectedFile(null);
      return;
    }
    setSelectedFile(file);
  };

  const canSubmit = !profileLoading && !!profile?.ps_number && !!selectedFile;

  return (
    <StudentPageShell
      title="ê³¼ì œ ì œì¶œ"
      description="ë™ì˜ìƒ ë˜ëŠ” ì‚¬ì§„ì„ ì˜¬ë¦¬ë©´ ì„ ìƒë‹˜ ì¸ë²¤í† ë¦¬ì— ì €ì¥ë©ë‹ˆë‹¤."
      onBack={() => window.history.back()}
    >
      <div className="stu-section stu-section--nested" style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-4)" }}>
        {profileLoading && <div className="stu-muted">í”„ë¡œí•„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>}
        {!profileLoading && profile && !profile.ps_number && (
          <div role="alert" style={{ padding: "var(--stu-space-3)", background: "var(--stu-surface)", border: "1px solid var(--stu-border)", borderRadius: "var(--stu-radius)", fontSize: 14 }}>
            ì œì¶œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ ì£¼ì„¸ìš”.
          </div>
        )}
        {uploadMut.isError && (
          <div role="alert" style={{ padding: "var(--stu-space-3)", background: "var(--stu-danger-bg)", border: "1px solid var(--stu-danger-border)", borderRadius: "var(--stu-radius)", fontSize: 14, color: "var(--stu-danger-text)", fontWeight: 600 }}>
            {error || (uploadMut.error instanceof Error ? uploadMut.error.message : "ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}
          </div>
        )}
        {uploadMut.isSuccess && (
          <div style={{ padding: "var(--stu-space-3)", background: "var(--stu-success-bg)", borderRadius: "var(--stu-radius)", fontSize: 14, color: "var(--stu-success-text)" }}>
            ê³¼ì œê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. ì„ ìƒë‹˜ì´ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </div>
        )}
        <input
          ref={fileInputRef}
          type="file"
          accept={ACCEPT}
          onChange={onFileChange}
          style={{ display: "none" }}
        />
        <button
          type="button"
          className="stu-btn stu-btn--secondary"
          disabled={profileLoading}
          onClick={() => fileInputRef.current?.click()}
          style={{ alignSelf: "flex-start" }}
        >
          íŒŒì¼ ì„ íƒ (ë™ì˜ìƒÂ·ì‚¬ì§„, ìµœëŒ€ {MAX_SIZE_MB}MB)
        </button>
        {selectedFile && (
          <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", padding: "var(--stu-space-2) var(--stu-space-3)", background: "var(--stu-surface)", border: "1px solid var(--stu-border)", borderRadius: "var(--stu-radius)", fontSize: 14 }}>
            <span style={{ overflow: "hidden", textOverflow: "ellipsis", whiteSpace: "nowrap" }}>{selectedFile.name} ({(selectedFile.size / 1024 / 1024).toFixed(2)}MB)</span>
            <button type="button" className="stu-btn stu-btn--ghost stu-btn--sm" onClick={() => { setSelectedFile(null); setError(null); if (fileInputRef.current) fileInputRef.current.value = ""; }}>
              ì‚­ì œ
            </button>
          </div>
        )}
        <button
          type="button"
          className="stu-btn stu-btn--primary"
          disabled={!canSubmit || uploadMut.isPending}
          onClick={() => uploadMut.mutate()}
          style={{ alignSelf: "flex-end", minHeight: 44 }}
        >
          {uploadMut.isPending ? "ì—…ë¡œë“œ ì¤‘â€¦" : "ì œì¶œí•˜ê¸°"}
        </button>
      </div>
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: submit/pages/SubmitHubPage.tsx
==========================================================================================
/**
 * ì œì¶œ í—ˆë¸Œ â€” ì„±ì í‘œ ì œì¶œ / ê³¼ì œ ì œì¶œ(ë™ì˜ìƒÂ·ì‚¬ì§„) ì„ íƒ
 */
import { Link } from "react-router-dom";
import StudentPageShell from "@/student/shared/ui/pages/StudentPageShell";
import { IconGrade, IconBoard } from "@/student/shared/ui/icons/Icons";

export default function SubmitHubPage() {
  return (
    <StudentPageShell
      title="ì œì¶œ"
      description="ì„±ì í‘œ ë˜ëŠ” ê³¼ì œ(ë™ì˜ìƒÂ·ì‚¬ì§„)ë¥¼ ì œì¶œí•˜ë©´ ì„ ìƒë‹˜ ì¸ë²¤í† ë¦¬ì— ì €ì¥ë©ë‹ˆë‹¤."
    >
      <div style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-3)" }}>
        <Link
          to="/student/submit/score"
          className="stu-panel stu-panel--pressable stu-panel--accent stu-panel--nav"
          style={{ display: "flex", alignItems: "center", gap: "var(--stu-space-3)", padding: "var(--stu-space-4)" }}
        >
          <div style={{ flexShrink: 0 }}>
            <IconGrade style={{ width: 28, height: 28, color: "var(--stu-primary)" }} />
          </div>
          <div style={{ flex: 1, minWidth: 0 }}>
            <div style={{ fontWeight: 600, fontSize: 16 }}>ì„±ì í‘œ ì œì¶œ</div>
            <div className="stu-muted" style={{ fontSize: 13, marginTop: 2 }}>ì´ë¯¸ì§€Â·PDFë¡œ ì„±ì í‘œë¥¼ ì œì¶œí•©ë‹ˆë‹¤.</div>
          </div>
          <span style={{ color: "var(--stu-text-muted)" }}>â†’</span>
        </Link>

        <Link
          to="/student/submit/assignment"
          className="stu-panel stu-panel--pressable stu-panel--accent stu-panel--nav"
          style={{ display: "flex", alignItems: "center", gap: "var(--stu-space-3)", padding: "var(--stu-space-4)" }}
        >
          <div style={{ flexShrink: 0 }}>
            <IconBoard style={{ width: 28, height: 28, color: "var(--stu-primary)" }} />
          </div>
          <div style={{ flex: 1, minWidth: 0 }}>
            <div style={{ fontWeight: 600, fontSize: 16 }}>ê³¼ì œ ì œì¶œ</div>
            <div className="stu-muted" style={{ fontSize: 13, marginTop: 2 }}>ë™ì˜ìƒÂ·ì‚¬ì§„ìœ¼ë¡œ ê³¼ì œë¥¼ ì œì¶œí•©ë‹ˆë‹¤.</div>
          </div>
          <span style={{ color: "var(--stu-text-muted)" }}>â†’</span>
        </Link>

        <Link
          to="/student/exams"
          className="stu-btn stu-btn--secondary"
          style={{ alignSelf: "flex-start", marginTop: "var(--stu-space-2)" }}
        >
          ì‹œí—˜ ë³´ê¸°
        </Link>
      </div>
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: submit/pages/SubmitScorePage.tsx
==========================================================================================
/**
 * ì„±ì í‘œ ì œì¶œ â€” ì´ë¯¸ì§€Â·PDF ì—…ë¡œë“œ â†’ í•™ìƒ ì¸ë²¤í† ë¦¬(ì„ ìƒ ì¸ë²¤í† ë¦¬ì™€ ë™ì¼)
 */
import { useState, useRef } from "react";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import StudentPageShell from "@/student/shared/ui/pages/StudentPageShell";
import { fetchMyProfile } from "@/student/domains/profile/api/profile";
import { uploadFile } from "@/features/storage/api/storage.api";

const ACCEPT = "image/*,.pdf";
const MAX_SIZE_MB = 20;

export default function SubmitScorePage() {
  const qc = useQueryClient();
  const fileInputRef = useRef<HTMLInputElement>(null);
  const [selectedFile, setSelectedFile] = useState<File | null>(null);
  const [error, setError] = useState<string | null>(null);

  const { data: profile, isLoading: profileLoading } = useQuery({
    queryKey: ["student-profile"],
    queryFn: fetchMyProfile,
  });

  const uploadMut = useMutation({
    mutationFn: async () => {
      if (!profile?.ps_number) throw new Error("í”„ë¡œí•„ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤.");
      if (!selectedFile) throw new Error("íŒŒì¼ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.");
      if (selectedFile.size > MAX_SIZE_MB * 1024 * 1024) {
        throw new Error(`íŒŒì¼ í¬ê¸°ëŠ” ${MAX_SIZE_MB}MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.`);
      }
      return uploadFile({
        scope: "student",
        studentPs: profile.ps_number,
        folderId: null,
        displayName: selectedFile.name,
        description: "ì„±ì í‘œ ì œì¶œ",
        icon: "file-text",
        file: selectedFile,
      });
    },
    onSuccess: () => {
      setSelectedFile(null);
      setError(null);
      if (fileInputRef.current) fileInputRef.current.value = "";
      qc.invalidateQueries({ queryKey: ["storage-inventory", "student", profile?.ps_number] });
    },
    onError: (e: Error) => {
      setError(e.message || "ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
    },
  });

  const onFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    setError(null);
    if (!file) {
      setSelectedFile(null);
      return;
    }
    if (file.size > MAX_SIZE_MB * 1024 * 1024) {
      setError(`íŒŒì¼ í¬ê¸°ëŠ” ${MAX_SIZE_MB}MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.`);
      setSelectedFile(null);
      return;
    }
    setSelectedFile(file);
  };

  const canSubmit = !profileLoading && !!profile?.ps_number && !!selectedFile;

  return (
    <StudentPageShell
      title="ì„±ì í‘œ ì œì¶œ"
      description="ì„±ì í‘œ ì´ë¯¸ì§€ ë˜ëŠ” PDFë¥¼ ì˜¬ë¦¬ë©´ ì„ ìƒë‹˜ ì¸ë²¤í† ë¦¬ì— ì €ì¥ë©ë‹ˆë‹¤."
      onBack={() => window.history.back()}
    >
      <div className="stu-section stu-section--nested" style={{ display: "flex", flexDirection: "column", gap: "var(--stu-space-4)" }}>
        {profileLoading && <div className="stu-muted">í”„ë¡œí•„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>}
        {!profileLoading && profile && !profile.ps_number && (
          <div role="alert" style={{ padding: "var(--stu-space-3)", background: "var(--stu-surface)", border: "1px solid var(--stu-border)", borderRadius: "var(--stu-radius)", fontSize: 14 }}>
            ì œì¶œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ ì£¼ì„¸ìš”.
          </div>
        )}
        {uploadMut.isError && (
          <div role="alert" style={{ padding: "var(--stu-space-3)", background: "var(--stu-danger-bg)", border: "1px solid var(--stu-danger-border)", borderRadius: "var(--stu-radius)", fontSize: 14, color: "var(--stu-danger-text)", fontWeight: 600 }}>
            {error || (uploadMut.error instanceof Error ? uploadMut.error.message : "ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}
          </div>
        )}
        {uploadMut.isSuccess && (
          <div style={{ padding: "var(--stu-space-3)", background: "var(--stu-success-bg)", borderRadius: "var(--stu-radius)", fontSize: 14, color: "var(--stu-success-text)" }}>
            ì„±ì í‘œê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. ì„ ìƒë‹˜ì´ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </div>
        )}
        <input
          ref={fileInputRef}
          type="file"
          accept={ACCEPT}
          onChange={onFileChange}
          style={{ display: "none" }}
        />
        <button
          type="button"
          className="stu-btn stu-btn--secondary"
          disabled={profileLoading}
          onClick={() => fileInputRef.current?.click()}
          style={{ alignSelf: "flex-start" }}
        >
          íŒŒì¼ ì„ íƒ (ì´ë¯¸ì§€Â·PDF, ìµœëŒ€ {MAX_SIZE_MB}MB)
        </button>
        {selectedFile && (
          <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", padding: "var(--stu-space-2) var(--stu-space-3)", background: "var(--stu-surface)", border: "1px solid var(--stu-border)", borderRadius: "var(--stu-radius)", fontSize: 14 }}>
            <span style={{ overflow: "hidden", textOverflow: "ellipsis", whiteSpace: "nowrap" }}>{selectedFile.name} ({(selectedFile.size / 1024).toFixed(1)}KB)</span>
            <button type="button" className="stu-btn stu-btn--ghost stu-btn--sm" onClick={() => { setSelectedFile(null); setError(null); if (fileInputRef.current) fileInputRef.current.value = ""; }}>
              ì‚­ì œ
            </button>
          </div>
        )}
        <button
          type="button"
          className="stu-btn stu-btn--primary"
          disabled={!canSubmit || uploadMut.isPending}
          onClick={() => uploadMut.mutate()}
          style={{ alignSelf: "flex-end", minHeight: 44 }}
        >
          {uploadMut.isPending ? "ì—…ë¡œë“œ ì¤‘â€¦" : "ì œì¶œí•˜ê¸°"}
        </button>
      </div>
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: video/api/video.ts
==========================================================================================
// PATH: C:\academyfront\src\student\domains\video\api\video.ts
import api from "@/student/shared/api/studentApi";
import type { AccessMode } from "@/features/videos/types/access-mode";

/** GET /student/video/me/ ì‘ë‹µ â€” ì˜ìƒ íƒ­ìš© */
export type StudentVideoMeSession = {
  id: number;
  title: string;
  order: number;
  date: string | null;
};

export type StudentVideoMeLecture = {
  id: number;
  title: string;
  sessions: StudentVideoMeSession[];
  enrollment_id?: number | null;
};

export type StudentVideoMePublic = {
  session_id: number;
  lecture_id: number;
} | null;

export type StudentVideoMeResponse = {
  public: StudentVideoMePublic;
  lectures: StudentVideoMeLecture[];
};

export async function fetchVideoMe(): Promise<StudentVideoMeResponse> {
  const res = await api.get<StudentVideoMeResponse>("/student/video/me/");
  const d = res.data;
  return {
    public: d?.public ?? null,
    lectures: Array.isArray(d?.lectures) ? d.lectures : [],
  };
}

export type StudentVideoListItem = {
  id: number;
  session_id: number;
  title: string;
  status: string;
  thumbnail_url?: string | null;
  duration?: number | null;
  progress?: number; // 0-100
  completed?: boolean;
  allow_skip: boolean;
  max_speed: number;
  show_watermark: boolean;
  access_mode?: AccessMode;
};

export type StudentSessionVideosResponse = {
  items: StudentVideoListItem[];
};

export type StudentVideoPlayback = {
  video: StudentVideoListItem;
  hls_url?: string | null;
  mp4_url?: string | null;
  play_url?: string | null; // ë°±ì—”ë“œì—ì„œ ì œê³µí•˜ëŠ” ì¬ìƒ URL
  policy: {
    allow_seek?: boolean;
    seek?: {
      mode?: "free" | "blocked" | "bounded_forward";
      forward_limit?: "max_watched" | null;
      grace_seconds?: number;
    };
    playback_rate?: {
      max?: number;
      ui_control?: boolean;
    };
    watermark?: {
      enabled?: boolean;
      mode?: "overlay";
      fields?: string[];
    };
    concurrency?: {
      max_sessions?: number;
      max_devices?: number;
    };
    access_mode?: AccessMode;
  };
};

export async function fetchStudentSessionVideos(
  sessionId: number,
  enrollmentId?: number | null
): Promise<StudentSessionVideosResponse> {
  if (Number.isNaN(Number(sessionId)) || sessionId < 1) {
    throw new Error("ìœ íš¨í•œ ì°¨ì‹œê°€ ì•„ë‹™ë‹ˆë‹¤.");
  }
  const res = await api.get(`/student/video/sessions/${sessionId}/videos/`, {
    params: enrollmentId ? { enrollment: enrollmentId } : undefined,
  });
  const d = res?.data;
  return {
    items: Array.isArray(d?.items) ? d.items : [],
  };
}

/**
 * í•™ìƒ ì•± ì „ìš©: ë¹„ë””ì˜¤ ì¬ìƒ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
 * ë°±ì—”ë“œ: GET /student/video/videos/{videoId}/playback/
 * - ë¹„ë””ì˜¤ ì •ë³´ì™€ ì¬ìƒ URL, ì •ì±…ì„ í•¨ê»˜ ë°˜í™˜
 */
export async function fetchStudentVideoPlayback(
  videoId: number,
  enrollmentId?: number | null
): Promise<StudentVideoPlayback> {
  const params: Record<string, string> = {};
  if (enrollmentId) {
    params.enrollment = String(enrollmentId);
  }
  if (Number.isNaN(Number(videoId)) || videoId < 1) {
    throw new Error("ìœ íš¨í•œ ì˜ìƒì´ ì•„ë‹™ë‹ˆë‹¤.");
  }
  const res = await api.get(`/student/video/videos/${videoId}/playback/`, {
    params: Object.keys(params).length > 0 ? params : undefined,
  });
  const data = res?.data;
  if (data == null || typeof data !== "object") {
    throw new Error("ì¬ìƒ ì •ë³´ë¥¼ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
  }
  return data as StudentVideoPlayback;
}

/**
 * ë¹„ë””ì˜¤ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
 * POST /student/video/videos/{videoId}/progress/
 */
export async function updateVideoProgress(
  videoId: number,
  data: {
    progress?: number; // 0-100 ë˜ëŠ” 0-1
    completed?: boolean;
    last_position?: number; // seconds
  }
): Promise<{
  id: number;
  video_id: number;
  enrollment_id: number;
  progress: number;
  progress_percent: number;
  completed: boolean;
  last_position: number;
}> {
  if (Number.isNaN(Number(videoId)) || videoId < 1) {
    throw new Error("ìœ íš¨í•œ ì˜ìƒì´ ì•„ë‹™ë‹ˆë‹¤.");
  }
  const res = await api.post(`/student/video/videos/${videoId}/progress/`, data);
  const out = res?.data;
  if (out == null || typeof out !== "object") {
    throw new Error("ì§„í–‰ë¥  ì €ì¥ ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤.");
  }
  return out as {
    id: number;
    video_id: number;
    enrollment_id: number;
    progress: number;
    progress_percent: number;
    completed: boolean;
    last_position: number;
  };
}


==========================================================================================
# FILE: video/components/CourseCard.tsx
==========================================================================================
// PATH: src/student/domains/video/components/CourseCard.tsx
// í”„ë¦¬ë¯¸ì—„ SaaS ì¸ê°• ëŠë‚Œì˜ ì½”ìŠ¤ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸

import { Link } from "react-router-dom";
import { IconPlay, IconChevronRight } from "@/student/shared/ui/icons/Icons";
import { formatDuration } from "../utils/format";
import VideoThumbnailWrapper from "./VideoThumbnailWrapper";

type CourseCardProps = {
  title: string;
  thumbnailUrl?: string | null;
  videoCount?: number;
  totalDuration?: number; // seconds
  progress?: number; // 0-100
  isNew?: boolean;
  isContinue?: boolean;
  isCompleted?: boolean;
  to: string;
  onClick?: () => void;
};

export default function CourseCard({
  title,
  thumbnailUrl,
  videoCount = 0,
  totalDuration,
  progress = 0,
  isNew = false,
  isContinue = false,
  isCompleted = false,
  to,
  onClick,
}: CourseCardProps) {
  const Component = onClick ? "button" : Link;
  const props = onClick
    ? { onClick, type: "button" as const }
    : { to, style: { textDecoration: "none", color: "inherit" } };

  return (
    <Component
      {...props}
      className="media-tile"
      style={{
        display: "block",
        width: "100%",
        textAlign: "left",
        borderRadius: 12,
        overflow: "hidden",
        background: "#1a1a1a",
        border: "2px solid rgba(255,255,255,0.15)",
        boxShadow: "0 4px 12px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.05)",
        transition: "transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease",
        cursor: "pointer",
        position: "relative",
      }}
      onMouseEnter={(e) => {
        e.currentTarget.style.transform = "translateY(-6px)";
        e.currentTarget.style.boxShadow = "0 12px 24px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.1)";
        e.currentTarget.style.borderColor = "rgba(255,255,255,0.25)";
      }}
      onMouseLeave={(e) => {
        e.currentTarget.style.transform = "translateY(0)";
        e.currentTarget.style.boxShadow = "0 4px 12px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.05)";
        e.currentTarget.style.borderColor = "rgba(255,255,255,0.15)";
      }}
      onMouseDown={(e) => {
        e.currentTarget.style.transform = "translateY(-3px) scale(0.98)";
      }}
      onMouseUp={(e) => {
        e.currentTarget.style.transform = "translateY(-6px)";
      }}
    >
      {/* ì§ˆê° ì˜¤ë²„ë ˆì´ */}
      <div
        style={{
          position: "absolute",
          inset: 0,
          background: "linear-gradient(180deg, rgba(255,255,255,0.03) 0%, transparent 50%, rgba(0,0,0,0.2) 100%)",
          pointerEvents: "none",
          zIndex: 1,
        }}
      />
      
      {/* ì¸ë„¤ì¼ ì˜ì—­ */}
      <div
        className="media-tile__thumb"
        style={{
          position: "relative",
          background: "#111",
          zIndex: 0,
          aspectRatio: "16 / 9",
          overflow: "hidden",
        }}
      >
        {thumbnailUrl ? (
          <div style={{ width: "100%", height: "100%", position: "relative" }}>
            {/* VideoThumbnail ì»´í¬ë„ŒíŠ¸ ì‚¬ìš© (featuresì—ì„œ ê°€ì ¸ì˜´) */}
            <VideoThumbnailWrapper
              title={title}
              thumbnail_url={thumbnailUrl}
              status="READY"
            />
            {/* ì¬ìƒ ì˜¤ë²„ë ˆì´ - Media Tile System */}
            <div
              style={{
                position: "absolute",
                inset: 0,
                display: "grid",
                placeItems: "center",
                background: "rgba(0,0,0,0.15)",
                opacity: 0.6,
                pointerEvents: "none",
                zIndex: 1,
              }}
            >
              <div
                style={{
                  width: 64,
                  height: 64,
                  borderRadius: "50%",
                  background: "rgba(255,255,255,0.9)",
                  display: "grid",
                  placeItems: "center",
                  transform: "scale(0.9)",
                  transition: "transform 0.2s ease",
                }}
              >
                <IconPlay style={{ width: 28, height: 28, color: "#000", marginLeft: 2 }} />
              </div>
            </div>
          </div>
        ) : (
          <div
            style={{
              width: "100%",
              height: "100%",
              display: "grid",
              placeItems: "center",
              // 2ë²ˆ í…Œë„ŒíŠ¸(tchul) ë¸Œëœë“œìƒ‰ ê·¸ë¼ë°ì´ì…˜
              background: "linear-gradient(135deg, #0d47a1 0%, #00695c 50%, #004d40 100%)",
            }}
          >
            <IconPlay style={{ width: 48, height: 48, color: "rgba(255,255,255,0.9)", opacity: 0.8 }} />
          </div>
        )}

        {/* ì§„í–‰ë¥  ë°” */}
        {progress > 0 && (
          <div
            style={{
              position: "absolute",
              bottom: 0,
              left: 0,
              right: 0,
              height: 4,
              background: "rgba(0,0,0,0.3)",
            }}
          >
            <div
              style={{
                height: "100%",
                width: `${progress}%`,
                background: "var(--stu-primary)",
                transition: "width 0.3s ease",
              }}
            />
          </div>
        )}

        {/* ë±ƒì§€ */}
        {(isNew || isContinue || isCompleted) && (
          <div
            style={{
              position: "absolute",
              top: 8,
              right: 8,
              display: "flex",
              gap: 4,
            }}
          >
            {isNew && (
              <span
                style={{
                  padding: "4px 8px",
                  borderRadius: 4,
                  background: "#ef4444",
                  color: "#fff",
                  fontSize: 10,
                  fontWeight: 700,
                  textTransform: "uppercase",
                }}
              >
                NEW
              </span>
            )}
            {isContinue && (
              <span
                style={{
                  padding: "4px 8px",
                  borderRadius: 4,
                  background: "var(--stu-primary)",
                  color: "#fff",
                  fontSize: 10,
                  fontWeight: 700,
                }}
              >
                ì´ì–´ë³´ê¸°
              </span>
            )}
            {isCompleted && (
              <span
                style={{
                  padding: "4px 8px",
                  borderRadius: 4,
                  background: "#22c55e",
                  color: "#fff",
                  fontSize: 10,
                  fontWeight: 700,
                }}
              >
                ì™„ë£Œ
              </span>
            )}
          </div>
        )}
      </div>

      {/* ì •ë³´ ì˜ì—­ */}
      <div style={{ marginTop: 6, padding: "0 4px 8px", position: "relative", zIndex: 1 }}>
        <div className="media-tile__title" style={{ fontWeight: 600, color: "#fff", textShadow: "0 1px 2px rgba(0,0,0,0.5)" }}>
          {title}
        </div>
      </div>
    </Component>
  );
}


==========================================================================================
# FILE: video/components/VideoThumbnailWrapper.tsx
==========================================================================================
// PATH: src/student/domains/video/components/VideoThumbnailWrapper.tsx
// CourseCardìš© VideoThumbnail ë˜í¼ (aspect-video ì˜¤ë²„ë¼ì´ë“œ)

import VideoThumbnail from "@/features/videos/ui/VideoThumbnail";

type Props = {
  title?: string;
  thumbnail_url?: string | null;
  status?: "READY" | "PROCESSING" | "FAILED" | "PENDING" | "UPLOADED";
};

/**
 * CourseCardìš© VideoThumbnail ë˜í¼
 * VideoThumbnailì˜ aspect-video í´ë˜ìŠ¤ë¥¼ ì˜¤ë²„ë¼ì´ë“œí•˜ì—¬ ë¶€ëª¨ ì»¨í…Œì´ë„ˆì— ë§ì¶¤
 */
export default function VideoThumbnailWrapper({ title, thumbnail_url, status }: Props) {
  return (
    <div style={{ width: "100%", height: "100%", position: "relative" }}>
      <div
        style={{
          width: "100%",
          height: "100%",
          overflow: "hidden",
        }}
      >
        <div
          style={{
            width: "100%",
            height: "100%",
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
          }}
        >
          <div
            style={{
              width: "100%",
              height: "100%",
              position: "relative",
            }}
            className="video-thumbnail-wrapper"
          >
            <style>{`
              .video-thumbnail-wrapper > div {
                aspect-ratio: unset !important;
                height: 100% !important;
                width: 100% !important;
              }
              .video-thumbnail-wrapper img {
                width: 100% !important;
                height: 100% !important;
                object-fit: cover !important;
              }
            `}</style>
            <VideoThumbnail title={title} thumbnail_url={thumbnail_url} status={status} />
          </div>
        </div>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: video/pages/CourseDetailPage.tsx
==========================================================================================
/**
 * ìˆ˜ì—… ìƒì„¸ í˜ì´ì§€ â€” ìƒë‹¨ì— ìˆ˜ì—… ì •ë³´, í•˜ë‹¨ì— ì°¨ì‹œë³„ ë°•ìŠ¤ (ì‘ì€ ì¸ë„¤ì¼ êµ¬ì¡°)
 */
import { useMemo } from "react";
import { useParams, useNavigate, useLocation, Link } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";
import { fetchVideoMe, fetchStudentSessionVideos } from "../api/video";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import StudentPageShell from "@/student/shared/ui/pages/StudentPageShell";
import { IconPlay } from "@/student/shared/ui/icons/Icons";
import { formatDuration } from "../utils/format";

// ì°¨ì‹œë³„ ë°•ìŠ¤ ì»´í¬ë„ŒíŠ¸ (ì˜ìƒ ëª©ë¡ê³¼ ë™ì¼í•œ ìŠ¤íƒ€ì¼)
function SessionBox({ 
  sessionId, 
  sessionTitle, 
  enrollmentId,
  order 
}: { 
  sessionId: number; 
  sessionTitle: string;
  enrollmentId?: number | null;
  order: number;
}) {
  const { data: videosData } = useQuery({
    queryKey: ["student-session-videos", sessionId, enrollmentId],
    queryFn: () => fetchStudentSessionVideos(sessionId, enrollmentId),
    enabled: !!sessionId,
  });

  const sessionData = useMemo(() => {
    if (!videosData?.items || videosData.items.length === 0) return null;
    
    const videos = videosData.items;
    const firstVideo = videos[0];
    const totalDuration = videos.reduce((sum, v) => sum + (v.duration ?? 0), 0);
    
    // ì§„í–‰ë¥  ê³„ì‚°: ë°±ì—”ë“œì—ì„œ ë°›ì€ progress ì‚¬ìš©
    // ì™„ë£Œëœ ì˜ìƒ ìˆ˜ / ì „ì²´ ì˜ìƒ ìˆ˜ë¡œ ì„¸ì…˜ ì „ì²´ ì§„í–‰ë¥  ê³„ì‚°
    const completedVideos = videos.filter((v) => (v.progress ?? 0) >= 100 || v.completed).length;
    const progress = videos.length > 0 ? Math.round((completedVideos / videos.length) * 100) : 0;
    
    return {
      thumbnailUrl: firstVideo.thumbnail_url,
      videoCount: videos.length,
      totalDuration,
      firstVideoId: firstVideo.id,
      progress, // 0-100
    };
  }, [videosData]);

  if (!sessionData) return null;

  return (
    <Link
      to={`/student/video/sessions/${sessionId}${enrollmentId ? `?enrollment=${enrollmentId}` : ""}`}
      style={{
        display: "flex",
        gap: 12,
        padding: "var(--stu-space-3)",
        borderRadius: 10,
        background: "#1a1a1a",
        border: "2px solid rgba(255,255,255,0.15)",
        textDecoration: "none",
        color: "inherit",
        transition: "transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease, background 0.2s ease",
        cursor: "pointer",
        boxShadow: "0 4px 12px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.05)",
        position: "relative",
      }}
      onMouseEnter={(e) => {
        e.currentTarget.style.transform = "translateY(-4px)";
        e.currentTarget.style.boxShadow = "0 8px 20px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.1)";
        e.currentTarget.style.background = "#222";
        e.currentTarget.style.borderColor = "rgba(255,255,255,0.25)";
      }}
      onMouseLeave={(e) => {
        e.currentTarget.style.transform = "translateY(0)";
        e.currentTarget.style.boxShadow = "0 4px 12px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.05)";
        e.currentTarget.style.background = "#1a1a1a";
        e.currentTarget.style.borderColor = "rgba(255,255,255,0.15)";
      }}
      onMouseDown={(e) => {
        e.currentTarget.style.transform = "translateY(-2px) scale(0.98)";
      }}
      onMouseUp={(e) => {
        e.currentTarget.style.transform = "translateY(-4px)";
      }}
    >
      {/* ì§ˆê° ì˜¤ë²„ë ˆì´ */}
      <div
        style={{
          position: "absolute",
          inset: 0,
          background: "linear-gradient(180deg, rgba(255,255,255,0.03) 0%, transparent 50%, rgba(0,0,0,0.2) 100%)",
          pointerEvents: "none",
          zIndex: 1,
          borderRadius: 10,
        }}
      />
      
      {/* ì¢Œì¸¡: ì‘ì€ í”Œë ˆì´ ì•„ì´ì½˜ */}
      <div
        style={{
          position: "relative",
          width: 160,
          aspectRatio: "16 / 9",
          borderRadius: 8,
          overflow: "hidden",
          background: "#111",
          flexShrink: 0,
          zIndex: 0,
        }}
      >
        {sessionData.thumbnailUrl ? (
          <img
            src={sessionData.thumbnailUrl}
            alt={sessionTitle}
            style={{
              width: "100%",
              height: "100%",
              objectFit: "cover",
            }}
          />
        ) : (
          <div
            style={{
              width: "100%",
              height: "100%",
              display: "grid",
              placeItems: "center",
              // 2ë²ˆ í…Œë„ŒíŠ¸(tchul) ë¸Œëœë“œìƒ‰ ê·¸ë¼ë°ì´ì…˜
              background: "linear-gradient(135deg, #0d47a1 0%, #00695c 50%, #004d40 100%)",
            }}
          >
            <IconPlay style={{ width: 32, height: 32, color: "rgba(255,255,255,0.9)", opacity: 0.8 }} />
          </div>
        )}

        {/* ì¬ìƒ ì˜¤ë²„ë ˆì´ */}
        <div
          style={{
            position: "absolute",
            inset: 0,
            display: "grid",
            placeItems: "center",
            background: "rgba(0,0,0,0.2)",
          }}
        >
          <div
            style={{
              width: 40,
              height: 40,
              borderRadius: "50%",
              background: "rgba(255,255,255,0.9)",
              display: "grid",
              placeItems: "center",
            }}
          >
            <IconPlay style={{ width: 20, height: 20, color: "#000", marginLeft: 2 }} />
          </div>
        </div>

        {/* ì§„í–‰ë¥  ë°” (YouTube ìŠ¤íƒ€ì¼) */}
        {sessionData.progress > 0 && (
          <div
            style={{
              position: "absolute",
              bottom: 0,
              left: 0,
              right: 0,
              height: 3,
              background: "rgba(0,0,0,0.3)",
              zIndex: 2,
            }}
          >
            <div
              style={{
                height: "100%",
                width: `${sessionData.progress}%`,
                background: "var(--stu-primary)",
                transition: "width 0.3s ease",
              }}
            />
          </div>
        )}
      </div>

      {/* ìš°ì¸¡: ì„¤ëª… */}
      <div
        style={{
          flex: 1,
          minWidth: 0,
          display: "flex",
          flexDirection: "column",
          justifyContent: "center",
          position: "relative",
          zIndex: 1,
        }}
      >
        <div
          style={{
            fontSize: 15,
            fontWeight: 600,
            color: "#fff",
            marginBottom: 4,
            display: "-webkit-box",
            WebkitLineClamp: 2,
            WebkitBoxOrient: "vertical",
            overflow: "hidden",
            lineHeight: 1.4,
            textShadow: "0 1px 2px rgba(0,0,0,0.5)",
          }}
        >
          {order}ì°¨ì‹œ Â· {sessionTitle}
        </div>
      </div>
    </Link>
  );
}

export default function CourseDetailPage() {
  const { lectureId } = useParams<{ lectureId?: string }>();
  const location = useLocation();
  const nav = useNavigate();
  // ì „ì²´ê³µê°œì˜ìƒ: ì •ì  ë¼ìš°íŠ¸ video/courses/public ë˜ëŠ” pathnameì— courses/public í¬í•¨ ì‹œ
  const pathname = location.pathname.replace(/\/$/, "");
  const isPublic =
    lectureId === "public" ||
    pathname.endsWith("video/courses/public") ||
    pathname.includes("/video/courses/public");
  const lectureIdNum = isPublic ? null : (lectureId ? parseInt(lectureId, 10) : null);

  const { data: videoMe, isLoading } = useQuery({
    queryKey: ["student-video-me"],
    queryFn: fetchVideoMe,
  });

  const lecture = useMemo(() => {
    if (!videoMe?.lectures || !lectureIdNum) return null;
    return videoMe.lectures.find((lec) => lec.id === lectureIdNum);
  }, [videoMe, lectureIdNum]);

  if (isLoading) {
    return (
      <StudentPageShell title="" noSectionFrame>
        <div className="video-page-content" style={{ padding: "var(--stu-space-4)" }}>
          <div className="stu-skel" style={{ height: 200, borderRadius: "var(--stu-radius-lg)" }} />
          <div className="stu-skel" style={{ height: 120, marginTop: 16, borderRadius: "var(--stu-radius-lg)" }} />
        </div>
      </StudentPageShell>
    );
  }

  // ì „ì²´ê³µê°œì˜ìƒì´ ì•„ë‹ ë•Œë§Œ ìˆ˜ì—… ì—†ìŒ ì˜¤ë¥˜ í‘œì‹œ
  if (!isPublic && !lecture) {
    return (
      <StudentPageShell title="" noSectionFrame>
        <div className="video-page-content" style={{ padding: "var(--stu-space-4)" }}>
          <EmptyState
            title="ìˆ˜ì—…ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
            description="ìˆ˜ì—…ì´ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤."
          />
        </div>
      </StudentPageShell>
    );
  }

  // ì „ì²´ê³µê°œì˜ìƒ: í…Œë„ŒíŠ¸ ë‚´ í•™ìƒì´ë©´ ì„¸ì…˜ë§Œ ìˆìœ¼ë©´ í‘œì‹œ (enrollment ë¶ˆí•„ìš”)
  const sessions = isPublic
    ? (videoMe?.public?.session_id
        ? [{ id: videoMe.public.session_id, title: "ì „ì²´ê³µê°œì˜ìƒ", order: 1, date: null }]
        : [{ id: 0, title: "ì „ì²´ê³µê°œì˜ìƒ", order: 1, date: null }])
    : (lecture?.sessions ?? []);

  const firstSessionId = sessions[0]?.id ?? 0;
  const enrollmentIdForLecture = isPublic ? null : (lecture ? (videoMe?.lectures?.find((l) => l.id === lecture.id)?.enrollment_id ?? null) : null);
  const { data: firstSessionVideos } = useQuery({
    queryKey: ["student-session-videos", firstSessionId, enrollmentIdForLecture],
    queryFn: () => fetchStudentSessionVideos(firstSessionId, enrollmentIdForLecture ?? undefined),
    enabled: !!firstSessionId && firstSessionId > 0,
  });

  const totalVideos = useMemo(() => {
    // TODO: ëª¨ë“  ì„¸ì…˜ì˜ ì˜ìƒ ê°œìˆ˜ í•©ì‚° (í˜„ì¬ëŠ” ì²« ë²ˆì§¸ ì„¸ì…˜ë§Œ)
    return firstSessionVideos?.items?.length ?? 0;
  }, [firstSessionVideos]);

  const totalDuration = useMemo(() => {
    // TODO: ëª¨ë“  ì„¸ì…˜ì˜ ì´ ì‹œê°„ í•©ì‚°
    return firstSessionVideos?.items?.reduce((sum, v) => sum + (v.duration ?? 0), 0) ?? 0;
  }, [firstSessionVideos]);

  return (
    <StudentPageShell title="" noSectionFrame>
      <div className="video-page-content" style={{ padding: "var(--stu-space-4)" }}>
        {/* ìƒë‹¨: ìˆ˜ì—… ì •ë³´ (ì¸ë„¤ì¼ ë°°ë„ˆ ì œê±°) */}
        <div
          style={{
            marginBottom: "var(--stu-space-6)",
          }}
        >
          <h1
            style={{
              fontSize: 22,
              fontWeight: 700,
              color: "#fff",
              marginBottom: "var(--stu-space-3)",
              letterSpacing: "-0.01em",
            }}
          >
            {isPublic ? "ì „ì²´ê³µê°œì˜ìƒ" : lecture?.title ?? "ìˆ˜ì—…"}
          </h1>
          
          <div
            style={{
              display: "flex",
              flexDirection: "column",
              gap: 6,
              fontSize: 14,
              color: "rgba(255,255,255,0.7)",
              marginBottom: "var(--stu-space-4)",
            }}
          >
            <div>
              <span style={{ fontWeight: 600 }}>ì°¨ì‹œ:</span> {sessions.length}ê°œ
            </div>
            {totalVideos > 0 && (
              <div>
                <span style={{ fontWeight: 600 }}>ì˜ìƒ:</span> {totalVideos}ê°œ Â· {formatDuration(totalDuration)}
              </div>
            )}
          </div>
        </div>

        {/* í•˜ë‹¨: ì°¨ì‹œë³„ ë°•ìŠ¤ */}
        <div>
          <h2
            style={{
              fontSize: 18,
              fontWeight: 700,
              color: "#fff",
              marginBottom: "var(--stu-space-4)",
            }}
          >
            ì°¨ì‹œ ëª©ë¡
          </h2>
          
          {sessions.length === 0 ? (
            <EmptyState
              title="ì°¨ì‹œê°€ ì—†ìŠµë‹ˆë‹¤"
              description="ì´ ìˆ˜ì—…ì—ëŠ” ì•„ì§ ì°¨ì‹œê°€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
            />
          ) : (
            <div
              style={{
                display: "flex",
                flexDirection: "column",
                gap: "var(--stu-space-4)",
              }}
            >
              {sessions.map((session) => {
                // ì „ì²´ê³µê°œì˜ìƒì´ì§€ë§Œ ì‹¤ì œ ì„¸ì…˜ì´ ì—†ëŠ” ê²½ìš° (id === 0)
                if (isPublic && session.id === 0) {
                  return (
                    <div
                      key="public-empty"
                      style={{
                        padding: "var(--stu-space-6)",
                        borderRadius: 10,
                        background: "#1a1a1a",
                        border: "2px solid rgba(255,255,255,0.15)",
                        textAlign: "center",
                      }}
                    >
                      <EmptyState
                        title="ì „ì²´ê³µê°œì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤"
                        description="ì „ì²´ê³µê°œì˜ìƒì´ ë“±ë¡ë˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."
                      />
                    </div>
                  );
                }
                return (
                  <SessionBox
                    key={session.id}
                    sessionId={session.id}
                    sessionTitle={session.title}
                    enrollmentId={enrollmentIdForLecture}
                    order={session.order}
                  />
                );
              })}
            </div>
          )}
        </div>
      </div>
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: video/pages/SessionDetailPage.tsx
==========================================================================================
/**
 * ì°¨ì‹œ ìƒì„¸ í˜ì´ì§€ â€” ì˜ìƒ ëª©ë¡ (ì‘ì€ ì¸ë„¤ì¼ êµ¬ì¡°)
 */
import { useEffect, useState } from "react";
import { useParams, useNavigate, useSearchParams, Link } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";
import { fetchStudentSessionVideos } from "../api/video";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import StudentPageShell from "@/student/shared/ui/pages/StudentPageShell";
import { IconPlay } from "@/student/shared/ui/icons/Icons";
import { formatDuration, formatDurationDetailed } from "../utils/format";

// ì˜ìƒ ëª©ë¡ ì•„ì´í…œ ì»´í¬ë„ŒíŠ¸
function VideoListItem({ 
  video, 
  enrollmentId,
  isCurrent = false,
  progress = 0, // 0-100
}: { 
  video: {
    id: number;
    title: string;
    thumbnail_url?: string | null;
    duration?: number | null;
  };
  enrollmentId?: number | null;
  isCurrent?: boolean;
  progress?: number; // 0-100
}) {
  return (
    <Link
      to={`/student/video/play?video=${video.id}${enrollmentId ? `&enrollment=${enrollmentId}` : ""}`}
      style={{
        display: "flex",
        gap: 12,
        padding: "var(--stu-space-3)",
        borderRadius: 10,
        background: isCurrent ? "rgba(255,255,255,0.04)" : "#1a1a1a",
        border: isCurrent 
          ? "2px solid rgba(255,255,255,0.2)" 
          : "2px solid rgba(255,255,255,0.15)",
        borderLeft: isCurrent ? "3px solid var(--stu-primary)" : "2px solid rgba(255,255,255,0.15)",
        textDecoration: "none",
        color: "inherit",
        transition: "transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease, background 0.2s ease",
        cursor: "pointer",
        boxShadow: "0 4px 12px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.05)",
        position: "relative",
      }}
      onMouseEnter={(e) => {
        e.currentTarget.style.transform = "translateY(-4px)";
        e.currentTarget.style.boxShadow = "0 8px 20px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.1)";
        e.currentTarget.style.background = "#222";
        e.currentTarget.style.borderColor = "rgba(255,255,255,0.25)";
      }}
      onMouseLeave={(e) => {
        e.currentTarget.style.transform = "translateY(0)";
        e.currentTarget.style.boxShadow = "0 4px 12px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.05)";
        e.currentTarget.style.background = "#1a1a1a";
        e.currentTarget.style.borderColor = "rgba(255,255,255,0.15)";
      }}
      onMouseDown={(e) => {
        e.currentTarget.style.transform = "translateY(-2px) scale(0.98)";
      }}
      onMouseUp={(e) => {
        e.currentTarget.style.transform = "translateY(-4px)";
      }}
    >
      {/* ì§ˆê° ì˜¤ë²„ë ˆì´ */}
      <div
        style={{
          position: "absolute",
          inset: 0,
          background: "linear-gradient(180deg, rgba(255,255,255,0.03) 0%, transparent 50%, rgba(0,0,0,0.2) 100%)",
          pointerEvents: "none",
          zIndex: 1,
          borderRadius: 10,
        }}
      />
      {/* ì¸ë„¤ì¼ */}
      <div
        style={{
          position: "relative",
          width: 160,
          aspectRatio: "16 / 9",
          borderRadius: 8,
          overflow: "hidden",
          background: "#111",
          flexShrink: 0,
          zIndex: 0,
        }}
      >
        {video.thumbnail_url ? (
          <img
            src={video.thumbnail_url}
            alt={video.title}
            style={{
              width: "100%",
              height: "100%",
              objectFit: "cover",
            }}
          />
        ) : (
          <div
            style={{
              width: "100%",
              height: "100%",
              display: "grid",
              placeItems: "center",
              // 2ë²ˆ í…Œë„ŒíŠ¸(tchul) ë¸Œëœë“œìƒ‰ ê·¸ë¼ë°ì´ì…˜
              background: "linear-gradient(135deg, #0d47a1 0%, #00695c 50%, #004d40 100%)",
            }}
          >
            <IconPlay style={{ width: 32, height: 32, color: "rgba(255,255,255,0.9)", opacity: 0.8 }} />
          </div>
        )}

        {/* í˜„ì¬ ì¬ìƒ ì¤‘ ì˜¤ë²„ë ˆì´ */}
        {isCurrent && (
          <div
            style={{
              position: "absolute",
              inset: 0,
              display: "grid",
              placeItems: "center",
              background: "rgba(0,0,0,0.3)",
              zIndex: 1,
            }}
          >
            <div
              style={{
                width: 48,
                height: 48,
                borderRadius: "50%",
                background: "rgba(255,255,255,0.95)",
                display: "grid",
                placeItems: "center",
                boxShadow: "0 2px 8px rgba(0,0,0,0.3)",
              }}
            >
              <IconPlay style={{ width: 24, height: 24, color: "#000", marginLeft: 2 }} />
            </div>
          </div>
        )}

        {/* ì§„í–‰ë¥  ë°” (YouTube ìŠ¤íƒ€ì¼) */}
        {progress > 0 && (
          <div
            style={{
              position: "absolute",
              bottom: 0,
              left: 0,
              right: 0,
              height: 3,
              background: "rgba(0,0,0,0.3)",
              zIndex: 2,
            }}
          >
            <div
              style={{
                height: "100%",
                width: `${progress}%`,
                background: "var(--stu-primary)",
                transition: "width 0.3s ease",
              }}
            />
          </div>
        )}

        {/* ì˜ìƒ ì‹œê°„ ì˜¤ë²„ë ˆì´ */}
        {video.duration && (
          <div
            style={{
              position: "absolute",
              bottom: progress > 0 ? 9 : 6,
              right: 6,
              padding: "2px 6px",
              borderRadius: 4,
              background: "rgba(0,0,0,0.8)",
              color: "#fff",
              fontSize: 11,
              fontWeight: 600,
              zIndex: 3,
            }}
          >
            {formatDurationDetailed(video.duration)}
          </div>
        )}
      </div>

      {/* ì •ë³´ */}
      <div
        style={{
          flex: 1,
          minWidth: 0,
          display: "flex",
          flexDirection: "column",
          justifyContent: "center",
          position: "relative",
          zIndex: 1,
        }}
      >
        <div
          style={{
            fontSize: 15,
            fontWeight: isCurrent ? 700 : 600,
            color: "#fff",
            marginBottom: 4,
            display: "-webkit-box",
            WebkitLineClamp: 2,
            WebkitBoxOrient: "vertical",
            overflow: "hidden",
            lineHeight: 1.4,
            textShadow: "0 1px 2px rgba(0,0,0,0.5)",
          }}
        >
          {video.title}
        </div>
      </div>
    </Link>
  );
}

export default function SessionDetailPage() {
  const { sessionId } = useParams<{ sessionId: string }>();
  const [searchParams] = useSearchParams();
  const nav = useNavigate();
  
  const sessionIdNum = sessionId ? parseInt(sessionId, 10) : null;
  const enrollmentId = searchParams.get("enrollment") ? parseInt(searchParams.get("enrollment")!, 10) : null;
  
  // í˜„ì¬ ì¬ìƒ ì¤‘ì¸ ì˜ìƒ ID (localStorageì—ì„œ ê°€ì ¸ì˜¤ê¸° - VideoPlayerPageì—ì„œ ì„¤ì •)
  // useMemo ëŒ€ì‹  useState + useEffect ì‚¬ìš©í•˜ì—¬ Hook ìˆœì„œ ì¼ê´€ì„± ìœ ì§€
  const [currentVideoId, setCurrentVideoId] = useState<number | null>(null);
  
  useEffect(() => {
    try {
      const stored = localStorage.getItem("student_current_video_id");
      setCurrentVideoId(stored ? parseInt(stored, 10) : null);
    } catch {
      setCurrentVideoId(null);
    }
    
    // localStorage ë³€ê²½ ê°ì§€ (ë‹¤ë¥¸ íƒ­/ì°½ì—ì„œ ë³€ê²½ ì‹œ)
    const handleStorageChange = (e: StorageEvent) => {
      if (e.key === "student_current_video_id") {
        try {
          setCurrentVideoId(e.newValue ? parseInt(e.newValue, 10) : null);
        } catch {
          setCurrentVideoId(null);
        }
      }
    };
    
    window.addEventListener("storage", handleStorageChange);
    return () => window.removeEventListener("storage", handleStorageChange);
  }, []);

  const { data: videosData, isLoading, isError, error } = useQuery({
    queryKey: ["student-session-videos", sessionIdNum, enrollmentId],
    queryFn: () => fetchStudentSessionVideos(sessionIdNum!, enrollmentId),
    enabled: !!sessionIdNum,
    retry: false,
  });

  const videos = videosData?.items ?? [];
  const res = (error as { response?: { status?: number; data?: { detail?: unknown } } })?.response;
  const is403 = isError && res?.status === 403;
  const serverMessage =
    typeof res?.data?.detail === "string"
      ? res.data.detail
      : Array.isArray(res?.data?.detail)
        ? String(res.data.detail[0] ?? "")
        : null;

  if (isLoading) {
    return (
      <StudentPageShell title="" noSectionFrame>
        <div className="video-page-content" style={{ padding: "var(--stu-space-4)" }}>
          <div className="stu-skel" style={{ height: 200, borderRadius: "var(--stu-radius-lg)" }} />
          <div className="stu-skel" style={{ height: 100, marginTop: 16, borderRadius: "var(--stu-radius-lg)" }} />
        </div>
      </StudentPageShell>
    );
  }

  if (is403) {
    return (
      <StudentPageShell title="" noSectionFrame>
        <div className="video-page-content" style={{ padding: "var(--stu-space-4)" }}>
          <EmptyState
            title="ì˜ìƒì„ ë³¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
            description={serverMessage || "ì´ ì°¨ì‹œì˜ ì˜ìƒì„ ë³¼ ìˆ˜ ìˆëŠ” ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ìˆ˜ê°• ì¤‘ì¸ ê°•ì˜ì¸ì§€ í™•ì¸í•˜ê±°ë‚˜, ì„ ìƒë‹˜ì—ê²Œ ë¬¸ì˜í•´ ì£¼ì„¸ìš”."}
          />
        </div>
      </StudentPageShell>
    );
  }

  if (isError && !is403) {
    return (
      <StudentPageShell title="" noSectionFrame>
        <div className="video-page-content" style={{ padding: "var(--stu-space-4)" }}>
          <EmptyState
            title="ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨"
            description={serverMessage || "ì˜ìƒ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”."}
          />
        </div>
      </StudentPageShell>
    );
  }

  if (!sessionIdNum || videos.length === 0) {
    return (
      <StudentPageShell title="" noSectionFrame>
        <div className="video-page-content" style={{ padding: "var(--stu-space-4)" }}>
          <EmptyState
            title="ì°¨ì‹œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
            description="ì°¨ì‹œê°€ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤."
          />
        </div>
      </StudentPageShell>
    );
  }

  return (
    <StudentPageShell title="" noSectionFrame>
      <div className="video-page-content" style={{ padding: "var(--stu-space-4)" }}>
        {/* í•˜ë‹¨: ì˜ìƒ ëª©ë¡ (í° ì¸ë„¤ì¼ ë°°ë„ˆ ì œê±°) */}
        <div>
          <h2
            style={{
              fontSize: 18,
              fontWeight: 700,
              color: "#fff",
              marginBottom: "var(--stu-space-4)",
            }}
          >
            ì˜ìƒ ëª©ë¡
          </h2>

          <div
            style={{
              display: "flex",
              flexDirection: "column",
              gap: "var(--stu-space-3)",
            }}
          >
            {videos.map((video) => {
              // ë°±ì—”ë“œì—ì„œ ë°›ì€ progress ì‚¬ìš© (0-100)
              const progress = video.progress ?? 0;
              const isCurrent = currentVideoId === video.id;
              
              return (
                <VideoListItem
                  key={video.id}
                  video={video}
                  enrollmentId={enrollmentId}
                  isCurrent={isCurrent}
                  progress={progress}
                />
              );
            })}
          </div>
        </div>
      </div>
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: video/pages/VideoHomePage.tsx
==========================================================================================
/**
 * ì˜ìƒ í™ˆ â€” í”„ë¦¬ë¯¸ì—„ SaaS ì¸ê°• ëŠë‚Œì˜ ì½”ìŠ¤ ì¹´ë“œ UI
 * ì „ì²´ê³µê°œì˜ìƒ(ë§¨ìœ„) + ê°•ì˜ë³„ ì½”ìŠ¤ ì¹´ë“œ
 */
import { useMemo } from "react";
import { useQuery } from "@tanstack/react-query";
import { fetchVideoMe, fetchStudentSessionVideos } from "../api/video";
import EmptyState from "@/student/shared/ui/layout/EmptyState";
import CourseCard from "../components/CourseCard";

// ì „ì²´ê³µê°œì˜ìƒ ì„¸ì…˜ìš© ì½”ìŠ¤ ì¹´ë“œ ë°ì´í„° ê³„ì‚°
function usePublicCourseCard(publicSession: { session_id: number } | null) {
  const { data: videosData } = useQuery({
    queryKey: ["student-session-videos", publicSession?.session_id, null],
    queryFn: () => fetchStudentSessionVideos(publicSession!.session_id, null),
    enabled: !!publicSession?.session_id,
  });

  return useMemo(() => {
    if (!videosData?.items || videosData.items.length === 0) return null;
    
    const videos = videosData.items;
    const totalDuration = videos.reduce((sum, v) => sum + ((v as { duration?: number }).duration ?? 0), 0);
    const firstVideo = videos[0];
    
    return {
      title: "ì „ì²´ê³µê°œì˜ìƒ",
      thumbnailUrl: firstVideo.thumbnail_url,
      videoCount: videos.length,
      totalDuration,
      progress: 0, // TODO: ì§„í–‰ë¥  ê³„ì‚°
      isNew: false,
      isContinue: false,
      isCompleted: false,
      to: `/student/video/courses/public`,
    };
  }, [videosData]);
}

// ê°•ì˜ë³„ ì½”ìŠ¤ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸ (hookì„ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ í˜¸ì¶œ)
function LectureCourseCard({ lecture }: { lecture: { id: number; title: string; sessions: Array<{ id: number }> } }) {
  const sessionIds = lecture.sessions.map((s) => s.id);
  const sessionQueries = useQuery({
    queryKey: ["student-lecture-videos", lecture.id],
    queryFn: async () => {
      const allVideos: Array<{ duration?: number; thumbnail_url?: string | null; id: number }> = [];
      for (const sessionId of sessionIds) {
        const res = await fetchStudentSessionVideos(sessionId, null);
        allVideos.push(...res.items);
      }
      return allVideos;
    },
    enabled: sessionIds.length > 0,
  });

  const cardData = useMemo(() => {
    if (!sessionQueries.data || sessionQueries.data.length === 0) return null;
    
    const videos = sessionQueries.data;
    const totalDuration = videos.reduce((sum, v) => sum + (v.duration ?? 0), 0);
    const firstVideo = videos[0];
    
    return {
      title: lecture.title,
      thumbnailUrl: firstVideo.thumbnail_url,
      videoCount: videos.length,
      totalDuration,
      progress: 0, // TODO: ì§„í–‰ë¥  ê³„ì‚°
      isNew: false,
      isContinue: false,
      isCompleted: false,
      to: `/student/video/courses/${lecture.id}`,
    };
  }, [lecture, sessionQueries.data]);

  if (!cardData) return null;

  return (
    <CourseCard
      title={cardData.title}
      thumbnailUrl={cardData.thumbnailUrl}
      videoCount={cardData.videoCount}
      totalDuration={cardData.totalDuration}
      progress={cardData.progress}
      isNew={cardData.isNew}
      isContinue={cardData.isContinue}
      isCompleted={cardData.isCompleted}
      to={cardData.to}
    />
  );
}

export default function VideoHomePage() {
  const { data: videoMe, isLoading, isError } = useQuery({
    queryKey: ["student-video-me"],
    queryFn: fetchVideoMe,
  });

  // ì „ì²´ê³µê°œì˜ìƒ: ë‚´ìš©ë¬¼ì´ ìˆë˜ ì—†ë˜ í•­ìƒ ì¹´ë“œ í‘œì‹œ
  const publicCard = usePublicCourseCard(videoMe?.public ?? null);
  // publicì´ nullì´ì–´ë„ ì „ì²´ê³µê°œì˜ìƒ ì¹´ë“œëŠ” í‘œì‹œ (ë‚´ìš© ì—†ìœ¼ë©´ ë¹ˆ ìƒíƒœ)
  const shouldShowPublicCard = true; // í•­ìƒ í‘œì‹œ

  const hasLectures = (videoMe?.lectures?.length ?? 0) > 0;
  const hasAny = shouldShowPublicCard || hasLectures;

  if (isLoading) {
    return (
      <div className="video-page-content" style={{ padding: "var(--stu-space-4)" }}>
        <div className="stu-skel" style={{ height: 200, borderRadius: "var(--stu-radius-lg)" }} />
        <div className="stu-skel" style={{ height: 200, marginTop: 16, borderRadius: "var(--stu-radius-lg)" }} />
      </div>
    );
  }

  if (isError || !hasAny) {
    return (
      <div className="video-page-content" style={{ padding: "var(--stu-space-4)" }}>
        <EmptyState
          title="ë“±ë¡ëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤"
          description="ì „ì²´ê³µê°œ ì˜ìƒì´ë‚˜ ìˆ˜ê°• ì¤‘ì¸ ê°•ì˜ì˜ ì°¨ì‹œ ì˜ìƒì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."
        />
      </div>
    );
  }

  return (
    <div className="video-page-content" style={{ 
      padding: "var(--stu-space-4)",
    }}>
      <h1
        className="video-page-title"
        style={{
          fontSize: 24,
          fontWeight: 800,
          marginBottom: "var(--stu-space-6)",
        }}
      >
        ìˆ˜ê°• ê°€ëŠ¥í•œ ê°•ì˜
      </h1>

      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fill, minmax(160px, 1fr))",
          gap: 16,
        }}
      >
        {/* ì „ì²´ê³µê°œì˜ìƒ ì½”ìŠ¤ ì¹´ë“œ - ë‚´ìš©ë¬¼ì´ ìˆë˜ ì—†ë˜ í•­ìƒ í‘œì‹œ */}
        {shouldShowPublicCard && (
          <CourseCard
            title={publicCard?.title ?? "ì „ì²´ê³µê°œì˜ìƒ"}
            thumbnailUrl={publicCard?.thumbnailUrl ?? null}
            videoCount={publicCard?.videoCount ?? 0}
            totalDuration={publicCard?.totalDuration ?? 0}
            progress={publicCard?.progress ?? 0}
            isNew={publicCard?.isNew ?? false}
            isContinue={publicCard?.isContinue ?? false}
            isCompleted={publicCard?.isCompleted ?? false}
            to={publicCard?.to ?? "/student/video/courses/public"}
          />
        )}

        {/* ê°•ì˜ë³„ ì½”ìŠ¤ ì¹´ë“œ */}
        {(videoMe?.lectures ?? []).map((lec) => (
          <LectureCourseCard key={lec.id} lecture={lec} />
        ))}
      </div>
    </div>
  );
}


==========================================================================================
# FILE: video/pages/VideoPlayerPage.tsx
==========================================================================================
// PATH: src/student/domains/video/pages/VideoPlayerPage.tsx
import { useCallback, useEffect, useMemo, useRef, useState } from "react";
import { useLocation, useNavigate, useParams } from "react-router-dom";

import StudentPageShell from "../../../shared/ui/pages/StudentPageShell";
import EmptyState from "../../../shared/ui/layout/EmptyState";
import { fetchStudentVideoPlayback, fetchStudentSessionVideos, updateVideoProgress } from "../api/video";
import { IconCheck, IconRefresh, IconArrowRight, IconPlay } from "@/student/shared/ui/icons/Icons";
import { Link } from "react-router-dom";
import { useMutation, useQueryClient } from "@tanstack/react-query";

import StudentVideoPlayer, {
  PlaybackBootstrap,
  VideoMetaLite,
} from "../playback/player/StudentVideoPlayer";
import { safeParseInt } from "../playback/player/design/utils";

function useQueryParams() {
  const { search } = useLocation();
  return useMemo(() => new URLSearchParams(search), [search]);
}

export default function VideoPlayerPage() {
  const nav = useNavigate();
  const q = useQueryParams();
  const params = useParams();
  const queryClient = useQueryClient();

  const videoId =
    safeParseInt(params.videoId) ??
    safeParseInt(q.get("video")) ??
    safeParseInt(q.get("video_id"));

  const rawEnrollmentId =
    safeParseInt(q.get("enrollment")) ??
    safeParseInt(q.get("enrollment_id")) ??
    safeParseInt(params.enrollmentId);
  const enrollmentId = rawEnrollmentId != null && Number.isFinite(rawEnrollmentId) ? rawEnrollmentId : null;

  const [loading, setLoading] = useState(true);
  const [err, setErr] = useState<string | null>(null);
  const [video, setVideo] = useState<(VideoMetaLite & { 
    description?: string | null;
    created_at?: string | null;
    view_count?: number | null;
    tags?: string[];
    session_id?: number;
  }) | null>(null);
  const [boot, setBoot] = useState<PlaybackBootstrap | null>(null);
  const [playbackData, setPlaybackData] = useState<any>(null);

  useEffect(() => {
    let alive = true;

    async function run() {
      setLoading(true);
      setErr(null);

      if (!videoId) {
        setLoading(false);
        setErr("video_idê°€ í•„ìš”í•©ë‹ˆë‹¤.");
        return;
      }

      // í˜„ì¬ ì¬ìƒ ì¤‘ì¸ ì˜ìƒ IDë¥¼ localStorageì— ì €ì¥ (SessionDetailPageì—ì„œ ì‚¬ìš©)
      try {
        localStorage.setItem("student_current_video_id", String(videoId));
      } catch (e) {
        console.warn("[VideoPlayerPage] Failed to save current video ID:", e);
      }

      try {
        // í•™ìƒ ì•± ì „ìš© API: ë¹„ë””ì˜¤ ì •ë³´ì™€ ì¬ìƒ ì •ë³´ë¥¼ í•œ ë²ˆì— ê°€ì ¸ì˜¤ê¸°
        const playbackData = await fetchStudentVideoPlayback(videoId, enrollmentId || undefined);
        
        if (!alive) return;

        // ë¹„ë””ì˜¤ ì •ë³´ ì¶”ì¶œ
        const vd = playbackData?.video;
        if (!vd || typeof vd.id === "undefined") {
          setErr("ì¬ìƒ ì •ë³´ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
          setLoading(false);
          return;
        }
        const v: VideoMetaLite & {
          description?: string | null;
          created_at?: string | null;
          view_count?: number | null;
          tags?: string[];
          session_id?: number;
        } = {
          id: Number(vd.id),
          title: String(vd.title ?? "ì˜ìƒ"),
          duration: vd.duration == null ? null : Number(vd.duration),
          status: String(vd.status ?? ""),
          thumbnail_url: vd.thumbnail_url ?? null,
          hls_url: playbackData.hls_url ?? null,
          description: (vd as Record<string, unknown>).description ?? null,
          created_at: (vd as Record<string, unknown>).created_at ?? null,
          view_count: (vd as Record<string, unknown>).view_count ?? null,
          tags: Array.isArray((vd as Record<string, unknown>).tags) ? (vd as Record<string, unknown>).tags as string[] : [],
          session_id: Number(vd.session_id),
        };

        // playbackData ì €ì¥ (ë‹¤ìŒ ê°•ì˜ ì°¾ê¸°ìš©)
        setPlaybackData(playbackData);

        // ì¬ìƒ URL í™•ì¸ (play_url ìš°ì„ , ì—†ìœ¼ë©´ hls_url ë˜ëŠ” mp4_url)
        const playUrl = playbackData.play_url || playbackData.hls_url || playbackData.mp4_url || "";
        
        if (!playUrl) {
          const videoStatus = playbackData?.video?.status;
          const detail = (playbackData as { detail?: string })?.detail ?? "";
          
          // ë°±ì—”ë“œì—ì„œ ì œê³µí•œ ìƒì„¸ ì—ëŸ¬ ë©”ì‹œì§€ê°€ ìˆìœ¼ë©´ ì‚¬ìš©
          if (detail) {
            setErr(detail);
          } else if (videoStatus && videoStatus !== "READY") {
            setErr(`ë¹„ë””ì˜¤ê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. (ìƒíƒœ: ${videoStatus})`);
          } else {
            setErr("ì¬ìƒ URLì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¹„ë””ì˜¤ íŒŒì¼ì´ ì²˜ë¦¬ ì¤‘ì´ê±°ë‚˜ ì—…ë¡œë“œë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
          }
          setLoading(false);
          return;
        }

        // Bootstrap ì •ë³´ ìƒì„±
        const b: PlaybackBootstrap = {
          token: `student-${videoId}-${Date.now()}`, // í•™ìƒ ì•±ìš© ì„ì‹œ token (ì„¸ì…˜ ê´€ë¦¬ ë¶ˆí•„ìš”)
          session_id: null,
          expires_at: null,
          access_mode: playbackData.policy?.access_mode || "FREE_REVIEW",
          monitoring_enabled: playbackData.policy?.monitoring_enabled ?? false,
          policy: playbackData.policy || {},
          play_url: playUrl,
        };

        setVideo(v);
        setBoot(b);
        setLoading(false);
      } catch (e: any) {
        if (!alive) return;
        console.error("[VideoPlayerPage] Error loading playback:", e);
        const msg =
          e?.response?.data?.detail ||
          e?.response?.data?.message ||
          e?.message ||
          "ì¬ìƒ í˜ì´ì§€ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
        setErr(String(msg));
        setLoading(false);
      }
    }

    run();

    return () => {
      alive = false;
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [videoId, enrollmentId]);

  // ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œ í˜„ì¬ ë¹„ë””ì˜¤ ID ì œê±°
  useEffect(() => {
    return () => {
      try {
        localStorage.removeItem("student_current_video_id");
      } catch (e) {
        // Ignore
      }
    };
  }, []);

  // ë‹¤ìŒ ê°•ì˜ ì°¾ê¸°: useQuery ì œê±° â†’ 1íšŒ fetchë§Œ (setData ì—°ì‡„ ë¦¬ë Œë”ë¡œ #310 ë°œìƒ ë°©ì§€)
  const sessionId = video?.session_id ?? null;
  const [sessionVideosData, setSessionVideosData] = useState<{ items: { id: number; title?: string; [k: string]: unknown }[] } | null>(null);

  useEffect(() => {
    if (!sessionId || !videoId) {
      setSessionVideosData(null);
      return;
    }
    let cancelled = false;
    fetchStudentSessionVideos(sessionId, enrollmentId ?? undefined)
      .then((res) => {
        if (!cancelled) setSessionVideosData(res);
      })
      .catch(() => {
        if (!cancelled) setSessionVideosData(null);
      });
    return () => { cancelled = true; };
  }, [sessionId, enrollmentId, videoId]);

  const nextVideo = useMemo(() => {
    if (!sessionVideosData?.items?.length || !videoId) return null;
    const videos = sessionVideosData.items;
    const currentIndex = videos.findIndex((v: { id: number }) => v.id === videoId);
    if (currentIndex >= 0 && currentIndex < videos.length - 1) {
      return videos[currentIndex + 1];
    }
    return null;
  }, [sessionVideosData, videoId]);

  const progressMutation = useMutation({
    mutationFn: (data: { progress?: number; completed?: boolean; last_position?: number }) => {
      if (!videoId) throw new Error("videoIdê°€ í•„ìš”í•©ë‹ˆë‹¤.");
      return updateVideoProgress(videoId, data);
    },
    onSuccess: () => {
      if (sessionId == null) return;
      const key = ["student-session-videos", sessionId, enrollmentId] as const;
      setTimeout(() => queryClient.invalidateQueries({ queryKey: key }), 0);
    },
  });

  const progressMutationRef = useRef(progressMutation);
  progressMutationRef.current = progressMutation;

  const onFatal = useCallback((reason: string) => setErr(reason), []);

  // ì§„í–‰ë¥  ì „ë‹¬ ì½œë°±: videoIdë§Œ depsë¡œ ê³ ì • â†’ progressMutation ì°¸ì¡° ë³€ê²½ ì‹œì—ë„ ì½œë°± ì•ˆì • (React #310 ë°©ì§€)
  const onLeaveProgress = useCallback(
    (data: { progress?: number; completed?: boolean; last_position?: number }) => {
      if (!videoId) return;
      progressMutationRef.current.mutate({
        progress: data.progress,
        last_position: data.last_position,
        completed: data.completed,
      });
    },
    [videoId]
  );

  // ìˆ˜ê°• ì™„ë£Œ ì²˜ë¦¬
  const handleComplete = () => {
    if (!videoId || !video) return;
    progressMutation.mutate({
      progress: 100,
      completed: true,
    });
  };

  // ë‹¤ì‹œë³´ê¸° ì²˜ë¦¬ (ì§„í–‰ë¥  ì´ˆê¸°í™”)
  const handleRewatch = () => {
    if (!videoId || !video) return;
    progressMutation.mutate({
      progress: 0,
      completed: false,
      last_position: 0,
    });
  };

  return (
    <div className="video-page-content" style={{ padding: "var(--stu-space-4)" }}>
      <div style={{ maxWidth: 1400, margin: "0 auto" }}>
        <div style={{ marginBottom: "var(--stu-space-4)", display: "flex", alignItems: "center", justifyContent: "space-between" }}>
          <button
            type="button"
            onClick={() => nav(-1)}
            style={{
              padding: "8px 16px",
              borderRadius: 8,
              border: "1px solid rgba(255,255,255,0.2)",
              background: "rgba(255,255,255,0.1)",
              color: "#fff",
              fontWeight: 600,
              cursor: "pointer",
              fontSize: 14,
            }}
          >
            â† ë’¤ë¡œ
          </button>
          {video && (
            <h1 style={{ fontSize: 18, fontWeight: 700, color: "#fff", margin: 0 }}>
              {video.title}
            </h1>
          )}
          <div style={{ width: 80 }} />
        </div>
      {loading ? (
        <div style={{ padding: 8 }}>
          <div
            style={{
              height: 520,
              borderRadius: 14,
              border: "1px solid #eee",
              background:
                "linear-gradient(90deg, #f3f3f3, #fafafa, #f3f3f3)",
              backgroundSize: "200% 100%",
              animation: "mediaShimmer 1.1s ease-in-out infinite",
            }}
          />
          <style>{`
            @keyframes mediaShimmer {
              0% { background-position: 200% 0; }
              100% { background-position: -200% 0; }
            }
          `}</style>
        </div>
      ) : err ? (
        <EmptyState
          title="ì¬ìƒì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
          description={err}
        />
      ) : video && boot ? (
        <>
          {/* ìƒë‹¨: ì˜ìƒ í”Œë ˆì´ì–´ */}
          <StudentVideoPlayer
            video={video}
            bootstrap={boot}
            enrollmentId={enrollmentId ? Number(enrollmentId) : 0}
            onFatal={onFatal}
            onLeaveProgress={onLeaveProgress}
          />
          
          {/* í•˜ë‹¨: í–‰ë™ ì¤‘ì‹¬ UI (YouTube SaaS ìŠ¤íƒ€ì¼) */}
          <div
            style={{
              marginTop: "var(--stu-space-6)",
            }}
          >
            {/* ì œëª© ë° í–‰ë™ ë²„íŠ¼ */}
            <div
              style={{
                display: "flex",
                alignItems: "center",
                justifyContent: "space-between",
                marginBottom: "var(--stu-space-4)",
                flexWrap: "wrap",
                gap: "var(--stu-space-3)",
              }}
            >
              <h2
                style={{
                  fontSize: 18,
                  fontWeight: 700,
                  color: "#fff",
                  margin: 0,
                }}
              >
                {video.title}
              </h2>
              
              {/* í–‰ë™ ë²„íŠ¼ ê·¸ë£¹ */}
              <div
                style={{
                  display: "flex",
                  gap: "var(--stu-space-2)",
                  flexWrap: "wrap",
                }}
              >
                {/* ìˆ˜ê°• ì™„ë£Œ ë²„íŠ¼ */}
                <button
                  type="button"
                  onClick={handleComplete}
                  disabled={progressMutation.isPending}
                  style={{
                    display: "flex",
                    alignItems: "center",
                    gap: 6,
                    padding: "8px 16px",
                    borderRadius: 8,
                    background: "rgba(255,255,255,0.1)",
                    border: "1px solid rgba(255,255,255,0.2)",
                    color: "#fff",
                    fontSize: 14,
                    fontWeight: 600,
                    cursor: "pointer",
                    transition: "all 0.2s ease",
                  }}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.background = "rgba(255,255,255,0.15)";
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.background = "rgba(255,255,255,0.1)";
                  }}
                >
                  <IconCheck style={{ width: 18, height: 18 }} />
                  <span>ìˆ˜ê°• ì™„ë£Œ</span>
                </button>
                
                {/* ë‹¤ì‹œë³´ê¸° ë²„íŠ¼ */}
                <button
                  type="button"
                  onClick={handleRewatch}
                  disabled={progressMutation.isPending}
                  style={{
                    display: "flex",
                    alignItems: "center",
                    gap: 6,
                    padding: "8px 16px",
                    borderRadius: 8,
                    background: "rgba(255,255,255,0.1)",
                    border: "1px solid rgba(255,255,255,0.2)",
                    color: "#fff",
                    fontSize: 14,
                    fontWeight: 600,
                    cursor: "pointer",
                    transition: "all 0.2s ease",
                  }}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.background = "rgba(255,255,255,0.15)";
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.background = "rgba(255,255,255,0.1)";
                  }}
                >
                  <IconRefresh style={{ width: 18, height: 18 }} />
                  <span>ë‹¤ì‹œë³´ê¸°</span>
                </button>
                
                {/* ë‹¤ìŒ ê°•ì˜ ë²„íŠ¼ */}
                {nextVideo ? (
                  <Link
                    to={`/student/video/play?video=${nextVideo.id}${enrollmentId ? `&enrollment=${enrollmentId}` : ""}`}
                    style={{
                      display: "flex",
                      alignItems: "center",
                      gap: 6,
                      padding: "8px 16px",
                      borderRadius: 8,
                      background: "var(--stu-primary)",
                      border: "none",
                      color: "#fff",
                      fontSize: 14,
                      fontWeight: 600,
                      cursor: "pointer",
                      textDecoration: "none",
                      transition: "all 0.2s ease",
                    }}
                    onMouseEnter={(e) => {
                      e.currentTarget.style.opacity = "0.9";
                      e.currentTarget.style.transform = "translateY(-1px)";
                    }}
                    onMouseLeave={(e) => {
                      e.currentTarget.style.opacity = "1";
                      e.currentTarget.style.transform = "translateY(0)";
                    }}
                  >
                    <span>ë‹¤ìŒ ê°•ì˜</span>
                    <IconArrowRight style={{ width: 18, height: 18 }} />
                  </Link>
                ) : (
                  <div
                    style={{
                      display: "flex",
                      alignItems: "center",
                      gap: 6,
                      padding: "8px 16px",
                      borderRadius: 8,
                      background: "rgba(255,255,255,0.05)",
                      border: "1px solid rgba(255,255,255,0.1)",
                      color: "rgba(255,255,255,0.5)",
                      fontSize: 14,
                      fontWeight: 600,
                      cursor: "not-allowed",
                    }}
                  >
                    <span>ë‹¤ìŒ ê°•ì˜</span>
                    <IconArrowRight style={{ width: 18, height: 18 }} />
                  </div>
                )}
              </div>
            </div>
            
            {/* êµ¬ë¶„ì„  */}
            <div
              style={{
                height: 1,
                background: "rgba(255,255,255,0.1)",
                marginBottom: "var(--stu-space-4)",
              }}
            />
            
            {/* ìë™ ì¬ìƒ ì•ˆë‚´ (ë‹¤ìŒ ê°•ì˜ê°€ ìˆì„ ë•Œë§Œ) */}
            {nextVideo && (
              <div
                style={{
                  padding: "var(--stu-space-3)",
                  borderRadius: 8,
                  background: "rgba(255,255,255,0.03)",
                  border: "1px solid rgba(255,255,255,0.05)",
                  fontSize: 14,
                  color: "rgba(255,255,255,0.7)",
                  display: "flex",
                  alignItems: "center",
                  gap: 8,
                }}
              >
                <IconPlay style={{ width: 16, height: 16, opacity: 0.6 }} />
                <span>ë‹¤ìŒ ê°•ì˜ ìë™ì¬ìƒ ON</span>
                <span style={{ opacity: 0.5 }}>Â·</span>
                <span style={{ opacity: 0.5 }}>5ì´ˆ í›„ ì¬ìƒ</span>
              </div>
            )}
          </div>
        </>
      ) : (
        <EmptyState title="ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤" description="ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”." />
      )}
      </div>
    </div>
  );
}


==========================================================================================
# FILE: video/playback/player/StudentVideoPlayer.tsx
==========================================================================================
// PATH: src/student/domains/video/playback/player/StudentVideoPlayer.tsx
import { useCallback, useEffect, useMemo, useRef, useState } from "react";
import studentApi from "@/student/shared/api/studentApi";

import "./player.css";

import {
  clamp,
  formatClock,
  formatDateTimeKorean,
  getEpochSec,
  getOrCreateDeviceId,
  safeParseFloat,
  safeParseInt,
} from "./design/utils";
import {
  IconButton,
  KebabMenu,
  MenuItem,
  Pill,
  PlayerToast,
  RangeSlider,
} from "./design/ui";

/**
 * âœ… SSOT: Backend playback/start returns policy + play_url
 * - FrontendëŠ” ì†Œë¹„ë§Œ í•œë‹¤ (íŒë‹¨/ê³„ì‚° ìµœì†Œ)
 * - ë‹¨, "ì •ì±… ê°•ì œ"ëŠ” í”Œë ˆì´ì–´ UXì˜ ì¼ë¶€ë¡œì„œ clientì—ì„œ ë§‰ëŠ”ë‹¤ (íƒìƒ‰/ë°°ì†/í‘œì‹œ)
 */

export type VideoMetaLite = {
  id: number;
  title: string;
  duration: number | null;
  status?: string;
  thumbnail_url?: string | null;
  hls_url?: string | null;
};

export type PlaybackBootstrap = {
  token: string;
  session_id: string | null;  // null for FREE_REVIEW
  expires_at: number | null;  // null for FREE_REVIEW
  access_mode: "FREE_REVIEW" | "PROCTORED_CLASS";
  monitoring_enabled: boolean;
  policy: any;
  play_url: string;
};

export type LeaveProgressPayload = {
  progress?: number;
  last_position?: number;
  completed?: boolean;
};

type Props = {
  video: VideoMetaLite;
  bootstrap: PlaybackBootstrap;
  enrollmentId: number;
  onFatal?: (reason: string) => void;
  /** ë‚˜ê°ˆ ë•Œ(ì–¸ë§ˆìš´íŠ¸) í˜„ì¬ ì‹œì²­ ìœ„ì¹˜ë¡œ ìë™ ì €ì¥ìš© */
  onLeaveProgress?: (data: LeaveProgressPayload) => void;
};

import type { AccessMode } from "@/features/videos/types/access-mode";

type Policy = {
  access_mode?: AccessMode;
  monitoring_enabled?: boolean;  // true only for PROCTORED_CLASS
  allow_seek?: boolean;
  seek?: {
    mode?: "free" | "blocked" | "bounded_forward";
    forward_limit?: "max_watched" | null;
    grace_seconds?: number;
  };
  playback_rate?: {
    max?: number;
    ui_control?: boolean;
  };
  watermark?: {
    enabled?: boolean;
    mode?: "overlay";
    fields?: string[];
  };
  concurrency?: {
    max_sessions?: number;
    max_devices?: number;
  };
};

type EventType =
  | "VISIBILITY_HIDDEN"
  | "VISIBILITY_VISIBLE"
  | "FOCUS_LOST"
  | "FOCUS_GAINED"
  | "SEEK_ATTEMPT"
  | "SPEED_CHANGE_ATTEMPT"
  | "FULLSCREEN_ENTER"
  | "FULLSCREEN_EXIT"
  | "PLAYER_ERROR";

function normalizePolicy(p: any): Policy {
  const policy = (p || {}) as Policy;
  policy.seek = (policy.seek || {}) as any;
  policy.playback_rate = (policy.playback_rate || {}) as any;
  policy.watermark = (policy.watermark || {}) as any;

  if (policy.monitoring_enabled == null) {
    policy.monitoring_enabled = policy.access_mode === "PROCTORED_CLASS";
  }
  if (policy.allow_seek == null) policy.allow_seek = true;
  if (!policy.seek) policy.seek = { mode: "free", grace_seconds: 3 };
  if (!policy.seek?.mode) policy.seek!.mode = "free";
  if (policy.seek?.grace_seconds == null) policy.seek!.grace_seconds = 3;

  if (policy.playback_rate?.max == null) policy.playback_rate = { ...policy.playback_rate, max: 16 };
  if (policy.playback_rate?.ui_control == null) policy.playback_rate = { ...policy.playback_rate, ui_control: true };

  if (policy.watermark?.enabled == null) policy.watermark = { ...policy.watermark, enabled: false };

  return policy;
}

/**
 * í•™ìƒ ì•±ì—ì„œëŠ” ì„¸ì…˜ ê´€ë¦¬ APIê°€ í•„ìš” ì—†ì„ ìˆ˜ ìˆìŒ
 * tokenì´ "student-" ì ‘ë‘ì‚¬ë¡œ ì‹œì‘í•˜ë©´ ìŠ¤í‚µ
 */
async function postHeartbeat(token: string) {
  if (token.startsWith("student-")) return; // í•™ìƒ ì•±ìš© ì„ì‹œ tokenì€ ìŠ¤í‚µ
  try {
    await studentApi.post(`/api/v1/videos/playback/heartbeat/`, { token });
  } catch (e) {
    // ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰
  }
}

async function postRefresh(token: string) {
  if (token.startsWith("student-")) return;
  try {
    await studentApi.post(`/api/v1/videos/playback/refresh/`, { token });
  } catch (e) {
    // ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰
  }
}

async function postEnd(token: string) {
  if (token.startsWith("student-")) return;
  try {
    await studentApi.post(`/api/v1/videos/playback/end/`, { token });
  } catch (e) {
    // ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰
  }
}

async function postEvents(
  token: string,
  events: Array<{ type: EventType; occurred_at: number; payload?: any }>,
  videoId: number,
  enrollmentId: number
) {
  if (!events.length) return;
  if (token.startsWith("student-")) return; // í•™ìƒ ì•±ìš© ì„ì‹œ tokenì€ ìŠ¤í‚µ
  try {
    await studentApi.post(`/api/v1/videos/playback/events/`, {
      token,
      video_id: videoId,
      enrollment_id: enrollmentId,
      events: events.map((e) => ({
        type: e.type,
        occurred_at: e.occurred_at,
        payload: e.payload || {},
      })),
    });
  } catch (e) {
    // ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰
  }
}

function useStableInterval(cb: () => void, ms: number, enabled: boolean) {
  const ref = useRef(cb);
  ref.current = cb;

  useEffect(() => {
    if (!enabled) return;
    const id = window.setInterval(() => ref.current(), ms);
    return () => window.clearInterval(id);
  }, [ms, enabled]);
}

export default function StudentVideoPlayer({ video, bootstrap, enrollmentId, onFatal, onLeaveProgress }: Props) {
  const onFatalRef = useRef(onFatal);
  onFatalRef.current = onFatal;

  const policy = useMemo(() => normalizePolicy(bootstrap.policy), [bootstrap.policy]);

  const allowSeek = !!policy.allow_seek && policy.seek?.mode !== "blocked";
  const seekMode = policy.seek?.mode || "free";
  const grace = Math.max(0, Number(policy.seek?.grace_seconds ?? 3));
  const boundedForward = seekMode === "bounded_forward";

  const speedUi = policy.playback_rate?.ui_control !== false;
  const maxRate = Math.max(1, safeParseFloat(policy.playback_rate?.max, 1) || 1);
  const speedLocked = !speedUi || maxRate <= 1.0001;

  const watermarkEnabled = !!policy.watermark?.enabled;

  // UI State
  const videoEl = useRef<HTMLVideoElement | null>(null);
  const wrapEl = useRef<HTMLDivElement | null>(null);

  const [ready, setReady] = useState(false);
  const [playing, setPlaying] = useState(false);
  const [buffering, setBuffering] = useState(false);

  const [duration, setDuration] = useState<number>(video.duration ?? 0);
  const [current, setCurrent] = useState<number>(0);

  const [volume, setVolume] = useState<number>(1);
  const [muted, setMuted] = useState<boolean>(false);

  const [rate, setRate] = useState<number>(1);
  const [theater, setTheater] = useState<boolean>(false);

  const [toast, setToast] = useState<{ text: string; kind?: "info" | "warn" | "danger" } | null>(null);

  /** ëª¨ë°”ì¼ OTT: ì»¨íŠ¸ë¡¤ í‘œì‹œ ì—¬ë¶€(ì‹±ê¸€íƒ­ í† ê¸€) + ìƒíƒœë¨¸ì‹  */
  const [showControls, setShowControls] = useState(true);
  const [isFullscreen, setIsFullscreen] = useState(false);

  const maxWatchedRef = useRef<number>(0); // seconds
  const lastTimeRef = useRef<number>(0);
  const seekGuardRef = useRef<{ blocking: boolean; lastWarnAt: number }>({ blocking: false, lastWarnAt: 0 });

  const eventQueueRef = useRef<Array<{ type: EventType; occurred_at: number; payload?: any }>>([]);
  const lastTapRef = useRef<{ time: number; x: number; y: number }>({ time: 0, x: 0, y: 0 });
  const tapCountRef = useRef(0);
  const tapTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null);
  const hideControlsTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null);
  const longPressTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null);
  const savedRateRef = useRef(1);
  const gestureLayerRef = useRef<HTMLDivElement | null>(null);
  const swipeHandledRef = useRef(false);
  const touchStartRef = useRef<{ y: number; volume: number; rightHalf: boolean } | null>(null);

  const tokenRef = useRef(bootstrap.token);
  useEffect(() => {
    tokenRef.current = bootstrap.token;
  }, [bootstrap.token]);

  // ë‚˜ê°ˆ ë•Œ ì €ì¥: ì–¸ë§ˆìš´íŠ¸ + íƒ­ ì „í™˜/ì°½ ë‚´ë¦¬ê¸°(ëª¨ë°”ì¼ ì›¹ Safari ë“±) â€” DBëŠ” ì´ ì‹œì ì—ë§Œ 1íšŒ ì“°ê¸°
  const flushProgress = useCallback(() => {
    if (!onLeaveProgress) return;
    const el = videoEl.current;
    if (!el) return;
    const lastPosition = Math.max(0, maxWatchedRef.current || 0);
    const dur = Number(el.duration);
    const progressPercent =
      dur > 0 && Number.isFinite(dur) ? Math.min(100, (lastPosition / dur) * 100) : 0;
    const completed = dur > 0 && lastPosition >= dur - 0.5;
    onLeaveProgress({
      progress: progressPercent,
      last_position: Math.round(lastPosition),
      completed,
    });
  }, [onLeaveProgress]);

  const flushProgressRef = useRef(flushProgress);
  flushProgressRef.current = flushProgress;

  // Unmount ì‹œì—ë§Œ ì €ì¥. depsì— flushProgress ë„£ì§€ ì•ŠìŒ â†’ ë¶€ëª¨ ë¦¬ë Œë” ì‹œ cleanup ë°˜ë³µ ì‹¤í–‰ ë°©ì§€ (React #310)
  useEffect(() => {
    return () => { flushProgressRef.current?.(); };
  }, []);

  // Page Visibility: ë‹¤ë¥¸ íƒ­ ì´ë™Â·ì‚¬íŒŒë¦¬ ì°½ ë‚´ë¦¬ê¸° ì‹œ í•œ ë²ˆ ì €ì¥ (ëª¨ë°”ì¼ ì›¹). ref ì‚¬ìš©ìœ¼ë¡œ effect ì¬ì‹¤í–‰ ë°©ì§€
  useEffect(() => {
    const onVisibilityChange = () => {
      if (document.visibilityState === "hidden") flushProgressRef.current?.();
    };
    document.addEventListener("visibilitychange", onVisibilityChange);
    return () => document.removeEventListener("visibilitychange", onVisibilityChange);
  }, []);

  // ---------------------------------------------------------------------------
  // Fullscreen sync + body scroll lock (ëª¨ë°”ì¼ Player Mode)
  // ---------------------------------------------------------------------------
  useEffect(() => {
    const wrap = wrapEl.current;
    if (!wrap) return;

    const onFullscreenChange = () => {
      const el =
        document.fullscreenElement ||
        (document as any).webkitFullscreenElement ||
        (document as any).mozFullScreenElement;
      const active = el === wrap || (el && wrap.contains(el));
      setIsFullscreen(!!active);
      if (active) {
        document.body.style.overflow = "hidden";
        document.body.style.touchAction = "none";
        setShowControls(true);
      } else {
        document.body.style.overflow = "";
        document.body.style.touchAction = "";
      }
    };

    document.addEventListener("fullscreenchange", onFullscreenChange);
    (document as any).addEventListener?.("webkitfullscreenchange", onFullscreenChange);
    (document as any).addEventListener?.("mozfullscreenchange", onFullscreenChange);

    return () => {
      document.removeEventListener("fullscreenchange", onFullscreenChange);
      (document as any).removeEventListener?.("webkitfullscreenchange", onFullscreenChange);
      (document as any).removeEventListener?.("mozfullscreenchange", onFullscreenChange);
      document.body.style.overflow = "";
      document.body.style.touchAction = "";
    };
  }, []);

  // ---------------------------------------------------------------------------
  // Auto-hide controls: PLAYING ì‹œ 3ì´ˆ í›„ ìˆ¨ê¹€, SEEKING/GESTURE/PAUSED ì‹œ ìœ ì§€
  // ---------------------------------------------------------------------------
  useEffect(() => {
    if (hideControlsTimerRef.current) {
      clearTimeout(hideControlsTimerRef.current);
      hideControlsTimerRef.current = null;
    }
    if (playing && !buffering && showControls) {
      hideControlsTimerRef.current = window.setTimeout(() => {
        hideControlsTimerRef.current = null;
        setShowControls(false);
      }, 3000);
    }
    return () => {
      if (hideControlsTimerRef.current) clearTimeout(hideControlsTimerRef.current);
    };
  }, [playing, buffering, showControls]);

  // ---------------------------------------------------------------------------
  // HLS attach
  // ---------------------------------------------------------------------------
  const attachSource = useCallback(async () => {
    const el = videoEl.current;
    if (!el) return;

    // reset
    try {
      el.pause();
    } catch {}
    el.src = "";

    let url = bootstrap.play_url || video.hls_url || "";
    
    // ë””ë²„ê¹…: URL í™•ì¸
    console.log("[StudentVideoPlayer] attachSource:", {
      play_url: bootstrap.play_url,
      video_hls_url: video.hls_url,
      final_url: url,
      hasUrl: !!url,
    });
    
    if (!url) {
      console.error("[StudentVideoPlayer] No play URL available:", {
        bootstrap: bootstrap,
        video: video,
      });
      onFatalRef.current?.("ì¬ìƒ URLì´ ì œê³µë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. (play_url ë˜ëŠ” hls_url í•„ìš”)");
      return;
    }
    
    // ìƒëŒ€ ê²½ë¡œì¸ ê²½ìš° ì ˆëŒ€ URLë¡œ ë³€í™˜
    try {
      // ì ˆëŒ€ URLì¸ì§€ í™•ì¸
      new URL(url);
    } catch (e) {
      // ìƒëŒ€ ê²½ë¡œì¸ ê²½ìš° API ë² ì´ìŠ¤ URLê³¼ ê²°í•©
      // studentApi.defaults.baseURLì€ /api/v1ì´ í¬í•¨ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, ì§ì ‘ í™˜ê²½ ë³€ìˆ˜ ì‚¬ìš©
      const apiBase = String(import.meta.env.VITE_API_BASE_URL || "https://api.hakwonplus.com").trim();
      // baseURLì´ ì´ë¯¸ ìŠ¬ë˜ì‹œë¡œ ëë‚˜ë©´ ì œê±°, urlì´ ìŠ¬ë˜ì‹œë¡œ ì‹œì‘í•˜ë©´ ì œê±°
      const base = apiBase.endsWith("/") ? apiBase.slice(0, -1) : apiBase;
      const path = url.startsWith("/") ? url : `/${url}`;
      url = `${base}${path}`;
      console.log("[StudentVideoPlayer] Converted relative URL to absolute:", {
        original: bootstrap.play_url || video.hls_url,
        apiBase: apiBase,
        final: url,
      });
    }
    
    // ìµœì¢… URL ìœ íš¨ì„± ê²€ì‚¬
    try {
      new URL(url);
    } catch (e) {
      console.error("[StudentVideoPlayer] Invalid URL format:", url, e);
      onFatalRef.current?.(`ì˜ëª»ëœ ì¬ìƒ URL í˜•ì‹ì…ë‹ˆë‹¤: ${url}`);
      return;
    }

    // Native HLS (Safari)
    const canNative =
      el.canPlayType("application/vnd.apple.mpegurl") ||
      el.canPlayType("application/x-mpegURL");

    if (canNative) {
      el.src = url;
      return;
    }

    // Hls.js
    try {
      const mod: any = await import("hls.js");
      const Hls = mod.default;

      if (Hls && Hls.isSupported()) {
        const hls = new Hls({
          lowLatencyMode: true,
          backBufferLength: 30,
          maxBufferLength: 60,
          maxMaxBufferLength: 120,
        });

        (el as any).__hls = hls;

        hls.on(Hls.Events.ERROR, (_: any, data: any) => {
          try {
            queueEvent("PLAYER_ERROR", {
              fatal: !!data?.fatal,
              details: data?.details || "",
              type: data?.type || "",
            });
          } catch {}

          if (data?.fatal) {
            const errorMsg = data?.details || data?.type || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜";
            const errorCode = data?.response?.code || data?.code;
            const is404 = errorCode === 404 || errorMsg.includes("404") || errorMsg.includes("Not Found");
            const isNetworkError = errorCode === -1 || errorCode === -2 || errorMsg.includes("network") || errorMsg.includes("NetworkError");
            
            let message = "";
            if (is404) {
              message = `ë¹„ë””ì˜¤ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¹„ë””ì˜¤ê°€ ì•„ì§ ì²˜ë¦¬ ì¤‘ì´ê±°ë‚˜ ì—…ë¡œë“œë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
            } else if (isNetworkError) {
              message = `ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.`;
            } else {
              message = `ì¬ìƒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${errorMsg}`;
            }
            
            console.error("[StudentVideoPlayer] HLS.js fatal error:", {
              errorCode,
              errorMsg,
              url,
              data,
            });
            
            setToast({ text: message, kind: "danger" });
            if (is404 || isNetworkError) {
              onFatalRef.current?.(message);
            }
          }
        });

        hls.loadSource(url);
        hls.attachMedia(el);
        return;
      }

      // fallback
      el.src = url;
    } catch (e) {
      // fallback
      el.src = url;
    }
  }, [bootstrap.play_url, video.hls_url]);

  // ---------------------------------------------------------------------------
  // Events batching (anti-spam)
  // ---------------------------------------------------------------------------
  const queueEvent = useCallback((type: EventType, payload?: any) => {
    const policy = normalizePolicy(bootstrap.policy);
    const monitoringEnabled = policy.monitoring_enabled ?? false;
    
    // If monitoring is disabled (FREE_REVIEW), skip all event logging
    if (!monitoringEnabled) {
      return;
    }
    
    // Only send violation-relevant events in PROCTORED_CLASS mode
    // FREE_REVIEW mode: minimal logging (no violation events)
    const violationEvents: EventType[] = ["SEEK_ATTEMPT", "SPEED_CHANGE_ATTEMPT"];
    const isViolationEvent = violationEvents.includes(type);
    const accessMode = policy.access_mode;
    
    if (accessMode === "FREE_REVIEW" && isViolationEvent) {
      // Don't send violation events in FREE_REVIEW mode
      return;
    }
    
    const now = getEpochSec();
    eventQueueRef.current.push({ type, occurred_at: now, payload: payload || {} });

    // small cap (memory safety)
    if (eventQueueRef.current.length > 300) {
      eventQueueRef.current.splice(0, eventQueueRef.current.length - 300);
    }
  }, [bootstrap.policy]);

  const queueEventRef = useRef(queueEvent);
  queueEventRef.current = queueEvent;

  const flushEvents = useCallback(async () => {
    const token = tokenRef.current;
    if (!token) return;
    const batch = eventQueueRef.current.splice(0, eventQueueRef.current.length);
    if (!batch.length) return;

    try {
      await postEvents(token, batch, video.id, enrollmentId);
    } catch (e: any) {
      // session revoked / inactive -> stop
      const msg = e?.response?.data?.detail || e?.message || "";
      if (String(msg).includes("session_inactive") || e?.response?.status === 409) {
        setToast({ text: "ì¬ìƒ ì„¸ì…˜ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.", kind: "danger" });
        onFatalRef.current?.("session_inactive");
      }
    }
  }, [video.id, enrollmentId]);

  const monitoringEnabled = policy.monitoring_enabled ?? false;

  // Events: only when monitoring_enabled (FREE_REVIEW sends nothing)
  useStableInterval(
    () => {
      flushEvents();
    },
    2200,
    monitoringEnabled
  );

  // Heartbeat: only for PROCTORED_CLASS
  useStableInterval(
    () => {
      const token = tokenRef.current;
      if (!token) return;

      postHeartbeat(token).catch((e: any) => {
        const msg = e?.response?.data?.detail || e?.message || "";
        if (String(msg).includes("policy_changed")) {
          setToast({ text: "ì •ì±…ì´ ë³€ê²½ë˜ì–´ ì¬ìƒì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.", kind: "danger" });
          onFatalRef.current?.("policy_changed");
          return;
        }
        if (String(msg).includes("session_inactive") || e?.response?.status === 409) {
          setToast({ text: "ì¬ìƒ ì„¸ì…˜ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.", kind: "danger" });
          onFatalRef.current?.("session_inactive");
          return;
        }
      });
    },
    30000,
    monitoringEnabled
  );

  // ---------------------------------------------------------------------------
  // Mount/Unmount lifecycle
  // ---------------------------------------------------------------------------
  useEffect(() => {
    attachSource();

    return () => {
      // cleanup hls
      const el = videoEl.current as any;
      const hls = el?.__hls;
      if (hls && typeof hls.destroy === "function") {
        try {
          hls.destroy();
        } catch {}
      }

      // end session (best-effort, only for PROCTORED_CLASS)
      const policy = normalizePolicy(bootstrap.policy);
      const monitoringEnabled = policy.monitoring_enabled ?? false;
      
      if (monitoringEnabled) {
        const token = tokenRef.current;
        if (token) {
          postEnd(token).catch(() => {});
        }

        // flush last events
        try {
          flushEvents();
        } catch {}
      }
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  // ---------------------------------------------------------------------------
  // Visibility / Focus events (ref ì‚¬ìš©ìœ¼ë¡œ queueEvent ë³€ê²½ ì‹œ effect ì¬ì‹¤í–‰ ë°©ì§€, React #310)
  // ---------------------------------------------------------------------------
  useEffect(() => {
    const onVis = () => {
      if (document.hidden) {
        queueEventRef.current("VISIBILITY_HIDDEN", { hidden: true });
      } else {
        queueEventRef.current("VISIBILITY_VISIBLE", { hidden: false });
        if (monitoringEnabled) {
          const token = tokenRef.current;
          if (token) postRefresh(token).catch(() => {});
        }
      }
    };
    const onBlur = () => queueEventRef.current("FOCUS_LOST", {});
    const onFocus = () => queueEventRef.current("FOCUS_GAINED", {});

    document.addEventListener("visibilitychange", onVis);
    window.addEventListener("blur", onBlur);
    window.addEventListener("focus", onFocus);

    return () => {
      document.removeEventListener("visibilitychange", onVis);
      window.removeEventListener("blur", onBlur);
      window.removeEventListener("focus", onFocus);
    };
  }, [monitoringEnabled]);

  // ---------------------------------------------------------------------------
  // Video event binding
  // ---------------------------------------------------------------------------
  useEffect(() => {
    const el = videoEl.current;
    if (!el) return;

    const onLoadedMeta = () => {
      const d = Number(el.duration || 0);
      if (d && Number.isFinite(d)) setDuration(d);
      setReady(true);
      setBuffering(false);
    };

    const onTime = () => {
      const t = Number(el.currentTime || 0);
      setCurrent(t);

      // "watched" = monotonic forward progress (safety against seek)
      const prev = lastTimeRef.current;
      lastTimeRef.current = t;

      if (t > maxWatchedRef.current) {
        maxWatchedRef.current = t;
      } else if (t + 0.15 < prev) {
        // user moved backward OR the stream jumped
        // don't treat as watched
      }
    };

    const onPlay = () => {
      setPlaying(true);
      setBuffering(false);
    };
    const onPause = () => setPlaying(false);
    const onWaiting = () => setBuffering(true);
    const onPlaying = () => setBuffering(false);

    const onRateChange = () => {
      const r = Number(el.playbackRate || 1);
      setRate(r);

      // enforce speed lock
      if (speedLocked) {
        if (Math.abs(r - 1) > 0.001) {
          try {
            el.playbackRate = 1;
          } catch {}
          setToast({ text: "ë°°ì† ë³€ê²½ì´ ì œí•œë˜ì–´ ìˆìŠµë‹ˆë‹¤.", kind: "warn" });
          queueEvent("SPEED_CHANGE_ATTEMPT", { attempted: r, enforced: 1 });
        }
        return;
      }

      if (r > maxRate + 0.0001) {
        try {
          el.playbackRate = maxRate;
        } catch {}
        setToast({ text: `ìµœëŒ€ ë°°ì†ì€ ${maxRate}x ì…ë‹ˆë‹¤.`, kind: "warn" });
        queueEvent("SPEED_CHANGE_ATTEMPT", { attempted: r, enforced: maxRate });
      }
    };

    const onSeeking = () => {
      if (allowSeek && !boundedForward) return;

      const now = Date.now();
      const guard = seekGuardRef.current;

      const target = Number(el.currentTime || 0);
      const maxWatched = Number(maxWatchedRef.current || 0);
      const allowedMax = boundedForward ? maxWatched + grace : maxWatched; // blocked -> no forward
      const isForwardBeyond = target > allowedMax + 0.001;

      // blocked seek -> any seek considered attempt
      if (!allowSeek || seekMode === "blocked") {
        // snap back
        guard.blocking = true;
        try {
          el.currentTime = maxWatched;
        } catch {}
        guard.blocking = false;

        if (now - guard.lastWarnAt > 900) {
          guard.lastWarnAt = now;
          setToast({ text: "íƒìƒ‰ì´ ì œí•œëœ ì˜ìƒì…ë‹ˆë‹¤.", kind: "warn" });
        }

        queueEvent("SEEK_ATTEMPT", {
          mode: "blocked",
          target,
          max_watched: maxWatched,
        });
        return;
      }

      if (boundedForward && isForwardBeyond) {
        // snap back to allowed
        guard.blocking = true;
        try {
          el.currentTime = allowedMax;
        } catch {}
        guard.blocking = false;

        if (now - guard.lastWarnAt > 900) {
          guard.lastWarnAt = now;
          setToast({ text: "ì•„ì§ ì‹œì²­í•˜ì§€ ì•Šì€ êµ¬ê°„ìœ¼ë¡œ ì´ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", kind: "warn" });
        }

        queueEvent("SEEK_ATTEMPT", {
          mode: "bounded_forward",
          target,
          max_watched: maxWatched,
          grace,
        });
      }
    };

    const onError = () => {
      const error = el.error as any;
      const errorCode = error?.code || 0;
      const errorMessage = error?.message || "";
      
      queueEvent("PLAYER_ERROR", {
        code: errorCode,
        message: errorMessage,
      });
      
      // MEDIA_ERR_SRC_NOT_SUPPORTED (4) ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜
      let message = "ì¬ìƒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
      if (errorCode === 4 || errorMessage.includes("404") || errorMessage.includes("Not Found")) {
        message = "ë¹„ë””ì˜¤ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (404). ì„œë²„ì— ë¹„ë””ì˜¤ íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.";
        onFatalRef.current?.("ë¹„ë””ì˜¤ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
      } else if (errorCode === 2) {
        message = "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.";
      } else if (errorCode === 3) {
        message = "ë¹„ë””ì˜¤ ë””ì½”ë”© ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
      }
      
      setToast({ text: message, kind: "danger" });
    };

    el.addEventListener("loadedmetadata", onLoadedMeta);
    el.addEventListener("timeupdate", onTime);
    el.addEventListener("play", onPlay);
    el.addEventListener("pause", onPause);
    el.addEventListener("waiting", onWaiting);
    el.addEventListener("playing", onPlaying);
    el.addEventListener("ratechange", onRateChange);
    el.addEventListener("seeking", onSeeking);
    el.addEventListener("error", onError);

    // initial constraints
    try {
      if (speedLocked) el.playbackRate = 1;
      if (maxRate < 1) el.playbackRate = 1;
    } catch {}

    return () => {
      el.removeEventListener("loadedmetadata", onLoadedMeta);
      el.removeEventListener("timeupdate", onTime);
      el.removeEventListener("play", onPlay);
      el.removeEventListener("pause", onPause);
      el.removeEventListener("waiting", onWaiting);
      el.removeEventListener("playing", onPlaying);
      el.removeEventListener("ratechange", onRateChange);
      el.removeEventListener("seeking", onSeeking);
      el.removeEventListener("error", onError);
    };
  }, [allowSeek, boundedForward, grace, maxRate, queueEvent, seekMode, speedLocked]);

  // ---------------------------------------------------------------------------
  // Controls actions
  // ---------------------------------------------------------------------------
  const togglePlay = useCallback(() => {
    const el = videoEl.current;
    if (!el) return;
    if (el.paused) {
      el.play().catch(() => {});
    } else {
      el.pause();
    }
  }, []);

  const requestFullscreen = useCallback(() => {
    const wrap = wrapEl.current;
    const video = videoEl.current;

    const isFs =
      document.fullscreenElement ||
      (document as any).webkitFullscreenElement ||
      (document as any).mozFullScreenElement;

    try {
      if (!isFs) {
        queueEvent("FULLSCREEN_ENTER", {});
        // ëª¨ë°”ì¼(iOS ë“±)ì—ì„œëŠ” ì‚¬ìš©ì ì œìŠ¤ì²˜ ì§í›„ ë™ê¸° í˜¸ì¶œì´ í•„ìš”. await ì“°ì§€ ì•ŠìŒ.
        if (wrap?.requestFullscreen) {
          wrap.requestFullscreen();
          return;
        }
        if ((wrap as any)?.webkitRequestFullscreen) {
          (wrap as any).webkitRequestFullscreen();
          return;
        }
        // iOS Safari ë“±: div ëŒ€ì‹  video ìš”ì†Œë§Œ ì „ì²´í™”ë©´ ì§€ì›í•˜ëŠ” ê²½ìš°
        if (video?.requestFullscreen) {
          video.requestFullscreen();
          return;
        }
        if ((video as any)?.webkitRequestFullscreen) {
          (video as any).webkitRequestFullscreen();
          return;
        }
      } else {
        queueEvent("FULLSCREEN_EXIT", {});
        if (document.exitFullscreen) document.exitFullscreen();
        else if ((document as any).webkitExitFullscreen) (document as any).webkitExitFullscreen();
      }
    } catch {}
  }, [queueEvent]);

  const setTime = useCallback((t: number) => {
    const el = videoEl.current;
    if (!el) return;

    const safe = clamp(t, 0, Math.max(0, duration || 0));
    try {
      el.currentTime = safe;
    } catch {}
  }, [duration]);

  const onScrub = useCallback((v: number) => {
    setShowControls(true);
    setTime(v);
  }, [setTime]);

  const onVolume = useCallback((v: number) => {
    const el = videoEl.current;
    if (!el) return;
    const vv = clamp(v, 0, 1);
    setVolume(vv);
    try {
      el.volume = vv;
    } catch {}
    if (vv <= 0.0001) setMuted(true);
    else setMuted(false);
  }, []);

  const toggleMute = useCallback(() => {
    const el = videoEl.current;
    if (!el) return;
    const m = !muted;
    setMuted(m);
    try {
      el.muted = m;
    } catch {}
  }, [muted]);

  const setPlaybackRate = useCallback((r: number) => {
    const el = videoEl.current;
    if (!el) return;

    if (speedLocked) {
      setToast({ text: "ë°°ì† ë³€ê²½ì´ ì œí•œë˜ì–´ ìˆìŠµë‹ˆë‹¤.", kind: "warn" });
      queueEvent("SPEED_CHANGE_ATTEMPT", { attempted: r, enforced: 1 });
      try {
        el.playbackRate = 1;
      } catch {}
      setRate(1);
      return;
    }

    const rr = clamp(r, 0.25, maxRate);
    try {
      el.playbackRate = rr;
    } catch {}
    setRate(rr);
  }, [maxRate, queueEvent, speedLocked]);

  const skip = useCallback((delta: number) => {
    const el = videoEl.current;
    if (!el) return;
    const t = Number(el.currentTime || 0) + Number(delta || 0);
    setTime(t);
  }, [setTime]);

  // íƒ­ êµ¬ì—­: ì¢Œ 30% = 0, ì¤‘ì•™ 40% = 1, ìš° 30% = 2
  const getTapZone = useCallback((rect: DOMRect, clientX: number) => {
    const w = rect.width;
    if (clientX < rect.left + w * 0.3) return 0;
    if (clientX > rect.right - w * 0.3) return 2;
    return 1;
  }, []);

  // ìœ íŠœë¸Œì‹ íƒ­ ìš°ì„ ìˆœìœ„: ì‹±ê¸€ = ì»¨íŠ¸ë¡¤ í† ê¸€(+ ì¤‘ì•™ì´ë©´ ì¬ìƒ í† ê¸€), ë”ë¸” = êµ¬ì—­ë³„ ì‹œí¬, íŠ¸ë¦¬í”Œ = Â±20ì´ˆ
  const resolveTap = useCallback(
    (clientX: number, rect: DOMRect) => {
      const count = tapCountRef.current;
      tapCountRef.current = 0;
      if (count === 1) {
        setShowControls((v) => !v);
        const zone = getTapZone(rect, clientX);
        if (zone === 1) togglePlay();
      } else if (count >= 2 && allowSeek) {
        const zone = getTapZone(rect, clientX);
        const delta = count >= 3 ? (zone === 0 ? -20 : zone === 2 ? 20 : 0) : zone === 0 ? -10 : zone === 2 ? 10 : 0;
        if (delta !== 0) {
          skip(delta);
          setToast({ text: delta > 0 ? `ì•ìœ¼ë¡œ ${Math.abs(delta)}ì´ˆ` : `ë’¤ë¡œ ${Math.abs(delta)}ì´ˆ`, kind: "info" });
        }
      }
    },
    [allowSeek, getTapZone, skip, togglePlay]
  );

  const onStageTap = useCallback(
    (clientX: number, clientY: number) => {
      const layer = gestureLayerRef.current;
      const rect = layer?.getBoundingClientRect?.();
      if (!rect) return;

      lastTapRef.current = { time: Date.now(), x: clientX, y: clientY };
      tapCountRef.current += 1;
      if (tapTimerRef.current) clearTimeout(tapTimerRef.current);
      tapTimerRef.current = setTimeout(() => {
        tapTimerRef.current = null;
        const r = gestureLayerRef.current?.getBoundingClientRect?.();
        if (r) resolveTap(lastTapRef.current.x, r);
      }, 200);
    },
    [resolveTap]
  );

  const onStageDoubleClick = useCallback(
    (e: React.MouseEvent<HTMLDivElement>) => {
      e.preventDefault();
      onStageTap(e.clientX, e.clientY);
    },
    [onStageTap]
  );

  const onStageTouchEnd = useCallback(
    (e: React.TouchEvent<HTMLDivElement>) => {
      onStageTouchEndLongPress();
      const t = e.changedTouches?.[0];
      if (!t) return;
      e.preventDefault();
      if (!swipeHandledRef.current) onStageTap(t.clientX, t.clientY);
      swipeHandledRef.current = false;
      touchStartRef.current = null;
    },
    [onStageTap, onStageTouchEndLongPress]
  );

  const onStageTouchMove = useCallback(
    (e: React.TouchEvent<HTMLDivElement>) => {
      const start = touchStartRef.current;
      const t = e.touches?.[0];
      if (!start || !t) return;
      const layer = gestureLayerRef.current;
      const rect = layer?.getBoundingClientRect?.();
      if (!rect) return;
      const dy = start.y - t.clientY;
      if (Math.abs(dy) < 15) return;
      swipeHandledRef.current = true;
      if (start.rightHalf) {
        const delta = dy * 0.008;
        const v = clamp((start.volume ?? volume) + delta, 0, 1);
        setVolume(v);
        const el = videoEl.current;
        if (el) try { el.volume = v; } catch {}
        if (v <= 0.0001) setMuted(true);
        else setMuted(false);
      }
    },
    [volume]
  );

  // ë¡±í”„ë ˆìŠ¤ 500ms â†’ 2ë°°ì† (ëª¨ë°”ì¼)
  const onStageTouchStart = useCallback(
    (e: React.TouchEvent<HTMLDivElement>) => {
      const layer = gestureLayerRef.current;
      const rect = layer?.getBoundingClientRect?.();
      const t = e.touches?.[0];
      if (t && rect) {
        touchStartRef.current = {
          y: t.clientY,
          volume: volume,
          rightHalf: t.clientX > rect.left + rect.width / 2,
        };
      }
      if (speedLocked) return;
      if (!rect || !t) return;
      const x = t.clientX;
      const rightHalf = x > rect.left + rect.width / 2;
      if (!rightHalf) return;
      savedRateRef.current = rate;
      if (longPressTimerRef.current) clearTimeout(longPressTimerRef.current);
      longPressTimerRef.current = setTimeout(() => {
        longPressTimerRef.current = null;
        setPlaybackRate(2);
        setToast({ text: "2ë°°ì†", kind: "info" });
      }, 500);
    },
    [rate, setPlaybackRate, speedLocked, volume]
  );

  const onStageTouchEndLongPress = useCallback(() => {
    if (longPressTimerRef.current) {
      clearTimeout(longPressTimerRef.current);
      longPressTimerRef.current = null;
    }
    const el = videoEl.current;
    if (el && savedRateRef.current !== undefined) {
      try {
        el.playbackRate = savedRateRef.current;
      } catch {}
      setRate(savedRateRef.current);
    }
  }, []);

  const onStageTouchCancel = useCallback(() => {
    onStageTouchEndLongPress();
  }, [onStageTouchEndLongPress]);

  // Hotkeys (YouTube-like)
  useEffect(() => {
    const onKey = (e: KeyboardEvent) => {
      // ignore typing
      const tag = (e.target as any)?.tagName?.toLowerCase?.();
      if (tag === "input" || tag === "textarea" || (e.target as any)?.isContentEditable) return;

      if (e.code === "Space") {
        e.preventDefault();
        togglePlay();
        return;
      }

      if (e.key === "k" || e.key === "K") {
        togglePlay();
        return;
      }

      if (e.key === "f" || e.key === "F") {
        requestFullscreen();
        return;
      }

      if (e.key === "m" || e.key === "M") {
        toggleMute();
        return;
      }

      if (e.key === "t" || e.key === "T") {
        setTheater((v) => !v);
        return;
      }

      if (e.key === "ArrowLeft") {
        skip(-5);
        return;
      }
      if (e.key === "ArrowRight") {
        skip(5);
        return;
      }
      if (e.key === "j" || e.key === "J") {
        skip(-10);
        return;
      }
      if (e.key === "l" || e.key === "L") {
        skip(10);
        return;
      }
    };

    window.addEventListener("keydown", onKey);
    return () => window.removeEventListener("keydown", onKey);
  }, [requestFullscreen, skip, toggleMute, togglePlay]);

  // Prime audio config
  useEffect(() => {
    const el = videoEl.current;
    if (!el) return;
    try {
      el.volume = volume;
      el.muted = muted;
    } catch {}
  }, [muted, volume]);

  const policyPills = useMemo(() => {
    const pills: Array<{ text: string; tone?: "neutral" | "warn" | "danger" }> = [];
    const accessMode = policy.access_mode;
    if (accessMode === "PROCTORED_CLASS") {
      pills.push({ text: "ì˜¨ë¼ì¸ ìˆ˜ì—… ëŒ€ì²´", tone: "warn" });
    } else if (accessMode === "FREE_REVIEW") {
      pills.push({
        text: monitoringEnabled ? "ë³µìŠµ" : "ë³µìŠµ ëª¨ë“œ (ëª¨ë‹ˆí„°ë§ ì—†ìŒ)",
        tone: "neutral",
      });
    }

    if (!allowSeek || seekMode === "blocked") pills.push({ text: "íƒìƒ‰ ì œí•œ", tone: "warn" });
    else if (boundedForward) pills.push({ text: "ì•ìœ¼ë¡œ íƒìƒ‰ ì œí•œ", tone: "warn" });

    if (speedLocked) pills.push({ text: "ë°°ì† ì œí•œ", tone: "warn" });

    if (watermarkEnabled) pills.push({ text: "ì›Œí„°ë§ˆí¬", tone: "neutral" });

    return pills;
  }, [policy.access_mode, monitoringEnabled, allowSeek, boundedForward, seekMode, speedLocked, watermarkEnabled]);

  const deviceId = useMemo(() => getOrCreateDeviceId(), []);

  const shareText = useMemo(() => {
    const policy = normalizePolicy(bootstrap.policy);
    const monitoringEnabled = policy.monitoring_enabled ?? false;
    
    if (!monitoringEnabled) {
      return `ê¸°ê¸°: ${deviceId.slice(0, 8)}â€¦ Â· ëª¨ë‹ˆí„°ë§ ì—†ìŒ (ë³µìŠµ ëª¨ë“œ)`;
    }
    
    const expires = bootstrap.expires_at ? formatDateTimeKorean(bootstrap.expires_at * 1000) : "";
    return `ê¸°ê¸°: ${deviceId.slice(0, 8)}â€¦ Â· ì„¸ì…˜ ë§Œë£Œ: ${expires || "-"}`;
  }, [bootstrap.expires_at, bootstrap.policy, deviceId]);

  const rateMenu = useMemo(() => {
    const common = [0.5, 0.75, 1, 1.25, 1.5, 2];
    const extra = [2.5, 3, 4, 5, 8, 10, 16];
    const list = [...common, ...extra].filter((x) => x <= maxRate + 0.0001);
    // always include 1
    if (!list.includes(1)) list.push(1);
    list.sort((a, b) => a - b);
    return list;
  }, [maxRate]);

  // ---------------------------------------------------------------------------
  // Render
  // ---------------------------------------------------------------------------
  return (
    <div className={`svpRoot ${theater ? "svpTheater" : ""}`}>
      <div className="svpLayout">
        <div className="svpPlayerCol">
          <div
            className={`svpPlayerWrap ${!showControls ? "svpPlayerWrap--controlsHidden" : ""} ${isFullscreen ? "svpPlayerWrap--fullscreen" : ""}`}
            ref={wrapEl}
          >
            <div className="svpTopBar">
              <div className="svpTopLeft">
                <div className="svpTitle" title={video.title}>
                  {video.title}
                </div>
                <div className="svpMeta">
                  <span className="svpMetaItem">video#{video.id}</span>
                  <span className="svpDot">â€¢</span>
                  <span className="svpMetaItem">enrollment#{enrollmentId}</span>
                </div>
              </div>

              <div className="svpTopRight">
                <div className="svpPills">
                  {policyPills.map((p, idx) => (
                    <Pill key={idx} tone={p.tone}>
                      {p.text}
                    </Pill>
                  ))}
                </div>

                <KebabMenu
                  align="right"
                  label="ë©”ë‰´"
                  items={[
                    {
                      label: "ì„¸ì…˜ ìƒˆë¡œê³ ì¹¨",
                      onClick: async () => {
                        const token = tokenRef.current;
                        if (!token) return;
                        try {
                          await postRefresh(token);
                          setToast({ text: "ì„¸ì…˜ í™•ì¸ ì™„ë£Œ", kind: "info" });
                        } catch {
                          setToast({ text: "ì„¸ì…˜ í™•ì¸ ì‹¤íŒ¨", kind: "warn" });
                        }
                      },
                    },
                    {
                      label: "ì´ ì˜ìƒ ì •ë³´",
                      onClick: () => {
                        setToast({ text: shareText, kind: "info" });
                      },
                    },
                  ]}
                />
              </div>
            </div>

            <div className="svpVideoStage" role="presentation">
              <video
                ref={videoEl}
                className="svpVideo"
                playsInline
                controls={false}
                preload="metadata"
                poster={video.thumbnail_url || undefined}
              />
              {/* GestureLayer: ëª¨ë“  í„°ì¹˜/í´ë¦­ ìº¡ì²˜ (touch-action:none), ë¸Œë¼ìš°ì € ì¤Œ/ìŠ¤í¬ë¡¤ ì°¨ë‹¨ */}
              <div
                ref={gestureLayerRef}
                className="svpGestureLayer"
                aria-hidden
                onClick={(e) => { e.preventDefault(); onStageTap(e.clientX, e.clientY); }}
                onDoubleClick={(e) => { e.preventDefault(); e.stopPropagation(); onStageTap(e.clientX, e.clientY); }}
                onTouchStart={onStageTouchStart}
                onTouchMove={onStageTouchMove}
                onTouchEnd={onStageTouchEnd}
                onTouchCancel={onStageTouchCancel}
              />

              {!ready && (
                <div className="svpOverlayCenter">
                  <div className="svpSpinner" />
                  <div className="svpOverlayText">ë¡œë”© ì¤‘â€¦</div>
                </div>
              )}

              {ready && !playing && (
                <button
                  className="svpBigPlay"
                  type="button"
                  onClick={togglePlay}
                  onDoubleClick={(e) => e.stopPropagation()}
                >
                  <span className="svpBigPlayIcon">â–¶</span>
                  <span className="svpBigPlayText">ì¬ìƒ</span>
                </button>
              )}

              {buffering && ready && (
                <div className="svpOverlayCorner">
                  <div className="svpSpinnerMini" />
                  <div className="svpOverlayTextMini">ë²„í¼ë§â€¦</div>
                </div>
              )}

              {watermarkEnabled && (
                <div className="svpWatermark">
                  <div className="svpWatermarkInner">
                    <div className="svpWatermarkTop">hakwonplus</div>
                    <div className="svpWatermarkBottom">{deviceId.slice(0, 8)}â€¦</div>
                  </div>
                </div>
              )}

              <div className="svpControls">
                <div className="svpProgressRow">
                  <RangeSlider
                    value={current}
                    min={0}
                    max={Math.max(0.1, duration || 0)}
                    step={0.1}
                    onChange={(v) => onScrub(v)}
                    ariaLabel="ì§„í–‰ ë°”"
                  />
                  <div className="svpTime">
                    <span className="svpTimeCur">{formatClock(current)}</span>
                    <span className="svpTimeSep">/</span>
                    <span className="svpTimeDur">{formatClock(duration)}</span>
                  </div>
                </div>

                <div className="svpControlRow">
                  <div className="svpLeftControls">
                    <IconButton
                      icon={playing ? "pause" : "play"}
                      label={playing ? "ì¼ì‹œì •ì§€" : "ì¬ìƒ"}
                      onClick={togglePlay}
                    />

                    <IconButton icon="replay10" label="-10ì´ˆ" onClick={() => skip(-10)} />
                    <IconButton icon="forward10" label="+10ì´ˆ" onClick={() => skip(10)} />

                    <div className="svpVolume">
                      <IconButton
                        icon={muted || volume <= 0.0001 ? "mute" : "volume"}
                        label="ìŒì†Œê±°"
                        onClick={toggleMute}
                      />
                      <div className="svpVolumeSlider">
                        <RangeSlider
                          value={muted ? 0 : volume}
                          min={0}
                          max={1}
                          step={0.01}
                          onChange={(v) => onVolume(v)}
                          ariaLabel="ë³¼ë¥¨"
                        />
                      </div>
                    </div>
                  </div>

                  <div className="svpRightControls">
                    <div className="svpRate">
                      <KebabMenu
                        align="right"
                        label={speedLocked ? "ë°°ì† ì œí•œ" : `ë°°ì† ${rate.toFixed(2)}x`}
                        disabled={speedLocked}
                        items={rateMenu.map((r) => ({
                          label: `${r}x${Math.abs(r - rate) < 0.001 ? " âœ“" : ""}`,
                          onClick: () => setPlaybackRate(r),
                        }))}
                        buttonClassName={speedLocked ? "svpRateDisabled" : ""}
                      />
                    </div>

                    <IconButton
                      icon={theater ? "shrink" : "theater"}
                      label={theater ? "ê¸°ë³¸ ë³´ê¸°" : "ê·¹ì¥ ëª¨ë“œ"}
                      onClick={() => setTheater((v) => !v)}
                    />
                    <IconButton
                      icon="fullscreen"
                      label="ì „ì²´í™”ë©´"
                      onPointerDown={() => requestFullscreen()}
                    />
                  </div>
                </div>

                {!allowSeek || speedLocked ? (
                  <div className="svpPolicyHint">
                    {!allowSeek || seekMode === "blocked" ? (
                      <span className="svpPolicyHintItem">
                        â€¢ íƒìƒ‰ì´ ì œí•œë©ë‹ˆë‹¤{boundedForward ? " (ì‹œì²­í•œ êµ¬ê°„ë§Œ ì´ë™ ê°€ëŠ¥)" : ""}
                      </span>
                    ) : boundedForward ? (
                      <span className="svpPolicyHintItem">â€¢ ì•ìœ¼ë¡œ íƒìƒ‰ì´ ì œí•œë©ë‹ˆë‹¤</span>
                    ) : null}
                    {speedLocked ? (
                      <span className="svpPolicyHintItem">â€¢ ë°°ì† ë³€ê²½ì´ ì œí•œë©ë‹ˆë‹¤</span>
                    ) : null}
                  </div>
                ) : (
                  <div className="svpPolicyHint svpPolicyHintMuted">
                    í‚¤ë³´ë“œ: Space/K(ì¬ìƒ), J/L(Â±10s), â†/â†’(Â±5s), F(ì „ì²´í™”ë©´), M(ìŒì†Œê±°), T(ê·¹ì¥)
                  </div>
                )}
              </div>
            </div>
          </div>

          <PlayerToast toast={toast} onClose={() => setToast(null)} />
        </div>

        <aside className="svpSide">
          <div className="svpSideCard">
            <div className="svpSideTitle">ì‹œì²­ ë„ìš°ë¯¸</div>

            {policy.monitoring_enabled ? (
              <>
                <div className="svpSideRow">
                  <div className="svpSideLabel">ì„¸ì…˜</div>
                  <div className="svpSideValue">{bootstrap.session_id?.slice(0, 8) || "-"}â€¦</div>
                </div>

                <div className="svpSideRow">
                  <div className="svpSideLabel">ë§Œë£Œ</div>
                  <div className="svpSideValue">
                    {bootstrap.expires_at ? formatDateTimeKorean(bootstrap.expires_at * 1000) : "-"}
                  </div>
                </div>
              </>
            ) : (
              <div className="svpSideRow">
                <div className="svpSideLabel">ëª¨ë‹ˆí„°ë§</div>
                <div className="svpSideValue">ë¹„í™œì„± (ë³µìŠµ ëª¨ë“œ)</div>
              </div>
            )}

            <div className="svpSideRow">
              <div className="svpSideLabel">ê¸°ê¸°</div>
              <div className="svpSideValue">{deviceId.slice(0, 10)}â€¦</div>
            </div>

            <div className="svpSideDivider" />

            <div className="svpSideTitle2">ì •ì±… ì ìš©</div>
            <div className="svpSideBullets">
              <div className="svpSideBullet">
                <span className="svpSideDot" />
                <span className="svpSideTxt">
                  {allowSeek
                    ? boundedForward
                      ? "ì‹œì²­í•œ êµ¬ê°„ê¹Œì§€ë§Œ ì´ë™ ê°€ëŠ¥"
                      : "íƒìƒ‰ ê°€ëŠ¥"
                    : "íƒìƒ‰ ì°¨ë‹¨"}
                </span>
              </div>

              <div className="svpSideBullet">
                <span className="svpSideDot" />
                <span className="svpSideTxt">
                  {speedLocked ? "ë°°ì† ì°¨ë‹¨" : `ìµœëŒ€ ë°°ì† ${maxRate}x`}
                </span>
              </div>

              <div className="svpSideBullet">
                <span className="svpSideDot" />
                <span className="svpSideTxt">{watermarkEnabled ? "ì›Œí„°ë§ˆí¬ í‘œì‹œ" : "ì›Œí„°ë§ˆí¬ ì—†ìŒ"}</span>
              </div>
            </div>

            <div className="svpSideDivider" />

            <button
              type="button"
              className="svpSideButton"
              onClick={() => {
                setToast({
                  text: `í˜„ì¬ ${formatClock(current)} / ${formatClock(duration)} (ì•½ ${Math.round(
                    (current / Math.max(1, duration)) * 100
                  )}%)`,
                  kind: "info",
                });
              }}
            >
              ì§„í–‰ë¥  ë³´ê¸°
            </button>

            {monitoringEnabled && (
              <button
                type="button"
                className="svpSideButton svpSideButtonGhost"
                onClick={() => {
                  const token = tokenRef.current;
                  if (!token) return;
                  postRefresh(token)
                    .then(() => setToast({ text: "ì„¸ì…˜ í™•ì¸ ì™„ë£Œ", kind: "info" }))
                    .catch(() => setToast({ text: "ì„¸ì…˜ í™•ì¸ ì‹¤íŒ¨", kind: "warn" }));
                }}
              >
                ì„¸ì…˜ ì ê²€
              </button>
            )}
          </div>
        </aside>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: video/playback/player/player.css
==========================================================================================
/* PATH: src/student/domains/video/playback/player/player.css */
:root {
  --svp-bg: #0f0f10;
  --svp-card: #151517;
  --svp-card2: #101012;
  --svp-line: rgba(255, 255, 255, 0.08);
  --svp-line2: rgba(255, 255, 255, 0.14);
  --svp-text: rgba(255, 255, 255, 0.92);
  --svp-text2: rgba(255, 255, 255, 0.68);
  --svp-text3: rgba(255, 255, 255, 0.48);
  --svp-accent: #ffffff;
  --svp-warn: #ffcf5a;
  --svp-danger: #ff5a6e;
  --svp-shadow: 0 14px 60px rgba(0, 0, 0, 0.48);
  --svp-radius: 16px;
  --svp-radius2: 18px;
  --svp-font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple SD Gothic Neo",
    "Noto Sans KR", "Malgun Gothic", "ë§‘ì€ ê³ ë”•", sans-serif;
}

.svpRoot {
  font-family: var(--svp-font);
  color: var(--svp-text);
}

.svpLayout {
  display: grid;
  grid-template-columns: minmax(0, 1fr) 320px;
  gap: 14px;
}

@media (max-width: 1080px) {
  .svpLayout {
    grid-template-columns: 1fr;
  }
  .svpSide {
    display: none;
  }
}

.svpPlayerCol {
  min-width: 0;
}

.svpPlayerWrap {
  border-radius: var(--svp-radius2);
  overflow: hidden;
  box-shadow: var(--svp-shadow);
  background: var(--svp-bg);
  border: 1px solid rgba(0, 0, 0, 0.5);
}

.svpTopBar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 14px 14px 10px 14px;
  background: linear-gradient(180deg, rgba(0, 0, 0, 0.66), rgba(0, 0, 0, 0));
}

.svpTopLeft {
  min-width: 0;
}

.svpTitle {
  font-weight: 900;
  font-size: 15px;
  letter-spacing: -0.2px;
  line-height: 1.2;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.svpMeta {
  margin-top: 4px;
  display: flex;
  align-items: center;
  gap: 6px;
  color: var(--svp-text3);
  font-size: 12px;
}

.svpDot {
  opacity: 0.65;
}

.svpTopRight {
  display: flex;
  align-items: center;
  gap: 10px;
}

.svpPills {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  justify-content: flex-end;
}

.svpVideoStage {
  position: relative;
  background: #000;
}

/* GestureLayer: í„°ì¹˜/í´ë¦­ ì „ìš© ë ˆì´ì–´, ë¸Œë¼ìš°ì € ì¤ŒÂ·ìŠ¤í¬ë¡¤ ì°¨ë‹¨ */
.svpGestureLayer {
  position: absolute;
  inset: 0;
  z-index: 10;
  touch-action: none;
  pointer-events: auto;
  cursor: pointer;
}

/* ì»¨íŠ¸ë¡¤ ìë™ ìˆ¨ê¹€ (ì¬ìƒ ì¤‘ 3ì´ˆ í›„), ì‹±ê¸€íƒ­ìœ¼ë¡œ í† ê¸€ */
.svpPlayerWrap--controlsHidden .svpTopBar,
.svpPlayerWrap--controlsHidden .svpControls {
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s ease;
}

.svpPlayerWrap .svpTopBar,
.svpPlayerWrap .svpControls {
  transition: opacity 0.2s ease;
}

/* ì „ì²´í™”ë©´ ì‹œ safe-area (ë…¸ì¹˜Â·í™ˆ ì¸ë””ì¼€ì´í„°) */
.svpPlayerWrap--fullscreen .svpControls {
  padding-bottom: max(12px, env(safe-area-inset-bottom));
}

.svpPlayerWrap--fullscreen .svpTopBar {
  padding-top: max(14px, env(safe-area-inset-top));
}

.svpVideo {
  display: block;
  width: 100%;
  height: auto;
  aspect-ratio: 16 / 9;
  background: #000;
}

.svpTheater .svpPlayerWrap {
  border-radius: 0;
}

.svpTheater .svpVideo {
  aspect-ratio: 21 / 9;
}

.svpOverlayCenter {
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  pointer-events: none;
  gap: 8px;
}

.svpOverlayText {
  font-size: 13px;
  color: var(--svp-text2);
}

.svpSpinner {
  width: 42px;
  height: 42px;
  border-radius: 999px;
  border: 4px solid rgba(255, 255, 255, 0.14);
  border-top-color: rgba(255, 255, 255, 0.9);
  animation: svpSpin 0.9s linear infinite;
}

.svpOverlayCorner {
  position: absolute;
  left: 12px;
  top: 12px;
  padding: 8px 10px;
  border-radius: 12px;
  background: rgba(0, 0, 0, 0.55);
  border: 1px solid rgba(255, 255, 255, 0.08);
  display: inline-flex;
  align-items: center;
  gap: 8px;
  pointer-events: none;
}

.svpSpinnerMini {
  width: 14px;
  height: 14px;
  border-radius: 999px;
  border: 2px solid rgba(255, 255, 255, 0.14);
  border-top-color: rgba(255, 255, 255, 0.85);
  animation: svpSpin 0.9s linear infinite;
}

.svpOverlayTextMini {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.85);
}

@keyframes svpSpin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.svpBigPlay {
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  background: radial-gradient(circle at center, rgba(0, 0, 0, 0.15), rgba(0, 0, 0, 0.55));
  border: 0;
  cursor: pointer;
  color: #fff;
}

.svpBigPlay:hover .svpBigPlayIcon {
  transform: translateY(-1px) scale(1.03);
}

.svpBigPlayIcon {
  width: 74px;
  height: 74px;
  border-radius: 999px;
  display: grid;
  place-items: center;
  font-size: 26px;
  font-weight: 900;
  background: rgba(255, 255, 255, 0.14);
  border: 1px solid rgba(255, 255, 255, 0.22);
  backdrop-filter: blur(10px);
  transition: transform 140ms ease, background 140ms ease;
}

.svpBigPlayText {
  margin-top: 10px;
  font-size: 12px;
  color: rgba(255, 255, 255, 0.78);
}

.svpControls {
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  padding: 10px 12px 12px 12px;
  background: linear-gradient(180deg, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.62) 50%, rgba(0, 0, 0, 0.85));
}

.svpProgressRow {
  display: grid;
  grid-template-columns: 1fr auto;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}

/* ëª¨ë°”ì¼: ì»¨íŠ¸ë¡¤ ì˜ì—­ ì¶•ì†Œ, ì„ íƒ ì˜µì…˜ ì¼ë¶€ ìˆ¨ê¹€ */
@media (max-width: 768px), (hover: none) {
  .svpControls {
    padding: 6px 8px 8px 8px;
  }
  .svpProgressRow {
    gap: 6px;
    margin-bottom: 6px;
  }
  .svpControlRow {
    gap: 4px;
    flex-wrap: wrap;
  }
  .svpLeftControls,
  .svpRightControls {
    gap: 4px;
  }
  .svpVolumeSlider {
    display: none !important;
  }
  .svpVolume {
    min-width: 0;
  }
  .svpPolicyHint,
  .svpPolicyHintMuted {
    display: none !important;
  }
  .svpTopBar {
    padding: 8px 10px 6px 10px;
  }
  .svpTitle {
    font-size: 13px;
  }
  .svpMeta {
    display: none;
  }
  .svpPills {
    display: none;
  }
  .svpTime {
    font-size: 11px;
    padding: 2px 6px;
  }
}

/* í„°ì¹˜ ë””ë°”ì´ìŠ¤: ë²„íŠ¼ í„°ì¹˜ ì˜ì—­ í™•ëŒ€ (44px ê¶Œì¥) */
@media (hover: none) and (pointer: coarse) {
  .svpControls .svpBtn {
    min-width: 44px;
    min-height: 44px;
    width: 44px;
    height: 44px;
  }
  .svpControls .svpBtnIcon {
    font-size: 14px;
  }
}

.svpTime {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.86);
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 8px;
  border-radius: 10px;
  background: rgba(255, 255, 255, 0.07);
  border: 1px solid rgba(255, 255, 255, 0.08);
}

.svpTimeSep {
  color: rgba(255, 255, 255, 0.55);
}

.svpControlRow {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.svpLeftControls,
.svpRightControls {
  display: flex;
  align-items: center;
  gap: 8px;
}

@media (max-width: 768px), (hover: none) {
  .svpRightControls > *:not(:last-child) {
    display: none !important;
  }
}

.svpVolume {
  display: flex;
  align-items: center;
  gap: 10px;
}

.svpVolumeSlider {
  width: 110px;
}

.svpRateDisabled {
  opacity: 0.75;
}

.svpPolicyHint {
  margin-top: 10px;
  font-size: 12px;
  color: rgba(255, 255, 255, 0.72);
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.svpPolicyHintMuted {
  color: rgba(255, 255, 255, 0.5);
}

.svpPolicyHintItem {
  opacity: 0.92;
}

.svpWatermark {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

.svpWatermarkInner {
  position: absolute;
  right: 12px;
  bottom: 80px;
  padding: 10px 12px;
  border-radius: 14px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  background: rgba(0, 0, 0, 0.28);
  backdrop-filter: blur(10px);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  opacity: 0.82;
}

.svpWatermarkTop {
  font-size: 11px;
  font-weight: 900;
  color: rgba(255, 255, 255, 0.9);
}

.svpWatermarkBottom {
  margin-top: 2px;
  font-size: 11px;
  color: rgba(255, 255, 255, 0.65);
  font-weight: 800;
}

.svpSide {
  min-width: 0;
}

.svpSideCard {
  border-radius: var(--svp-radius);
  padding: 14px;
  background: linear-gradient(180deg, #121214, #0e0e10);
  border: 1px solid rgba(0, 0, 0, 0.48);
  box-shadow: 0 12px 42px rgba(0, 0, 0, 0.28);
}

.svpSideTitle {
  font-weight: 900;
  font-size: 14px;
  letter-spacing: -0.2px;
  margin-bottom: 12px;
}

.svpSideRow {
  display: flex;
  justify-content: space-between;
  gap: 10px;
  padding: 8px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.06);
}

.svpSideRow:last-of-type {
  border-bottom: 0;
}

.svpSideLabel {
  color: rgba(255, 255, 255, 0.62);
  font-size: 12px;
  font-weight: 800;
}

.svpSideValue {
  color: rgba(255, 255, 255, 0.92);
  font-size: 12px;
  font-weight: 900;
}

.svpSideDivider {
  height: 1px;
  background: rgba(255, 255, 255, 0.08);
  margin: 12px 0;
}

.svpSideTitle2 {
  font-weight: 900;
  font-size: 12px;
  color: rgba(255, 255, 255, 0.86);
  margin-bottom: 10px;
}

.svpSideBullets {
  display: grid;
  gap: 8px;
}

.svpSideBullet {
  display: grid;
  grid-template-columns: 10px 1fr;
  gap: 10px;
  align-items: center;
}

.svpSideDot {
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: rgba(255, 255, 255, 0.55);
}

.svpSideTxt {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.72);
  font-weight: 700;
}

.svpSideButton {
  margin-top: 12px;
  width: 100%;
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.14);
  background: rgba(255, 255, 255, 0.1);
  color: rgba(255, 255, 255, 0.92);
  font-weight: 900;
  cursor: pointer;
  transition: transform 120ms ease, background 120ms ease;
}

.svpSideButton:hover {
  transform: translateY(-1px);
  background: rgba(255, 255, 255, 0.13);
}

.svpSideButton:active {
  transform: translateY(0px);
}

.svpSideButtonGhost {
  background: rgba(0, 0, 0, 0.35);
}

.svpSideButtonGhost:hover {
  background: rgba(0, 0, 0, 0.45);
}


==========================================================================================
# FILE: video/playback/player/design/index.ts
==========================================================================================
// PATH: src/student/domains/video/playback/player/design/index.ts
import "./ui.css";

export * from "./ui";
export * from "./utils";


==========================================================================================
# FILE: video/playback/player/design/ui.css
==========================================================================================
/* PATH: src/student/domains/video/playback/player/design/ui.css */
.svpPill {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 9px;
  border-radius: 999px;
  font-size: 11px;
  font-weight: 900;
  color: rgba(255, 255, 255, 0.92);
  background: rgba(255, 255, 255, 0.09);
  border: 1px solid rgba(255, 255, 255, 0.12);
}

.svpPillWarn {
  color: rgba(0, 0, 0, 0.86);
  background: rgba(255, 207, 90, 0.9);
  border-color: rgba(255, 207, 90, 0.75);
}

.svpPillDanger {
  color: rgba(0, 0, 0, 0.86);
  background: rgba(255, 90, 110, 0.92);
  border-color: rgba(255, 90, 110, 0.78);
}

.svpBtn {
  width: 38px;
  height: 38px;
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.14);
  background: rgba(255, 255, 255, 0.08);
  color: rgba(255, 255, 255, 0.92);
  cursor: pointer;
  display: grid;
  place-items: center;
  transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
}

.svpBtn:hover {
  transform: translateY(-1px);
  background: rgba(255, 255, 255, 0.11);
  border-color: rgba(255, 255, 255, 0.2);
}

.svpBtn:active {
  transform: translateY(0px);
}

.svpBtn:disabled {
  cursor: not-allowed;
  opacity: 0.6;
}

.svpBtnIcon {
  font-weight: 900;
  font-size: 12px;
  letter-spacing: -0.2px;
}

.svpBtnKebab .svpBtnIcon {
  font-size: 16px;
  transform: translateY(-1px);
}

.svpRange {
  width: 100%;
  accent-color: rgba(255, 255, 255, 0.92);
  cursor: pointer;
}

.svpMenu {
  position: relative;
}

.svpMenuPanel {
  position: absolute;
  top: 44px;
  left: 0;
  width: 220px;
  border-radius: 14px;
  padding: 6px;
  background: rgba(12, 12, 14, 0.92);
  border: 1px solid rgba(255, 255, 255, 0.12);
  box-shadow: 0 18px 60px rgba(0, 0, 0, 0.48);
  backdrop-filter: blur(12px);
  z-index: 50;
}

.svpMenuRight {
  left: auto;
  right: 0;
}

.svpMenuItem {
  width: 100%;
  text-align: left;
  padding: 10px 10px;
  border: 0;
  border-radius: 10px;
  background: transparent;
  color: rgba(255, 255, 255, 0.88);
  font-weight: 900;
  cursor: pointer;
  font-size: 12px;
}

.svpMenuItem:hover {
  background: rgba(255, 255, 255, 0.08);
}

.svpToast {
  position: fixed;
  left: 50%;
  bottom: 18px;
  transform: translateX(-50%);
  z-index: 1000;

  display: flex;
  align-items: center;
  gap: 10px;

  padding: 10px 12px;
  border-radius: 14px;
  background: rgba(15, 15, 18, 0.92);
  border: 1px solid rgba(255, 255, 255, 0.16);
  box-shadow: 0 18px 70px rgba(0, 0, 0, 0.55);
  backdrop-filter: blur(12px);
}

.svpToastWarn {
  border-color: rgba(255, 207, 90, 0.35);
}

.svpToastDanger {
  border-color: rgba(255, 90, 110, 0.35);
}

.svpToastText {
  font-size: 12px;
  font-weight: 900;
  color: rgba(255, 255, 255, 0.92);
  max-width: min(680px, 86vw);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.svpToastClose {
  width: 30px;
  height: 30px;
  border-radius: 10px;
  border: 1px solid rgba(255, 255, 255, 0.12);
  background: rgba(255, 255, 255, 0.06);
  color: rgba(255, 255, 255, 0.9);
  cursor: pointer;
  display: grid;
  place-items: center;
  font-weight: 900;
}


==========================================================================================
# FILE: video/playback/player/design/ui.tsx
==========================================================================================
// PATH: src/student/domains/video/playback/player/design/ui.tsx
import { useEffect, useMemo, useRef, useState } from "react";
import { clamp } from "./utils";

export function Pill({
  children,
  tone = "neutral",
}: {
  children: any;
  tone?: "neutral" | "warn" | "danger";
}) {
  const cls =
    tone === "danger"
      ? "svpPill svpPillDanger"
      : tone === "warn"
        ? "svpPill svpPillWarn"
        : "svpPill";
  return <span className={cls}>{children}</span>;
}

export function IconButton({
  icon,
  label,
  onClick,
  onPointerDown,
}: {
  icon:
    | "play"
    | "pause"
    | "replay10"
    | "forward10"
    | "volume"
    | "mute"
    | "fullscreen"
    | "theater"
    | "shrink";
  label: string;
  onClick?: () => void;
  /** ëª¨ë°”ì¼ì—ì„œ ì „ì²´í™”ë©´ ë“± ì‚¬ìš©ì ì œìŠ¤ì²˜ ì§í›„ API í˜¸ì¶œìš©. ì „ë‹¬ ì‹œ pointerdownì—ì„œ í˜¸ì¶œí•˜ê³  preventDefaultë¡œ click ì¤‘ë³µ ë°©ì§€ */
  onPointerDown?: (e: React.PointerEvent) => void;
}) {
  const handlePointerDown = (e: React.PointerEvent) => {
    if (onPointerDown) {
      onPointerDown(e);
      e.preventDefault();
    }
  };
  return (
    <button
      type="button"
      className="svpBtn"
      onClick={onPointerDown ? undefined : onClick}
      onPointerDown={onPointerDown ? handlePointerDown : undefined}
      aria-label={label}
      title={label}
    >
      <span className="svpBtnIcon" aria-hidden="true">
        {icon === "play" ? "â–¶" : null}
        {icon === "pause" ? "âšâš" : null}
        {icon === "replay10" ? "â†º10" : null}
        {icon === "forward10" ? "10â†»" : null}
        {icon === "volume" ? "ğŸ”Š" : null}
        {icon === "mute" ? "ğŸ”‡" : null}
        {icon === "fullscreen" ? "â›¶" : null}
        {icon === "theater" ? "â–­" : null}
        {icon === "shrink" ? "â–¢" : null}
      </span>
    </button>
  );
}

export function RangeSlider({
  value,
  min,
  max,
  step,
  onChange,
  ariaLabel,
}: {
  value: number;
  min: number;
  max: number;
  step?: number;
  onChange: (v: number) => void;
  ariaLabel?: string;
}) {
  const v = Number(value || 0);
  const mn = Number(min || 0);
  const mx = Math.max(mn + 0.0001, Number(max || 0));
  const st = Number(step || 0.01);

  return (
    <input
      className="svpRange"
      type="range"
      value={clamp(v, mn, mx)}
      min={mn}
      max={mx}
      step={st}
      onChange={(e) => onChange(Number(e.target.value))}
      aria-label={ariaLabel || "range"}
    />
  );
}

export type MenuItem = {
  label: string;
  onClick: () => void;
};

export function KebabMenu({
  label,
  items,
  align = "left",
  disabled,
  buttonClassName,
}: {
  label: string;
  items: MenuItem[];
  align?: "left" | "right";
  disabled?: boolean;
  buttonClassName?: string;
}) {
  const [open, setOpen] = useState(false);
  const root = useRef<HTMLDivElement | null>(null);

  useEffect(() => {
    const onDown = (e: any) => {
      if (!root.current) return;
      if (!root.current.contains(e.target)) setOpen(false);
    };
    window.addEventListener("mousedown", onDown);
    return () => window.removeEventListener("mousedown", onDown);
  }, []);

  return (
    <div className="svpMenu" ref={root}>
      <button
        type="button"
        className={`svpBtn svpBtnKebab ${buttonClassName || ""}`}
        onClick={() => !disabled && setOpen((v) => !v)}
        aria-label={label}
        title={label}
        disabled={!!disabled}
      >
        <span className="svpBtnIcon" aria-hidden="true">
          â‹®
        </span>
      </button>

      {open && !disabled && (
        <div className={`svpMenuPanel ${align === "right" ? "svpMenuRight" : ""}`}>
          {items.map((it, idx) => (
            <button
              key={idx}
              type="button"
              className="svpMenuItem"
              onClick={() => {
                setOpen(false);
                it.onClick();
              }}
            >
              {it.label}
            </button>
          ))}
        </div>
      )}
    </div>
  );
}

export function PlayerToast({
  toast,
  onClose,
}: {
  toast: { text: string; kind?: "info" | "warn" | "danger" } | null;
  onClose: () => void;
}) {
  const t = toast;
  const [show, setShow] = useState(!!t);

  useEffect(() => {
    if (!t) {
      setShow(false);
      return;
    }
    setShow(true);
    const id = window.setTimeout(() => onClose(), 2600);
    return () => window.clearTimeout(id);
  }, [t, onClose]);

  if (!t || !show) return null;

  const cls =
    t.kind === "danger" ? "svpToast svpToastDanger" : t.kind === "warn" ? "svpToast svpToastWarn" : "svpToast";

  return (
    <div className={cls} role="status" aria-live="polite">
      <div className="svpToastText">{t.text}</div>
      <button type="button" className="svpToastClose" onClick={onClose} aria-label="ë‹«ê¸°">
        âœ•
      </button>
    </div>
  );
}


==========================================================================================
# FILE: video/playback/player/design/utils.ts
==========================================================================================
// PATH: src/student/domains/video/playback/player/design/utils.ts
export function clamp(v: number, min: number, max: number) {
  const n = Number(v);
  if (!Number.isFinite(n)) return min;
  return Math.max(min, Math.min(max, n));
}

export function safeParseInt(v: any, fallback?: number): number | null {
  if (v == null) return fallback ?? null;
  const n = Number.parseInt(String(v), 10);
  if (Number.isNaN(n)) return fallback ?? null;
  return n;
}

export function safeParseFloat(v: any, fallback?: number): number | null {
  if (v == null) return fallback ?? null;
  const n = Number.parseFloat(String(v));
  if (Number.isNaN(n)) return fallback ?? null;
  return n;
}

export function formatClock(sec: number) {
  const s = Math.max(0, Math.floor(Number(sec) || 0));
  const h = Math.floor(s / 3600);
  const m = Math.floor((s % 3600) / 60);
  const ss = s % 60;

  if (h > 0) {
    return `${h}:${String(m).padStart(2, "0")}:${String(ss).padStart(2, "0")}`;
  }
  return `${m}:${String(ss).padStart(2, "0")}`;
}

export function getEpochSec() {
  return Math.floor(Date.now() / 1000);
}

export function formatDateTimeKorean(ms: number) {
  if (!ms) return "-";
  const d = new Date(ms);
  if (Number.isNaN(d.getTime())) return "-";
  const y = d.getFullYear();
  const m = String(d.getMonth() + 1).padStart(2, "0");
  const day = String(d.getDate()).padStart(2, "0");
  const hh = String(d.getHours()).padStart(2, "0");
  const mm = String(d.getMinutes()).padStart(2, "0");
  return `${y}-${m}-${day} ${hh}:${mm}`;
}

export function getOrCreateDeviceId() {
  const key = "student_device_id_v1";
  let v = "";
  try {
    v = String(localStorage.getItem(key) || "");
  } catch {
    v = "";
  }
  if (v && v.length >= 12) return v;

  const seed = Math.random().toString(16).slice(2);
  const now = Date.now().toString(16);
  v = `dev_${now}_${seed}`.replace(/[^a-zA-Z0-9_]/g, "").slice(0, 42);

  try {
    localStorage.setItem(key, v);
  } catch {}

  return v;
}


==========================================================================================
# FILE: video/utils/format.ts
==========================================================================================
// PATH: src/student/domains/video/utils/format.ts
/**
 * ë¹„ë””ì˜¤ ë„ë©”ì¸ ê³µí†µ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
 */

/**
 * ì´ˆë¥¼ ì‹œê°„ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (ì˜ˆ: "1ì‹œê°„ 30ë¶„", "45ë¶„")
 */
export function formatDuration(sec: number | null | undefined): string {
  if (sec == null || sec <= 0) return "0ë¶„";
  const h = Math.floor(sec / 3600);
  const m = Math.floor((sec % 3600) / 60);
  if (h > 0) return `${h}ì‹œê°„ ${m}ë¶„`;
  return `${m}ë¶„`;
}

/**
 * ì´ˆë¥¼ ì‹œ:ë¶„:ì´ˆ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (ì˜ˆ: "1:30:45", "45:30")
 */
export function formatDurationDetailed(sec: number | null | undefined): string {
  if (sec == null || sec <= 0) return "0:00";
  const h = Math.floor(sec / 3600);
  const m = Math.floor((sec % 3600) / 60);
  const s = Math.floor(sec % 60);
  if (h > 0) return `${h}:${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;
  return `${m}:${String(s).padStart(2, "0")}`;
}
