====================================================================================================
# FRONTEND FOLDER: student__domains
# ROOT PATH: C:\academyfront\src\student\domains
====================================================================================================


==========================================================================================
# FILE: dashboard/api/dashboard.ts
==========================================================================================
// PATH: src/student/domains/dashboard/api/dashboard.ts

import api from "@/student/shared/api/studentApi";

export async function fetchStudentDashboard() {
  const res = await api.get("/student/dashboard/");
  const data = res.data ?? {};
  return {
    notices: Array.isArray(data.notices) ? data.notices : [],
    today_sessions: Array.isArray(data.today_sessions)
      ? data.today_sessions
      : [],
    badges: typeof data.badges === "object" && data.badges ? data.badges : {},
  };
}


==========================================================================================
# FILE: dashboard/components/NoticeBanner.tsx
==========================================================================================
// src/student/domains/dashboard/components/NoticeBanner.tsx
/**
 * âœ… NoticeBanner (MVP)
 * - ê³µì§€ 1ê°œë§Œ ë³´ì—¬ì£¼ëŠ” í˜•íƒœ
 * - íŒë‹¨/í•„í„°ë§ âŒ
 */

import EmptyState from "@/student/shared/components/EmptyState";
import { DashboardNotice } from "@/student/domains/dashboard/api/dashboard";
import { formatYmd } from "@/student/shared/utils/date";

export default function NoticeBanner({ notices }: { notices: DashboardNotice[] }) {
  if (!notices.length) {
    return <EmptyState title="ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤." />;
  }

  const first = notices[0];

  return (
    <div
      style={{
        border: "1px solid #eee",
        borderRadius: 12,
        background: "#fff",
        padding: 14,
      }}
    >
      <div style={{ display: "flex", justifyContent: "space-between", gap: 10 }}>
        <div style={{ fontWeight: 800 }}>ğŸ“£ ê³µì§€ì‚¬í•­</div>
        <div style={{ fontSize: 12, color: "#777" }}>
          {formatYmd(first.created_at ?? null)}
        </div>
      </div>
      <div style={{ marginTop: 8, color: "#333" }}>{first.title}</div>
    </div>
  );
}


==========================================================================================
# FILE: dashboard/components/QuickActionGrid.tsx
==========================================================================================
// src/student/domains/dashboard/components/QuickActionGrid.tsx
/**
 * âœ… QuickActionGrid
 * - ì´ë¯¸ì§€ì˜ "ë°”ë¡œê°€ê¸° 4ê°œ" êµ¬í˜„
 * - ë§í¬ë§Œ ì œê³µ (íŒë‹¨/ê³„ì‚° âŒ)
 */

import { Link } from "react-router-dom";

export default function QuickActionGrid() {
  const items = [
    { label: "ê³¼ì œ ì œì¶œ", to: "/student/assignments" }, // ì¶”í›„ ë„ë©”ì¸ ì—°ê²°
    { label: "í•™ìŠµìë£Œ", to: "/student/materials" }, // ì¶”í›„ ë„ë©”ì¸ ì—°ê²°
    { label: "ì‹œí—˜ Â· í‰ê°€", to: "/student/exams" },
    { label: "ì„±ì  ê´€ë¦¬", to: "/student/grades" },
  ];

  return (
    <div
      style={{
        border: "1px solid #eee",
        borderRadius: 12,
        background: "#fff",
        padding: 14,
      }}
    >
      <div style={{ fontWeight: 800, marginBottom: 10 }}>ë°”ë¡œê°€ê¸°</div>

      <div
        style={{
          display: "grid",
          gridTemplateColumns: "1fr 1fr",
          gap: 10,
        }}
      >
        {items.map((it) => (
          <Link
            key={it.to}
            to={it.to}
            style={{
              textDecoration: "none",
              border: "1px solid #eee",
              borderRadius: 10,
              padding: "14px 12px",
              fontWeight: 700,
              color: "#111",
              background: "#fafafa",
            }}
          >
            {it.label}
          </Link>
        ))}
      </div>

      <div style={{ marginTop: 10, fontSize: 12, color: "#777" }}>
        â€» ê³¼ì œ/ìë£ŒëŠ” ì¶”í›„ ë„ë©”ì¸ ì—°ê²° ì˜ˆì • (ë¼ìš°íŒ… ìë¦¬ë§Œ í™•ë³´)
      </div>
    </div>
  );
}


==========================================================================================
# FILE: dashboard/components/TodaySessionsCard.tsx
==========================================================================================
// src/student/domains/dashboard/components/TodaySessionsCard.tsx
/**
 * âœ… TodaySessionsCard (MVP)
 * - "ì˜¤ëŠ˜ í•  ì¼" ì¹´ë“œ
 * - ì •ë ¬/íŒë‹¨ âŒ (ë°±ì—”ë“œê°€ ì¤€ ìˆœì„œ ê·¸ëŒ€ë¡œ)
 */

import { Link } from "react-router-dom";
import EmptyState from "@/student/shared/components/EmptyState";
import SectionHeader from "@/student/shared/components/SectionHeader";
import { DashboardSession } from "@/student/domains/dashboard/api/dashboard";
import { formatYmd } from "@/student/shared/utils/date";

export default function TodaySessionsCard({ sessions }: { sessions: DashboardSession[] }) {
  return (
    <div style={{ border: "1px solid #eee", borderRadius: 12, background: "#fff", padding: 14 }}>
      <SectionHeader title="ì˜¤ëŠ˜ í•  ì¼" right={<span style={{ fontSize: 12, color: "#777" }}>ì°¨ì‹œ</span>} />

      {!sessions.length && (
        <EmptyState title="ì˜¤ëŠ˜ í•  ì°¨ì‹œê°€ ì—†ìŠµë‹ˆë‹¤." description="ë°±ì—”ë“œê°€ ë‚´ë ¤ì£¼ëŠ” í•  ì¼ ëª©ë¡ì„ ê·¸ëŒ€ë¡œ í‘œì‹œí•©ë‹ˆë‹¤." />
      )}

      {sessions.length > 0 && (
        <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
          {sessions.map((s) => (
            <Link
              key={s.id}
              to={`/student/sessions/${s.id}`}
              style={{
                textDecoration: "none",
                border: "1px solid #eee",
                borderRadius: 10,
                padding: 12,
                display: "flex",
                justifyContent: "space-between",
                alignItems: "center",
                color: "#111",
              }}
            >
              <div>
                <div style={{ fontWeight: 800 }}>{s.title}</div>
                <div style={{ marginTop: 4, fontSize: 12, color: "#777" }}>
                  {formatYmd(s.date ?? null)}
                  {s.status ? ` Â· ${s.status}` : ""}
                </div>
              </div>
              <div style={{ color: "#999" }}>â€º</div>
            </Link>
          ))}
        </div>
      )}
    </div>
  );
}


==========================================================================================
# FILE: dashboard/hooks/useStudentDashboard.ts
==========================================================================================
// src/student/domains/dashboard/hooks/useStudentDashboard.ts
/**
 * âœ… useStudentDashboard
 * - Dashboard ë‹¨ì¼ ì¿¼ë¦¬
 */

import { useQuery } from "@tanstack/react-query";
import { fetchStudentDashboard } from "@/student/domains/dashboard/api/dashboard";

export function useStudentDashboard() {
  return useQuery({
    queryKey: ["student-dashboard"],
    queryFn: fetchStudentDashboard,
  });
}


==========================================================================================
# FILE: dashboard/pages/DashboardPage.tsx
==========================================================================================
// src/student/domains/dashboard/pages/DashboardPage.tsx
/**
 * âœ… DashboardPage (LOCK v1)
 * - í•™ìƒì•±ì˜ í–‰ë™ í—ˆë¸Œ
 * - ì´ë¯¸ì§€ UI êµ¬ì¡°ë¥¼ ê·¸ëŒ€ë¡œ ë„ë©”ì¸í™”í•œ í˜ì´ì§€
 *
 * ì›ì¹™:
 * - ì˜¤ëŠ˜ í•  ì¼/ì •ë ¬/íŒë‹¨ âŒ
 * - ë°±ì—”ë“œ ì‘ë‹µ ê·¸ëŒ€ë¡œ ë Œë”ë§ âœ…
 */

import StudentPageShell from "@/student/shared/components/StudentPageShell";
import { useStudentDashboard } from "@/student/domains/dashboard/hooks/useStudentDashboard";
import NoticeBanner from "@/student/domains/dashboard/components/NoticeBanner";
import TodaySessionsCard from "@/student/domains/dashboard/components/TodaySessionsCard";
import QuickActionGrid from "@/student/domains/dashboard/components/QuickActionGrid";
import EmptyState from "@/student/shared/components/EmptyState";

export default function DashboardPage() {
  const { data, isLoading, isError } = useStudentDashboard();

  if (isLoading) {
    return (
      <StudentPageShell title="í™ˆ" description="ì˜¤ëŠ˜ í•´ì•¼ í•  ì¼ì„ í™•ì¸í•˜ì„¸ìš”.">
        <div style={{ color: "#666", fontSize: 14 }}>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </StudentPageShell>
    );
  }

  if (isError || !data) {
    return (
      <StudentPageShell title="í™ˆ" description="ì˜¤ëŠ˜ í•´ì•¼ í•  ì¼ì„ í™•ì¸í•˜ì„¸ìš”.">
        <EmptyState title="ëŒ€ì‹œë³´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤." description="ë°±ì—”ë“œ ì‘ë‹µì„ í™•ì¸í•´ì£¼ì„¸ìš”." />
      </StudentPageShell>
    );
  }

  return (
    <StudentPageShell title="í™ˆ" description="ì˜¤ëŠ˜ í•´ì•¼ í•  ì¼ì„ í™•ì¸í•˜ì„¸ìš”.">
      <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
        <NoticeBanner notices={data.notices} />
        <TodaySessionsCard sessions={data.today_sessions} />
        <QuickActionGrid />
      </div>
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: exams/api/assets.ts
==========================================================================================
// src/student/domains/exams/api/assets.ts
/**
 * âœ… Student Exam Assets API (LOCK v1)
 * - í•™ìƒì€ downloadë§Œ (ì—…ë¡œë“œëŠ” ê´€ë¦¬ì/êµì‚¬)
 * - asset_type ì˜ë¯¸ í•´ì„ âŒ
 */

import api from "@/student/shared/api/studentApi";

export type ExamAsset = {
  id: number;
  asset_type: string;
  download_url: string;
};

export async function fetchExamAssets(examId: number): Promise<ExamAsset[]> {
  const res = await api.get(`/exams/${examId}/assets/`);
  const data = res.data;
  if (Array.isArray(data?.items)) return data.items as ExamAsset[];
  if (Array.isArray(data)) return data as ExamAsset[];
  return [];
}


==========================================================================================
# FILE: exams/api/exams.ts
==========================================================================================
// PATH: src/student/domains/exams/api/exams.ts

import api from "@/student/shared/api/studentApi";

export type StudentExam = {
  id: number;
  title: string;
  open_at: string | null;
  close_at: string | null;
  allow_retake: boolean;
  max_attempts: number;
  pass_score: number;
  description?: string | null;
  session_id?: number | null;
};

export type ExamsListResponse = {
  items: StudentExam[];
};

export async function fetchStudentExams(): Promise<ExamsListResponse> {
  const res = await api.get("/student/exams/");
  const data = res.data;
  if (data?.items && Array.isArray(data.items)) return data as ExamsListResponse;
  if (Array.isArray(data)) return { items: data as StudentExam[] };
  return { items: [] };
}

export async function fetchStudentExam(examId: number): Promise<StudentExam> {
  const res = await api.get(`/student/exams/${examId}/`);
  return res.data as StudentExam;
}


==========================================================================================
# FILE: exams/api/results.ts
==========================================================================================
// PATH: src/student/domains/exams/api/results.ts

import api from "@/student/shared/api/studentApi";

export type MyExamResult = {
  exam_id: number;
  attempt_id: number;
  total_score: number;
  max_score: number;
  is_pass: boolean;
  submitted_at: string | null;
  can_retake: boolean;
};

export type MyExamResultItem = {
  question_id: number;
  question_number: number;
  student_answer: string | null;
  correct_answer: string | null;
  score: number;
  max_score: number;
  is_correct: boolean;
  meta?: Record<string, any>;
};

export async function fetchMyExamResult(examId: number): Promise<MyExamResult> {
  const res = await api.get(`/student/results/me/exams/${examId}/`);
  return res.data as MyExamResult;
}

export async function fetchMyExamResultItems(
  examId: number
): Promise<MyExamResultItem[]> {
  const res = await api.get(`/student/results/me/exams/${examId}/items/`);
  const data = res.data;
  if (Array.isArray(data?.items)) return data.items as MyExamResultItem[];
  if (Array.isArray(data)) return data as MyExamResultItem[];
  return [];
}


==========================================================================================
# FILE: exams/components/ExamActionButton.tsx
==========================================================================================



==========================================================================================
# FILE: exams/components/ExamCard.tsx
==========================================================================================



==========================================================================================
# FILE: exams/components/ExamResultItems.tsx
==========================================================================================



==========================================================================================
# FILE: exams/components/ExamResultSummary.tsx
==========================================================================================



==========================================================================================
# FILE: exams/hooks/useMyExamResult.ts
==========================================================================================
// src/student/domains/exams/hooks/useMyExamResult.ts
/**
 * âœ… useMyExamResult (LOCK v1)
 */

import { useQuery } from "@tanstack/react-query";
import { fetchMyExamResult } from "@/student/domains/exams/api/results";

export function useMyExamResult(examId?: number) {
  const safeId = Number(examId);

  return useQuery({
    queryKey: ["my-exam-result", safeId],
    queryFn: () => fetchMyExamResult(safeId),
    enabled: Number.isFinite(safeId),
  });
}


==========================================================================================
# FILE: exams/hooks/useMyExamResultItems.ts
==========================================================================================
// src/student/domains/exams/hooks/useMyExamResultItems.ts
/**
 * âœ… useMyExamResultItems (LOCK v1)
 */

import { useQuery } from "@tanstack/react-query";
import { fetchMyExamResultItems } from "@/student/domains/exams/api/results";

export function useMyExamResultItems(examId?: number) {
  const safeId = Number(examId);

  return useQuery({
    queryKey: ["my-exam-result-items", safeId],
    queryFn: () => fetchMyExamResultItems(safeId),
    enabled: Number.isFinite(safeId),
  });
}


==========================================================================================
# FILE: exams/hooks/useStudentExams.ts
==========================================================================================
// src/student/domains/exams/hooks/useStudentExams.ts
/**
 * âœ… useStudentExams / useStudentExam
 */

import { useQuery } from "@tanstack/react-query";
import { fetchStudentExam, fetchStudentExams } from "@/student/domains/exams/api/exams";

export function useStudentExams(params?: { session_id?: number }) {
  const sessionId = params?.session_id;
  const enabled = sessionId == null ? true : Number.isFinite(Number(sessionId));

  return useQuery({
    queryKey: ["student-exams", params ?? {}],
    queryFn: () => fetchStudentExams(params),
    enabled,
  });
}

export function useStudentExam(examId?: number) {
  const safeId = Number(examId);
  return useQuery({
    queryKey: ["student-exam", safeId],
    queryFn: () => fetchStudentExam(safeId),
    enabled: Number.isFinite(safeId),
  });
}


==========================================================================================
# FILE: exams/pages/ExamDetailPage.tsx
==========================================================================================
// src/student/domains/exams/pages/ExamDetailPage.tsx
/**
 * âœ… ExamDetailPage (í•™ìƒ)
 * - ìì‚° ë‹¤ìš´ë¡œë“œ + ê²°ê³¼/ì œì¶œ ì§„ì…
 *
 * ì›ì¹™:
 * - ì‘ì‹œ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ í”„ë¡ íŠ¸ì—ì„œ íŒë‹¨ âŒ
 * - "ì¬ì‹œí—˜ ë²„íŠ¼" íŒë‹¨ì€ Result APIì˜ can_retakeë§Œ ì‹ ë¢° âœ…
 */

import { Link, useParams } from "react-router-dom";
import StudentPageShell from "@/student/shared/components/StudentPageShell";
import EmptyState from "@/student/shared/components/EmptyState";
import { useStudentExam } from "@/student/domains/exams/hooks/useStudentExams";
import { useMyExamResult } from "@/student/domains/exams/hooks/useMyExamResult";
import { useQuery } from "@tanstack/react-query";
import { fetchExamAssets } from "@/student/domains/exams/api/assets";

export default function ExamDetailPage() {
  const { examId } = useParams();
  const safeId = Number(examId);

  const examQ = useStudentExam(Number.isFinite(safeId) ? safeId : undefined);

  // âœ… ê²°ê³¼ëŠ” "ë‹¨ì¼ ì§„ì‹¤": can_retake í¬í•¨
  const resultQ = useMyExamResult(Number.isFinite(safeId) ? safeId : undefined);

  // âœ… ìì‚° ëª©ë¡
  const assetsQ = useQuery({
    queryKey: ["student-exam-assets", safeId],
    queryFn: () => fetchExamAssets(safeId),
    enabled: Number.isFinite(safeId),
  });

  if (!Number.isFinite(safeId)) {
    return (
      <StudentPageShell title="ì‹œí—˜" description="ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.">
        <EmptyState title="ì‹œí—˜ IDê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  if (examQ.isLoading) {
    return (
      <StudentPageShell title="ì‹œí—˜" description="ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...">
        <div style={{ fontSize: 14, color: "#666" }}>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </StudentPageShell>
    );
  }

  if (examQ.isError || !examQ.data) {
    return (
      <StudentPageShell title="ì‹œí—˜" description="ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.">
        <EmptyState title="ì‹œí—˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  const exam = examQ.data;
  const canRetake = typeof resultQ.data?.can_retake === "boolean" ? resultQ.data.can_retake : true;

  return (
    <StudentPageShell
      title={exam.title}
      description="ìì‚° ë‹¤ìš´ë¡œë“œ / ì œì¶œ / ê²°ê³¼ ì¡°íšŒ"
      actions={
        <Link to="/student/exams" style={linkBtn}>
          ëª©ë¡
        </Link>
      }
    >
      <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
        {/* ===== Assets ===== */}
        <div style={card}>
          <div style={{ fontWeight: 900, marginBottom: 8 }}>ìì‚°</div>

          {assetsQ.isLoading && <div style={{ fontSize: 13, color: "#666" }}>ìì‚° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>}
          {assetsQ.isError && <div style={{ fontSize: 13, color: "#c00" }}>ìì‚° ì¡°íšŒ ì‹¤íŒ¨</div>}

          {assetsQ.data && assetsQ.data.length === 0 && (
            <div style={{ fontSize: 13, color: "#777" }}>ë“±ë¡ëœ ìì‚°ì´ ì—†ìŠµë‹ˆë‹¤.</div>
          )}

          {assetsQ.data && assetsQ.data.length > 0 && (
            <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
              {assetsQ.data.map((a) => (
                <a
                  key={a.id}
                  href={a.download_url}
                  target="_blank"
                  rel="noreferrer"
                  style={{ ...linkBtn, width: "fit-content" }}
                >
                  ë‹¤ìš´ë¡œë“œ: {a.asset_type}
                </a>
              ))}
            </div>
          )}
        </div>

        {/* ===== Actions ===== */}
        <div style={card}>
          <div style={{ fontWeight: 900, marginBottom: 8 }}>ì‘ì‹œ / ê²°ê³¼</div>

          <div style={{ display: "flex", gap: 8, flexWrap: "wrap" }}>
            <Link to={`/student/exams/${exam.id}/result`} style={linkBtn}>
              ê²°ê³¼ ë³´ê¸°
            </Link>

            {/* âœ… can_retakeë§Œ ì‹ ë¢° */}
            <Link
              to={`/student/exams/${exam.id}/submit`}
              style={{
                ...linkBtn,
                opacity: canRetake ? 1 : 0.4,
                pointerEvents: canRetake ? "auto" : "none",
              }}
            >
              {canRetake ? "ì œì¶œí•˜ê¸°" : "ì¬ì‹œí—˜ ë¶ˆê°€"}
            </Link>
          </div>

          <div style={{ marginTop: 8, fontSize: 12, color: "#777" }}>
            â€» ì¬ì‹œí—˜ ê°€ëŠ¥ ì—¬ë¶€ëŠ” ê²°ê³¼ APIì˜ <b>can_retake</b>ë§Œ ì‹ ë¢°í•©ë‹ˆë‹¤.
          </div>
        </div>
      </div>
    </StudentPageShell>
  );
}

const card: React.CSSProperties = {
  border: "1px solid #eee",
  borderRadius: 12,
  padding: 14,
  background: "#fff",
};

const linkBtn: React.CSSProperties = {
  display: "inline-block",
  padding: "10px 12px",
  borderRadius: 10,
  border: "1px solid #ddd",
  textDecoration: "none",
  background: "#fafafa",
  color: "#111",
  fontWeight: 800,
};


==========================================================================================
# FILE: exams/pages/ExamListPage.tsx
==========================================================================================
// src/student/domains/exams/pages/ExamListPage.tsx
/**
 * âœ… ExamListPage (í•™ìƒ)
 * - ì‹œí—˜ ëª©ë¡
 * - session_id query param ì§€ì› (ì„¸ì…˜ í—ˆë¸Œì—ì„œ ì§„ì… ì‹œ ìœ ìš©)
 *
 * ì›ì¹™:
 * - OPEN/CLOSED íŒë‹¨ âŒ
 * - ë°±ì—”ë“œ í•„ë“œ ê·¸ëŒ€ë¡œ ë…¸ì¶œ âœ…
 */

import { Link, useSearchParams } from "react-router-dom";
import StudentPageShell from "@/student/shared/components/StudentPageShell";
import EmptyState from "@/student/shared/components/EmptyState";
import { useStudentExams } from "@/student/domains/exams/hooks/useStudentExams";
import { formatYmd } from "@/student/shared/utils/date";

export default function ExamListPage() {
  const [sp] = useSearchParams();
  const sessionParam = sp.get("session");
  const sessionId = sessionParam ? Number(sessionParam) : undefined;

  const { data, isLoading, isError } = useStudentExams(
    sessionId ? { session_id: sessionId } : undefined
  );

  const items = data?.items ?? [];

  return (
    <StudentPageShell
      title="ì‹œí—˜"
      description={sessionId ? `ì„¸ì…˜(${sessionId}) ê¸°ì¤€ ì‹œí—˜ ëª©ë¡` : "ì „ì²´ ì‹œí—˜ ëª©ë¡"}
    >
      {isLoading && <div style={{ fontSize: 14, color: "#666" }}>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>}

      {(isError || !data) && <EmptyState title="ì‹œí—˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤." />}

      {data && items.length === 0 && (
        <EmptyState title="ì‹œí—˜ì´ ì—†ìŠµë‹ˆë‹¤." description="ë“±ë¡ëœ ì‹œí—˜ì´ ì—†ê±°ë‚˜ ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤." />
      )}

      {items.length > 0 && (
        <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
          {items.map((e) => (
            <Link
              key={e.id}
              to={`/student/exams/${e.id}`}
              style={{
                textDecoration: "none",
                border: "1px solid #eee",
                borderRadius: 10,
                padding: 12,
                background: "#fff",
                color: "#111",
              }}
            >
              <div style={{ fontWeight: 900 }}>{e.title}</div>
              <div style={{ marginTop: 4, fontSize: 12, color: "#777" }}>
                open: {formatYmd(e.open_at)} Â· close: {formatYmd(e.close_at)}
              </div>
            </Link>
          ))}
        </div>
      )}
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: exams/pages/ExamResultPage.tsx
==========================================================================================
// src/student/domains/exams/pages/ExamResultPage.tsx
/**
 * âœ… ExamResultPage (í•™ìƒ ê²°ê³¼)
 * - ëŒ€í‘œ Result + ResultItem(ë¬¸í•­ë³„) ë Œë”ë§
 * - íŒë‹¨/ê³„ì‚° âŒ
 * - can_retake / is_pass ê·¸ëŒ€ë¡œ ì‚¬ìš© âœ…
 */

import { Link, useParams } from "react-router-dom";
import StudentPageShell from "@/student/shared/components/StudentPageShell";
import EmptyState from "@/student/shared/components/EmptyState";
import { useMyExamResult } from "@/student/domains/exams/hooks/useMyExamResult";
import { useMyExamResultItems } from "@/student/domains/exams/hooks/useMyExamResultItems";

export default function ExamResultPage() {
  const { examId } = useParams();
  const safeId = Number(examId);

  const resultQ = useMyExamResult(Number.isFinite(safeId) ? safeId : undefined);
  const itemsQ = useMyExamResultItems(Number.isFinite(safeId) ? safeId : undefined);

  if (!Number.isFinite(safeId)) {
    return (
      <StudentPageShell title="ì‹œí—˜ ê²°ê³¼" description="ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.">
        <EmptyState title="ì‹œí—˜ IDê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  if (resultQ.isLoading) {
    return (
      <StudentPageShell title="ì‹œí—˜ ê²°ê³¼" description="ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...">
        <div style={{ fontSize: 14, color: "#666" }}>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </StudentPageShell>
    );
  }

  if (resultQ.isError || !resultQ.data) {
    return (
      <StudentPageShell title="ì‹œí—˜ ê²°ê³¼" description="ì¡°íšŒ ì‹¤íŒ¨">
        <EmptyState
          title="ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤."
          description="ì•„ì§ ì±„ì  ì „ì´ê±°ë‚˜ ê¶Œí•œ/ë°ì´í„°ê°€ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
        />
      </StudentPageShell>
    );
  }

  const r = resultQ.data;

  return (
    <StudentPageShell
      title="ì‹œí—˜ ê²°ê³¼"
      description={`exam_id: ${r.exam_id} Â· attempt_id: ${r.attempt_id}`}
      actions={
        <Link to={`/student/exams/${safeId}`} style={linkBtn}>
          ì‹œí—˜ìœ¼ë¡œ
        </Link>
      }
    >
      <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
        {/* ===== Summary ===== */}
        <div style={card}>
          <div style={{ fontWeight: 900 }}>ìš”ì•½</div>

          <div style={{ marginTop: 8, display: "flex", gap: 10, alignItems: "center" }}>
            <div style={{ fontSize: 22, fontWeight: 900 }}>
              {r.total_score} / {r.max_score}
            </div>

            <span
              style={{
                padding: "4px 8px",
                borderRadius: 999,
                fontSize: 12,
                fontWeight: 900,
                background: r.is_pass ? "#e8fff0" : "#ffecec",
                color: r.is_pass ? "#0a7a38" : "#b10000",
              }}
            >
              {r.is_pass ? "í†µê³¼" : "ë¯¸í†µê³¼"}
            </span>
          </div>

          <div style={{ marginTop: 8, fontSize: 13, color: "#666" }}>
            submitted_at: {r.submitted_at ?? "-"}
          </div>

          <div style={{ marginTop: 8, fontSize: 13, color: "#666" }}>
            can_retake: <b>{String(r.can_retake)}</b>
          </div>
        </div>

        {/* ===== Items ===== */}
        <div style={card}>
          <div style={{ fontWeight: 900, marginBottom: 8 }}>ë¬¸í•­ë³„ ê²°ê³¼</div>

          {itemsQ.isLoading && <div style={{ fontSize: 13, color: "#666" }}>ë¬¸í•­ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>}
          {itemsQ.isError && <div style={{ fontSize: 13, color: "#c00" }}>ë¬¸í•­ ì¡°íšŒ ì‹¤íŒ¨</div>}

          {itemsQ.data && itemsQ.data.length === 0 && (
            <div style={{ fontSize: 13, color: "#777" }}>ë¬¸í•­ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
          )}

          {itemsQ.data && itemsQ.data.length > 0 && (
            <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
              {itemsQ.data.map((it) => (
                <div
                  key={`${it.question_id}-${it.question_number}`}
                  style={{
                    border: "1px solid #eee",
                    borderRadius: 10,
                    padding: 10,
                    background: "#fafafa",
                  }}
                >
                  <div style={{ fontWeight: 900 }}>
                    Q{it.question_number} (id:{it.question_id})
                  </div>
                  <div style={{ marginTop: 6, fontSize: 13, color: "#444" }}>
                    ì •ì˜¤: <b>{it.is_correct ? "ì •ë‹µ" : "ì˜¤ë‹µ"}</b>
                    {" Â· "}
                    ì ìˆ˜: <b>{it.score}</b> / {it.max_score}
                  </div>
                  <div style={{ marginTop: 6, fontSize: 13, color: "#666" }}>
                    ë‚´ ë‹µ: {it.student_answer ?? "-"} / ì •ë‹µ: {it.correct_answer ?? "-"}
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    </StudentPageShell>
  );
}

const card: React.CSSProperties = {
  border: "1px solid #eee",
  borderRadius: 12,
  padding: 14,
  background: "#fff",
};

const linkBtn: React.CSSProperties = {
  display: "inline-block",
  padding: "10px 12px",
  borderRadius: 10,
  border: "1px solid #ddd",
  textDecoration: "none",
  background: "#fafafa",
  color: "#111",
  fontWeight: 800,
};


==========================================================================================
# FILE: exams/pages/ExamSubmitPage.tsx
==========================================================================================
// src/student/domains/exams/pages/ExamSubmitPage.tsx
/**
 * âœ… ExamSubmitPage (í•™ìƒ ì œì¶œ)
 *
 * âš ï¸ ì¤‘ìš”:
 * - Submission feature ì¬ì‚¬ìš©ì´ ì›ì¹™(C)
 * - ë‹¤ë§Œ ì´ í”„ë¡œì íŠ¸ëŠ” submissions êµ¬í˜„ì´ ì—¬ëŸ¬ ë²„ì „ì´ ì„ì—¬ìˆì„ ìˆ˜ ìˆì–´,
 *   "ì»´íŒŒì¼ ì•ˆì • + ìµœì†Œ UX" ê¸°ì¤€ìœ¼ë¡œ í™”ë©´ ê³¨ê²©ë§Œ ì œê³µí•œë‹¤.
 *
 * ì—¬ê¸°ì„œëŠ”:
 * - ì œì¶œì€ /features/submissions ë¡œ ì´ì‹/ì—°ê²°í•˜ê¸° ì‰¬ìš´ í˜•íƒœë¡œë§Œ ë‘”ë‹¤.
 * - í”„ë¡ íŠ¸ì—ì„œ ìƒíƒœ íŒë‹¨/ê³„ì‚° âŒ
 * - ì œì¶œ ì™„ë£Œ í›„: Result refetch/ì´ë™ âœ…
 */

import { Link, useNavigate, useParams } from "react-router-dom";
import StudentPageShell from "@/student/shared/components/StudentPageShell";
import EmptyState from "@/student/shared/components/EmptyState";

export default function ExamSubmitPage() {
  const { examId } = useParams();
  const safeId = Number(examId);
  const nav = useNavigate();

  if (!Number.isFinite(safeId)) {
    return (
      <StudentPageShell title="ì œì¶œ" description="ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.">
        <EmptyState title="ì‹œí—˜ IDê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  return (
    <StudentPageShell
      title="ì‹œí—˜ ì œì¶œ"
      description="OMR/ë‹µì•ˆ ì œì¶œì€ submissions featureë¡œ ì—°ê²°ë©ë‹ˆë‹¤."
      actions={
        <Link to={`/student/exams/${safeId}`} style={linkBtn}>
          ë’¤ë¡œ
        </Link>
      }
    >
      <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
        <div style={card}>
          <div style={{ fontWeight: 900 }}>ì œì¶œ UX (MVP)</div>
          <div style={{ marginTop: 8, fontSize: 13, color: "#666" }}>
            âœ… ì´ í™”ë©´ì€ â€œì œì¶œå…¥å£â€ë§Œ ë‹´ë‹¹í•©ë‹ˆë‹¤. ì‹¤ì œ ì—…ë¡œë“œ/í´ë§ì€
            <code>features/submissions</code>ë¥¼ ì¬ì‚¬ìš©í•´ì„œ ë¶™ì´ì„¸ìš”.
          </div>

          <div style={{ marginTop: 12, fontSize: 13, color: "#666" }}>
            - ì—…ë¡œë“œ ì„±ê³µ â†’ í´ë§ DONE â†’ ê²°ê³¼ í˜ì´ì§€ ì´ë™
            <br />- FAILED â†’ ì¬ì—…ë¡œë“œ ìœ ë„
          </div>

          <div style={{ marginTop: 12 }}>
            <button
              type="button"
              style={btnStyle}
              onClick={() => {
                // âœ… ì‹¤ì œ êµ¬í˜„ì€ submissionsë¡œ ë¶™ì´ë©´ ë¨
                // ì§€ê¸ˆì€ ë„¤ë¹„ UXë§Œ
                nav(`/student/exams/${safeId}/result`);
              }}
            >
              (ì„ì‹œ) ì œì¶œ ì™„ë£Œ ì²˜ë¦¬
            </button>
          </div>
        </div>

        <div style={{ fontSize: 12, color: "#777" }}>
          â€» ì—¬ê¸°ì„œ ì •ì±…/ì±„ì /ê²°ê³¼ íŒë‹¨ì„ í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤. ë°±ì—”ë“œê°€ ë‹¨ì¼ ì§„ì‹¤ì…ë‹ˆë‹¤.
        </div>
      </div>
    </StudentPageShell>
  );
}

const card: React.CSSProperties = {
  border: "1px solid #eee",
  borderRadius: 12,
  padding: 14,
  background: "#fff",
};

const linkBtn: React.CSSProperties = {
  display: "inline-block",
  padding: "10px 12px",
  borderRadius: 10,
  border: "1px solid #ddd",
  textDecoration: "none",
  background: "#fafafa",
  color: "#111",
  fontWeight: 800,
};

const btnStyle: React.CSSProperties = {
  padding: "10px 12px",
  borderRadius: 10,
  border: "1px solid #ddd",
  background: "#111",
  color: "#fff",
  fontWeight: 800,
};


==========================================================================================
# FILE: grades/api/grades.ts
==========================================================================================



==========================================================================================
# FILE: grades/components/GradeBadge.tsx
==========================================================================================



==========================================================================================
# FILE: grades/components/GradeRow.tsx
==========================================================================================



==========================================================================================
# FILE: grades/pages/GradeDetailPage.tsx
==========================================================================================



==========================================================================================
# FILE: grades/pages/GradeListPage.tsx
==========================================================================================



==========================================================================================
# FILE: grades/pages/GradesPage.tsx
==========================================================================================
// src/student/domains/grades/pages/GradesPage.tsx
/**
 * âœ… GradesPage (MVP)
 * - ì„±ì  = ê²°ê³¼ ëª¨ì•„ë³´ê¸° í—ˆë¸Œ
 * - ìƒì„¸/ì§‘ê³„ëŠ” ë°±ì—”ë“œê°€ ë‚´ë ¤ì£¼ëŠ” ê°’ë§Œ ë Œë”ë§ (ì¶”í›„ API ì—°ê²°)
 */

import StudentPageShell from "@/student/shared/components/StudentPageShell";
import EmptyState from "@/student/shared/components/EmptyState";

export default function GradesPage() {
  return (
    <StudentPageShell title="ì„±ì " description="ì‹œí—˜/ê³¼ì œ ê²°ê³¼ ìš”ì•½ í—ˆë¸Œ">
      <EmptyState
        title="ì„±ì  ë„ë©”ì¸ ì—°ê²° ì˜ˆì •"
        description="ë°±ì—”ë“œ grades API ë¶™ì´ë©´ ë¦¬ìŠ¤íŠ¸/ìƒì„¸ë¥¼ ë°”ë¡œ í™•ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
      />
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: media/api/media.ts
==========================================================================================
// PATH: C:\academyfront\src\student\domains\media\api\media.ts
import api from "@/student/shared/api/studentApi";

export type StudentVideoRule = "free" | "once" | "blocked";

export type StudentVideoListItem = {
  id: number;
  session_id: number;
  title: string;
  status: string;
  thumbnail_url?: string | null;

  allow_skip: boolean;
  max_speed: number;
  show_watermark: boolean;
  effective_rule: StudentVideoRule;
};

export type StudentSessionVideosResponse = {
  items: StudentVideoListItem[];
};

export type StudentVideoPlayback = {
  video: StudentVideoListItem;
  hls_url?: string | null;
  mp4_url?: string | null;
  policy: {
    allow_skip: boolean;
    max_speed: number;
    show_watermark: boolean;
    effective_rule: StudentVideoRule;
  };
};

export async function fetchStudentSessionVideos(
  sessionId: number,
  enrollmentId?: number | null
): Promise<StudentSessionVideosResponse> {
  const res = await api.get(`/student/media/sessions/${sessionId}/videos/`, {
    params: enrollmentId ? { enrollment: enrollmentId } : undefined,
  });
  const d = res.data;
  return {
    items: Array.isArray(d?.items) ? d.items : [],
  };
}

export async function fetchStudentVideoPlayback(
  videoId: number,
  enrollmentId?: number | null
): Promise<StudentVideoPlayback> {
  const res = await api.get(`/student/media/videos/${videoId}/playback/`, {
    params: enrollmentId ? { enrollment: enrollmentId } : undefined,
  });
  return res.data as StudentVideoPlayback;
}


==========================================================================================
# FILE: media/pages/MediaPlayerPage.tsx
==========================================================================================
// PATH: C:\academyfront\src\student\domains\media\pages\MediaPlayerPage.tsx
import { useMemo, useState } from "react";
import { useSearchParams } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";

import StudentPageShell from "@/student/shared/components/StudentPageShell";
import EmptyState from "@/student/shared/components/EmptyState";

import {
  fetchStudentSessionVideos,
  fetchStudentVideoPlayback,
  StudentVideoListItem,
} from "@/student/domains/media/api/media";

// âœ… ì´ë¯¸ í”„ë¡œì íŠ¸ì— ì¡´ì¬í•˜ëŠ” "ì§„ì§œ í•™ìƒ í”Œë ˆì´ì–´"
import StudentVideoPlayer from "@/student/media/playback/player/StudentVideoPlayer";

function Pill({
  tone,
  children,
}: {
  tone: "ok" | "warn" | "danger";
  children: React.ReactNode;
}) {
  const bg =
    tone === "danger" ? "#ffecec" : tone === "warn" ? "#fff6e5" : "#e8fff0";
  const color =
    tone === "danger" ? "#b10000" : tone === "warn" ? "#a06100" : "#0a7a38";

  return (
    <span
      style={{
        padding: "4px 10px",
        borderRadius: 999,
        background: bg,
        color,
        fontSize: 12,
        fontWeight: 900,
      }}
    >
      {children}
    </span>
  );
}

export default function MediaPlayerPage() {
  const [sp] = useSearchParams();
  const sessionId = Number(sp.get("session"));

  // enrollmentIdê°€ í•„ìš”í•˜ë©´ ì—¬ê¸°ì„œ query paramìœ¼ë¡œë„ ë°›ì„ ìˆ˜ ìˆê²Œ í™•ì¥ ê°€ëŠ¥
  // (ì§€ê¸ˆì€ ë‹¨ì¼ì§„ì‹¤ ìœ„ë°° ì—†ì´ optional)
  const enrollmentId: number | null = null;

  const [selectedVideoId, setSelectedVideoId] = useState<number | null>(null);

  const listQ = useQuery({
    queryKey: ["student-session-videos", sessionId],
    queryFn: () => fetchStudentSessionVideos(sessionId, enrollmentId),
    enabled: Number.isFinite(sessionId),
    staleTime: 3000,
    retry: 1,
  });

  const videos: StudentVideoListItem[] = listQ.data?.items ?? [];

  const activeVideoId = useMemo(() => {
    if (selectedVideoId) return selectedVideoId;
    return videos.length ? videos[0].id : null;
  }, [selectedVideoId, videos]);

  const playbackQ = useQuery({
    queryKey: ["student-video-playback", activeVideoId],
    queryFn: () => fetchStudentVideoPlayback(activeVideoId!, enrollmentId),
    enabled: !!activeVideoId,
    staleTime: 2000,
    retry: 1,
  });

  if (!Number.isFinite(sessionId)) {
    return (
      <StudentPageShell title="ì˜ìƒ" description="ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.">
        <EmptyState title="session íŒŒë¼ë¯¸í„°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  if (listQ.isLoading) {
    return (
      <StudentPageShell title="ì˜ìƒ" description={`session: ${sessionId}`}>
        <div style={{ fontSize: 14, color: "#666" }}>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </StudentPageShell>
    );
  }

  if (listQ.isError) {
    return (
      <StudentPageShell title="ì˜ìƒ" description={`session: ${sessionId}`}>
        <EmptyState title="ì˜ìƒ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  if (!videos.length) {
    return (
      <StudentPageShell title="ì˜ìƒ" description={`session: ${sessionId}`}>
        <EmptyState title="ì„¸ì…˜ì— ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  const p = playbackQ.data;
  const policy = p?.policy;

  return (
    <StudentPageShell
      title="ì˜ìƒ"
      description={`session: ${sessionId} Â· videos: ${videos.length}`}
    >
      <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
        {/* ===== video select ===== */}
        <div
          style={{
            border: "1px solid #eee",
            borderRadius: 12,
            padding: 12,
            background: "#fff",
          }}
        >
          <div style={{ fontWeight: 900, marginBottom: 8 }}>ì˜ìƒ ëª©ë¡</div>
          <div style={{ display: "flex", gap: 8, flexWrap: "wrap" }}>
            {videos.map((v) => {
              const active = v.id === activeVideoId;
              const blocked = v.effective_rule === "blocked";

              return (
                <button
                  key={v.id}
                  type="button"
                  onClick={() => setSelectedVideoId(v.id)}
                  style={{
                    padding: "10px 12px",
                    borderRadius: 10,
                    border: "1px solid #ddd",
                    background: active ? "#111" : "#fafafa",
                    color: active ? "#fff" : "#111",
                    fontWeight: 800,
                    opacity: blocked ? 0.55 : 1,
                    cursor: "pointer",
                  }}
                  title={blocked ? "ì‹œì²­ ì œí•œ" : "ì¬ìƒ"}
                >
                  #{v.id} {v.title}
                </button>
              );
            })}
          </div>
        </div>

        {/* ===== policy snapshot (single truth) ===== */}
        <div
          style={{
            border: "1px solid #eee",
            borderRadius: 12,
            padding: 12,
            background: "#fff",
          }}
        >
          <div style={{ fontWeight: 900, marginBottom: 8 }}>ì ìš© ì •ì±…(ë‹¨ì¼ì§„ì‹¤)</div>

          {!policy && playbackQ.isLoading && (
            <div style={{ fontSize: 13, color: "#666" }}>ì •ì±… ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
          )}

          {playbackQ.isError && (
            <div style={{ fontSize: 13, color: "#c00" }}>
              ì •ì±…/ì¬ìƒ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨ (blockedë©´ 403ì¼ ìˆ˜ ìˆìŒ)
            </div>
          )}

          {policy && (
            <div style={{ display: "flex", gap: 10, alignItems: "center", flexWrap: "wrap" }}>
              {policy.effective_rule === "blocked" ? (
                <Pill tone="danger">ê¶Œí•œ: ì œí•œ</Pill>
              ) : policy.effective_rule === "once" ? (
                <Pill tone="warn">ê¶Œí•œ: 1íšŒ</Pill>
              ) : (
                <Pill tone="ok">ê¶Œí•œ: ë¬´ì œí•œ</Pill>
              )}

              <Pill tone="ok">ì›Œí„°ë§ˆí¬: {policy.show_watermark ? "ON" : "OFF"}</Pill>
              <Pill tone="ok">ê±´ë„ˆë›°ê¸°: {policy.allow_skip ? "í—ˆìš©" : "ì°¨ë‹¨"}</Pill>
              <Pill tone="ok">ìµœëŒ€ ë°°ì†: {Number(policy.max_speed ?? 1).toFixed(2)}x</Pill>
            </div>
          )}
        </div>

        {/* ===== real player ===== */}
        <div
          style={{
            border: "1px solid #eee",
            borderRadius: 12,
            padding: 12,
            background: "#fff",
          }}
        >
          <div style={{ fontWeight: 900, marginBottom: 8 }}>ì¬ìƒ</div>

          {/* âœ… blocked ë“±ìœ¼ë¡œ playbackQê°€ 403ì´ë©´ ì—¬ê¸°ì„œ ì¬ìƒí•˜ì§€ ì•ŠìŒ */}
          {playbackQ.isError ? (
            <EmptyState
              title="ì¬ìƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
              description="ê¶Œí•œì´ ì œí•œë˜ì—ˆê±°ë‚˜(403) ì˜ìƒì´ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
            />
          ) : activeVideoId ? (
            <StudentVideoPlayer
              videoId={activeVideoId}
              enrollmentId={enrollmentId ?? -1}
              previewMode="student"
            />
          ) : (
            <EmptyState title="ì„ íƒëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤." />
          )}
        </div>
      </div>
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: media/playback/player/MediaPlayerPage.tsx
==========================================================================================
// PATH: src/student/domains/media/pages/MediaPlayerPage.tsx
import { useMemo, useState } from "react";
import { useSearchParams } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";

import StudentPageShell from "@/student/shared/components/StudentPageShell";
import EmptyState from "@/student/shared/components/EmptyState";

import {
  fetchStudentSessionVideos,
  fetchStudentVideoPlayback,
  StudentVideoListItem,
} from "@/student/domains/media/api/media";

// âœ… alias ì‚¬ìš© âŒ â†’ ìƒëŒ€ê²½ë¡œ ê³ ì •
import StudentVideoPlayer from "../../../media/playback/player/StudentVideoPlayer";

export default function MediaPlayerPage() {
  const [sp] = useSearchParams();
  const sessionId = Number(sp.get("session"));
  const enrollmentId: number | null = null;

  const [selectedVideoId, setSelectedVideoId] = useState<number | null>(null);

  const listQ = useQuery({
    queryKey: ["student-session-videos", sessionId],
    queryFn: () => fetchStudentSessionVideos(sessionId, enrollmentId),
    enabled: Number.isFinite(sessionId),
  });

  const videos: StudentVideoListItem[] = listQ.data?.items ?? [];

  const activeVideoId = useMemo(() => {
    if (selectedVideoId) return selectedVideoId;
    return videos.length ? videos[0].id : null;
  }, [selectedVideoId, videos]);

  const playbackQ = useQuery({
    queryKey: ["student-video-playback", activeVideoId],
    queryFn: () => fetchStudentVideoPlayback(activeVideoId!, enrollmentId),
    enabled: !!activeVideoId,
  });

  if (!Number.isFinite(sessionId)) {
    return (
      <StudentPageShell title="ì˜ìƒ">
        <EmptyState title="session íŒŒë¼ë¯¸í„° ì˜¤ë¥˜" />
      </StudentPageShell>
    );
  }

  if (listQ.isLoading) {
    return (
      <StudentPageShell title="ì˜ìƒ">
        <div>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </StudentPageShell>
    );
  }

  if (!videos.length) {
    return (
      <StudentPageShell title="ì˜ìƒ">
        <EmptyState title="ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  return (
    <StudentPageShell title="ì˜ìƒ">
      {playbackQ.isError ? (
        <EmptyState title="ì¬ìƒ ë¶ˆê°€ (ê¶Œí•œ ë˜ëŠ” 403)" />
      ) : activeVideoId ? (
        <StudentVideoPlayer
          videoId={activeVideoId}
          enrollmentId={enrollmentId ?? -1}
          previewMode="student"
        />
      ) : (
        <EmptyState title="ì„ íƒëœ ì˜ìƒ ì—†ìŒ" />
      )}
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: media/playback/player/StudentVideoPlayer.tsx
==========================================================================================
// PATH: src/student/media/playback/player/StudentVideoPlayer.tsx
import { useEffect, useRef } from "react";
import { useQuery } from "@tanstack/react-query";
import Hls from "hls.js";

import { fetchStudentVideoPlayback } from "@/student/domains/media/api/media";

type Props = {
  videoId: number;
  enrollmentId: number;
  previewMode?: string;
};

export default function StudentVideoPlayer({ videoId, enrollmentId }: Props) {
  const videoRef = useRef<HTMLVideoElement | null>(null);

  const q = useQuery({
    queryKey: ["video-playback", videoId, enrollmentId],
    queryFn: () => fetchStudentVideoPlayback(videoId, enrollmentId),
    enabled: Number.isFinite(videoId),
    retry: false,
  });

  useEffect(() => {
    const video = videoRef.current;
    if (!video || !q.data) return;

    const { hls_url, mp4_url } = q.data;

    if (hls_url && Hls.isSupported()) {
      const hls = new Hls();
      hls.loadSource(hls_url);
      hls.attachMedia(video);
      return () => hls.destroy();
    }

    if (mp4_url) {
      video.src = mp4_url;
    }
  }, [q.data]);

  if (q.isLoading) return <div>ì˜ìƒ ë¡œë”© ì¤‘...</div>;
  if (q.isError || !q.data) return <div>ì¬ìƒ ì‹¤íŒ¨</div>;

  return (
    <video
      ref={videoRef}
      controls
      playsInline
      style={{ width: "100%", maxHeight: 520, background: "#000" }}
    />
  );
}


==========================================================================================
# FILE: qna/pages/QnaPage.tsx
==========================================================================================
// src/student/domains/qna/pages/QnaPage.tsx
/**
 * âœ… QnaPage (MVP)
 * - Q&A ëª©ë¡/ì‘ì„±ì€ ì¶”í›„ ì—°ê²°
 */

import StudentPageShell from "@/student/shared/components/StudentPageShell";
import EmptyState from "@/student/shared/components/EmptyState";

export default function QnaPage() {
  return (
    <StudentPageShell title="Q&A" description="ì§ˆë¬¸/ë‹µë³€">
      <EmptyState
        title="Q&A ë„ë©”ì¸ ì—°ê²° ì˜ˆì •"
        description="ëª©ë¡/ì‘ì„±/ìƒì„¸ API ì—°ê²° ì‹œ ë°”ë¡œ í™•ì¥í•©ë‹ˆë‹¤."
      />
    </StudentPageShell>
  );
}


==========================================================================================
# FILE: sessions/api/sessions.ts
==========================================================================================
// PATH: src/student/domains/sessions/api/sessions.ts

import api from "@/student/shared/api/studentApi";

export type StudentSession = {
  id: number;
  title: string;
  date?: string | null;
  status?: string | null;
  exam_ids?: number[] | null;
};

export async function fetchMySessions(): Promise<StudentSession[]> {
  const res = await api.get("/student/sessions/me/");
  const data = res.data;
  if (Array.isArray(data)) return data as StudentSession[];
  if (Array.isArray(data?.items)) return data.items as StudentSession[];
  return [];
}

export async function fetchSessionDetail(sessionId: number): Promise<StudentSession> {
  const res = await api.get(`/student/sessions/${sessionId}/`);
  return res.data as StudentSession;
}


==========================================================================================
# FILE: sessions/components/SessionAssignmentAction.tsx
==========================================================================================



==========================================================================================
# FILE: sessions/components/SessionExamAction.tsx
==========================================================================================



==========================================================================================
# FILE: sessions/components/SessionInfoCard.tsx
==========================================================================================



==========================================================================================
# FILE: sessions/components/SessionVideoAction.tsx
==========================================================================================



==========================================================================================
# FILE: sessions/hooks/useStudentSessions.ts
==========================================================================================
// src/student/domains/sessions/hooks/useStudentSessions.ts
/**
 * âœ… useStudentSessions
 */

import { useQuery } from "@tanstack/react-query";
import { fetchMySessions, fetchSessionDetail } from "@/student/domains/sessions/api/sessions";

export function useMySessions() {
  return useQuery({
    queryKey: ["student-sessions"],
    queryFn: fetchMySessions,
  });
}

export function useSessionDetail(sessionId?: number) {
  const safeId = Number(sessionId);
  return useQuery({
    queryKey: ["student-session", safeId],
    queryFn: () => fetchSessionDetail(safeId),
    enabled: Number.isFinite(safeId),
  });
}


==========================================================================================
# FILE: sessions/pages/SessionDetailPage.tsx
==========================================================================================
// src/student/domains/sessions/pages/SessionDetailPage.tsx
/**
 * âœ… SessionDetailPage (í—ˆë¸Œ)
 * - í•™ìƒ ì•±ì˜ "í–‰ë™ ì¤‘ì‹¬ í—ˆë¸Œ"
 * - ì˜ìƒ/ì‹œí—˜/ê³¼ì œ/ìë£Œ ë§í¬ë§Œ ì œê³µ (íŒë‹¨/ê³„ì‚° âŒ)
 *
 * ì£¼ì˜:
 * - session â†’ exam ì—°ê²° ì¶”ë¡  âŒ
 * - ë°±ì—”ë“œê°€ exam_ids ë“±ì„ ë‚´ë ¤ì£¼ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
 * - ì—†ìœ¼ë©´ "ì‹œí—˜ìœ¼ë¡œ ì´ë™" ê°™ì€ ë²”ìš© ë§í¬ë§Œ ì œê³µ
 */

import { Link, useParams } from "react-router-dom";
import StudentPageShell from "@/student/shared/components/StudentPageShell";
import EmptyState from "@/student/shared/components/EmptyState";
import { useSessionDetail } from "@/student/domains/sessions/hooks/useStudentSessions";
import { formatYmd } from "@/student/shared/utils/date";

export default function SessionDetailPage() {
  const { sessionId } = useParams();
  const safeId = Number(sessionId);

  const { data, isLoading, isError } = useSessionDetail(
    Number.isFinite(safeId) ? safeId : undefined
  );

  if (!Number.isFinite(safeId)) {
    return (
      <StudentPageShell title="ì°¨ì‹œ" description="ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.">
        <EmptyState title="ì„¸ì…˜ IDê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  if (isLoading) {
    return (
      <StudentPageShell title="ì°¨ì‹œ" description="ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...">
        <div style={{ fontSize: 14, color: "#666" }}>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </StudentPageShell>
    );
  }

  if (isError || !data) {
    return (
      <StudentPageShell title="ì°¨ì‹œ" description="ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.">
        <EmptyState title="ì°¨ì‹œ ìƒì„¸ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤." />
      </StudentPageShell>
    );
  }

  return (
    <StudentPageShell title={data.title} description={`ë‚ ì§œ: ${formatYmd(data.date ?? null)}`}>
      <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
        {/* ===== Actions ===== */}
        <ActionCard title="ì˜ìƒ ë³´ê¸°" desc="ë¯¸ë””ì–´ ë„ë©”ì¸ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.">
          {/* media ì´ì‹ ì „ì´ë©´ ë§í¬ë§Œ ìë¦¬ í™•ë³´ */}
          <Link to={`/student/media?session=${data.id}`} style={btnStyle}>
            ì˜ìƒìœ¼ë¡œ ì´ë™
          </Link>
        </ActionCard>

        <ActionCard title="ì‹œí—˜/í‰ê°€" desc="ì‹œí—˜ ëª©ë¡ ë˜ëŠ” í•´ë‹¹ ì‹œí—˜ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.">
          {/* âœ… ë°±ì—”ë“œê°€ exam_ids ë‚´ë ¤ì£¼ëŠ” ê²½ìš°: ì§ì ‘ ë§í¬ */}
          {Array.isArray(data.exam_ids) && data.exam_ids.length > 0 ? (
            <div style={{ display: "flex", gap: 8, flexWrap: "wrap" }}>
              {data.exam_ids.map((eid) => (
                <Link key={eid} to={`/student/exams/${eid}`} style={btnStyle}>
                  ì‹œí—˜ #{eid}
                </Link>
              ))}
            </div>
          ) : (
            <Link to="/student/exams" style={btnStyle}>
              ì‹œí—˜ ëª©ë¡ ë³´ê¸°
            </Link>
          )}
        </ActionCard>

        <ActionCard title="ì„±ì " desc="ê²°ê³¼ ìš”ì•½ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.">
          <Link to="/student/grades" style={btnStyle}>
            ì„±ì  ë³´ê¸°
          </Link>
        </ActionCard>

        <div style={{ fontSize: 12, color: "#777" }}>
          â€» ì´ í˜ì´ì§€ëŠ” â€œí–‰ë™ í—ˆë¸Œâ€ì…ë‹ˆë‹¤. ì •ì±…/ìƒíƒœ íŒë‹¨ì€ ë°±ì—”ë“œê°€ ì±…ì„ì§‘ë‹ˆë‹¤.
        </div>
      </div>
    </StudentPageShell>
  );
}

function ActionCard({
  title,
  desc,
  children,
}: {
  title: string;
  desc: string;
  children: React.ReactNode;
}) {
  return (
    <div style={{ border: "1px solid #eee", borderRadius: 12, padding: 14, background: "#fff" }}>
      <div style={{ fontWeight: 800 }}>{title}</div>
      <div style={{ marginTop: 4, fontSize: 13, color: "#666" }}>{desc}</div>
      <div style={{ marginTop: 10 }}>{children}</div>
    </div>
  );
}

const btnStyle: React.CSSProperties = {
  display: "inline-block",
  padding: "10px 12px",
  borderRadius: 10,
  border: "1px solid #ddd",
  textDecoration: "none",
  background: "#fafafa",
  color: "#111",
  fontWeight: 700,
};


==========================================================================================
# FILE: sessions/pages/SessionListPage.tsx
==========================================================================================
// src/student/domains/sessions/pages/SessionListPage.tsx
/**
 * âœ… SessionListPage (MVP)
 * - ë‚´ ì°¨ì‹œ ëª©ë¡
 * - í´ë¦­ -> SessionDetailPage (í–‰ë™ í—ˆë¸Œ)
 */

import { Link } from "react-router-dom";
import StudentPageShell from "@/student/shared/components/StudentPageShell";
import EmptyState from "@/student/shared/components/EmptyState";
import { useMySessions } from "@/student/domains/sessions/hooks/useStudentSessions";
import { formatYmd } from "@/student/shared/utils/date";

export default function SessionListPage() {
  const { data, isLoading, isError } = useMySessions();

  return (
    <StudentPageShell title="ì°¨ì‹œ" description="í•™ìŠµí•  ì°¨ì‹œë¥¼ ì„ íƒí•˜ì„¸ìš”.">
      {isLoading && <div style={{ fontSize: 14, color: "#666" }}>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>}

      {(isError || !data) && (
        <EmptyState title="ì°¨ì‹œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤." />
      )}

      {data && data.length === 0 && (
        <EmptyState title="ì°¨ì‹œê°€ ì—†ìŠµë‹ˆë‹¤." description="ìˆ˜ê°• ì¤‘ì¸ ê°•ì˜/ì°¨ì‹œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”." />
      )}

      {data && data.length > 0 && (
        <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
          {data.map((s) => (
            <Link
              key={s.id}
              to={`/student/sessions/${s.id}`}
              style={{
                textDecoration: "none",
                border: "1px solid #eee",
                borderRadius: 10,
                padding: 12,
                background: "#fff",
                color: "#111",
              }}
            >
              <div style={{ fontWeight: 800 }}>{s.title}</div>
              <div style={{ marginTop: 4, fontSize: 12, color: "#777" }}>
                {formatYmd(s.date ?? null)}
                {s.status ? ` Â· ${s.status}` : ""}
              </div>
            </Link>
          ))}
        </div>
      )}
    </StudentPageShell>
  );
}
