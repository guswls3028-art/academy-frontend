====================================================================================================
# FRONTEND FOLDER: features__students
# ROOT PATH: C:\academyfront\src\features\students
====================================================================================================


==========================================================================================
# FILE: STUDENTS DOMAIN UI SSOT.md
==========================================================================================
ğŸ“ STUDENTS DOMAIN UI SSOT

Students UI Design Single Source of Truth

ì´ ë¬¸ì„œëŠ” features/students ì˜ì—­ì˜ ë ˆì´ì•„ì›ƒ, íƒ­, ì¹´ë“œ, í…Œì´ë¸”, ì˜¤ë²„ë ˆì´ íŒ¨í„´ì„
ê³ ì •ëœ ë””ìì¸ ê·œì¹™(SSOT) ìœ¼ë¡œ ì •ì˜í•œë‹¤.

ì´ ë¬¸ì„œì— ëª…ì‹œë˜ì§€ ì•Šì€ UI ë³€í˜•ì€ ê¸ˆì§€í•˜ë©°,
ë‹¤ë¥¸ ë„ë©”ì¸(staff, lectures, exams ë“±)ë„ ë™ì¼ ê·œì¹™ì„ ê·¸ëŒ€ë¡œ ë”°ë¥¸ë‹¤.

1. ìµœìƒìœ„ ë ˆì´ì•„ì›ƒ ê·œì¹™ (Domain Layout)
1.1 Domain Layout êµ¬ì¡°

ëª¨ë“  ë„ë©”ì¸ í˜ì´ì§€ëŠ” ë°˜ë“œì‹œ ë‹¤ìŒ êµ¬ì¡°ë¥¼ ë”°ë¥¸ë‹¤.

[ Domain Header ]
 â”œâ”€ Accent Bar (Primary Color)
 â”œâ”€ Title (text-2xl / bold)
 â”œâ”€ Description (text-base / muted)
 â””â”€ Domain Tabs (ds-tabs)

[ Domain Content ]
 â””â”€ Rounded Card (radius-2xl, border)
    â””â”€ Outlet

1.2 StudentsLayout.tsx ì±…ì„

ë„ë©”ì¸ íƒ€ì´í‹€, ì„¤ëª…, íƒ­ UIë¥¼ ì „ë‹´

ì‹¤ì œ í˜ì´ì§€ ë‚´ìš©ì€ ì ˆëŒ€ í¬í•¨í•˜ì§€ ì•ŠëŠ”ë‹¤

ë‚´ë¶€ í˜ì´ì§€ëŠ” ë°˜ë“œì‹œ <Outlet />ìœ¼ë¡œ ë Œë”ë§

âœ” í—ˆìš©

íƒ­ ì ê¸ˆ (disabled, pointer-events-none)

ì„¤ëª… ë¬¸êµ¬ ë³€ê²½

âŒ ê¸ˆì§€

í…Œì´ë¸” / ì¹´ë“œ ì§ì ‘ í¬í•¨

API / ìƒíƒœ ë¡œì§ í¬í•¨

2. ë„ë©”ì¸ íƒ­ ê·œì¹™ (Tabs)
2.1 íƒ­ ê¸°ë³¸ ì›ì¹™

ëª¨ë“  ë„ë©”ì¸ì€ ds-tabs + ds-tab ì‚¬ìš©

í…ìŠ¤íŠ¸ í¬ê¸°: text-[15px] font-semibold

í™œì„± ìƒíƒœ: is-active í´ë˜ìŠ¤

2.2 ì ê¸ˆ íƒ­ ê·œì¹™ (LOCKED TAB)

ì•„ì§ êµ¬í˜„ë˜ì§€ ì•Šì€ ê¸°ëŠ¥ì€ ë…¸ì¶œì€ í•˜ë˜ í´ë¦­ ë¶ˆê°€ ì²˜ë¦¬í•œë‹¤.

í•„ìˆ˜ ì¡°ê±´

disabled

pointer-events-none

opacity-40

tooltip(title) ì œê³µ

const lockedTabClass =
  "opacity-40 cursor-not-allowed pointer-events-none";


â— ë¼ìš°íŒ…ì€ ì‚´ì•„ ìˆì–´ë„ UIì—ì„œ ì ‘ê·¼ ë¶ˆê°€í•´ì•¼ í•œë‹¤

3. Domain Content ì¹´ë“œ ê·œì¹™
3.1 ê³µí†µ ì¹´ë“œ ìŠ¤íƒ€ì¼

ëª¨ë“  ë„ë©”ì¸ í˜ì´ì§€ëŠ” ë‹¤ìŒ ì¹´ë“œ ìŠ¤íƒ€ì¼ì„ ì‚¬ìš©í•œë‹¤.

border-radius: rounded-2xl

background: var(--bg-surface)

border: var(--border-divider)

ë‚´ë¶€ íŒ¨ë”©ì€ í˜ì´ì§€ì—ì„œ ì œì–´

<div className="rounded-2xl bg-[var(--bg-surface)] border border-[var(--border-divider)]">
  <Outlet />
</div>


âŒ ì¹´ë“œ ì•ˆì— ë˜ ì¹´ë“œ ì¤‘ì²© ê¸ˆì§€
âŒ radius/ìƒ‰ìƒ ì„ì˜ ë³€ê²½ ê¸ˆì§€

4. ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ ê·œì¹™ (Home Page)
4.1 HomePage ì±…ì„ ë¶„ë¦¬

StudentsHomePage.tsxëŠ” ë‹¤ìŒë§Œ ë‹´ë‹¹í•œë‹¤:

ê²€ìƒ‰ ì…ë ¥

í•„í„° ëª¨ë‹¬ ì œì–´

ìƒì„±/ì‚­ì œ ëª¨ë‹¬ ì œì–´

í…Œì´ë¸” ë Œë”ë§

ë¼ìš°íŒ… ì—°ê²°

âŒ ê¸ˆì§€

í…Œì´ë¸” row ìƒì„¸ êµ¬í˜„

ëª¨ë‹¬ ë‚´ë¶€ UI êµ¬í˜„

5. í…Œì´ë¸” ê·œì¹™ (StudentsTable)
5.1 í…Œì´ë¸” í—¤ë”

ì»¬ëŸ¼ í—¤ë” ë°°ê²½:

color-mix(
  var(--color-brand-primary) 6%,
  var(--color-bg-surface-hover)
)


ì»¬ëŸ¼ í—¤ë” í…ìŠ¤íŠ¸:

color-mix(
  var(--color-brand-primary) 55%,
  var(--color-text-secondary)
)

5.2 í…ìŠ¤íŠ¸ í¬ê¸° ê·œì¹™
ì˜ì—­	í¬ê¸°
ì´ë¦„	15px / bold
ì „í™”/í•™êµ	14px
ë“±ë¡ì¼	13px
ìƒíƒœ ë±ƒì§€	12px

ğŸ‘‰ ì „í™”ë²ˆí˜¸/ì‹ë³„ì í¬í•¨, ì „ë¶€ ê°€ë…ì„± ìš°ì„ 

6. ìƒì„¸ í˜ì´ì§€ ê·œì¹™ (Overlay Pattern)
6.1 ì ‘ê·¼ ë°©ì‹

ë¦¬ìŠ¤íŠ¸ â†’ /admin/students/:id

í˜ì´ì§€ ì´ë™ì´ ì•„ë‹ˆë¼ ì˜¤ë²„ë ˆì´

backdrop í´ë¦­ ì‹œ navigate(-1)

<div className="fixed inset-0 z-40 bg-black/60" />

6.2 Overlay êµ¬ì¡°
[ Backdrop ]
[ Centered Overlay Panel ]
 â”œâ”€ Gradient Header
 â”œâ”€ Left Info Panel
 â””â”€ Right Tabs Panel


max-width: 1120px

radius: 22px

box-shadow í•„ìˆ˜

7. ì •ë³´ í–‰(Row) ê·œì¹™ (InfoRow)

label: muted / font-weight 800

value: primary / font-weight 950

accent í–‰ì€ brand-primary 10% mix ì‚¬ìš©

âŒ ì„ì˜ ì•„ì´ì½˜, ì»¬ëŸ¬ ì¶”ê°€ ê¸ˆì§€

8. ëª¨ë‹¬ ê·œì¹™ (Create / Edit / Delete)
8.1 ê³µí†µ ì›ì¹™

ë°˜ë“œì‹œ AdminModal ì‚¬ìš©

ë‹¨ì¶•í‚¤ ì§€ì›:

ESC â†’ ë‹«ê¸°

âŒ˜/Ctrl + Enter â†’ ì €ì¥/ë“±ë¡

width ê³ ì • (520 / 720)

8.2 ì…ë ¥ ìŠ¤íƒ€ì¼

ds-input, ds-textarea, ds-selectë§Œ ì‚¬ìš©

height, padding ë³€ê²½ ê¸ˆì§€

9. ë‹¤ë¥¸ ë„ë©”ì¸ ì ìš© ê·œì¹™ (MANDATORY)

ì´ SSOTëŠ” ë‹¤ìŒ ë„ë©”ì¸ì— ê·¸ëŒ€ë¡œ ë³µì‚¬ ì ìš©í•œë‹¤.

features/staff

features/lectures

features/exams

features/clinics

âœ” ì´ë¦„/ë¬¸êµ¬ë§Œ ë³€ê²½ ê°€ëŠ¥
âŒ êµ¬ì¡°/íŒ¨í„´ ë³€ê²½ ë¶ˆê°€

10. ë³€ê²½ ì •ì±… (LOCK)

ì´ ë¬¸ì„œ ë³€ê²½ = ë””ìì¸ ê¸°ì¤€ ë³€ê²½

ë³€ê²½ ì‹œ:

SSOT ë¬¸ì„œ ìˆ˜ì •

ëª¨ë“  ë„ë©”ì¸ ë™ì‹œ ë°˜ì˜

ë¶€ë¶„ ì ìš© ê¸ˆì§€


==========================================================================================
# FILE: StudentsLayout.tsx
==========================================================================================
// PATH: src/features/students/StudentsLayout.tsx
import { Outlet } from "react-router-dom";
import { DomainLayout } from "@/shared/ui/layout";

const STUDENTS_TABS = [
  { key: "home", label: "í™ˆ", path: "/admin/students/home" },
  { key: "scores", label: "í•™êµ ì„±ì ", locked: true },
  { key: "history", label: "ìƒë‹´ ì´ë ¥", locked: true },
];

export default function StudentsLayout() {
  return (
    <DomainLayout
      title="í•™ìƒ ê´€ë¦¬"
      description="í•™ìƒ ì¶”ê°€ Â· í•™êµ ì„±ì  Â· ìƒë‹´"
      tabs={STUDENTS_TABS}
    >
      <Outlet />
    </DomainLayout>
  );
}


==========================================================================================
# FILE: StudentsRoutes.tsx
==========================================================================================
// PATH: src/features/students/StudentsRoutes.tsx
import { Routes, Route, Navigate } from "react-router-dom";

import StudentsLayout from "./StudentsLayout";

import StudentsHomePage from "./pages/StudentsHomePage";
import StudentsHistoryPage from "./pages/StudentsHistoryPage";
import StudentsScoresPage from "./pages/StudentsScoresPage";
import StudentDetailOverlay from "./overlays/StudentDetailOverlay";

export default function StudentsRoutes() {
  return (
    <Routes>
      <Route element={<StudentsLayout />}>
        <Route index element={<Navigate to="home" replace />} />
        <Route path="home" element={<StudentsHomePage />} />
        <Route path="history" element={<StudentsHistoryPage />} />
        <Route path="scores" element={<StudentsScoresPage />} />
      </Route>

      {/* í•™ìƒ ìƒì„¸ëŠ” Overlay (ì§ì›ê³¼ ë™ì¼ íŒ¨í„´) */}
      <Route path=":studentId/*" element={<StudentDetailOverlay />} />
    </Routes>
  );
}


==========================================================================================
# FILE: api/students.ts
==========================================================================================
// PATH: src/features/students/api/students.ts
import api from "@/shared/api/axios";

/* ===============================
 * Types
 * =============================== */

export interface ClientStudentTag {
  id: number;
  name: string;
  color: string;
}

export interface ClientEnrollmentLite {
  id: number;
  lectureName: string | null;
}

export interface ClientStudent {
  id: number;
  name: string;

  psNumber: string;
  omrCode: string;

  studentPhone: string | null;
  parentPhone: string | null;

  school: string | null;
  schoolClass: string | null;
  major: string | null;

  grade: number | null;
  gender: string | null;

  registeredAt: string | null;
  active: boolean;
  memo?: string | null;

  schoolType: "MIDDLE" | "HIGH" | null;

  tags: ClientStudentTag[];
  enrollments: ClientEnrollmentLite[];
}

export interface StudentTag {
  id: number;
  name: string;
  color: string;
}

/* ===============================
 * Mapper
 * =============================== */

function safeStr(v: any): string {
  return typeof v === "string" ? v : v == null ? "" : String(v);
}

function mapStudent(item: any): ClientStudent {
  const phone = item?.phone ?? null;
  const omrCode = item?.omr_code ?? "";

  // ğŸ”§ ë³€ê²½: UIì—ëŠ” í•­ìƒ phoneë§Œ ì „ë‹¬
  const displayPhone = phone ?? null;

  const schoolType: "MIDDLE" | "HIGH" | null =
    item?.school_type ??
    (item?.middle_school ? "MIDDLE" : item?.high_school ? "HIGH" : null);

  return {
    id: Number(item?.id),
    name: safeStr(item?.name),

    psNumber: safeStr(item?.ps_number),
    omrCode: safeStr(omrCode),

    studentPhone: displayPhone ?? null,
    parentPhone: item?.parent_phone ?? null,

    school: item?.high_school ?? item?.middle_school ?? null,
    schoolClass: item?.high_school_class ?? null,
    major: item?.major ?? null,

    grade: item?.grade ?? null,
    gender: item?.gender ?? null,

    registeredAt: item?.created_at ?? null,
    active: item?.is_managed ?? false,
    memo: item?.memo ?? null,

    schoolType,

    tags: Array.isArray(item?.tags)
      ? item.tags.map((t: any) => ({
          id: Number(t?.id),
          name: safeStr(t?.name),
          color: safeStr(t?.color),
        }))
      : [],

    enrollments: Array.isArray(item?.enrollments)
      ? item.enrollments.map((en: any) => ({
          id: Number(en?.id),
          lectureName: en?.lecture_name ?? null,
        }))
      : [],
  };
}

/* ===============================
 * Ordering (server-side friendly)
 * =============================== */

const ORDERING_MAP: Record<string, string> = {
  name: "name",
  registeredAt: "created_at",
  active: "is_managed",
  psNumber: "ps_number",
  studentPhone: "phone",
  parentPhone: "parent_phone",
  school: "high_school",
  schoolClass: "high_school_class",
  grade: "grade",
  gender: "gender",
};

function buildOrdering(sort: string): string | undefined {
  if (!sort) return undefined;

  const isDesc = sort.startsWith("-");
  const key = isDesc ? sort.slice(1) : sort;

  const mapped = ORDERING_MAP[key];
  if (!mapped) return undefined;

  return isDesc ? `-${mapped}` : mapped;
}

/* ===============================
 * List / Detail
 * =============================== */

export async function fetchStudents(
  search: string,
  filters: any = {},
  sort: string = ""
) {
  const ordering = buildOrdering(sort);

  const params: any = {
    search: search || undefined,
    ...filters,
    ordering: ordering || undefined,
  };

  const res = await api.get("/students/", { params });

  const items = Array.isArray(res.data?.results)
    ? res.data.results
    : Array.isArray(res.data)
    ? res.data
    : [];

  return items.map(mapStudent);
}

export async function getStudentDetail(id: number) {
  const res = await api.get(`/students/${id}/`);
  return mapStudent(res.data);
}

/* ===============================
 * CREATE
 * =============================== */

export async function createStudent(form: any) {
  const name = safeStr(form?.name).trim();
  const psNumber = safeStr(form?.psNumber).trim();
  const initialPassword = safeStr(form?.initialPassword).trim();

  const omrCodeInput = safeStr(form?.omrCode).trim();
  const studentPhoneInput = safeStr(form?.studentPhone).trim();
  const parentPhoneInput = safeStr(form?.parentPhone).trim();

  const phone = form?.noPhone === true ? `010${omrCodeInput}` : studentPhoneInput;

  const payload = {
    name,
    ps_number: psNumber,
    phone,
    omr_code: safeStr(phone).slice(-8),
    initial_password: initialPassword,

    parent_phone: parentPhoneInput,

    school_type: form?.schoolType,
    high_school: form?.schoolType === "HIGH" ? form?.school || null : null,
    middle_school: form?.schoolType === "MIDDLE" ? form?.school || null : null,

    high_school_class: form?.schoolType === "HIGH" ? form?.schoolClass || null : null,

    major: form?.schoolType === "HIGH" ? form?.major || null : null,

    grade: form?.grade ? Number(form.grade) : null,
    gender: form?.gender || null,
    memo: form?.memo || null,

    is_managed: !!form?.active,
  };

  const res = await api.post("/students/", payload);
  return mapStudent(res.data);
}

/* ===============================
 * UPDATE
 * =============================== */

export async function updateStudent(id: number, form: any) {
  const payload: any = {
    grade: form?.grade ? Number(form.grade) : null,
    gender: form?.gender ?? null,
    memo: form?.memo ?? null,
    is_managed: !!form?.active,
  };

  if (form?.parentPhone !== undefined) {
    payload.parent_phone = safeStr(form?.parentPhone).trim();
  }

  const phone =
    form?.noPhone === true
      ? `010${safeStr(form?.omrCode).trim()}`
      : form?.studentPhone
      ? safeStr(form?.studentPhone).trim()
      : undefined;

  if (phone) {
    payload.phone = phone;
    payload.omr_code = safeStr(phone).slice(-8);
  }

  if (form?.psNumber !== undefined) {
    payload.ps_number = safeStr(form?.psNumber).trim();
  }

  if (form?.schoolType) {
    payload.school_type = form.schoolType;
    payload.high_school = form.schoolType === "HIGH" ? form?.school || null : null;
    payload.middle_school = form.schoolType === "MIDDLE" ? form?.school || null : null;
    payload.high_school_class =
      form.schoolType === "HIGH" ? form?.schoolClass || null : null;
    payload.major = form.schoolType === "HIGH" ? form?.major || null : null;
  }

  const res = await api.patch(`/students/${id}/`, payload);
  return mapStudent(res.data);
}

/* ===============================
 * TOGGLE ACTIVE
 * =============================== */

export async function toggleStudentActive(id: number, nextActive: boolean) {
  const res = await api.patch(`/students/${id}/`, {
    is_managed: nextActive,
  });
  return mapStudent(res.data);
}

/* ===============================
 * DELETE
 * =============================== */

export async function deleteStudent(id: number) {
  await api.delete(`/students/${id}/`);
  return true;
}

/* ===============================
 * TAG
 * =============================== */

export async function getTags(): Promise<StudentTag[]> {
  const res = await api.get(`/students/tags/`);
  const items = Array.isArray(res.data?.results)
    ? res.data.results
    : Array.isArray(res.data)
    ? res.data
    : [];
  return items.map((t: any) => ({
    id: Number(t?.id),
    name: safeStr(t?.name),
    color: safeStr(t?.color),
  }));
}

export async function attachStudentTag(studentId: number, tagId: number) {
  await api.post(`/students/${studentId}/add_tag/`, { tag_id: tagId });
}

export async function detachStudentTag(studentId: number, tagId: number) {
  await api.post(`/students/${studentId}/remove_tag/`, { tag_id: tagId });
}

/* ===============================
 * MEMO
 * =============================== */

export async function createMemo(studentId: number, content: string) {
  await api.patch(`/students/${studentId}/`, { memo: String(content ?? "") });
}


==========================================================================================
# FILE: components/DeleteConfirmModal.tsx
==========================================================================================
// PATH: src/features/students/components/DeleteConfirmModal.tsx
import { useEffect, useMemo, useState } from "react";
import { AdminModal, ModalBody, ModalFooter, ModalHeader } from "@/shared/ui/modal";
import { Button } from "@/shared/ui/ds";
import { deleteStudent } from "../api/students";

export default function DeleteConfirmModal({
  open,
  id,
  onClose,
  onSuccess,
}: {
  open: boolean;
  id: number;
  onClose: () => void;
  onSuccess: () => void;
}) {
  const [busy, setBusy] = useState(false);

  const title = useMemo(() => "í•™ìƒ ì‚­ì œ", []);

  useEffect(() => {
    function onKeyDown(e: KeyboardEvent) {
      if (e.key === "Escape") onClose();
    }
    if (open) window.addEventListener("keydown", onKeyDown);
    return () => window.removeEventListener("keydown", onKeyDown);
  }, [open, onClose]);

  async function handleDelete() {
    if (busy) return;
    setBusy(true);
    try {
      await deleteStudent(id);
      onSuccess();
      onClose();
    } finally {
      setBusy(false);
    }
  }

  return (
    <AdminModal open={open} onClose={onClose} type="confirm" width={520}>
      <ModalHeader
        type="confirm"
        title={title}
        description="ì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
      />

      <ModalBody>
        <div
          style={{
            fontSize: 13,
            fontWeight: 850,
            color: "var(--color-text-secondary)",
            lineHeight: 1.6,
          }}
        >
          í•´ë‹¹ í•™ìƒì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
        </div>

        <div
          style={{
            marginTop: 12,
            padding: "10px 12px",
            borderRadius: 12,
            border:
              "1px solid color-mix(in srgb, var(--color-error) 22%, var(--color-border-divider))",
            background:
              "color-mix(in srgb, var(--color-error) 6%, var(--color-bg-surface))",
            color: "var(--color-text-secondary)",
            fontSize: 12,
            fontWeight: 850,
            letterSpacing: "-0.12px",
          }}
        >
          ì‚­ì œ í›„ì—ëŠ” í•™ìƒ ì •ë³´/íƒœê·¸/ë©”ëª¨/ì—°ê²°ëœ ì´ë ¥ì´ ë³µêµ¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
        </div>
      </ModalBody>

      <ModalFooter
        left={
          <span
            style={{
              fontSize: 12,
              fontWeight: 850,
              color: "var(--color-text-muted)",
            }}
          >
            ESC ë¡œ ë‹«ê¸°
          </span>
        }
        right={
          <>
            <Button intent="secondary" onClick={onClose} disabled={busy}>
              ì·¨ì†Œ
            </Button>
            <Button intent="danger" onClick={handleDelete} disabled={busy}>
              {busy ? "ì‚­ì œ ì¤‘â€¦" : "ì‚­ì œ"}
            </Button>
          </>
        }
      />
    </AdminModal>
  );
}


==========================================================================================
# FILE: components/EditStudentModal.tsx
==========================================================================================
// PATH: src/features/students/components/EditStudentModal.tsx
import { useEffect, useMemo, useState } from "react";
import { AdminModal, ModalBody, ModalFooter, ModalHeader } from "@/shared/ui/modal";
import { Button } from "@/shared/ui/ds";
import { updateStudent } from "../api/students";

interface Props {
  open: boolean;
  initialValue: any;
  onClose: () => void;
  onSuccess: () => void;
}

function is8Digits(v: any) {
  return /^\d{8}$/.test(String(v ?? ""));
}

export default function EditStudentModal({
  open,
  initialValue,
  onClose,
  onSuccess,
}: Props) {
  const initialNoPhone = useMemo(() => {
    return initialValue.studentPhone && is8Digits(initialValue.studentPhone);
  }, [initialValue.studentPhone]);

  const [noPhone, setNoPhone] = useState(initialNoPhone);
  const [busy, setBusy] = useState(false);
  /** 400 ì‘ë‹µ ì‹œ ë°±ì—”ë“œ í•„ë“œë³„ ì—ëŸ¬ (backend key -> message). setFields ê°œë…ìœ¼ë¡œ ë§¤í•‘ */
  const [fieldErrors, setFieldErrors] = useState<Record<string, string>>({});

  const [form, setForm] = useState({
    name: initialValue.name || "",
    gender: initialValue.gender || "",
    psNumber: initialValue.psNumber || "",
    studentPhone: initialNoPhone ? "" : initialValue.studentPhone || "",
    omrCode: initialNoPhone ? initialValue.studentPhone || "" : "",
    parentPhone: initialValue.parentPhone || "",
    schoolType: initialValue.schoolType || "HIGH",
    school: initialValue.school || "",
    grade: initialValue.grade ? String(initialValue.grade) : "",
    schoolClass: initialValue.schoolClass || "",
    major: initialValue.major || "",
    memo: initialValue.memo || "",
    active: !!initialValue.active,
  });

  useEffect(() => {
    if (!open) return;

    function onKeyDown(e: KeyboardEvent) {
      if (e.key === "Escape") onClose();
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") handleSubmit();
    }
    window.addEventListener("keydown", onKeyDown);
    return () => window.removeEventListener("keydown", onKeyDown);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [open, onClose, form, noPhone, busy]);

  useEffect(() => {
    if (!open) return;
    setNoPhone(initialNoPhone);
    setBusy(false);
    setFieldErrors({});
    setForm({
      name: initialValue.name || "",
      gender: initialValue.gender || "",
      psNumber: initialValue.psNumber || "",
      studentPhone: initialNoPhone ? "" : initialValue.studentPhone || "",
      omrCode: initialNoPhone ? initialValue.studentPhone || "" : "",
      parentPhone: initialValue.parentPhone || "",
      schoolType: initialValue.schoolType || "HIGH",
      school: initialValue.school || "",
      grade: initialValue.grade ? String(initialValue.grade) : "",
      schoolClass: initialValue.schoolClass || "",
      major: initialValue.major || "",
      memo: initialValue.memo || "",
      active: !!initialValue.active,
    });
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [open, initialValue?.id]);

  /** ë°±ì—”ë“œ í•„ë“œëª… -> í”„ë¡ íŠ¸ í•„ë“œëª… (setFields ë§¤í•‘) */
  const backendToFrontendField: Record<string, string> = {
    ps_number: "psNumber",
    omr_code: noPhone ? "omrCode" : "studentPhone",
    phone: "studentPhone",
    parent_phone: "parentPhone",
    name: "name",
  };

  function handleChange(e: any) {
    const { name } = e.target;
    setForm((p) => ({ ...p, [name]: e.target.value }));
    if (fieldErrors[name]) setFieldErrors((prev) => ({ ...prev, [name]: "" }));
  }

  /** StudentUpdateSerializer / ëª¨ë¸ ê¸°ì¤€ í•„ìˆ˜: name, ps_number, phone, parent_phone (Createì™€ ë™ì¼) */
  function validate(): string | null {
    if (!String(form.name || "").trim()) return "í•„ìˆ˜ ì…ë ¥ì…ë‹ˆë‹¤.";
    if (!String(form.psNumber || "").trim()) return "í•„ìˆ˜ ì…ë ¥ì…ë‹ˆë‹¤.";

    if (noPhone) {
      const code = String(form.omrCode || "").trim();
      if (!code) return "í•„ìˆ˜ ì…ë ¥ì…ë‹ˆë‹¤.";
      if (!/^\d{8}$/.test(code)) return "ì‹ë³„ìëŠ” 8ìë¦¬ ìˆ«ì(XXXXXXXX)ì—¬ì•¼ í•©ë‹ˆë‹¤.";
    } else {
      const phone = String(form.studentPhone || "").trim();
      if (!phone) return "í•„ìˆ˜ ì…ë ¥ì…ë‹ˆë‹¤.";
      if (!/^010\d{8}$/.test(phone)) return "í•™ìƒ ì „í™”ë²ˆí˜¸ëŠ” 010XXXXXXXX í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤.";
    }

    const parent = String(form.parentPhone || "").trim();
    if (!parent) return "í•„ìˆ˜ ì…ë ¥ì…ë‹ˆë‹¤.";
    if (!/^010\d{8}$/.test(parent)) return "í•™ë¶€ëª¨ ì „í™”ë²ˆí˜¸ëŠ” 010XXXXXXXX í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤.";

    return null;
  }

  async function handleSubmit() {
    if (busy) return;

    const err = validate();
    if (err) return alert(err);

    setBusy(true);
    setFieldErrors({});
    try {
      await updateStudent(initialValue.id, { ...form, noPhone });
      onSuccess();
      onClose();
    } catch (raw: any) {
      const data = raw?.response?.data;
      if (raw?.response?.status === 400 && data && typeof data === "object") {
        const next: Record<string, string> = {};
        for (const [backendKey, val] of Object.entries(data)) {
          const msg = Array.isArray(val) ? val[0] : typeof val === "string" ? val : "";
          if (!msg) continue;
          const frontKey = backendToFrontendField[backendKey] ?? backendKey;
          next[frontKey] = msg;
        }
        setFieldErrors(next);
        const messages = Object.entries(next)
          .map(([k, v]) => (k === "name" ? "ì´ë¦„" : k === "psNumber" ? "ì•„ì´ë””" : k === "studentPhone" ? "í•™ìƒ ì „í™”/ì‹ë³„ì" : k === "omrCode" ? "ì‹ë³„ì" : k === "parentPhone" ? "í•™ë¶€ëª¨ ì „í™”" : k) + ": " + v)
          .join("\n");
        alert(messages);
      } else {
        alert(raw?.message || "ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
      }
    } finally {
      setBusy(false);
    }
  }

  return (
    <AdminModal open={open} onClose={onClose} type="action" width={720}>
      <ModalHeader
        type="action"
        title="í•™ìƒ ìˆ˜ì •"
        description="âŒ˜/Ctrl + Enter ë¡œ ì €ì¥"
      />

      <ModalBody>
        <div style={{ display: "grid", gap: 12 }}>
          <div style={{ display: "grid", gridTemplateColumns: "1fr auto", gap: 10 }}>
            <input
              name="name"
              placeholder="ì´ë¦„"
              value={form.name}
              onChange={handleChange}
              className="ds-input"
              data-required="true"
              data-invalid={!String(form.name || "").trim() ? "true" : "false"}
              disabled={busy}
              autoFocus
            />

            <div style={{ display: "flex", gap: 8 }}>
              {[{ key: "M", label: "ë‚¨ì" }, { key: "F", label: "ì—¬ì" }].map((g) => (
                <Button
                  key={g.key}
                  intent={form.gender === g.key ? "secondary" : "ghost"}
                  aria-pressed={form.gender === g.key}
                  onClick={() => setForm((p) => ({ ...p, gender: g.key }))}
                  disabled={busy}
                >
                  {g.label}
                </Button>
              ))}
            </div>
          </div>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
            <input
              name="psNumber"
              placeholder="ì•„ì´ë””(PS ë²ˆí˜¸)"
              value={form.psNumber}
              onChange={handleChange}
              className="ds-input"
              data-required="true"
              data-invalid={!String(form.psNumber || "").trim() ? "true" : "false"}
              disabled={busy}
            />

            <div
              style={{
                display: "flex",
                alignItems: "center",
                gap: 10,
                padding: "0 12px",
                borderRadius: 12,
                border: "1px solid var(--color-border-divider)",
                background: "var(--color-bg-surface-soft)",
                height: 44,
              }}
            >
              <span
                style={{
                  fontSize: 12,
                  fontWeight: 900,
                  color: "var(--color-text-secondary)",
                }}
              >
                ìƒíƒœ
              </span>
              <Button
                intent={form.active ? "secondary" : "ghost"}
                size="sm"
                aria-pressed={form.active}
                onClick={() => setForm((p) => ({ ...p, active: !p.active }))}
                disabled={busy}
              >
                {form.active ? "í™œì„±" : "ë¹„í™œì„±"}
              </Button>
            </div>
          </div>

          <div style={{ display: "grid", gridTemplateColumns: "1fr auto", gap: 10 }}>
            <input
              name={noPhone ? "omrCode" : "studentPhone"}
              placeholder={noPhone ? "ì‹ë³„ì (XXXXXXXX)" : "í•™ìƒ ì „í™”ë²ˆí˜¸ (010XXXXXXXX)"}
              value={noPhone ? form.omrCode : form.studentPhone}
              onChange={handleChange}
              className="ds-input"
              data-required="true"
              disabled={busy}
            />
            <Button
              intent={noPhone ? "secondary" : "ghost"}
              onClick={() => {
                setNoPhone((v) => !v);
                setForm((p) => ({ ...p, studentPhone: "", omrCode: "" }));
              }}
              disabled={busy}
            >
              {noPhone ? "ì „í™”ë²ˆí˜¸ ì…ë ¥" : "ì—†ìŒ(ì‹ë³„ìì‚¬ìš©)"}
            </Button>
          </div>

          <input
            name="parentPhone"
            placeholder="í•™ë¶€ëª¨ ì „í™”ë²ˆí˜¸ (010XXXXXXXX)"
            value={form.parentPhone}
            onChange={handleChange}
            className="ds-input"
            data-required="true"
            disabled={busy}
          />

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
            {[{ key: "HIGH", label: "ê³ ë“±í•™êµ" }, { key: "MIDDLE", label: "ì¤‘í•™êµ" }].map(
              (t) => (
                <Button
                  key={t.key}
                  intent={form.schoolType === t.key ? "secondary" : "ghost"}
                  aria-pressed={form.schoolType === t.key}
                  onClick={() =>
                    setForm((p) => ({
                      ...p,
                      schoolType: t.key,
                      school: "",
                      schoolClass: "",
                      major: "",
                    }))
                  }
                  disabled={busy}
                >
                  {t.label}
                </Button>
              )
            )}
          </div>

          <div style={{ display: "grid", gridTemplateColumns: "1fr auto", gap: 10 }}>
            <input
              name="school"
              placeholder="í•™êµëª…"
              value={form.school}
              onChange={handleChange}
              className="ds-input"
              disabled={busy}
            />
            <div style={{ display: "flex", gap: 8 }}>
              {["1", "2", "3"].map((g) => (
                <Button
                  key={g}
                  intent={form.grade === g ? "secondary" : "ghost"}
                  aria-pressed={form.grade === g}
                  onClick={() => setForm((p) => ({ ...p, grade: g }))}
                  disabled={busy}
                >
                  {g}í•™ë…„
                </Button>
              ))}
            </div>
          </div>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
            <input
              name="schoolClass"
              placeholder="ë°˜"
              value={form.schoolClass}
              onChange={handleChange}
              className="ds-input"
              disabled={busy}
            />
            <input
              name="major"
              placeholder="ê³„ì—´(ê³ ë“±ë§Œ)"
              value={form.major}
              onChange={handleChange}
              className="ds-input"
              disabled={busy}
            />
          </div>

          <textarea
            name="memo"
            rows={4}
            placeholder="ë©”ëª¨"
            value={form.memo}
            onChange={handleChange}
            className="ds-textarea"
            disabled={busy}
          />
        </div>
      </ModalBody>

      <ModalFooter
        left={
          <span style={{ fontSize: 12, fontWeight: 850, color: "var(--color-text-muted)" }}>
            âŒ˜/Ctrl + Enter ì €ì¥
          </span>
        }
        right={
          <>
            <Button intent="secondary" onClick={onClose} disabled={busy}>
              ì·¨ì†Œ
            </Button>
            <Button intent="primary" onClick={handleSubmit} disabled={busy}>
              {busy ? "ì €ì¥ ì¤‘â€¦" : "ì €ì¥"}
            </Button>
          </>
        }
      />
    </AdminModal>
  );
}


==========================================================================================
# FILE: components/StudentCreateModal.tsx
==========================================================================================
// PATH: src/features/students/components/StudentCreateModal.tsx
import { useEffect, useState } from "react";
import { AdminModal, ModalBody, ModalFooter, ModalHeader } from "@/shared/ui/modal";
import { Button } from "@/shared/ui/ds";
import { createStudent } from "../api/students";

interface Props {
  open: boolean;
  onClose: () => void;
  onSuccess: () => void;
}

export default function StudentCreateModal({ open, onClose, onSuccess }: Props) {
  const [noPhone, setNoPhone] = useState(false);
  const [busy, setBusy] = useState(false);

  const [form, setForm] = useState({
    name: "",
    gender: "",
    psNumber: "",
    initialPassword: "",
    studentPhone: "",
    omrCode: "",
    parentPhone: "",
    schoolType: "HIGH",
    school: "",
    grade: "",
    schoolClass: "",
    major: "",
    memo: "",
    active: true,
  });

  useEffect(() => {
    if (!open) return;

    function onKeyDown(e: KeyboardEvent) {
      if (e.key === "Escape") onClose();
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") handleSubmit();
    }
    window.addEventListener("keydown", onKeyDown);
    return () => window.removeEventListener("keydown", onKeyDown);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [open, onClose, form, noPhone, busy]);

  useEffect(() => {
    if (!open) return;
    setNoPhone(false);
    setBusy(false);
    setForm({
      name: "",
      gender: "",
      psNumber: "",
      initialPassword: "",
      studentPhone: "",
      omrCode: "",
      parentPhone: "",
      schoolType: "HIGH",
      school: "",
      grade: "",
      schoolClass: "",
      major: "",
      memo: "",
      active: true,
    });
  }, [open]);

  function handleChange(e: any) {
    const { name, value } = e.target;
    setForm((p) => ({ ...p, [name]: value }));
  }

  function validate(): string | null {
    // ë°±ì—”ë“œ StudentCreateSerializer required í•„ë“œì™€ ë™ì¼: name, ps_number, initial_password, phone, parent_phone
    if (!String(form.name || "").trim()) return "í•„ìˆ˜ ì…ë ¥ì…ë‹ˆë‹¤.";
    if (!String(form.psNumber || "").trim()) return "í•„ìˆ˜ ì…ë ¥ì…ë‹ˆë‹¤.";
    if (!String(form.initialPassword || "").trim()) return "í•„ìˆ˜ ì…ë ¥ì…ë‹ˆë‹¤.";

    if (noPhone) {
      const code = String(form.omrCode || "").trim();
      if (!code) return "í•„ìˆ˜ ì…ë ¥ì…ë‹ˆë‹¤.";
      if (!/^\d{8}$/.test(code)) return "ì‹ë³„ìëŠ” 8ìë¦¬ ìˆ«ì(XXXXXXXX)ì—¬ì•¼ í•©ë‹ˆë‹¤.";
    } else {
      const phone = String(form.studentPhone || "").trim();
      if (!phone) return "í•„ìˆ˜ ì…ë ¥ì…ë‹ˆë‹¤.";
      if (!/^010\d{8}$/.test(phone)) return "í•™ìƒ ì „í™”ë²ˆí˜¸ëŠ” 010XXXXXXXX í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤.";
    }

    const parent = String(form.parentPhone || "").trim();
    if (!parent) return "í•„ìˆ˜ ì…ë ¥ì…ë‹ˆë‹¤.";
    if (!/^010\d{8}$/.test(parent)) return "í•™ë¶€ëª¨ ì „í™”ë²ˆí˜¸ëŠ” 010XXXXXXXX í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤.";

    return null;
  }

  async function handleSubmit() {
    if (busy) return;

    const err = validate();
    if (err) return alert(err);

    setBusy(true);
    try {
      await createStudent({ ...form, noPhone });
      onSuccess();
      onClose();
    } finally {
      setBusy(false);
    }
  }

  return (
    <AdminModal open={open} onClose={onClose} type="action" width={720}>
      <ModalHeader
        type="action"
        title="í•™ìƒ ë“±ë¡"
        description="âŒ˜/Ctrl + Enter ë¡œ ë“±ë¡"
      />

      <ModalBody>
        <div style={{ display: "grid", gap: 12 }}>
          <div style={{ display: "grid", gridTemplateColumns: "1fr auto", gap: 10 }}>
            <input
              name="name"
              placeholder="ì´ë¦„"
              value={form.name}
              onChange={handleChange}
              className="ds-input"
              data-required="true"
              data-invalid={!String(form.name || "").trim() ? "true" : "false"}
              disabled={busy}
              autoFocus
            />

            <div style={{ display: "flex", gap: 8 }}>
              {[{ key: "M", label: "ë‚¨ì" }, { key: "F", label: "ì—¬ì" }].map((g) => (
                <Button
                  key={g.key}
                  intent={form.gender === g.key ? "secondary" : "ghost"}
                  aria-pressed={form.gender === g.key}
                  onClick={() => setForm((p) => ({ ...p, gender: g.key }))}
                  disabled={busy}
                >
                  {g.label}
                </Button>
              ))}
            </div>
          </div>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
            <input
              name="psNumber"
              placeholder="ë¡œê·¸ì¸ ì•„ì´ë””"
              value={form.psNumber}
              onChange={handleChange}
              className="ds-input"
              data-required="true"
              data-invalid={!String(form.psNumber || "").trim() ? "true" : "false"}
              disabled={busy}
            />
            <input
              name="initialPassword"
              type="password"
              placeholder="ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸"
              value={form.initialPassword}
              onChange={handleChange}
              className="ds-input"
              data-required="true"
              data-invalid={!String(form.initialPassword || "").trim() ? "true" : "false"}
              disabled={busy}
            />
          </div>

          <div style={{ display: "grid", gridTemplateColumns: "1fr auto", gap: 10 }}>
            <input
              name={noPhone ? "omrCode" : "studentPhone"}
              placeholder={noPhone ? "ì‹ë³„ì (XXXXXXXX)" : "í•™ìƒ ì „í™”ë²ˆí˜¸ (010XXXXXXXX)"}
              value={noPhone ? form.omrCode : form.studentPhone}
              onChange={handleChange}
              className="ds-input"
              data-required="true"
              disabled={busy}
            />
            <Button
              intent={noPhone ? "secondary" : "ghost"}
              onClick={() => {
                setNoPhone((v) => !v);
                setForm((p) => ({ ...p, studentPhone: "", omrCode: "" }));
              }}
              disabled={busy}
            >
              {noPhone ? "ì „í™”ë²ˆí˜¸ ì…ë ¥" : "ì—†ìŒ(ì‹ë³„ìì‚¬ìš©)"}
            </Button>
          </div>

          <input
            name="parentPhone"
            placeholder="í•™ë¶€ëª¨ ì „í™”ë²ˆí˜¸ (010XXXXXXXX)"
            value={form.parentPhone}
            onChange={handleChange}
            className="ds-input"
            data-required="true"
            disabled={busy}
          />

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
            {[{ key: "HIGH", label: "ê³ ë“±í•™êµ" }, { key: "MIDDLE", label: "ì¤‘í•™êµ" }].map(
              (t) => (
                <Button
                  key={t.key}
                  intent={form.schoolType === t.key ? "secondary" : "ghost"}
                  aria-pressed={form.schoolType === t.key}
                  onClick={() =>
                    setForm((p) => ({
                      ...p,
                      schoolType: t.key,
                      school: "",
                      schoolClass: "",
                      major: "",
                    }))
                  }
                  disabled={busy}
                >
                  {t.label}
                </Button>
              )
            )}
          </div>

          <div style={{ display: "grid", gridTemplateColumns: "1fr auto", gap: 10 }}>
            <input
              name="school"
              placeholder="í•™êµëª…"
              value={form.school}
              onChange={handleChange}
              className="ds-input"
              disabled={busy}
            />
            <div style={{ display: "flex", gap: 8 }}>
              {["1", "2", "3"].map((g) => (
                <Button
                  key={g}
                  intent={form.grade === g ? "secondary" : "ghost"}
                  aria-pressed={form.grade === g}
                  onClick={() => setForm((p) => ({ ...p, grade: g }))}
                  disabled={busy}
                >
                  {g}í•™ë…„
                </Button>
              ))}
            </div>
          </div>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
            <input
              name="schoolClass"
              placeholder="ë°˜"
              value={form.schoolClass}
              onChange={handleChange}
              className="ds-input"
              disabled={busy}
            />
            <input
              name="major"
              placeholder="ê³„ì—´(ê³ ë“±ë§Œ)"
              value={form.major}
              onChange={handleChange}
              className="ds-input"
              disabled={busy}
            />
          </div>

          <textarea
            name="memo"
            rows={4}
            placeholder="ë©”ëª¨"
            value={form.memo}
            onChange={handleChange}
            className="ds-textarea"
            disabled={busy}
          />

          <div
            style={{
              marginTop: 2,
              display: "grid",
              gridTemplateColumns: "1fr auto",
              gap: 10,
              alignItems: "center",
            }}
          >
            <div
              style={{
                fontSize: 11,
                fontWeight: 850,
                color: "var(--color-text-muted)",
              }}
            >
              ë“±ë¡ í›„ ìƒì„¸ í™”ë©´ì—ì„œ íƒœê·¸/ë©”ëª¨/ìƒíƒœë¥¼ ì¶”ê°€ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>

            <Button
              intent={form.active ? "secondary" : "ghost"}
              size="sm"
              aria-pressed={form.active}
              onClick={() => setForm((p) => ({ ...p, active: !p.active }))}
              disabled={busy}
            >
              {form.active ? "í™œì„±" : "ë¹„í™œì„±"}
            </Button>
          </div>
        </div>
      </ModalBody>

      <ModalFooter
        left={
          <span style={{ fontSize: 12, fontWeight: 850, color: "var(--color-text-muted)" }}>
            âŒ˜/Ctrl + Enter ë“±ë¡
          </span>
        }
        right={
          <>
            <Button intent="secondary" onClick={onClose} disabled={busy}>
              ì·¨ì†Œ
            </Button>
            <Button intent="primary" onClick={handleSubmit} disabled={busy}>
              {busy ? "ë“±ë¡ ì¤‘â€¦" : "ë“±ë¡"}
            </Button>
          </>
        }
      />
    </AdminModal>
  );
}


==========================================================================================
# FILE: components/StudentFilterModal.tsx
==========================================================================================
// PATH: src/features/students/components/StudentFilterModal.tsx
import { useEffect, useMemo, useState } from "react";
import { AdminModal, ModalBody, ModalFooter, ModalHeader } from "@/shared/ui/modal";
import { Button } from "@/shared/ui/ds";

interface Props {
  open: boolean;
  onClose: () => void;
  filters: any;
  onApply: (next: any) => void;
}

function normalize(next: any) {
  Object.keys(next).forEach((k) => {
    const v = next[k];
    if (v === "" || v == null) delete next[k];
  });

  if (typeof next.is_managed === "string") {
    if (next.is_managed === "true") next.is_managed = true;
    else if (next.is_managed === "false") next.is_managed = false;
    else delete next.is_managed;
  }

  if (typeof next.grade === "string" && next.grade.trim()) {
    const n = Number(next.grade);
    if (Number.isFinite(n)) next.grade = n;
    else delete next.grade;
  }

  if (typeof next.school_type === "string" && !next.school_type.trim()) {
    delete next.school_type;
  }

  return next;
}

export default function StudentFilterModal({
  open,
  onClose,
  filters,
  onApply,
}: Props) {
  const [local, setLocal] = useState<any>(filters || {});
  const title = useMemo(() => "ê³ ê¸‰ í•„í„°", []);

  useEffect(() => {
    if (!open) return;
    setLocal(filters || {});
  }, [open, filters]);

  useEffect(() => {
    function onKeyDown(e: KeyboardEvent) {
      if (e.key === "Escape") onClose();
    }
    if (open) window.addEventListener("keydown", onKeyDown);
    return () => window.removeEventListener("keydown", onKeyDown);
  }, [open, onClose]);

  function update(key: string, value: any) {
    setLocal((prev: any) => ({ ...prev, [key]: value }));
  }

  function apply() {
    const next = normalize({ ...local });
    onApply(next);
  }

  function reset() {
    setLocal({});
  }

  return (
    <AdminModal open={open} onClose={onClose} type="action" width={720}>
      <ModalHeader
        type="action"
        title={title}
        description="ì¡°ê±´ì— ë§ëŠ” í•™ìƒë§Œ ì¡°íšŒí•©ë‹ˆë‹¤."
      />

      <ModalBody>
        <div style={{ display: "grid", gap: 12 }}>
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
            <select
              className="ds-select"
              value={local.school_type ?? ""}
              onChange={(e) => update("school_type", e.target.value)}
            >
              <option value="">í•™êµê¸‰ ì „ì²´</option>
              <option value="HIGH">ê³ ë“±</option>
              <option value="MIDDLE">ì¤‘ë“±</option>
            </select>

            <select
              className="ds-select"
              value={local.is_managed ?? ""}
              onChange={(e) => update("is_managed", e.target.value)}
            >
              <option value="">ìƒíƒœ ì „ì²´</option>
              <option value="true">í™œì„±</option>
              <option value="false">ë¹„í™œì„±</option>
            </select>
          </div>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
            <input
              className="ds-input"
              placeholder="ì•„ì´ë””"
              value={local.ps_number || ""}
              onChange={(e) => update("ps_number", e.target.value)}
            />
            <input
              className="ds-input"
              placeholder="OMR ì‹ë³„ì (8ìë¦¬)"
              value={local.omr_code || ""}
              onChange={(e) => update("omr_code", e.target.value)}
            />
          </div>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
            <input
              className="ds-input"
              placeholder="ì´ë¦„"
              value={local.name || ""}
              onChange={(e) => update("name", e.target.value)}
            />
            <input
              className="ds-input"
              placeholder="ê³„ì—´(major)"
              value={local.major || ""}
              onChange={(e) => update("major", e.target.value)}
            />
          </div>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
            <input
              className="ds-input"
              placeholder="ê³ ë“±í•™êµ"
              value={local.high_school || ""}
              onChange={(e) => update("high_school", e.target.value)}
            />
            <input
              className="ds-input"
              placeholder="ì¤‘í•™êµ"
              value={local.middle_school || ""}
              onChange={(e) => update("middle_school", e.target.value)}
            />
          </div>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
            <select
              className="ds-select"
              value={local.gender || ""}
              onChange={(e) => update("gender", e.target.value)}
            >
              <option value="">ì„±ë³„ ì „ì²´</option>
              <option value="M">ë‚¨</option>
              <option value="F">ì—¬</option>
            </select>

            <select
              className="ds-select"
              value={local.grade ?? ""}
              onChange={(e) => update("grade", e.target.value)}
            >
              <option value="">í•™ë…„ ì „ì²´</option>
              <option value="1">1í•™ë…„</option>
              <option value="2">2í•™ë…„</option>
              <option value="3">3í•™ë…„</option>
            </select>
          </div>

          <div
            style={{
              marginTop: 2,
              fontSize: 11,
              fontWeight: 850,
              color: "var(--color-text-muted)",
              lineHeight: 1.6,
            }}
          >
            íŒ: í•„í„°ëŠ” ì„œë²„ ì¡°íšŒì— ë°˜ì˜ë©ë‹ˆë‹¤. ë¶ˆí•„ìš”í•œ ë¹ˆ ê°’ì€ ìë™ ì œê±°ë©ë‹ˆë‹¤.
          </div>
        </div>
      </ModalBody>

      <ModalFooter
        left={
          <Button intent="ghost" onClick={reset}>
            ì´ˆê¸°í™”
          </Button>
        }
        right={
          <>
            <Button intent="secondary" onClick={onClose}>
              ì·¨ì†Œ
            </Button>
            <Button intent="primary" onClick={apply}>
              ì ìš©
            </Button>
          </>
        }
      />
    </AdminModal>
  );
}


==========================================================================================
# FILE: components/StudentsTable.tsx
==========================================================================================
// PATH: src/features/students/components/StudentsTable.tsx
import { useMemo } from "react";
import { EmptyState, Button } from "@/shared/ui/ds";
import { DomainTable } from "@/shared/ui/domain";
import { toggleStudentActive } from "../api/students";
import { useQueryClient } from "@tanstack/react-query";

function escapeRegExp(s: string) {
  return s.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
}

function highlight(text: string, keyword: string) {
  if (!keyword) return text;
  const k = keyword.trim();
  if (!k) return text;

  const parts = String(text).split(new RegExp(`(${escapeRegExp(k)})`, "gi"));
  return parts.map((p, i) =>
    p.toLowerCase() === k.toLowerCase() ? (
      <mark
        key={`hl-${i}-${String(p).slice(0, 8)}`}
        className="px-0.5 rounded"
        style={{
          backgroundColor: "var(--state-selected-bg)",
          color: "inherit",
        }}
      >
        {p}
      </mark>
    ) : (
      p
    )
  );
}

function formatPhone(v: any) {
  if (!v) return "-";
  return String(v);
}

export default function StudentsTable({
  data = [],
  search,
  sort,
  onSortChange,
  onDelete,
  onRowClick,
  onEditClick,
}: {
  data: any[];
  search: string;
  sort: string;
  onSortChange: (v: string) => void;
  onDelete: (id: number) => void;
  onRowClick: (id: number) => void;
  onEditClick: (id: number) => void;
}) {
  const qc = useQueryClient();

  const columns = useMemo(
    () => [
      { key: "name", label: "ì´ë¦„", w: 140 },
      { key: "studentPhone", label: "í•™ìƒ ì „í™”/ì‹ë³„ì", w: 190 },
      { key: "parentPhone", label: "í•™ë¶€ëª¨ ì „í™”", w: 170 },
      { key: "school", label: "í•™êµ", w: 160 },
      { key: "schoolClass", label: "ë°˜", w: 80 },
      { key: "registeredAt", label: "ë“±ë¡ì¼", w: 120 },
      { key: "active", label: "ìƒíƒœ", w: 110 },
    ],
    []
  );

  if (!data.length) {
    return (
      <EmptyState
        title="í•™ìƒ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤."
        description="ê²€ìƒ‰/í•„í„° ì¡°ê±´ì„ í™•ì¸í•˜ê±°ë‚˜, ìƒˆ í•™ìƒì„ ë“±ë¡í•´ ì£¼ì„¸ìš”."
        scope="panel"
      />
    );
  }

  async function toggle(id: number, active: boolean) {
    await toggleStudentActive(id, !active);
    qc.invalidateQueries({ queryKey: ["students"] });
    qc.invalidateQueries({ queryKey: ["student", id] });
  }

  function sortHeader(colKey: string, label: string) {
    const isAsc = sort === colKey;
    const isDesc = sort === `-${colKey}`;
    const next = isAsc ? `-${colKey}` : isDesc ? "" : colKey;

    return (
      <th
        key={colKey}
        onClick={() => onSortChange(next)}
        className="cursor-pointer select-none"
        aria-sort={isAsc ? "ascending" : isDesc ? "descending" : "none"}
        scope="col"
      >
        <span className="inline-flex items-center gap-2">
          {label}
          <span
            aria-hidden
            style={{
              fontSize: 11,
              opacity: isAsc || isDesc ? 1 : 0.35,
              color: "var(--color-primary)",
            }}
          >
            {isAsc ? "â–²" : isDesc ? "â–¼" : "â‡…"}
          </span>
        </span>
      </th>
    );
  }

  return (
    <DomainTable tableClassName="ds-table--staff-home" tableStyle={{ tableLayout: "fixed" }}>
      <colgroup>
        {columns.map((c) => (
          <col key={c.key} style={{ width: c.w }} />
        ))}
        <col style={{ width: 160 }} />
      </colgroup>

      <thead>
        <tr>
          {columns.map((c) => sortHeader(c.key, c.label))}
          <th scope="col">ì‘ì—…</th>
        </tr>
      </thead>

      <tbody>
        {data.map((s) => (
            <tr
              key={s.id}
              onClick={() => onRowClick(s.id)}
              tabIndex={0}
              role="button"
              className="group cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-[var(--color-border-focus)]/40"
            >
              {/* ì´ë¦„ */}
              <td className="text-[15px] font-bold leading-6 text-[var(--color-text-primary)] truncate">
                {highlight(s.name || "-", search)}
              </td>

              {/* í•™ìƒ ì „í™” */}
              <td className="text-[14px] leading-6 text-[var(--color-text-secondary)] truncate">
                {highlight(formatPhone(s.studentPhone), search)}
              </td>

              {/* í•™ë¶€ëª¨ ì „í™” */}
              <td className="text-[14px] leading-6 text-[var(--color-text-secondary)] truncate">
                {highlight(s.parentPhone || "-", search)}
              </td>

              {/* í•™êµ */}
              <td className="text-[14px] leading-6 text-[var(--color-text-secondary)] truncate">
                {s.school || "-"}
              </td>

              {/* ë°˜ */}
              <td className="text-[14px] leading-6 text-[var(--color-text-secondary)] truncate">
                {s.schoolClass || "-"}
              </td>

              {/* ë“±ë¡ì¼ */}
              <td className="text-[13px] leading-6 font-semibold text-[var(--color-text-muted)] truncate">
                {s.registeredAt?.slice(0, 10) || "-"}
              </td>

              {/* ìƒíƒœ */}
              <td className="text-center" onClick={(e) => e.stopPropagation()}>
                <span
                  style={{
                    padding: "5px 12px",
                    borderRadius: 999,
                    fontWeight: 800,
                    fontSize: 12,
                    color: "white",
                    backgroundColor: s.active ? "#22c55e" : "#ef4444",
                  }}
                >
                  {s.active ? "í™œì„±" : "ë¹„í™œì„±"}
                </span>
              </td>

              {/* ì‘ì—… */}
              <td onClick={(e) => e.stopPropagation()}>
                <div className="flex items-center justify-center gap-2">
                  <Button intent="primary" size="sm" onClick={() => onEditClick(s.id)}>
                    ìˆ˜ì •
                  </Button>
                  <Button intent="danger" size="sm" onClick={() => onDelete(s.id)}>
                    ì‚­ì œ
                  </Button>
                </div>
              </td>
            </tr>
          ))}
      </tbody>
    </DomainTable>
  );
}


==========================================================================================
# FILE: hooks/useStudentsQuery.ts
==========================================================================================
// PATH: src/features/students/hooks/useStudentsQuery.ts
import { useQuery } from "@tanstack/react-query";
import { fetchStudents } from "../api/students";

function compare(a: any, b: any, key: string) {
  const av = a[key];
  const bv = b[key];

  if (av == null && bv == null) return 0;
  if (av == null) return -1;
  if (bv == null) return 1;

  if (key === "registeredAt") {
    const at = new Date(av || "").getTime();
    const bt = new Date(bv || "").getTime();
    return at - bt;
  }

  if (typeof av === "boolean" && typeof bv === "boolean") {
    return Number(av) - Number(bv);
  }

  if (typeof av === "number" && typeof bv === "number") {
    return av - bv;
  }

  return String(av).localeCompare(String(bv), "ko");
}

export function useStudentsQuery(search: string, filters: any, sort: string) {
  return useQuery({
    queryKey: ["students", search, filters, sort],
    queryFn: async () => {
      const data = await fetchStudents(search, filters, sort);

      if (!sort) return data;

      const isDesc = sort.startsWith("-");
      const key = isDesc ? sort.slice(1) : sort;

      const sorted = [...data].sort((a, b) => compare(a, b, key));
      return isDesc ? sorted.reverse() : sorted;
    },
    staleTime: 1000 * 5,
  });
}


==========================================================================================
# FILE: pages/StudentsDetailPage.tsx
==========================================================================================
// PATH: src/features/students/pages/StudentsDetailPage.tsx

import { useParams, useNavigate } from "react-router-dom";
import { useState } from "react";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import { createPortal } from "react-dom";

import {
  getStudentDetail,
  getTags,
  attachStudentTag,
  detachStudentTag,
  createMemo,
  deleteStudent,
} from "../api/students";

import StudentFormModal from "../components/EditStudentModal";
import { PageHeader, Section, EmptyState, Button } from "@/shared/ui/ds";

/* ================= constants ================= */

const TABS = [
  { key: "enroll", label: "ìˆ˜ê°• ì´ë ¥" },
  { key: "clinic", label: "í´ë¦¬ë‹‰/ìƒë‹´ ì´ë ¥" },
  { key: "question", label: "ì§ˆë¬¸ ì´ë ¥" },
  { key: "score", label: "ì„±ì  ì´ë ¥" },
  { key: "schoolScore", label: "í•™êµ ì„±ì " },
];

/* ================= page ================= */

export default function StudentsDetailPage() {
  const { studentId } = useParams();
  const navigate = useNavigate();
  const id = Number(studentId);
  const qc = useQueryClient();

  const [tab, setTab] = useState("enroll");
  const [editOpen, setEditOpen] = useState(false);

  const { data: student, isLoading } = useQuery({
    queryKey: ["student", id],
    queryFn: () => getStudentDetail(id),
    enabled: !!id,
  });

  const { data: tags } = useQuery({
    queryKey: ["tags"],
    queryFn: getTags,
  });

  const addTag = useMutation({
    mutationFn: (tagId: number) => attachStudentTag(id, tagId),
    onSuccess: () => qc.invalidateQueries({ queryKey: ["student", id] }),
  });

  const removeTag = useMutation({
    mutationFn: (tagId: number) => detachStudentTag(id, tagId),
    onSuccess: () => qc.invalidateQueries({ queryKey: ["student", id] }),
  });

  const updateMemo = useMutation({
    mutationFn: (memo: string) => createMemo(id, memo),
    onSuccess: () => qc.invalidateQueries({ queryKey: ["student", id] }),
  });

  async function handleDelete() {
    if (!confirm("ì´ í•™ìƒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
    await deleteStudent(id);
    qc.invalidateQueries({ queryKey: ["students"] });
    navigate(-1);
  }

  if (isLoading || !student) return null;

  return (
    <>
      {/* backdrop */}
      <div className="fixed inset-0 z-40 bg-black/60" onClick={() => navigate(-1)} />

      {/* overlay wrapper */}
      <div
        className="fixed inset-0 z-50 flex justify-center overflow-auto"
        style={{
          paddingTop: "calc(var(--panel-header, 64px) + 24px)",
          paddingBottom: 32,
        }}
      >
        <div
          className="w-full max-w-[1120px]"
          style={{
            borderRadius: 22,
            background: "var(--layout-page-bg)",
            border: "1px solid var(--color-border-divider)",
            boxShadow: "0 40px 120px rgba(0,0,0,0.55)",
          }}
        >
          {/* HEADER (GRADIENT) */}
          <div
            style={{
              borderTopLeftRadius: 22,
              borderTopRightRadius: 22,
              background:
                "linear-gradient(90deg, var(--color-primary) 0%, color-mix(in srgb, var(--color-primary) 30%, transparent) 100%), var(--color-primary)",
              color: "white",
            }}
          >
            <PageHeader
              title={
                <div style={{ fontSize: 22, fontWeight: 950, letterSpacing: "-0.3px" }}>
                  {student.name}
                </div>
              }
              description={<span style={{ opacity: 0.85 }}>ì•„ì´ë”” Â· {student.psNumber}</span>}
              actions={
                <div className="flex items-center gap-2">
                  <span
                    style={{
                      padding: "4px 12px",
                      fontSize: 12,
                      fontWeight: 900,
                      borderRadius: 999,
                      color: "white",
                      backgroundColor: student.active ? "var(--color-success)" : "var(--color-error)",
                    }}
                  >
                    {student.active ? "í™œì„±" : "ë¹„í™œì„±"}
                  </span>
                  <Button intent="secondary" size="sm" onClick={() => setEditOpen(true)}>
                    ìˆ˜ì •
                  </Button>
                  <Button intent="danger" size="sm" onClick={handleDelete}>
                    ì‚­ì œ
                  </Button>
                  <Button intent="ghost" size="sm" onClick={() => navigate(-1)}>
                    ë‹«ê¸°
                  </Button>
                </div>
              }
            />
          </div>

          {/* BODY */}
          <div className="px-6 py-6">
            <Section>
              <div
                style={{
                  display: "grid",
                  gridTemplateColumns: "300px 1fr",
                  gap: 20,
                }}
              >
                {/* LEFT PANEL */}
                <div
                  style={{
                    borderRadius: 18,
                    padding: 16,
                    background: "var(--bg-surface)",
                    border: "1px solid var(--color-border-divider)",
                  }}
                >
                  <div style={{ display: "grid", gap: 8 }}>
                    <InfoRow label="í•™ìƒ ì „í™”/ì‹ë³„ì" value={student.studentPhone} accent />
                    <InfoRow label="í•™ë¶€ëª¨ ì „í™”" value={student.parentPhone} />
                    <InfoRow label="ì„±ë³„" value={student.gender} />
                    <InfoRow label="í•™êµ" value={student.school} />
                    <InfoRow
                      label="í•™ë…„"
                      value={student.grade ? `${student.grade}í•™ë…„` : "-"}
                    />
                    <InfoRow label="ë°˜" value={student.schoolClass} />
                    <InfoRow label="ê³„ì—´" value={student.major} />
                  </div>

                  {/* TAG */}
                  <div style={{ marginTop: 18 }}>
                    <div
                      style={{
                        fontSize: 12,
                        fontWeight: 900,
                        marginBottom: 6,
                        color: "var(--color-text-muted)",
                      }}
                    >
                      íƒœê·¸
                    </div>

                    <div className="flex flex-wrap gap-2 mb-2">
                      {student.tags?.length ? (
                        student.tags.map((t: any) => (
                          <span
                            key={t.id}
                            style={{
                              padding: "4px 10px",
                              borderRadius: 999,
                              fontSize: 11,
                              fontWeight: 900,
                              background: `color-mix(in srgb, ${t.color} 22%, var(--color-bg-surface))`,
                              color: t.color,
                              border: `1px solid ${t.color}`,
                            }}
                          >
                            {t.name}
                          </span>
                        ))
                      ) : (
                        <span style={{ fontSize: 11, color: "var(--color-text-muted)" }}>
                          íƒœê·¸ ì—†ìŒ
                        </span>
                      )}
                    </div>

                    <select
                      className="ds-input"
                      onChange={(e) => {
                        const tagId = Number(e.target.value);
                        if (tagId) addTag.mutate(tagId);
                        e.currentTarget.value = "";
                      }}
                    >
                      <option value="">íƒœê·¸ ì¶”ê°€â€¦</option>
                      {tags?.map((tag: any) => (
                        <option key={tag.id} value={tag.id}>
                          {tag.name}
                        </option>
                      ))}
                    </select>
                  </div>

                  {/* MEMO */}
                  <div style={{ marginTop: 18 }}>
                    <div
                      style={{
                        fontSize: 12,
                        fontWeight: 900,
                        marginBottom: 6,
                        color: "var(--color-text-muted)",
                      }}
                    >
                      ë©”ëª¨
                    </div>
                    <textarea
                      className="ds-textarea"
                      rows={4}
                      defaultValue={student.memo}
                      placeholder="ë©”ëª¨..."
                      onBlur={(e) => updateMemo.mutate(e.target.value)}
                    />
                  </div>
                </div>

                {/* RIGHT PANEL */}
                <div
                  style={{
                    borderRadius: 18,
                    padding: 16,
                    background: "var(--bg-surface)",
                    border: "1px solid var(--color-border-divider)",
                  }}
                >
                  <div
                    style={{
                      display: "flex",
                      gap: 6,
                      padding: 6,
                      marginBottom: 14,
                      borderRadius: 14,
                      background: "var(--color-bg-surface-soft)",
                      border: "1px solid var(--color-border-divider)",
                    }}
                  >
                    {TABS.map((t) => {
                      const active = tab === t.key;
                      return (
                        <button
                          key={t.key}
                          onClick={() => setTab(t.key)}
                          style={{
                            padding: "8px 14px",
                            borderRadius: 12,
                            fontSize: 13,
                            fontWeight: 900,
                            color: active ? "white" : "var(--color-text-secondary)",
                            background: active ? "var(--color-primary)" : "transparent",
                            boxShadow: active ? "0 1px 2px rgba(0,0,0,0.08)" : "none",
                          }}
                        >
                          {t.label}
                        </button>
                      );
                    })}
                  </div>

                  <div style={{ minHeight: 260 }}>
                    {tab === "enroll" ? (
                      <EnrollmentsTab enrollments={student.enrollments} />
                    ) : (
                      <EmptyState title="ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤." />
                    )}
                  </div>
                </div>
              </div>
            </Section>
          </div>
        </div>
      </div>

      {/* ğŸ”§ ìˆ˜ì • ë²„íŠ¼ ëª¨ë‹¬ í¬íƒˆ */}
      {editOpen &&
        createPortal(
          <StudentFormModal
            open={true}
            initialValue={student}
            onClose={() => setEditOpen(false)}
            onSuccess={() => {
              setEditOpen(false);
              qc.invalidateQueries({ queryKey: ["student", id] });
            }}
          />,
          document.body
        )}
    </>
  );
}

/* ================= sub ================= */

function InfoRow({
  label,
  value,
  accent,
}: {
  label: string;
  value: any;
  accent?: boolean;
}) {
  return (
    <div
      style={{
        display: "grid",
        gridTemplateColumns: "1fr auto",
        alignItems: "center",
        padding: "8px 10px",
        borderRadius: 12,
        background: accent
          ? "color-mix(in srgb, var(--color-primary) 10%, var(--color-bg-surface))"
          : "var(--color-bg-surface)",
        border: "1px solid var(--color-border-divider)",
        fontSize: 12,
      }}
    >
      <span style={{ fontWeight: 800, color: "var(--color-text-muted)" }}>{label}</span>
      <span style={{ fontWeight: 950, color: "var(--color-text-primary)" }}>{value || "-"}</span>
    </div>
  );
}

function EnrollmentsTab({ enrollments }: { enrollments: any[] }) {
  if (!enrollments?.length) return <EmptyState title="ìˆ˜ê°• ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤." />;

  return (
    <div style={{ display: "grid", gap: 10 }}>
      {enrollments.map((en: any) => (
        <div
          key={en.id}
          style={{
            padding: "12px 14px",
            borderRadius: 14,
            background: "var(--color-bg-surface)",
            border: "1px solid var(--color-border-divider)",
            fontSize: 13,
            fontWeight: 900,
          }}
        >
          {en.lectureName || "-"}
        </div>
      ))}
    </div>
  );
}


==========================================================================================
# FILE: pages/StudentsHomePage.tsx
==========================================================================================
// PATH: src/features/students/pages/StudentsHomePage.tsx
import { useEffect, useMemo, useState } from "react";
import { useNavigate } from "react-router-dom";
import { useQueryClient } from "@tanstack/react-query";

import { useStudentsQuery } from "../hooks/useStudentsQuery";
import StudentsTable from "../components/StudentsTable";
import StudentCreateModal from "../components/StudentCreateModal";
import StudentFilterModal from "../components/StudentFilterModal";
import DeleteConfirmModal from "../components/DeleteConfirmModal";

import { Button, EmptyState } from "@/shared/ui/ds";

export default function StudentsHomePage() {
  const navigate = useNavigate();
  const qc = useQueryClient();

  const [searchInput, setSearchInput] = useState("");
  const [search, setSearch] = useState("");
  const [filters, setFilters] = useState<any>({});
  const [showCreate, setShowCreate] = useState(false);
  const [showFilter, setShowFilter] = useState(false);
  const [sort, setSort] = useState("-registeredAt");
  const [deleteId, setDeleteId] = useState<number | null>(null);

  useEffect(() => {
    const t = setTimeout(() => setSearch(searchInput), 250);
    return () => clearTimeout(t);
  }, [searchInput]);

  const { data, isLoading } = useStudentsQuery(search, filters, sort);
  const activeFilterCount = useMemo(
    () => Object.keys(filters || {}).length,
    [filters]
  );

  return (
    <>
      <div className="rounded-2xl bg-[var(--bg-surface)] border border-[var(--border-divider)]">
        {/* CARD HEADER */}
        <div className="px-5 py-4 border-b border-[var(--border-divider)]">
          <div className="text-base font-semibold mb-2">
            í•™ìƒ ê´€ë¦¬
          </div>

          <input
            className="ds-input"
            placeholder="ì´ë¦„ / ì•„ì´ë”” / ì „í™”ë²ˆí˜¸ / í•™êµ ê²€ìƒ‰"
            value={searchInput}
            onChange={(e) => setSearchInput(e.target.value)}
            style={{ maxWidth: 360 }}
          />
        </div>

        {/* CARD ACTIONS */}
        <div className="px-5 py-3 flex items-center gap-2 border-b border-[var(--border-divider)]">
          <Button intent="secondary" onClick={() => setShowFilter(true)}>
            ê³ ê¸‰ í•„í„°{activeFilterCount ? ` (${activeFilterCount})` : ""}
          </Button>
          <Button intent="primary" onClick={() => setShowCreate(true)}>
            í•™ìƒ ì¶”ê°€
          </Button>

          <span className="ml-auto text-sm font-semibold text-[var(--color-text-muted)]">
            {isLoading ? "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦" : `${data?.length ?? 0}ëª…`}
          </span>
        </div>

        {/* CARD BODY */}
        <div className="p-4">
          {isLoading ? (
            <EmptyState scope="panel" tone="loading" title="ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦" />
          ) : data?.length ? (
            <StudentsTable
              data={data}
              search={search}
              sort={sort}
              onSortChange={setSort}
              onDelete={(id) => setDeleteId(id)}
              onRowClick={(id) => navigate(`/admin/students/${id}`)}
            />
          ) : (
            <EmptyState
              scope="panel"
              tone="empty"
              title="í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤"
              description="í•™ìƒì„ ë“±ë¡í•˜ë©´ ëª©ë¡/ê²€ìƒ‰/ì´ë ¥ ê´€ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤."
              actions={
                <Button intent="primary" onClick={() => setShowCreate(true)}>
                  í•™ìƒ ì¶”ê°€
                </Button>
              }
            />
          )}
        </div>
      </div>

      {/* MODALS */}
      <StudentCreateModal
        open={showCreate}
        onClose={() => setShowCreate(false)}
        onSuccess={() => {
          setShowCreate(false);
          qc.invalidateQueries({ queryKey: ["students"] });
        }}
      />

      <StudentFilterModal
        open={showFilter}
        filters={filters}
        onClose={() => setShowFilter(false)}
        onApply={(next) => {
          setFilters(next);
          setShowFilter(false);
        }}
      />

      {deleteId != null && (
        <DeleteConfirmModal
          open
          id={deleteId}
          onClose={() => setDeleteId(null)}
          onSuccess={() => {
            setDeleteId(null);
            qc.invalidateQueries({ queryKey: ["students"] });
          }}
        />
      )}
    </>
  );
}
