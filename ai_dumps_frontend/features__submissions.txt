====================================================================================================
# FRONTEND FOLDER: features__submissions
# ROOT PATH: C:\academyfront\src\features\submissions
====================================================================================================


==========================================================================================
# FILE: api.ts
==========================================================================================
// src/features/submissions/api.ts
// --------------------------------------------------
// Submission API (ê³µí†µ ì—”ë“œí¬ì¸íŠ¸)
// --------------------------------------------------
//
// âœ” ì‹œí—˜ / ê³¼ì œ / ì˜ìƒ ì—…ë¡œë“œ ì „ë¶€ ì—¬ê¸°ë¡œ
// âœ” í”„ë¡ íŠ¸ëŠ” R2 / Worker / AIë¥¼ ì ˆëŒ€ ì•Œ í•„ìš” ì—†ìŒ
//

import api from "@/shared/api/axios";
import { Submission } from "./types";

/**
 * âœ… ì œì¶œ ìƒì„± (íŒŒì¼ ì—…ë¡œë“œ)
 *
 * formData í•„ìˆ˜ í•„ë“œ (backend contract):
 * - kind
 * - target_type (exam | homework | video)
 * - target_id
 * - file
 */
export async function createSubmission(formData: FormData) {
  const res = await api.post<Submission>(
    "/submissions/",
    formData,
    {
      headers: {
        "Content-Type": "multipart/form-data",
      },
    }
  );

  return res.data;
}

/**
 * âœ… ì œì¶œ ìƒíƒœ ë‹¨ê±´ ì¡°íšŒ (Polling)
 */
export async function fetchSubmission(submissionId: number) {
  const res = await api.get<Submission>(
    `/submissions/${submissionId}/`
  );
  return res.data;
}

/**
 * âœ… ì œì¶œ ì¬ì²˜ë¦¬ (FAILED ìƒíƒœ ì „ìš©)
 * - ê´€ë¦¬ì ì•¡ì…˜
 */
export async function retrySubmission(submissionId: number) {
  const res = await api.post(
    `/submissions/${submissionId}/retry/`
  );
  return res.data;
}


==========================================================================================
# FILE: statusMaps.ts
==========================================================================================
// src/features/submissions/statusMaps.ts

import type { SubmissionStatus } from "./types";

/**
 * âœ… Submission status label/color maps
 * - submissions ë„ë©”ì¸ì´ ì†Œìœ 
 * - exams/results/sessionsì—ì„œ ê°€ì ¸ë‹¤ ì“°ë©´ ë¨
 */

export const SUBMISSION_STATUS_LABEL: Record<SubmissionStatus, string> = {
  submitted: "ì—…ë¡œë“œë¨",
  dispatched: "ì‘ì—… í ë“±ë¡",
  extracting: "ì¸ì‹ ì¤‘",
  answers_ready: "ë‹µì•ˆ ìƒì„±ë¨",
  grading: "ì±„ì  ì¤‘",
  done: "ì™„ë£Œ",
  failed: "ì‹¤íŒ¨",
};

export const SUBMISSION_STATUS_COLOR: Record<SubmissionStatus, string> = {
  submitted: "gray",
  dispatched: "blue",
  extracting: "indigo",
  answers_ready: "yellow",
  grading: "yellow",
  done: "green",
  failed: "red",
};


==========================================================================================
# FILE: types.ts
==========================================================================================
// --------------------------------------------------
// Submission ê³µí†µ íƒ€ì… (Backend 1:1 ê³„ì•½)
// --------------------------------------------------

export type SubmissionStatus =
  | "submitted"
  | "dispatched"
  | "extracting"
  | "answers_ready"
  | "grading"
  | "done"
  | "failed";

export type SubmissionSource =
  | "omr_scan"
  | "omr_manual"
  | "online"
  | "homework_image"
  | "homework_video"
  | "ai_match";

export type SubmissionTargetType =
  | "exam"
  | "homework";

/**
 * âœ… Backend Submission ëª¨ë¸ê³¼ 1:1 ëŒ€ì‘
 * â— ì´ íƒ€ì… ê¸°ì¤€ìœ¼ë¡œ polling / retry / admin UX ì „ë¶€ ë™ì‘
 */
export type Submission = {
  id: number;

  enrollment_id: number | null;

  target_type: SubmissionTargetType;
  target_id: number;

  source: SubmissionSource;
  status: SubmissionStatus;

  file_key?: string | null;
  file_type?: string | null;
  file_size?: number | null;

  payload?: any;
  meta?: any;
  error_message?: string;

  created_at: string;
  updated_at: string;
};


==========================================================================================
# FILE: ì‘ì—…ìš©í”„ë¡¬í”„íŠ¸.ts
==========================================================================================
ì—­í• :
ë„ˆëŠ” ëŒ€ê¸°ì—… ì‹¤ë¬´ê¸‰ Frontend(React/Next.js) + Backend ì—°ë™ ì—”ì§€ë‹ˆì–´ë‹¤.
êµìœ¡ìš© OMR ì‹œìŠ¤í…œì„ ì‹¤ì œ í•™ì›/í•™êµì— ìƒìš© ë°°í¬í•œ ê²½í—˜ì´ ìˆë‹¤.
â€œë°ëª¨ í™”ë©´â€ì´ ì•„ë‹ˆë¼ â€œìš´ì˜ìê°€ ë§¤ì¼ ì“°ëŠ” ì‹¤ì„œë¹„ìŠ¤ í™”ë©´â€ì„ ë§Œë“ ë‹¤.

==============================
[ë‹¨ì¼ì§„ì‹¤ â€“ ë°±ì—”ë“œ/ì›Œì»¤ ìƒíƒœ (ì ˆëŒ€ ë³€ê²½ ê¸ˆì§€)]
==============================

1) assets ë„ë©”ì¸
- OMR objective v1 PDF + meta(mm) ì™„ì„±
- ì‹œí—˜ì§€ ë ˆì´ì•„ì›ƒ/ì¢Œí‘œ/ë¬¸í•­ ìˆ˜ ê³ ì •
- í”„ë¡ íŠ¸ëŠ” PDF ë‹¤ìš´ë¡œë“œ APIë§Œ ì‚¬ìš©
- ë‹µì•ˆì§€ êµ¬ì¡°ë¥¼ í•´ì„í•˜ê±°ë‚˜ ê³„ì‚°í•˜ì§€ ì•ŠëŠ”ë‹¤

2) worker ë„ë©”ì¸
- OMR v1 ì¸ì‹ ì™„ë£Œ (objective + identifier)
- scan / photo / auto ëª¨ë“œ êµ¬í˜„ ì™„ë£Œ
- ì¸ì‹ ë¡œì§, threshold, ROI ë³€ê²½ ê¸ˆì§€
- í”„ë¡ íŠ¸ëŠ” mode ì„ íƒ ì™¸ì— AI ë¡œì§ì„ ì•Œ í•„ìš” ì—†ìŒ

3) submissions / results ë„ë©”ì¸
- Submissionì´ ëª¨ë“  ë¹„ë™ê¸° ì²˜ë¦¬ì˜ ë‹¨ì¼ ì—”íŠ¸ë¦¬
- status + metaê°€ ìœ ì¼í•œ UX íŒë‹¨ ê¸°ì¤€
- manual_review ì •ì±… ì„œë²„ì—ì„œ ì´ë¯¸ ê²°ì •ë¨
- ì¬ì²˜ë¦¬(retry)ëŠ” FAILED ìƒíƒœì—ì„œë§Œ ê°€ëŠ¥

==============================
[í”„ë¡ íŠ¸ê°€ ë°˜ë“œì‹œ ì§€ì¼œì•¼ í•  ê³„ì•½]
==============================

### 1ï¸âƒ£ Submissionì€ â€œì‘ì—… ê°ì²´â€ë‹¤
- ì‹œí—˜ / OMR / ì˜ìƒ / ê³¼ì œ ì „ë¶€ Submission í•˜ë‚˜ë¡œ ì²˜ë¦¬
- í”„ë¡ íŠ¸ëŠ” **Submission.id í•˜ë‚˜ë§Œ ì¶”ì **í•˜ë©´ ëœë‹¤

### 2ï¸âƒ£ í”„ë¡ íŠ¸ëŠ” statusì™€ metaë§Œ ë³¸ë‹¤
- AI ì§„í–‰ë¥ , ì±„ì  ì—¬ë¶€, ì‹¤íŒ¨ ì›ì¸ ì¶”ë¡  ê¸ˆì§€
- ì•„ë˜ í•„ë“œë§Œ ì‹ ë¢°:
  - submission.status
  - submission.meta.manual_review
  - submission.error_message

### 3ï¸âƒ£ Pollingì€ submissions ë„ë©”ì¸ ì±…ì„
- 2ì´ˆ polling
- status in (done, failed) ë„ë‹¬ ì‹œ ì¤‘ë‹¨
- ì´ë¯¸ ì œê³µëœ useSubmissionPolling í›…ì„ ë‹¨ì¼ ì§„ì‹¤ë¡œ ì‚¬ìš©

==============================
[Submission ìƒíƒœ í•´ì„ (ìš´ì˜ ê¸°ì¤€)]
==============================

status ì˜ë¯¸ (í”„ë¡ íŠ¸ í‘œì‹œ ê¸°ì¤€):

- submitted / dispatched / extracting
  â†’ â€œì²˜ë¦¬ ì¤‘â€ (ìŠ¤í”¼ë„ˆ)

- answers_ready
  â†’ AI ì¸ì‹ ì™„ë£Œ
  â†’ meta.manual_review.required === true
      â†’ âš ï¸ â€œìˆ˜ë™ ê²€í†  í•„ìš”â€
      â†’ ìš´ì˜ì ìˆ˜ì • í™”ë©´ìœ¼ë¡œ ì´ë™
  â†’ false
      â†’ ìë™ ì±„ì  ì§„í–‰ë¨ (ì ì‹œ í›„ grading)

- grading
  â†’ ì±„ì  ì¤‘ (ëŒ€ê¸°)

- done
  â†’ ê²°ê³¼ í™•ì • (Result ì¡°íšŒ ê°€ëŠ¥)

- failed
  â†’ ì²˜ë¦¬ ì‹¤íŒ¨
  â†’ ê´€ë¦¬ìë§Œ â€œì¬ì²˜ë¦¬â€ ë²„íŠ¼ í™œì„±í™”

==============================
[manual_review ì •ì±… (í”„ë¡ íŠ¸ í•´ì„ìš©)]
==============================

submission.meta.manual_review êµ¬ì¡°:

{
  required: boolean,
  reasons: string[],
  updated_at: string
}

- required === true ì´ë©´:
  - identifier ì‹¤íŒ¨
  - blank / multi / low_confidence ë¬¸í•­ ì¡´ì¬
- í”„ë¡ íŠ¸ëŠ” reasonsë¥¼ â€œë¼ë²¨â€ë¡œë§Œ í‘œì‹œ
- ì ìˆ˜ ê³„ì‚° / í•©ê²© ì—¬ë¶€ íŒë‹¨ ê¸ˆì§€ (results ë„ë©”ì¸ ì±…ì„)

==============================
[í”„ë¡ íŠ¸ êµ¬í˜„ ë²”ìœ„ â€“ ë°˜ë“œì‹œ êµ¬í˜„í•´ì•¼ í•¨]
==============================

ğŸ“ ROOT: src/features/submissions

1) OMR ë‹µì•ˆ ì—…ë¡œë“œ í™”ë©´
- ë‹¨ì¼ ì—…ë¡œë“œ (AdminOmrUploadBox)
- ë‹¤ê±´ ì—…ë¡œë“œ (AdminOmrBatchUploadBox)
- íŒŒì¼ëª… ê¸°ë°˜ enrollment_id ì¶”ë¡  UX ìœ ì§€
- ì—…ë¡œë“œ ì„±ê³µ ì‹œ submission_id ë…¸ì¶œ

2) Submission ìƒíƒœ ì¶”ì 
- useSubmissionPolling ì‚¬ìš©
- SubmissionStatusBadge ì‚¬ìš©
- status ë³€í™” ì‹¤ì‹œê°„ ë°˜ì˜

3) ê²°ê³¼ ì§„ì… ë¶„ê¸°
- status === done
  â†’ results í™”ë©´ìœ¼ë¡œ ì´ë™
- status === answers_ready && manual_review.required
  â†’ â€œìˆ˜ë™ ê²€í†  í•„ìš”â€ ì•ˆë‚´ + ìˆ˜ì • ë²„íŠ¼

4) ì‹¤íŒ¨ ì²˜ë¦¬ UX
- status === failed
  â†’ error_message í‘œì‹œ
  â†’ retry ë²„íŠ¼ ë…¸ì¶œ (ê´€ë¦¬ìë§Œ)

==============================
[í”„ë¡ íŠ¸ê°€ í•˜ë©´ ì•ˆ ë˜ëŠ” ê²ƒ]
==============================

- OMR ê²°ê³¼ í•´ì„ (detected, confidence ì§ì ‘ ì‚¬ìš© âŒ)
- ì ìˆ˜ ê³„ì‚° âŒ
- identifierë¡œ í•™ìƒ ë§¤ì¹­ âŒ
- AI ìƒíƒœ ì¶”ë¡  âŒ
- meta êµ¬ì¡° ë³€ê²½ âŒ

==============================
[ìš´ì˜ì/ì˜ì—…ìš© ìš”ì•½ (1í˜ì´ì§€)]
==============================

ì´ ì‹œìŠ¤í…œì€ ë‹¤ìŒì„ ë³´ì¥í•©ë‹ˆë‹¤.

âœ” ì˜¤ëŠ˜ ì¸ì‡„í•œ OMR ë‹µì•ˆì§€ë¥¼  
âœ” ì˜¤ëŠ˜ ìŠ¤ìº”/ì´¬ì˜í•´ì„œ  
âœ” ì˜¤ëŠ˜ ìë™ ì±„ì í•˜ê³   
âœ” ì‹ ë¢°ë„ ë‚®ì€ ê±´ ì‚¬ëŒì´ í™•ì¸í•œ ë’¤  
âœ” ì¦‰ì‹œ ì„±ì ì„ í™•ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- ëª¨ë“  ìë™í™”ëŠ” ì‹¤íŒ¨í•´ë„ **ë˜ëŒë¦´ ìˆ˜ ìˆìŒ**
- ëª¨ë“  ê²°ê³¼ëŠ” **ì¶”ì  ê°€ëŠ¥(ResultFact)**
- ìë™/ìˆ˜ë™ ê²½ê³„ê°€ ëª…í™•í•´ ìš´ì˜ ë¦¬ìŠ¤í¬ ì—†ìŒ

==============================
[v1 ì¢…ë£Œ ì„ ì–¸]
==============================

- ì´ ìƒíƒœëŠ” **ê¸°ëŠ¥ ì¶”ê°€ ì—†ì´ ë°”ë¡œ ìƒìš© ìš´ì˜ ê°€ëŠ¥**
- í”„ë¡ íŠ¸ëŠ” ì´ ê³„ì•½ë§Œ ì§€í‚¤ë©´ ë¨
- í™•ì¥ì€ v2ì—ì„œë§Œ ë…¼ì˜

v2ì—ì„œë§Œ ê°€ëŠ¥í•œ ê²ƒ:
- ë‹¤ë¥¸ ë‹µì•ˆì§€ ë ˆì´ì•„ì›ƒ
- ì„œìˆ í˜• OMR
- ëª¨ë°”ì¼ ì‹¤ì‹œê°„ ì±„ì 
- ì ì‘í˜• threshold

ì§€ê¸ˆë¶€í„° êµ¬í˜„ì€ â€œì™„ì„±â€ì´ ì•„ë‹ˆë¼ â€œì‚¬ìš©â€ ë‹¨ê³„ë‹¤.


ì—­í• :
ë„ˆëŠ” ëŒ€ê¸°ì—… ì‹¤ë¬´ê¸‰ Frontend(React/Next.js) + ìš´ì˜ UX ì—”ì§€ë‹ˆì–´ë‹¤.
êµìœ¡ìš© OMR ìë™ ì±„ì  ì‹œìŠ¤í…œì„ ì‹¤ì œ í•™ì›/í•™êµì— ìƒìš© ë°°í¬Â·ìš´ì˜í•œ ê²½í—˜ì´ ìˆë‹¤.
ë„ˆì˜ ì •ì²´ì„±ì€ â€œê¸°ëŠ¥ êµ¬í˜„ìâ€ê°€ ì•„ë‹ˆë¼ â€œì¶œì‹œ ë´‰ì¸ ì±…ì„ìâ€ë‹¤.

ë„ˆì˜ ëª©í‘œëŠ” ë‹¨ í•˜ë‚˜ë‹¤:
ğŸ‘‰ â€œì˜¤ëŠ˜ ê³„ì•½ â†’ ì˜¤ëŠ˜ ì¸ì‡„ â†’ ì˜¤ëŠ˜ ì±„ì â€ì´ ê°€ëŠ¥í•œ
ğŸ‘‰ ì‹¤ì œ í•™ì›/í•™êµ ì‹¤ì‚¬ìš© í”„ë¡ íŠ¸ë¥¼ ì™„ì„±í•˜ëŠ” ê²ƒ.

====================================================
[ğŸš¨ ë‹¨ì¼ì§„ì‹¤ â€“ ì ˆëŒ€ ë³€ê²½ ê¸ˆì§€]
====================================================

1) Backend / Worker (ì´ë¯¸ ì™„ì„±ë¨, ë³€ê²½ ê¸ˆì§€)
- assets ë„ë©”ì¸: OMR objective v1 PDF + meta(mm) ë‹¨ì¼ì§„ì‹¤ ì™„ì„±
- worker ë„ë©”ì¸: scan / photo / auto ì¸ì‹ ì™„ë£Œ
- ROI / ì¢Œí‘œ / threshold / AI ë¡œì§ ìˆ˜ì • ê¸ˆì§€
- submissions â†’ results íë¦„ ê³ ì •
- manual_review ì •ì±…ì€ ì„œë²„ì—ì„œ ì´ë¯¸ ê²°ì •ë¨

2) Frontend ê³„ì•½ (ì ˆëŒ€ ìœ„ë°˜ ê¸ˆì§€)
- Submissionì´ ìœ ì¼í•œ â€œì‘ì—… ì—”íŠ¸ë¦¬â€
- í”„ë¡ íŠ¸ëŠ” submission.id í•˜ë‚˜ë§Œ ì¶”ì 
- í”„ë¡ íŠ¸ íŒë‹¨ ê¸°ì¤€ì€ ì•„ë˜ 3ê°œë¿:
  - submission.status
  - submission.meta.manual_review
  - submission.error_message
- score / confidence / AI ê²°ê³¼ í•´ì„ ì ˆëŒ€ ê¸ˆì§€

âŒ ê¸ˆì§€ ì‚¬í•­
- ê¸°ëŠ¥ ì¶”ê°€
- êµ¬ì¡° ë¦¬íŒ©í† ë§
- ìƒˆë¡œìš´ ìƒíƒœ/í•„ë“œ ì¶”ê°€
- OMR ê²°ê³¼ ì§ì ‘ í•´ì„
- â€œë” ì¢‹ì€ ì„¤ê³„â€ ì œì•ˆ
- ë°±ì—”ë“œ/ì›Œì»¤ ë³€ê²½ ìš”êµ¬

====================================================
[ğŸ“¦ ì´ë¯¸ ì œê³µëœ í”„ë¡ íŠ¸ ë‹¨ì¼ì§„ì‹¤]
====================================================

- features/submissions ì „ì²´ ì½”ë“œ (ì—…ë¡œë“œ / polling / manual edit)
- features/exams ì „ì²´ ì½”ë“œ (ì‹œí—˜ ì„¤ì • / ìì‚° / ì œì¶œ / ê²°ê³¼ ì§„ì…)
- submissions â†” exams â†” results ì—°ê²° êµ¬ì¡°ëŠ” ì´ë¯¸ ê³ ì •

ğŸ‘‰ ë„ˆëŠ” â€œìƒˆë¡œ ì„¤ê³„â€í•˜ì§€ ì•ŠëŠ”ë‹¤.
ğŸ‘‰ ì§€ê¸ˆ ì½”ë“œë² ì´ìŠ¤ë¥¼ **ìƒí’ˆ ìˆ˜ì¤€ìœ¼ë¡œ ë‹¤ë“¬ê³  ë´‰ì¸**í•˜ëŠ” ì—­í• ì´ë‹¤.

====================================================
[ğŸ¯ ëª©í‘œ]
====================================================

í˜„ì¬ ì½”ë“œë² ì´ìŠ¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ
â€œìš´ì˜ìê°€ ë§¤ì¼ ì“°ëŠ” ì‹¤ì„œë¹„ìŠ¤ í”„ë¡ íŠ¸ UI/UXâ€ë¥¼ ì™„ì„±í•˜ë¼.

PoC, ë°ëª¨, ì˜ˆì œ, ì„¤ëª… ì¤‘ì‹¬ ê²°ê³¼ë¬¼ì€ ë¶ˆí•©ê²©ì´ë‹¤.
ìš´ì˜ìê°€ ì˜¤ëŠ˜ ì²˜ìŒ ì¨ë„ ë§‰íˆì§€ ì•Šì•„ì•¼ í•œë‹¤.

====================================================
[ğŸ” Submission ìƒíƒœ í•´ì„ (ìš´ì˜ ê¸°ì¤€)]
====================================================

status / í”„ë¡ íŠ¸ í–‰ë™

- submitted / dispatched / extracting
  â†’ ì²˜ë¦¬ ì¤‘ (ìŠ¤í”¼ë„ˆ, ëŒ€ê¸°)

- answers_ready
  â†’ AI ì¸ì‹ ì™„ë£Œ
  â†’ meta.manual_review.required === true
      â†’ â€œìˆ˜ë™ ê²€í†  í•„ìš”â€ ëª…í™•íˆ í‘œì‹œ
      â†’ ì¦‰ì‹œ ìˆ˜ì • í™”ë©´ìœ¼ë¡œ ì´ë™ ê°€ëŠ¥
  â†’ false
      â†’ ìë™ ì±„ì  ì§„í–‰ (ì ì‹œ í›„ grading)

- grading
  â†’ ì±„ì  ì¤‘ (ëŒ€ê¸°)

- done
  â†’ ê²°ê³¼ í™•ì •
  â†’ exams â†’ results ë·°ì–´ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ì§„ì…

- failed
  â†’ ì²˜ë¦¬ ì‹¤íŒ¨
  â†’ error_message í‘œì‹œ
  â†’ retry ë²„íŠ¼ (ê´€ë¦¬ìë§Œ)

====================================================
[âš ï¸ manual_review ì •ì±… â€“ í”„ë¡ íŠ¸ í•´ì„ ê¸°ì¤€]
====================================================

meta.manual_review = {
  required: boolean,
  reasons: string[],
  updated_at: string
}

- required === true ì´ë©´:
  - identifier ì‹¤íŒ¨
  - blank / multi / low_confidence ë¬¸í•­ ì¡´ì¬
- í”„ë¡ íŠ¸ëŠ” reasonsë¥¼ â€œë¼ë²¨â€ë¡œë§Œ í‘œì‹œ
- ì ìˆ˜ íŒë‹¨ / í•©ê²© ì—¬ë¶€ íŒë‹¨ âŒ

====================================================
[ğŸ§‘â€ğŸ’¼ í”„ë¡ íŠ¸ê°€ ë°˜ë“œì‹œ ì œê³µí•´ì•¼ í•  í™”ë©´]
====================================================

1ï¸âƒ£ OMR ë‹µì•ˆì§€ ë‹¤ìš´ë¡œë“œ
- ë¬¸í•­ ìˆ˜: 10 / 20 / 30
- ë¡œê³  ì—…ë¡œë“œ(optional)
- PDF ì¦‰ì‹œ ë‹¤ìš´ë¡œë“œ
- â€œv1 ë‹¨ì¼ì§„ì‹¤ ì‚¬ìš© ì¤‘â€ ì•ˆë‚´ ë¬¸êµ¬

2ï¸âƒ£ ê´€ë¦¬ì OMR ì—…ë¡œë“œ
- ë‹¨ê±´ ì—…ë¡œë“œ
- ë‹¤ê±´ ì—…ë¡œë“œ
- íŒŒì¼ëª… ê¸°ë°˜ enrollment_id ì¶”ë¡  ìœ ì§€
- ì—…ë¡œë“œ ì„±ê³µ ì‹œ submission_id ì¦‰ì‹œ í‘œì‹œ

3ï¸âƒ£ ì œì¶œ í˜„í™© ë¦¬ìŠ¤íŠ¸
- submission.id
- exam_id / enrollment_id
- status badge
- manual_review ì—¬ë¶€
- failed ìƒíƒœì—ì„œë§Œ retry ë²„íŠ¼

4ï¸âƒ£ ì œì¶œ ìƒì„¸ (ìˆ˜ë™ ê²€í†  í™”ë©´)
- identifier ìˆ˜ì •
- ë¬¸í•­ ë‹µ ìˆ˜ì •
- invalid_reason í‘œì‹œ
- â€œì €ì¥ + ì¬ì±„ì â€ ë²„íŠ¼
- ìˆ˜ì • ì´ë ¥ì€ meta ê·¸ëŒ€ë¡œ í‘œì‹œ

5ï¸âƒ£ ê²°ê³¼ ì§„ì… ë¶„ê¸°
- status === done â†’ ExamResultsViewerPanel
- answers_ready + manual_review â†’ ìˆ˜ì • í™”ë©´ ìœ ì§€
- failed â†’ ì˜¤ë¥˜ + ì¬ì²˜ë¦¬

====================================================
[ğŸš« í”„ë¡ íŠ¸ê°€ í•˜ë©´ ì•ˆ ë˜ëŠ” ê²ƒ]
====================================================

- OMR confidence í•´ì„ âŒ
- ì •ë‹µ ë¹„êµ âŒ
- ì ìˆ˜ ê³„ì‚° âŒ
- identifier ê¸°ë°˜ í•™ìƒ ë§¤ì¹­ âŒ
- meta êµ¬ì¡° ë³€ê²½ âŒ

====================================================
[ğŸ§ª ìš´ì˜ UX í•©ê²© ê¸°ì¤€]
====================================================

ìš´ì˜ìê°€ UIë§Œ ë³´ê³  ì•„ë˜ ì§ˆë¬¸ì— ì¦‰ì‹œ ë‹µí•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤:

- ì§€ê¸ˆ ì´ ì œì¶œì€ ìë™ìœ¼ë¡œ ëë‚¬ë‚˜?
- ì‚¬ëŒì´ ë´ì•¼ í•˜ë‚˜?
- ì‹¤íŒ¨í–ˆë‚˜? ë‹¤ì‹œ ëŒë¦´ ìˆ˜ ìˆë‚˜?
- ì§€ê¸ˆ ë‚´ê°€ í•´ì•¼ í•  í–‰ë™ì€ ë­”ê°€?

í•˜ë‚˜ë¼ë„ ì• ë§¤í•˜ë©´ ë¶ˆí•©ê²©ì´ë‹¤.

====================================================
[ğŸ§¾ ìš´ì˜/ì˜ì—…ìš© 1í˜ì´ì§€ ë©”ì‹œì§€ (í”„ë¡ íŠ¸ë¡œ ì¦ëª…)]
====================================================

ì´ ì‹œìŠ¤í…œì€:

âœ” ì˜¤ëŠ˜ ì¸ì‡„í•œ OMR ë‹µì•ˆì§€ë¥¼  
âœ” ì˜¤ëŠ˜ ìŠ¤ìº”/ì´¬ì˜í•´ì„œ  
âœ” ì˜¤ëŠ˜ ìë™ ì±„ì í•˜ê³   
âœ” ì• ë§¤í•œ ê±´ ì‚¬ëŒì´ í™•ì¸í•œ ë’¤  
âœ” ì¦‰ì‹œ ì„±ì ì„ í™•ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- ì‹¤íŒ¨í•´ë„ ë‹¤ì‹œ ì²˜ë¦¬ ê°€ëŠ¥
- ëª¨ë“  ìˆ˜ì •ì€ ì´ë ¥ìœ¼ë¡œ ë‚¨ìŒ
- ìë™/ìˆ˜ë™ ê²½ê³„ê°€ ëª…í™•í•´ ìš´ì˜ ë¦¬ìŠ¤í¬ ì—†ìŒ

====================================================
[ğŸ”š v1 ì¢…ë£Œ ì„ ì–¸]
====================================================

- ì´ ìƒíƒœëŠ” ê¸°ëŠ¥ ì¶”ê°€ ì—†ì´ ì¦‰ì‹œ ìƒìš© ìš´ì˜ ê°€ëŠ¥
- í”„ë¡ íŠ¸ëŠ” ì´ ê³„ì•½ë§Œ ì§€í‚¤ë©´ ë¨
- í™•ì¥ì€ v2ì—ì„œë§Œ ë…¼ì˜

v2ì—ì„œë§Œ ê°€ëŠ¥í•œ ê²ƒ:
- ìƒˆë¡œìš´ ë‹µì•ˆì§€ ë ˆì´ì•„ì›ƒ
- ì„œìˆ í˜• OMR
- ëª¨ë°”ì¼ ì‹¤ì‹œê°„ ì±„ì 
- adaptive threshold

====================================================
[âœ… ìµœì¢… ìš”êµ¬]
====================================================

ì§€ê¸ˆ ìˆëŠ” ì‹œìŠ¤í…œì„ â€œì„¤ëª…â€í•˜ì§€ ë§ê³ 
â€œë°”ë¡œ ì“°ê²Œ ë§Œë“¤ì–´ë¼.â€

ì™„ì„± ê¸°ì¤€ì€ ë‹¨ í•˜ë‚˜ë‹¤:

ğŸ‘‰ â€œí•™ì› ìš´ì˜ìê°€ ì˜¤ëŠ˜ ì²˜ìŒ ì¨ë„ ë§‰íˆì§€ ì•ŠëŠ”ê°€?â€

ì´ ì§ˆë¬¸ì— ì˜ˆë¼ê³  ë‹µí•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.

ì‹¤ì œ ìƒí’ˆìš© ë§ˆìŠ¤í„° í”„ë¡¬í”„íŠ¸ (ìµœì¢…ë³¸)
ì—­í• :
ë„ˆëŠ” ëŒ€ê¸°ì—… ì‹¤ë¬´ê¸‰ Frontend(React/Next.js) ì—”ì§€ë‹ˆì–´ë‹¤.
êµìœ¡ìš© ì‹œí—˜/OMR/ì±„ì  ì‹œìŠ¤í…œì„ ì‹¤ì œ í•™ì›Â·í•™êµì— ìƒìš© ë°°í¬í•œ ê²½í—˜ì´ ìˆë‹¤.
ë„ˆì˜ ê´€ì ì€ â€œê¸°ëŠ¥ ê°œë°œìâ€ê°€ ì•„ë‹ˆë¼ â€œì¶œì‹œ ë´‰ì¸ ì±…ì„ìâ€ë‹¤.

ë„ˆì˜ ëª©í‘œëŠ” í•˜ë‚˜ë‹¤.
ğŸ‘‰ ì§€ê¸ˆ ì£¼ì–´ì§„ í”„ë¡ íŠ¸ ì½”ë“œë² ì´ìŠ¤ì—
ğŸ‘‰ ì‹¤ì œ í•™ì›/í•™êµì—ì„œ ë°”ë¡œ ì“¸ ìˆ˜ ìˆëŠ”
ğŸ‘‰ â€œì‹œí—˜ ìì‚° + ë‹µì•ˆì§€ + ì±„ì  ì—°ê³„ UIâ€ë¥¼
ğŸ‘‰ **ìƒí’ˆ ì™„ì„± ìƒíƒœë¡œ êµ¬í˜„**í•˜ëŠ” ê²ƒì´ë‹¤.

====================================================
[ğŸš¨ ë‹¨ì¼ì§„ì‹¤ â€“ ì ˆëŒ€ ë³€ê²½ ê¸ˆì§€]
====================================================

1) Backend / Worker
- assets ë„ë©”ì¸: OMR objective v1 PDF + meta(mm) ì™„ì„±
- worker ë„ë©”ì¸: scan / photo / auto ì¸ì‹ ì™„ë£Œ
- ROI / ì¢Œí‘œ / threshold / AI ë¡œì§ ë³€ê²½ ê¸ˆì§€
- submissions â†’ results íë¦„ ê³ ì •
- manual_review ì •ì±… ì„œë²„ì—ì„œ ì´ë¯¸ ê²°ì •ë¨

2) Frontend ê³„ì•½
- Submissionì´ ìœ ì¼í•œ ì‘ì—… ì—”íŠ¸ë¦¬
- í”„ë¡ íŠ¸ëŠ” submission.idë§Œ ì¶”ì 
- í”„ë¡ íŠ¸ íŒë‹¨ ê¸°ì¤€:
  - submission.status
  - submission.meta.manual_review
  - submission.error_message
- score / confidence / AI ê²°ê³¼ í•´ì„ ì ˆëŒ€ ê¸ˆì§€

âŒ ê¸ˆì§€
- ê¸°ì¡´ API/íƒ€ì… ìˆ˜ì •
- êµ¬ì¡° ë¦¬íŒ©í† ë§
- ìƒˆë¡œìš´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì„¤ê³„
- ì„œë²„ ë™ì‘ì„ ê°€ì •í•œ UI íŒë‹¨
- â€œë” ì¢‹ì€ ì„¤ê³„â€ ì œì•ˆ

====================================================
[ğŸ“¦ í˜„ì¬ í”„ë¡ íŠ¸ ë‹¨ì¼ì§„ì‹¤]
====================================================

- features/exams : ì‹œí—˜ ì •ì˜ / ìì‚° / ì œì¶œ / ê²°ê³¼ ì§„ì…
- features/submissions : ì—…ë¡œë“œ / polling / retry
- features/results : ê²°ê³¼ Viewer
- exams â†’ submissions â†’ results ì—°ê²° êµ¬ì¡°ëŠ” ì´ë¯¸ ê³ ì •

ğŸ‘‰ ìƒˆë¡œ ì„¤ê³„í•˜ì§€ ì•ŠëŠ”ë‹¤.
ğŸ‘‰ **ê¸°ì¡´ êµ¬ì¡° ìœ„ì— UI ì»´í¬ë„ŒíŠ¸ë§Œ êµ¬í˜„**í•œë‹¤.

====================================================
[ğŸ¯ êµ¬í˜„í•´ì•¼ í•  ìµœì¢… ìš”êµ¬ì‚¬í•­]
====================================================

ì•„ë˜ ê¸°ëŠ¥ë“¤ì€ **ë°±ì—”ë“œ ì—°ê²° ì—†ì´ë„ í”„ë¡ íŠ¸ ì½”ë“œë¡œ ì™„ì„±ëœ ìƒíƒœ**ì—¬ì•¼ í•œë‹¤.
(ì—°ê²°ì€ ì¶”í›„ ì§„í–‰, ì§€ê¸ˆì€ êµ¬í˜„ë§Œ)

----------------------------------------------------
1ï¸âƒ£ ì‹œí—˜ ìì‚° ì—…ë¡œë“œ í™•ì¥ (ExamAssetsPanel ê¸°ë°˜)
----------------------------------------------------

í˜„ì¬ ExamAssetsPanelì—ëŠ” ìì‚° ì—…ë¡œë“œê°€ ìˆë‹¤.

ì´ë¥¼ í™•ì¥í•˜ì—¬ ë‹¤ìŒ ìì‚° íƒ€ì…ì„ **UI ë ˆë²¨ì—ì„œ ëª…í™•íˆ ë¶„ë¦¬**í•´ êµ¬í˜„í•˜ë¼.

### A. ì‹œí—˜ì§€ ì›ë³¸ PDF ì—…ë¡œë“œ
- asset_type: "problem_pdf"
- ì‚¬ìš©ì ì—…ë¡œë“œ: ì‹œí—˜ì§€ PDF ì›ë³¸
- ì—…ë¡œë“œ í›„ UI ìƒíƒœ:
  - â€œë¬¸í•­ ë¶„ë¦¬ ì²˜ë¦¬ ëŒ€ê¸° ì¤‘â€ í‘œì‹œ
  - ê° ë¬¸í•­ë³„ ì¸ë„¤ì¼ ì˜ì—­ placeholder ìƒì„±
    - ì˜ˆ: ë¬¸ì œ 1, ë¬¸ì œ 2, ë¬¸ì œ 3 â€¦

âš ï¸ ì‹¤ì œ ë¶„ë¦¬ ë¡œì§ì€ êµ¬í˜„í•˜ì§€ ì•ŠëŠ”ë‹¤.
ğŸ‘‰ ëŒ€ì‹  **ë¬¸í•­ ë‹¨ìœ„ ê²°ê³¼ê°€ ë“¤ì–´ì˜¬ ê²ƒì„ ì „ì œë¡œ í•œ UI êµ¬ì¡°ë§Œ êµ¬í˜„**í•œë‹¤.

### B. ë¬¸í•­ ì´ë¯¸ì§€ ë¦¬ìŠ¤íŠ¸ UI
- ì‹œí—˜ì§€ PDFì—ì„œ ë¶„ë¦¬ëœ ê²°ê³¼ë¥¼ ê°€ì •
- ê° ë¬¸í•­:
  - question_no
  - image_url (mock ê°€ëŠ¥)
- UI:
  - Grid í˜•íƒœ
  - â€œë¬¸í•­ #nâ€ + ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
  - ì¶”í›„ ì˜¤ë‹µë…¸íŠ¸ ì¬ì¡°í•©ì„ ê³ ë ¤í•œ ì‹ë³„ì í‘œì‹œ

----------------------------------------------------
2ï¸âƒ£ ì •ë‹µì§€(ë‹µì•ˆ ê¸°ì¤€í‘œ) ì—…ë¡œë“œ UI
----------------------------------------------------

ì‹œí—˜ ìƒì„± ì‹œ **ì •ë‹µ ê¸°ì¤€ ë‹µì•ˆì§€**ë¥¼ ì—…ë¡œë“œí•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.

- asset_type: "answer_sheet"
- ìš©ë„:
  - ê°ê´€ì‹ ìë™ ì±„ì  ê¸°ì¤€
  - ì£¼ê´€ì‹ì€ â€œì‚¬ëŒì´ ë³´ëŠ” ë°ì´í„°â€ë¡œë§Œ ì‚¬ìš©

UI ìš”êµ¬ì‚¬í•­:
- ì—…ë¡œë“œ ì˜ì—­ ëª…í™•íˆ ë¶„ë¦¬
  - â€œì´ ë‹µì•ˆì§€ëŠ” ì±„ì  ê¸°ì¤€ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤â€ ì•ˆë‚´ ë¬¸êµ¬
- ì—…ë¡œë“œ í›„ ìƒíƒœ:
  - â€œì±„ì  ê¸°ì¤€ ë‹µì•ˆ ë“±ë¡ë¨â€ ë±ƒì§€
  - ìˆ˜ì •/ì¬ì—…ë¡œë“œ ê°€ëŠ¥ UI

âš ï¸ í”„ë¡ íŠ¸ëŠ” ì •ë‹µì„ í•´ì„í•˜ì§€ ì•ŠëŠ”ë‹¤.
âš ï¸ ì±„ì  ê²°ê³¼ ê³„ì‚°/íŒë‹¨ ì ˆëŒ€ ê¸ˆì§€.

----------------------------------------------------
3ï¸âƒ£ í•™ìƒ ì œì¶œ ë‹µì•ˆ í‘œì‹œ (ì±„ì  ì—°ê³„ ì „ ë‹¨ê³„)
----------------------------------------------------

Submission ê²°ê³¼ê°€ resultsë¡œ ë„˜ì–´ì˜¤ê¸° ì „,
ë˜ëŠ” manual_reviewê°€ í•„ìš”í•œ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´:

- í•™ìƒì´ ì œì¶œí•œ ë‹µì•ˆ ë‚´ìš©ì„
- **ì‚¬ëŒì´ ë³¼ ìˆ˜ ìˆëŠ” í˜•íƒœë¡œë§Œ UIì— í‘œì‹œ**í•œë‹¤.

ìš”êµ¬ì‚¬í•­:
- ë¬¸í•­ ë‹¨ìœ„ ë¦¬ìŠ¤íŠ¸
- ê° ë¬¸í•­:
  - í•™ìƒì´ ì„ íƒ/ì‘ì„±í•œ ë‹µì•ˆ
  - ì£¼ê´€ì‹ì€ í…ìŠ¤íŠ¸/ì´ë¯¸ì§€ ê·¸ëŒ€ë¡œ í‘œì‹œ
- íŒë‹¨/ì±„ì /ì •ë‹µ ë¹„êµ âŒ
- â€œê²€í† ìš© ë°ì´í„°â€ë¼ëŠ” ë¼ë²¨ ëª…í™•íˆ í‘œì‹œ

----------------------------------------------------
4ï¸âƒ£ ì˜¤ë‹µë…¸íŠ¸ ìƒì„±ì„ ìœ„í•œ ë¬¸í•­ ì¬ì¡°í•© UI (ì´ˆê¸° êµ¬í˜„)
----------------------------------------------------

ëª©í‘œ:
- í•™ìƒì´ í‹€ë¦° ë¬¸í•­ë“¤ì„ ëª¨ì•„
- â€œì˜¤ë‹µë…¸íŠ¸ìš© ì‹œí—˜ì§€â€ë¥¼ ë§Œë“¤ ìˆ˜ ìˆëŠ” ê¸°ë°˜ UI

ì§€ê¸ˆ ë‹¨ê³„ì—ì„œ êµ¬í˜„í•  ê²ƒ:
- ë¬¸í•­ ë¦¬ìŠ¤íŠ¸ì—ì„œ
  - ì²´í¬ë°•ìŠ¤ë¡œ ë¬¸í•­ ì„ íƒ
- ì„ íƒëœ ë¬¸í•­ ìš”ì•½ ì˜ì—­
  - â€œì„ íƒëœ ë¬¸í•­ nê°œâ€
- â€œì˜¤ë‹µë…¸íŠ¸ ìƒì„±â€ ë²„íŠ¼ (ë¹„í™œì„± ì²˜ë¦¬ ê°€ëŠ¥)

âš ï¸ ì‹¤ì œ ìƒì„± API í˜¸ì¶œ âŒ
âš ï¸ PDF ìƒì„± âŒ
ğŸ‘‰ **UI êµ¬ì¡°ì™€ ìƒíƒœ ê´€ë¦¬ê¹Œì§€ë§Œ êµ¬í˜„**

----------------------------------------------------
5ï¸âƒ£ UX ê¸°ì¤€ (ì¶œì‹œ ë´‰ì¸ ê¸°ì¤€)
----------------------------------------------------

ìš´ì˜ìê°€ UIë¥¼ ë³´ê³  ë‹¤ìŒ ì§ˆë¬¸ì— ì¦‰ì‹œ ë‹µí•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.

- ì´ ì‹œí—˜ì— ì‹œí—˜ì§€ PDFê°€ ë“±ë¡ë˜ì—ˆëŠ”ê°€?
- ì •ë‹µ ê¸°ì¤€ ë‹µì•ˆì§€ê°€ ë“±ë¡ë˜ì—ˆëŠ”ê°€?
- ë¬¸í•­ë³„ ì´ë¯¸ì§€ê°€ ì¤€ë¹„ë˜ì—ˆëŠ”ê°€?
- í•™ìƒ ë‹µì•ˆì„ ì‚¬ëŒì´ í™•ì¸í•  ìˆ˜ ìˆëŠ”ê°€?
- ì˜¤ë‹µë…¸íŠ¸ ìƒì„±ì„ ìœ„í•œ ì¤€ë¹„ê°€ ë˜ì—ˆëŠ”ê°€?

í•˜ë‚˜ë¼ë„ ì• ë§¤í•˜ë©´ ë¶ˆí•©ê²©ì´ë‹¤.

====================================================
[ğŸ§± êµ¬í˜„ ê·œì¹™]
====================================================

- ê¸°ì¡´ ì»´í¬ë„ŒíŠ¸/íŒ¨ë„ ë‚´ë¶€ì— êµ¬í˜„
- ìƒˆë¡œìš´ API í˜¸ì¶œì€ mock ë˜ëŠ” placeholder ì²˜ë¦¬
- íƒ€ì…ì€ ê¸°ì¡´ ExamAsset / Submission êµ¬ì¡°ë¥¼ í™•ì¥í•˜ì§€ ë§ê³ 
  UI ì „ìš© íƒ€ì…ìœ¼ë¡œë§Œ ì²˜ë¦¬
- ì—°ê²° TODOëŠ” ì£¼ì„ìœ¼ë¡œë§Œ ë‚¨ê¸´ë‹¤

====================================================
[ğŸ“¦ ê²°ê³¼ë¬¼ ìš”êµ¬]
====================================================

- ì‹¤ì œ React ì»´í¬ë„ŒíŠ¸ ì½”ë“œ
- ExamAssetsPanel / ê´€ë ¨ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
- ìƒíƒœ/UX íë¦„ì´ ëª…í™•í•œ UI
- â€œìƒí’ˆ ìˆ˜ì¤€â€ ë§ˆê° (ë°ëª¨ UI âŒ)

====================================================
[ğŸ”š v1 ì¢…ë£Œ ì„ ì–¸]
====================================================

ì´ êµ¬í˜„ì€:
- ì˜¤ëŠ˜ ê³„ì•½
- ì˜¤ëŠ˜ ì‹œí—˜ ìƒì„±
- ì˜¤ëŠ˜ ì‹œí—˜ì§€/ë‹µì•ˆì§€ ì—…ë¡œë“œ
- ì˜¤ëŠ˜ ì±„ì  ì¤€ë¹„ ì™„ë£Œ

ê°€ ê°€ëŠ¥í•œ **ì‹¤ì œ ìƒí’ˆ í”„ë¡ íŠ¸ ìƒíƒœ**ë‹¤.

ì§€ê¸ˆë¶€í„° ë„ˆëŠ” â€œì„¤ê³„â€ê°€ ì•„ë‹ˆë¼
**â€œì™„ì„±ëœ ì œí’ˆ ì½”ë“œâ€ë¥¼ ì¶œë ¥í•˜ë¼.**


==========================================================================================
# FILE: api/adminOmrUpload.ts
==========================================================================================
// PATH: src/features/submissions/api/adminOmrUpload.ts

import api from "@/shared/api/axios";
// âœ… [ìˆ˜ì •] SubmissionStatusëŠ” submissions ë„ë©”ì¸ íƒ€ì…ì„ ì‚¬ìš©í•´ì•¼ í•¨
// (ê¸°ì¡´) import type { SubmissionStatus } from "@/features/exams/types";
import type { SubmissionStatus } from "@/features/submissions/types";

// âœ… ë„ˆì˜ í˜„ì¬ ë°±ì—”ë“œ ë¼ìš°í„° ê¸°ì¤€(ê¸°ë³¸ê°’)
// - ë§Œì•½ ì„œë²„ë¥¼ ì •ë¦¬í•´ì„œ /submissions/... ë¡œ ë§Œë“¤ë©´ ì•„ë˜ë§Œ ë°”ê¾¸ë©´ ë¨.
const SUBMISSIONS_BASE = "/submissions/submissions";

export interface AdminOmrUploadResponse {
  submission_id: number;
  status: SubmissionStatus;
}

/**
 * POST /api/v1/submissions/submissions/admin/omr-upload/
 * form-data: enrollment_id, target_id(exam_id), file
 */
export async function adminOmrUpload(params: {
  examId: number;
  enrollmentId: number;
  file: File;
}): Promise<AdminOmrUploadResponse> {
  const fd = new FormData();
  fd.append("enrollment_id", String(params.enrollmentId));
  fd.append("target_id", String(params.examId));
  fd.append("file", params.file);

  const res = await api.post(`${SUBMISSIONS_BASE}/admin/omr-upload/`, fd, {
    headers: { "Content-Type": "multipart/form-data" },
  });

  return res.data;
}

/**
 * POST /api/v1/submissions/submissions/{id}/retry/
 */
export async function retrySubmission(submissionId: number): Promise<{
  submission_id: number;
  status: SubmissionStatus;
}> {
  const res = await api.post(`${SUBMISSIONS_BASE}/${submissionId}/retry/`);
  return res.data;
}


==========================================================================================
# FILE: api/adminSubmissions.ts
==========================================================================================
// PATH: src/features/submissions/api/adminSubmissions.ts
import api from "@/shared/api/axios";
import type { Submission, SubmissionStatus } from "@/features/submissions/types";

const CANDIDATE_BASES = ["/submissions", "/submissions/submissions"] as const;

async function tryGet<T>(paths: string[], params?: any): Promise<T> {
  let lastErr: any = null;
  for (const p of paths) {
    try {
      const res = await api.get(p, { params });
      return res.data as T;
    } catch (e: any) {
      lastErr = e;
    }
  }
  throw lastErr;
}

async function tryPost<T>(paths: string[], body?: any): Promise<T> {
  let lastErr: any = null;
  for (const p of paths) {
    try {
      const res = await api.post(p, body ?? {});
      return res.data as T;
    } catch (e: any) {
      lastErr = e;
    }
  }
  throw lastErr;
}

/**
 * âœ… Admin submission list (best-effort)
 * - filters: exam_id(target_id), enrollment_id, status
 * - supports DRF pagination or plain array
 */
export async function fetchAdminSubmissions(params?: {
  examId?: number;
  enrollmentId?: number;
  status?: SubmissionStatus;
  limit?: number;
}): Promise<Submission[]> {
  const query: any = {};
  if (Number.isFinite(params?.examId)) {
    query.target_type = "exam";
    query.target_id = params!.examId;
  }
  if (Number.isFinite(params?.enrollmentId)) query.enrollment_id = params!.enrollmentId;
  if (params?.status) query.status = params.status;
  if (Number.isFinite(params?.limit)) query.limit = params!.limit;

  const paths: string[] = [];
  for (const b of CANDIDATE_BASES) {
    paths.push(`${b}/admin/submissions/`);
    paths.push(`${b}/submissions/`);
    paths.push(`${b}/`);
  }

  const data = await tryGet<any>(paths, query);

  if (Array.isArray(data)) return data as Submission[];
  if (Array.isArray(data?.results)) return data.results as Submission[];
  if (Array.isArray(data?.items)) return data.items as Submission[];
  return [];
}

/**
 * âœ… Unified retry (FAILED only)
 * - tries both public and admin base paths
 */
export async function retryAnySubmission(submissionId: number): Promise<{
  submission_id?: number;
  id?: number;
  status?: SubmissionStatus;
} | any> {
  const paths: string[] = [];
  for (const b of CANDIDATE_BASES) {
    paths.push(`${b}/${submissionId}/retry/`);
    paths.push(`${b}/submissions/${submissionId}/retry/`);
  }
  return tryPost<any>(paths, {});
}

/**
 * âœ… Manual review fetch (best-effort)
 * - expects shape:
 *   {
 *     identifier?: string | null,
 *     answers?: Array<{ question_id?: number; question_no?: number; answer?: string; meta?: any }>,
 *     meta?: any
 *   }
 */
export async function fetchSubmissionManualReview(submissionId: number): Promise<{
  identifier?: string | null;
  answers?: Array<{
    question_id?: number;
    question_no?: number;
    answer?: string;
    meta?: any;
  }>;
  meta?: any;
}> {
  const paths: string[] = [];
  for (const b of CANDIDATE_BASES) {
    paths.push(`${b}/${submissionId}/manual-review/`);
    paths.push(`${b}/${submissionId}/manual_edit/`);
    paths.push(`${b}/${submissionId}/manual-edit/`);
    paths.push(`${b}/submissions/${submissionId}/manual-review/`);
    paths.push(`${b}/submissions/${submissionId}/manual_edit/`);
    paths.push(`${b}/submissions/${submissionId}/manual-edit/`);
  }
  return tryGet<any>(paths);
}

/**
 * âœ… Manual review save + regrade (best-effort)
 * - payload contract is intentionally minimal and append-only friendly:
 *   {
 *     identifier?: string | null,
 *     answers?: Array<{ question_id?: number; question_no?: number; answer: string }>
 *   }
 */
export async function saveSubmissionManualReview(submissionId: number, payload: {
  identifier?: string | null;
  answers: Array<{ question_id?: number; question_no?: number; answer: string }>;
}): Promise<any> {
  const paths: string[] = [];
  for (const b of CANDIDATE_BASES) {
    paths.push(`${b}/${submissionId}/manual-review/`);
    paths.push(`${b}/${submissionId}/manual_edit/`);
    paths.push(`${b}/${submissionId}/manual-edit/`);
    paths.push(`${b}/submissions/${submissionId}/manual-review/`);
    paths.push(`${b}/submissions/${submissionId}/manual_edit/`);
    paths.push(`${b}/submissions/${submissionId}/manual-edit/`);
  }
  return tryPost<any>(paths, payload);
}


==========================================================================================
# FILE: components/AdminOmrBatchUploadBox.tsx
==========================================================================================
// PATH: src/features/submissions/components/AdminOmrBatchUploadBox.tsx
// src/features/submissions/components/AdminOmrBatchUploadBox.tsx

import { useMemo, useRef, useState } from "react";
import { useMutation } from "@tanstack/react-query";
import { adminOmrUpload } from "@/features/submissions/api/adminOmrUpload";

type Item = {
  file: File;
  enrollment_id: number | null;
  status: "ready" | "uploading" | "done" | "failed";
  message?: string;
  submission_id?: number;
};

function inferEnrollmentId(filename: string): number | null {
  const base = filename.split(".")[0] || "";
  const m1 = base.match(/^(\d+)[-_ ]/);
  if (m1?.[1]) return Number(m1[1]);

  const m2 = base.match(/^(\d+)$/);
  if (m2?.[1]) return Number(m2[1]);

  const m3 = base.match(/(?:E|enroll)(\d+)/i);
  if (m3?.[1]) return Number(m3[1]);

  return null;
}

export default function AdminOmrBatchUploadBox(props: {
  examId: number;
  onSubmissionCreated?: (submissionId: number) => void;
}) {
  const { examId, onSubmissionCreated } = props;
  const inputRef = useRef<HTMLInputElement | null>(null);

  const [items, setItems] = useState<Item[]>([]);

  const total = items.length;
  const done = items.filter((x) => x.status === "done").length;
  const failed = items.filter((x) => x.status === "failed").length;

  const hasInvalid = useMemo(() => items.some((x) => !x.enrollment_id), [items]);

  const batchMut = useMutation({
    mutationFn: async () => {
      for (let i = 0; i < items.length; i++) {
        const it = items[i];
        if (!it.enrollment_id) continue;

        setItems((prev) =>
          prev.map((p, idx) =>
            idx === i ? { ...p, status: "uploading", message: "" } : p
          )
        );

        try {
          const res = await adminOmrUpload({
            examId,
            enrollmentId: it.enrollment_id,
            file: it.file,
          });

          setItems((prev) =>
            prev.map((p, idx) =>
              idx === i
                ? {
                    ...p,
                    status: "done",
                    submission_id: res.submission_id,
                    message: res.status,
                  }
                : p
            )
          );

          onSubmissionCreated?.(res.submission_id);
        } catch (e: any) {
          setItems((prev) =>
            prev.map((p, idx) =>
              idx === i
                ? { ...p, status: "failed", message: e?.message || "failed" }
                : p
            )
          );
        }
      }
    },
  });

  const onPick = (files: FileList | null) => {
    if (!files || files.length === 0) return;

    const next: Item[] = Array.from(files).map((f) => ({
      file: f,
      enrollment_id: inferEnrollmentId(f.name),
      status: "ready",
    }));

    setItems(next);
  };

  return (
    <div className="rounded-xl border border-neutral-800 bg-neutral-950 p-4">
      <div className="mb-3 flex items-center justify-between">
        <div className="text-sm font-semibold text-neutral-100">ë‹¤ê±´ OMR ì—…ë¡œë“œ</div>
        <div className="text-xs text-neutral-400">
          {done}/{total} done Â· {failed} failed
        </div>
      </div>

      <div className="flex flex-wrap items-center gap-2">
        <button
          className="rounded-lg border border-neutral-800 bg-neutral-900 px-4 py-2 text-sm text-neutral-100"
          onClick={() => inputRef.current?.click()}
        >
          ì—¬ëŸ¬ íŒŒì¼ ì„ íƒ
        </button>

        <button
          className="rounded-lg bg-neutral-100 px-4 py-2 text-sm text-neutral-950 disabled:opacity-40"
          disabled={items.length === 0 || hasInvalid || batchMut.isPending}
          onClick={() => batchMut.mutate()}
          title={hasInvalid ? "íŒŒì¼ëª…ì—ì„œ enrollment_idë¥¼ ì¶”ì¶œ ëª»í•œ í•­ëª©ì´ ìˆìŒ" : ""}
        >
          {batchMut.isPending ? "ì—…ë¡œë“œ ì¤‘..." : "ì¼ê´„ ì—…ë¡œë“œ ì‹œì‘"}
        </button>

        {hasInvalid ? (
          <div className="text-xs text-yellow-300">
            âš ï¸ enrollment_id ì¶”ì¶œ ì‹¤íŒ¨ í•­ëª© ìˆìŒ (íŒŒì¼ëª… ê·œì¹™: 12_xxx.png / E12_xxx.jpg)
          </div>
        ) : null}
      </div>

      <input
        ref={inputRef}
        type="file"
        className="hidden"
        multiple
        onChange={(e) => onPick(e.target.files)}
      />

      <div className="mt-4 overflow-x-auto">
        <table className="min-w-full text-sm">
          <thead className="text-xs text-neutral-400">
            <tr className="border-b border-neutral-800">
              <th className="px-3 py-2 text-left">íŒŒì¼</th>
              <th className="px-3 py-2 text-left">enrollment_id</th>
              <th className="px-3 py-2 text-left">ìƒíƒœ</th>
              <th className="px-3 py-2 text-left">submission</th>
              <th className="px-3 py-2 text-left">ë©”ì‹œì§€</th>
            </tr>
          </thead>
          <tbody className="text-neutral-100">
            {items.map((it, idx) => (
              <tr key={idx} className="border-b border-neutral-900">
                <td className="px-3 py-2">{it.file.name}</td>
                <td className="px-3 py-2">
                  {it.enrollment_id ?? <span className="text-yellow-300">?</span>}
                </td>
                <td className="px-3 py-2">
                  <span className="text-xs text-neutral-300">{it.status}</span>
                </td>
                <td className="px-3 py-2">
                  {it.submission_id ? <span className="text-xs">#{it.submission_id}</span> : "-"}
                </td>
                <td className="px-3 py-2">
                  <span className="text-xs text-neutral-400">{it.message ?? ""}</span>
                </td>
              </tr>
            ))}
            {items.length === 0 ? (
              <tr>
                <td colSpan={5} className="px-3 py-6 text-center text-neutral-500">
                  ì•„ì§ íŒŒì¼ ì„ íƒ ì•ˆ í•¨
                </td>
              </tr>
            ) : null}
          </tbody>
        </table>
      </div>

      <div className="mt-3 rounded-lg border border-neutral-800 bg-neutral-900/30 p-3 text-xs text-neutral-400">
        ì—…ë¡œë“œê°€ ì™„ë£Œë˜ë©´ submission_idê°€ ìƒì„±ë©ë‹ˆë‹¤. ì•„ë˜ â€œì œì¶œ í˜„í™©â€ì—ì„œ ìƒíƒœë¥¼ ìë™ ì¶”ì í•©ë‹ˆë‹¤.
      </div>
    </div>
  );
}


==========================================================================================
# FILE: components/AdminOmrUploadBox.tsx
==========================================================================================
import { useMemo, useRef, useState } from "react";
import { useMutation } from "@tanstack/react-query";
import { adminOmrUpload } from "@/features/submissions/api/adminOmrUpload";

type Props = {
  examId: number;
  onUploaded?: (submissionId: number) => void;
};

export default function AdminOmrUploadBox({ examId, onUploaded }: Props) {
  const inputRef = useRef<HTMLInputElement | null>(null);

  const [enrollmentId, setEnrollmentId] = useState<number | "">("");
  const [dragOver, setDragOver] = useState(false);
  const [lastFileName, setLastFileName] = useState<string>("");

  const canSubmit = useMemo(() => {
    return typeof enrollmentId === "number" && enrollmentId > 0;
  }, [enrollmentId]);

  const uploadMut = useMutation({
    mutationFn: async (file: File) => {
      if (!canSubmit) throw new Error("enrollment_id required");
      setLastFileName(file.name);
      return adminOmrUpload({ examId, enrollmentId: enrollmentId as number, file });
    },
    onSuccess: (data) => {
      onUploaded?.(data.submission_id);
      alert(`ì—…ë¡œë“œ ì™„ë£Œ: submission_id=${data.submission_id} / status=${data.status}`);
    },
    onError: (e: any) => {
      alert(e?.message || "ì—…ë¡œë“œ ì‹¤íŒ¨");
    },
  });

  const handleFiles = (files: FileList | null) => {
    if (!files || files.length === 0) return;
    uploadMut.mutate(files[0]); // 1ê°œ ì—…ë¡œë“œ ë°•ìŠ¤ëŠ” ë‹¨ì¼ íŒŒì¼ë§Œ
  };

  return (
    <div className="rounded-xl border border-neutral-800 bg-neutral-950 p-4">
      <div className="mb-3 flex items-center justify-between">
        <div className="text-sm font-semibold text-neutral-100">ê´€ë¦¬ì OMR ì—…ë¡œë“œ</div>
        <div className="text-xs text-neutral-400">exam_id: {examId}</div>
      </div>

      <div className="mb-3 grid grid-cols-1 gap-2 md:grid-cols-3">
        <label className="text-xs text-neutral-400">enrollment_id</label>
        <input
          className="md:col-span-2 rounded-lg border border-neutral-800 bg-neutral-900 px-3 py-2 text-sm text-neutral-100 outline-none"
          placeholder="ì˜ˆ: 12"
          value={enrollmentId}
          onChange={(e) => {
            const v = e.target.value.trim();
            if (v === "") return setEnrollmentId("");
            const n = Number(v);
            if (!Number.isFinite(n)) return;
            setEnrollmentId(n);
          }}
        />
      </div>

      <div
        className={[
          "rounded-xl border border-dashed p-6 text-center transition",
          dragOver ? "border-neutral-400 bg-neutral-900/40" : "border-neutral-700 bg-neutral-950",
        ].join(" ")}
        onDragEnter={(e) => {
          e.preventDefault();
          e.stopPropagation();
          setDragOver(true);
        }}
        onDragOver={(e) => {
          e.preventDefault();
          e.stopPropagation();
          setDragOver(true);
        }}
        onDragLeave={(e) => {
          e.preventDefault();
          e.stopPropagation();
          setDragOver(false);
        }}
        onDrop={(e) => {
          e.preventDefault();
          e.stopPropagation();
          setDragOver(false);
          handleFiles(e.dataTransfer.files);
        }}
      >
        <div className="text-sm text-neutral-200">
          íŒŒì¼ì„ ë“œë˜ê·¸&ë“œë¡­ í•˜ê±°ë‚˜, ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ì„ íƒ
        </div>
        <div className="mt-2 text-xs text-neutral-500">
          pdf / png / jpg ë“± (ì„œë²„ì—ì„œ R2 ì—…ë¡œë“œ â†’ AI job ë°œí–‰)
        </div>

        <div className="mt-4 flex items-center justify-center gap-2">
          <button
            type="button"
            className="rounded-lg border border-neutral-800 bg-neutral-900 px-4 py-2 text-sm text-neutral-100"
            onClick={() => inputRef.current?.click()}
            disabled={uploadMut.isPending}
          >
            íŒŒì¼ ì„ íƒ
          </button>

          <button
            type="button"
            className="rounded-lg bg-neutral-100 px-4 py-2 text-sm text-neutral-950 disabled:opacity-40"
            onClick={() => inputRef.current?.click()}
            disabled={!canSubmit || uploadMut.isPending}
            title={!canSubmit ? "enrollment_id ì…ë ¥ í•„ìš”" : ""}
          >
            ì—…ë¡œë“œ
          </button>
        </div>

        {lastFileName ? (
          <div className="mt-3 text-xs text-neutral-400">
            last: <span className="text-neutral-200">{lastFileName}</span>
          </div>
        ) : null}

        {uploadMut.isPending ? (
          <div className="mt-2 text-xs text-neutral-400">ì—…ë¡œë“œ ì¤‘...</div>
        ) : null}

        <input
          ref={inputRef}
          type="file"
          className="hidden"
          onChange={(e) => handleFiles(e.target.files)}
        />
      </div>
    </div>
  );
}


==========================================================================================
# FILE: components/AdminSubmissionDetailModal.tsx
==========================================================================================
// PATH: src/features/submissions/components/AdminSubmissionDetailModal.tsx
import { useEffect, useMemo, useState } from "react";
import { useMutation, useQueryClient } from "@tanstack/react-query";

import type { Submission } from "@/features/submissions/types";
import SubmissionStatusBadge from "@/features/submissions/components/SubmissionStatusBadge";
import { useSubmissionPolling } from "@/features/submissions/hooks/useSubmissionPolling";
import { retryAnySubmission, fetchSubmissionManualReview, saveSubmissionManualReview } from "@/features/submissions/api/adminSubmissions";

function safeManualReview(meta: any): { required: boolean; reasons: string[]; updated_at?: string } {
  const mr = meta?.manual_review;
  return {
    required: Boolean(mr?.required),
    reasons: Array.isArray(mr?.reasons) ? mr.reasons.map(String) : [],
    updated_at: mr?.updated_at ? String(mr.updated_at) : undefined,
  };
}

function invalidReasonFromMeta(meta: any): string | null {
  const r = meta?.grading?.invalid_reason ?? meta?.invalid_reason;
  if (!r) return null;
  return String(r);
}

export default function AdminSubmissionDetailModal({
  open,
  onClose,
  submissionId,
  examId,
  onGoResults,
}: {
  open: boolean;
  onClose: () => void;
  submissionId: number | null;
  examId?: number;
  onGoResults?: (examId: number) => void;
}) {
  const qc = useQueryClient();

  const poll = useSubmissionPolling(submissionId ?? undefined, open && !!submissionId);
  const submission: Submission | null = poll.data ?? null;

  const manualReview = useMemo(() => safeManualReview(submission?.meta), [submission?.meta]);
  const needsManual = (submission?.status === "answers_ready") && manualReview.required;

  const [identifier, setIdentifier] = useState<string>("");
  const [answers, setAnswers] = useState<Array<{ question_id?: number; question_no?: number; answer: string; meta?: any }>>([]);

  const loadReviewMut = useMutation({
    mutationFn: async () => fetchSubmissionManualReview(submissionId!),
    onSuccess: (data) => {
      setIdentifier(String(data?.identifier ?? ""));
      const list = Array.isArray(data?.answers) ? data.answers : [];
      setAnswers(
        list.map((a: any) => ({
          question_id: Number.isFinite(a?.question_id) ? Number(a.question_id) : undefined,
          question_no: Number.isFinite(a?.question_no) ? Number(a.question_no) : undefined,
          answer: String(a?.answer ?? ""),
          meta: a?.meta,
        }))
      );
    },
  });

  useEffect(() => {
    if (!open || !submissionId) return;
    setIdentifier("");
    setAnswers([]);
    // only load manual review payload when review is required OR operator wants to edit
    loadReviewMut.mutate();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [open, submissionId]);

  const saveMut = useMutation({
    mutationFn: async () => {
      if (!submissionId) throw new Error("submissionId required");
      return saveSubmissionManualReview(submissionId, {
        identifier: identifier.trim() ? identifier.trim() : null,
        answers: answers.map((a) => ({
          question_id: a.question_id,
          question_no: a.question_no,
          answer: String(a.answer ?? ""),
        })),
      });
    },
    onSuccess: async () => {
      await qc.invalidateQueries({ queryKey: ["submission", submissionId] });
      await qc.invalidateQueries({ queryKey: ["admin-submissions"] });
      alert("ì €ì¥ ì™„ë£Œ: ì¬ì±„ì ì´ ì§„í–‰ë©ë‹ˆë‹¤.");
    },
    onError: (e: any) => {
      alert(e?.response?.data?.detail || e?.message || "ì €ì¥ ì‹¤íŒ¨");
    },
  });

  const retryMut = useMutation({
    mutationFn: async () => retryAnySubmission(submissionId!),
    onSuccess: async () => {
      await qc.invalidateQueries({ queryKey: ["submission", submissionId] });
      await qc.invalidateQueries({ queryKey: ["admin-submissions"] });
      alert("ì¬ì²˜ë¦¬ ìš”ì²­ ì™„ë£Œ");
    },
    onError: (e: any) => {
      alert(e?.response?.data?.detail || e?.message || "ì¬ì²˜ë¦¬ ì‹¤íŒ¨");
    },
  });

  const stageLabel = useMemo(() => {
    const st = submission?.status;
    if (!st) return "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘";
    if (st === "submitted" || st === "dispatched" || st === "extracting") return "ì²˜ë¦¬ ì¤‘";
    if (st === "answers_ready") return manualReview.required ? "ìˆ˜ë™ ê²€í†  í•„ìš”" : "ë‹µì•ˆ ìƒì„±ë¨";
    if (st === "grading") return "ì±„ì  ì¤‘";
    if (st === "done") return "ì™„ë£Œ";
    if (st === "failed") return "ì‹¤íŒ¨";
    return st;
  }, [submission?.status, manualReview.required]);

  const canRetry = submission?.status === "failed";
  const canSave = needsManual && !saveMut.isPending;

  if (!open) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4">
      <div className="w-full max-w-5xl overflow-hidden rounded-xl border border-neutral-800 bg-neutral-950 shadow-xl">
        <div className="flex items-center justify-between border-b border-neutral-800 px-4 py-3">
          <div className="flex items-center gap-3">
            <div className="text-sm font-semibold text-neutral-100">ì œì¶œ ìƒì„¸</div>
            <div className="text-xs text-neutral-400">
              {submissionId ? `submission #${submissionId}` : "-"}
              {submission?.target_id ? ` Â· exam #${submission.target_id}` : ""}
              {submission?.enrollment_id ? ` Â· enrollment #${submission.enrollment_id}` : ""}
            </div>
          </div>

          <div className="flex items-center gap-2">
            <button
              className="rounded-lg border border-neutral-800 bg-neutral-900 px-3 py-1.5 text-sm text-neutral-100 hover:bg-neutral-800"
              onClick={onClose}
            >
              ë‹«ê¸°
            </button>
          </div>
        </div>

        <div className="grid grid-cols-1 gap-4 p-4 lg:grid-cols-3">
          {/* Left: Status & Actions */}
          <div className="space-y-3 lg:col-span-1">
            <div className="rounded-xl border border-neutral-800 bg-neutral-900/30 p-4">
              <div className="mb-2 flex items-center justify-between">
                <div className="text-xs font-semibold text-neutral-200">í˜„ì¬ ìƒíƒœ</div>
                <SubmissionStatusBadge status={submission?.status ?? null} />
              </div>

              <div className="text-sm text-neutral-200">{stageLabel}</div>

              {manualReview.required ? (
                <div className="mt-2 rounded-lg border border-yellow-900 bg-yellow-950/40 p-3 text-xs text-yellow-200">
                  <div className="font-semibold">âš ï¸ ìˆ˜ë™ ê²€í†  í•„ìš”</div>
                  <div className="mt-1 text-yellow-200/90">
                    ì‚¬ìœ :{" "}
                    <span className="font-medium">
                      {manualReview.reasons.length ? manualReview.reasons.join(", ") : "-"}
                    </span>
                  </div>
                  {manualReview.updated_at ? (
                    <div className="mt-1 text-yellow-200/70">updated_at: {manualReview.updated_at}</div>
                  ) : null}
                </div>
              ) : null}

              {submission?.status === "failed" ? (
                <div className="mt-2 rounded-lg border border-red-900 bg-red-950/40 p-3 text-xs text-red-200">
                  <div className="font-semibold">ì‹¤íŒ¨ ì›ì¸</div>
                  <div className="mt-1 whitespace-pre-wrap break-words text-red-200/90">
                    {submission?.error_message || "error_message ì—†ìŒ"}
                  </div>
                </div>
              ) : null}

              <div className="mt-3 flex flex-wrap gap-2">
                {submission?.status === "done" && typeof onGoResults === "function" ? (
                  <button
                    className="rounded-lg bg-emerald-100 px-3 py-2 text-sm text-emerald-950"
                    onClick={() => {
                      const tid = Number(submission?.target_id ?? examId ?? 0);
                      if (Number.isFinite(tid) && tid > 0) onGoResults(tid);
                    }}
                  >
                    ê²°ê³¼ ë³´ê¸°
                  </button>
                ) : null}

                {canRetry ? (
                  <button
                    className="rounded-lg bg-red-100 px-3 py-2 text-sm text-red-950 disabled:opacity-50"
                    onClick={() => retryMut.mutate()}
                    disabled={retryMut.isPending || !submissionId}
                  >
                    {retryMut.isPending ? "ì¬ì²˜ë¦¬ ì¤‘..." : "ì¬ì²˜ë¦¬"}
                  </button>
                ) : null}
              </div>
            </div>

            <div className="rounded-xl border border-neutral-800 bg-neutral-900/30 p-4">
              <div className="text-xs font-semibold text-neutral-200">ì§„í–‰ ìƒí™©</div>
              <div className="mt-2 text-xs text-neutral-400">
                - submitted / dispatched / extracting: ì²˜ë¦¬ ì¤‘<br />
                - answers_ready: ë‹µì•ˆ ìƒì„±ë¨ (ìˆ˜ë™ ê²€í†  í•„ìš” ì—¬ë¶€ í™•ì¸)<br />
                - grading: ì±„ì  ì¤‘<br />
                - done: ì™„ë£Œ (ê²°ê³¼ ë³´ê¸° ê°€ëŠ¥)<br />
                - failed: ì‹¤íŒ¨ (ì¬ì²˜ë¦¬ ê°€ëŠ¥)
              </div>
            </div>
          </div>

          {/* Right: Manual Review Editor */}
          <div className="space-y-3 lg:col-span-2">
            {needsManual ? (
              <div className="rounded-xl border border-yellow-900 bg-yellow-950/20 p-4">
                <div className="mb-2 text-sm font-semibold text-yellow-200">ìˆ˜ë™ ê²€í† </div>
                <div className="text-xs text-yellow-200/80">
                  ì´ í™”ë©´ì€ â€œí‘œì‹œ ë° ìˆ˜ì •â€ë§Œ í•©ë‹ˆë‹¤. ì ìˆ˜/ì •ë‹µ ë¹„êµ/AI í•´ì„ì€ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </div>
              </div>
            ) : (
              <div className="rounded-xl border border-neutral-800 bg-neutral-900/30 p-4">
                <div className="text-sm font-semibold text-neutral-100">ê²€í†  Â· ìˆ˜ì •</div>
                <div className="mt-1 text-xs text-neutral-400">
                  ìˆ˜ë™ ê²€í† ê°€ í•„ìš”í•  ë•Œë§Œ ì €ì¥ì´ í™œì„±í™”ë©ë‹ˆë‹¤.
                </div>
              </div>
            )}

            <div className="rounded-xl border border-neutral-800 bg-neutral-950 p-4">
              <div className="mb-3 flex items-center justify-between">
                <div className="text-sm font-semibold text-neutral-100">ì‹ë³„ì (identifier)</div>
                <div className="text-xs text-neutral-500">
                  {loadReviewMut.isPending ? "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..." : ""}
                </div>
              </div>

              <input
                className="w-full rounded-lg border border-neutral-800 bg-neutral-900 px-3 py-2 text-sm text-neutral-100 outline-none"
                placeholder="ì˜ˆ: í•™ìƒ ì‹ë³„ì (ìš´ì˜ ì •ì±…ì— ë”°ë¼ ì‚¬ìš©)"
                value={identifier}
                onChange={(e) => setIdentifier(e.target.value)}
                disabled={!needsManual}
              />

              <div className="mt-2 text-xs text-neutral-500">
                â€» identifierëŠ” â€œí‘œì‹œ/ìˆ˜ì •â€ë§Œ í•©ë‹ˆë‹¤. í•™ìƒ ë§¤ì¹­/íŒë‹¨ ë¡œì§ì€ ì„œë²„ ë‹¨ì¼ì§„ì‹¤ì…ë‹ˆë‹¤.
              </div>
            </div>

            <div className="rounded-xl border border-neutral-800 bg-neutral-950 p-4">
              <div className="mb-3 flex items-center justify-between">
                <div className="text-sm font-semibold text-neutral-100">ë¬¸í•­ ë‹µì•ˆ ìˆ˜ì •</div>
                <div className="text-xs text-neutral-500">
                  {answers.length ? `${answers.length}ê°œ ë¬¸í•­` : "ë¬¸í•­ ë°ì´í„° ì—†ìŒ"}
                </div>
              </div>

              {answers.length === 0 ? (
                <div className="rounded-lg border border-neutral-800 bg-neutral-900/40 p-3 text-sm text-neutral-400">
                  ë¬¸í•­ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. (ì„œë²„ manual-edit ì‘ë‹µì„ í™•ì¸í•˜ì„¸ìš”)
                </div>
              ) : (
                <div className="max-h-[52vh] overflow-auto rounded-lg border border-neutral-800">
                  <table className="min-w-full text-sm">
                    <thead className="sticky top-0 bg-neutral-950 text-xs text-neutral-400">
                      <tr className="border-b border-neutral-800">
                        <th className="px-3 py-2 text-left">ë¬¸í•­</th>
                        <th className="px-3 py-2 text-left">ë‹µ</th>
                        <th className="px-3 py-2 text-left">invalid_reason</th>
                      </tr>
                    </thead>
                    <tbody className="text-neutral-100">
                      {answers.map((a, idx) => {
                        const qLabel =
                          Number.isFinite(a.question_no) && (a.question_no as number) > 0
                            ? `#${a.question_no}`
                            : Number.isFinite(a.question_id) && (a.question_id as number) > 0
                              ? `id:${a.question_id}`
                              : `row:${idx + 1}`;

                        const inv = invalidReasonFromMeta(a.meta);

                        return (
                          <tr key={idx} className="border-b border-neutral-900">
                            <td className="px-3 py-2 text-xs text-neutral-300">{qLabel}</td>
                            <td className="px-3 py-2">
                              <input
                                className="w-full rounded-md border border-neutral-800 bg-neutral-900 px-2 py-1 text-sm text-neutral-100 outline-none"
                                value={a.answer}
                                onChange={(e) => {
                                  const v = e.target.value;
                                  setAnswers((prev) =>
                                    prev.map((p, i) => (i === idx ? { ...p, answer: v } : p))
                                  );
                                }}
                                disabled={!needsManual}
                              />
                            </td>
                            <td className="px-3 py-2 text-xs text-neutral-400">
                              {inv ? (
                                <span className="rounded-full border border-neutral-800 bg-neutral-900 px-2 py-0.5">
                                  {inv}
                                </span>
                              ) : (
                                "-"
                              )}
                            </td>
                          </tr>
                        );
                      })}
                    </tbody>
                  </table>
                </div>
              )}

              <div className="mt-3 flex items-center justify-between gap-2">
                <div className="text-xs text-neutral-500">
                  â€» invalid_reasonì€ í‘œì‹œë§Œ í•©ë‹ˆë‹¤. íŒë‹¨/ì ìˆ˜ ê³„ì‚°ì€ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </div>

                <button
                  className="rounded-lg bg-yellow-100 px-4 py-2 text-sm text-yellow-950 disabled:opacity-40"
                  disabled={!canSave || saveMut.isPending || !submissionId}
                  onClick={() => saveMut.mutate()}
                  title={!needsManual ? "ìˆ˜ë™ ê²€í†  í•„ìš” ìƒíƒœì—ì„œë§Œ ì €ì¥ ê°€ëŠ¥" : ""}
                >
                  {saveMut.isPending ? "ì €ì¥ ì¤‘..." : "ì €ì¥ + ì¬ì±„ì "}
                </button>
              </div>
            </div>

            {submission?.meta?.manual_edits ? (
              <div className="rounded-xl border border-neutral-800 bg-neutral-950 p-4">
                <div className="mb-2 text-sm font-semibold text-neutral-100">ìˆ˜ì • ì´ë ¥ (meta.manual_edits)</div>
                <pre className="max-h-[240px] overflow-auto rounded-lg border border-neutral-800 bg-neutral-900 p-3 text-xs text-neutral-300">
                  {JSON.stringify(submission.meta.manual_edits, null, 2)}
                </pre>
              </div>
            ) : null}
          </div>
        </div>

        <div className="border-t border-neutral-800 px-4 py-3 text-xs text-neutral-500">
          {poll.isFetching ? "ìƒíƒœ ì—…ë°ì´íŠ¸ ì¤‘..." : " "}
        </div>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: components/AdminSubmissionsPanel.tsx
==========================================================================================
// PATH: src/features/submissions/components/AdminSubmissionsPanel.tsx
import { useMemo, useState } from "react";
import type { Submission } from "@/features/submissions/types";
import SubmissionStatusBadge from "@/features/submissions/components/SubmissionStatusBadge";
import ManualReviewBadge from "@/features/submissions/components/ManualReviewBadge";
import AdminSubmissionDetailModal from "@/features/submissions/components/AdminSubmissionDetailModal";
import { useAdminSubmissions } from "@/features/submissions/hooks/useAdminSubmissions";
import { retryAnySubmission } from "@/features/submissions/api/adminSubmissions";
import { useMutation, useQueryClient } from "@tanstack/react-query";

function safeManualReview(meta: any): { required: boolean; reasons: string[]; updated_at?: string } {
  const mr = meta?.manual_review;
  return {
    required: Boolean(mr?.required),
    reasons: Array.isArray(mr?.reasons) ? mr.reasons.map(String) : [],
    updated_at: mr?.updated_at ? String(mr.updated_at) : undefined,
  };
}

export default function AdminSubmissionsPanel({
  examId,
  onGoResults,
}: {
  examId: number;
  onGoResults?: (examId: number) => void;
}) {
  const qc = useQueryClient();
  const [selectedId, setSelectedId] = useState<number | null>(null);

  const q = useAdminSubmissions({
    examId,
    enabled: Number.isFinite(examId) && examId > 0,
    limit: 100,
    polling: true,
  });

  const list: Submission[] = q.data ?? [];

  const stats = useMemo(() => {
    const out = {
      total: list.length,
      manual: 0,
      done: 0,
      failed: 0,
      processing: 0,
    };
    for (const s of list) {
      const mr = safeManualReview(s.meta);
      if (mr.required && s.status === "answers_ready") out.manual++;
      if (s.status === "done") out.done++;
      else if (s.status === "failed") out.failed++;
      else out.processing++;
    }
    return out;
  }, [list]);

  const retryMut = useMutation({
    mutationFn: async (id: number) => retryAnySubmission(id),
    onSuccess: async () => {
      await qc.invalidateQueries({ queryKey: ["admin-submissions", examId] });
      await qc.invalidateQueries({ queryKey: ["admin-submissions"] });
      alert("ì¬ì²˜ë¦¬ ìš”ì²­ ì™„ë£Œ");
    },
    onError: (e: any) => {
      alert(e?.response?.data?.detail || e?.message || "ì¬ì²˜ë¦¬ ì‹¤íŒ¨");
    },
  });

  return (
    <div className="space-y-3">
      <div className="rounded-xl border border-neutral-800 bg-neutral-950 p-4">
        <div className="mb-2 flex items-start justify-between gap-3">
          <div>
            <div className="text-sm font-semibold text-neutral-100">ì œì¶œ í˜„í™©</div>
            <div className="text-xs text-neutral-500">
              ì—…ë¡œë“œ â†’ ì¸ì‹ â†’ (í•„ìš” ì‹œ ìˆ˜ë™ ê²€í† ) â†’ ì±„ì  â†’ ê²°ê³¼ í™•ì •
            </div>
          </div>
          <div className="text-xs text-neutral-400">
            exam_id: <span className="text-neutral-200">{examId}</span>
          </div>
        </div>

        <div className="flex flex-wrap gap-2 text-xs">
          <span className="rounded-full border border-neutral-800 bg-neutral-900 px-3 py-1 text-neutral-300">
            ì „ì²´ {stats.total}
          </span>
          <span className="rounded-full border border-neutral-800 bg-neutral-900 px-3 py-1 text-neutral-300">
            ì²˜ë¦¬ì¤‘ {stats.processing}
          </span>
          <span className="rounded-full border border-yellow-900 bg-yellow-950 px-3 py-1 text-yellow-200">
            ìˆ˜ë™ê²€í†  {stats.manual}
          </span>
          <span className="rounded-full border border-emerald-900 bg-emerald-950 px-3 py-1 text-emerald-200">
            ì™„ë£Œ {stats.done}
          </span>
          <span className="rounded-full border border-red-900 bg-red-950 px-3 py-1 text-red-200">
            ì‹¤íŒ¨ {stats.failed}
          </span>
        </div>
      </div>

      <div className="rounded-xl border border-neutral-800 bg-neutral-950">
        <div className="border-b border-neutral-800 px-4 py-3">
          <div className="text-xs font-semibold text-neutral-300">ì œì¶œ ëª©ë¡</div>
        </div>

        <div className="overflow-x-auto">
          <table className="min-w-full text-sm">
            <thead className="text-xs text-neutral-500">
              <tr className="border-b border-neutral-800">
                <th className="px-3 py-2 text-left">submission</th>
                <th className="px-3 py-2 text-left">enrollment</th>
                <th className="px-3 py-2 text-left">status</th>
                <th className="px-3 py-2 text-left">manual_review</th>
                <th className="px-3 py-2 text-left">action</th>
              </tr>
            </thead>

            <tbody className="text-neutral-100">
              {q.isLoading ? (
                <tr>
                  <td colSpan={5} className="px-3 py-6 text-center text-neutral-500">
                    ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                  </td>
                </tr>
              ) : q.isError ? (
                <tr>
                  <td colSpan={5} className="px-3 py-6 text-center text-red-300">
                    ì œì¶œ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨
                  </td>
                </tr>
              ) : list.length === 0 ? (
                <tr>
                  <td colSpan={5} className="px-3 py-8 text-center text-neutral-500">
                    ì•„ì§ ì œì¶œì´ ì—†ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ OMR ì—…ë¡œë“œ í›„ submission_idê°€ ìƒì„±ë©ë‹ˆë‹¤.
                  </td>
                </tr>
              ) : (
                list.map((s) => {
                  const mr = safeManualReview(s.meta);
                  const canRetry = s.status === "failed";

                  return (
                    <tr key={s.id} className="border-b border-neutral-900 hover:bg-neutral-900/30">
                      <td className="px-3 py-2">
                        <button
                          className="text-left text-sm text-neutral-100 underline decoration-neutral-700 underline-offset-2 hover:decoration-neutral-200"
                          onClick={() => setSelectedId(s.id)}
                        >
                          #{s.id}
                        </button>
                        <div className="text-xs text-neutral-500">exam #{s.target_id}</div>
                      </td>
                      <td className="px-3 py-2">
                        <div className="text-sm">{s.enrollment_id ?? "-"}</div>
                        <div className="text-xs text-neutral-500">{s.source}</div>
                      </td>
                      <td className="px-3 py-2">
                        <SubmissionStatusBadge status={s.status} />
                      </td>
                      <td className="px-3 py-2">
                        <ManualReviewBadge required={mr.required && s.status === "answers_ready"} reasons={mr.reasons} />
                      </td>
                      <td className="px-3 py-2">
                        <div className="flex flex-wrap gap-2">
                          <button
                            className="rounded-lg border border-neutral-800 bg-neutral-900 px-3 py-1.5 text-xs text-neutral-100 hover:bg-neutral-800"
                            onClick={() => setSelectedId(s.id)}
                          >
                            ìƒì„¸
                          </button>

                          {s.status === "done" && typeof onGoResults === "function" ? (
                            <button
                              className="rounded-lg bg-emerald-100 px-3 py-1.5 text-xs text-emerald-950"
                              onClick={() => onGoResults(Number(s.target_id))}
                            >
                              ê²°ê³¼
                            </button>
                          ) : null}

                          {canRetry ? (
                            <button
                              className="rounded-lg bg-red-100 px-3 py-1.5 text-xs text-red-950 disabled:opacity-50"
                              disabled={retryMut.isPending}
                              onClick={() => retryMut.mutate(s.id)}
                            >
                              {retryMut.isPending ? "ì¬ì²˜ë¦¬..." : "ì¬ì²˜ë¦¬"}
                            </button>
                          ) : null}
                        </div>
                      </td>
                    </tr>
                  );
                })
              )}
            </tbody>
          </table>
        </div>

        <div className="border-t border-neutral-800 px-4 py-3 text-xs text-neutral-500">
          {q.isFetching ? "ìƒíƒœ ì—…ë°ì´íŠ¸ ì¤‘..." : " "}
        </div>
      </div>

      <AdminSubmissionDetailModal
        open={selectedId != null}
        submissionId={selectedId}
        examId={examId}
        onClose={() => setSelectedId(null)}
        onGoResults={onGoResults}
      />
    </div>
  );
}


==========================================================================================
# FILE: components/ManualReviewBadge.tsx
==========================================================================================
// PATH: src/features/submissions/components/ManualReviewBadge.tsx
export default function ManualReviewBadge({
  required,
  reasons,
}: {
  required: boolean;
  reasons?: string[];
}) {
  if (!required) {
    return (
      <span className="inline-flex items-center rounded-full border border-neutral-800 bg-neutral-950 px-2 py-1 text-xs text-neutral-400">
        ìë™ ì²˜ë¦¬
      </span>
    );
  }

  return (
    <span
      className="inline-flex items-center gap-1 rounded-full border border-yellow-800 bg-yellow-950 px-2 py-1 text-xs text-yellow-200"
      title={(reasons ?? []).join(", ")}
    >
      âš ï¸ ìˆ˜ë™ ê²€í†  í•„ìš”{reasons?.length ? ` (${reasons.length})` : ""}
    </span>
  );
}


==========================================================================================
# FILE: components/SubmissionStatusBadge.tsx
==========================================================================================
// src/features/submissions/components/SubmissionStatusBadge.tsx

import type { SubmissionStatus } from "@/features/submissions/types";
import {
  SUBMISSION_STATUS_COLOR,
  SUBMISSION_STATUS_LABEL,
} from "@/features/submissions/statusMaps";

const COLOR_CLASS: Record<string, string> = {
  gray: "bg-neutral-800 text-neutral-200 border-neutral-700",
  blue: "bg-blue-950 text-blue-200 border-blue-800",
  indigo: "bg-indigo-950 text-indigo-200 border-indigo-800",
  yellow: "bg-yellow-950 text-yellow-200 border-yellow-800",
  green: "bg-emerald-950 text-emerald-200 border-emerald-800",
  red: "bg-red-950 text-red-200 border-red-800",
};

export default function SubmissionStatusBadge({
  status,
}: {
  status: SubmissionStatus | null;
}) {
  if (!status) {
    return (
      <span className="inline-flex items-center rounded-full border border-neutral-800 bg-neutral-900 px-2 py-1 text-xs text-neutral-300">
        -
      </span>
    );
  }

  const key = SUBMISSION_STATUS_COLOR[status];
  const cls = COLOR_CLASS[key] ?? COLOR_CLASS.gray;

  return (
    <span className={`inline-flex items-center rounded-full border px-2 py-1 text-xs ${cls}`}>
      {SUBMISSION_STATUS_LABEL[status]}
    </span>
  );
}


==========================================================================================
# FILE: dev/SubmissionTestPanel.tsx
==========================================================================================
const handleUpload = async (file: File) => {
  const formData = new FormData();

  // âœ… backend contract ì •í™•íˆ ë§ì¶¤
  formData.append("enrollment_id", "1"); // í…ŒìŠ¤íŠ¸ìš©
  formData.append("target_type", "exam");
  formData.append("target_id", "1");
  formData.append("source", "omr_scan");
  formData.append("file", file);

  const submission = await createSubmission(formData);
  setSubmissionId(submission.id);
};


==========================================================================================
# FILE: hooks/useAdminSubmissions.ts
==========================================================================================
// PATH: src/features/submissions/hooks/useAdminSubmissions.ts
import { useQuery } from "@tanstack/react-query";
import type { Submission, SubmissionStatus } from "@/features/submissions/types";
import { fetchAdminSubmissions } from "@/features/submissions/api/adminSubmissions";

export function useAdminSubmissions(params: {
  examId?: number;
  enrollmentId?: number;
  status?: SubmissionStatus;
  enabled?: boolean;
  limit?: number;
  polling?: boolean;
}) {
  const enabled = params.enabled ?? true;
  const polling = params.polling ?? true;

  return useQuery<Submission[]>({
    queryKey: ["admin-submissions", params.examId, params.enrollmentId, params.status, params.limit],
    queryFn: () =>
      fetchAdminSubmissions({
        examId: params.examId,
        enrollmentId: params.enrollmentId,
        status: params.status,
        limit: params.limit ?? 50,
      }),
    enabled: enabled,
    refetchInterval: polling ? 2000 : false,
  });
}


==========================================================================================
# FILE: hooks/useSubmissionPolling.ts
==========================================================================================
// src/features/submissions/hooks/useSubmissionPolling.ts
// --------------------------------------------------
// Submission ìƒíƒœ Polling ê³µí†µ í›… (â­ í•µì‹¬)
// --------------------------------------------------
//
// ì´ í›… í•˜ë‚˜ë¡œ:
// - í•™ìƒ ì—…ë¡œë“œ ì§„í–‰ ìƒíƒœ
// - ê´€ë¦¬ì ì¬ì²˜ë¦¬ ìƒíƒœ
// - ì˜ìƒ ë¶„ì„ ìƒíƒœ
// ì „ë¶€ ë™ì¼ UXë¡œ ì²˜ë¦¬ ê°€ëŠ¥
//

import { useQuery } from "@tanstack/react-query";
import { fetchSubmission } from "../api";
import { Submission } from "../types";

const TERMINAL_STATUS = ["done", "failed"] as const;

/**
 * âœ… Submission ìƒíƒœ ìë™ ì¶”ì  í›…
 *
 * - 2ì´ˆ ê°„ê²© polling
 * - done / failed ë„ë‹¬ ì‹œ ìë™ ì¤‘ë‹¨
 */
export function useSubmissionPolling(
  submissionId?: number,
  enabled: boolean = true
) {
  return useQuery<Submission>({
    queryKey: ["submission", submissionId],
    queryFn: () => fetchSubmission(submissionId!),

    enabled: enabled && Number.isFinite(submissionId),

    refetchInterval: (data) => {
      if (!data) return 2000;
      return TERMINAL_STATUS.includes(data.status)
        ? false
        : 2000;
    },
  });
}
