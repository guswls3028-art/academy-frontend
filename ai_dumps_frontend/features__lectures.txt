====================================================================================================
# FRONTEND FOLDER: features__lectures
# ROOT PATH: C:\academyfront\src\features\lectures
====================================================================================================


==========================================================================================
# FILE: LecturesRoutes.tsx
==========================================================================================



==========================================================================================
# FILE: api/attendance.ts
==========================================================================================
// PATH: src/features/lectures/api/attendance.ts
import api from "@/shared/api/axios";

/* =========================================================
 * 1️⃣ 세션 단위 출결 목록 조회 (SessionDetailPage)
 * GET /api/v1/lectures/attendance/?session={id}
 * ======================================================= */
export async function fetchAttendance(sessionId: number) {
  const res = await api.get("/lectures/attendance/", {
    params: { session: sessionId },
  });
  return Array.isArray(res.data) ? res.data : res.data.results;
}

/* =========================================================
 * 2️⃣ 출결 단건 수정 (상태 / 메모)
 * PATCH /api/v1/lectures/attendance/{id}/
 * ======================================================= */
export async function updateAttendance(
  id: number,
  payload: { status?: string; memo?: string }
) {
  const res = await api.patch(`/lectures/attendance/${id}/`, payload);
  return res.data;
}

/* =========================================================
 * 3️⃣ 세션 기준 학생 등록
 * POST /api/v1/lectures/attendance/bulk_create/
 * ======================================================= */
export async function bulkCreateAttendance(
  sessionId: number,
  studentIds: number[]
) {
  if (!Array.isArray(studentIds) || studentIds.length === 0) {
    throw new Error("students 배열이 비어있습니다.");
  }

  const res = await api.post("/lectures/attendance/bulk_create/", {
    session: sessionId,
    students: studentIds,
  });
  return res.data;
}

/* =========================================================
 * 4️⃣ 강의 × 차시 출결 매트릭스
 * GET /api/v1/lectures/attendance/matrix/?lecture={id}
 * ======================================================= */

export type AttendanceMatrixSessionCell = {
  session_id: number;
  title: string;
  status?: string | null;
  status_label?: string | null;
};

export type AttendanceMatrixRow = {
  student_id: number;
  student_name: string;
  sessions: AttendanceMatrixSessionCell[];
};

export async function fetchAttendanceMatrix(lectureId: number) {
  const res = await api.get("/lectures/attendance/matrix/", {
    params: { lecture: lectureId },
  });
  return res.data;
}

/* =========================================================
 * 5️⃣ 출결 엑셀 다운로드
 * ======================================================= */
export function downloadAttendanceExcel(lectureId: number) {
  window.location.href = `/api/v1/lectures/attendance/excel/?lecture=${lectureId}`;
}


==========================================================================================
# FILE: api/board.ts
==========================================================================================
// PATH: src/features/lectures/api/board.ts
import api from "@/shared/api/axios";

/**
 * ✅ Board 관련 API
 * /api/v1/interactions/*
 */
const PREFIX = "/interactions";

/* =========================
 * TYPES
 * ========================= */
export interface BoardCategory {
  id: number;
  lecture: number;
  name: string;
  order: number;
}

export interface BoardAttachment {
  id: number;
  post: number;
  file: string;
}

export interface BoardPost {
  id: number;
  lecture: number;
  category: number;
  title: string;
  content: string;
  created_by: number | null;
  created_at: string;
  attachments: BoardAttachment[];
}

export interface BoardReadStatus {
  id: number;
  post: number;
  enrollment: number;
  checked_at: string;
  student_name?: string;
}

/* =========================
 * UTILS
 * ========================= */
function unwrap<T>(data: any): T[] {
  if (Array.isArray(data)) return data;
  if (Array.isArray(data?.results)) return data.results;
  return [];
}

/* =========================
 * CATEGORY
 * ========================= */
export async function fetchBoardCategories(
  lectureId: number
): Promise<BoardCategory[]> {
  const res = await api.get(`${PREFIX}/board-categories/`, {
    params: { lecture: lectureId },
  });
  return unwrap<BoardCategory>(res.data);
}

export async function createBoardCategory(payload: {
  lecture: number;
  name: string;
}): Promise<BoardCategory> {
  const res = await api.post(`${PREFIX}/board-categories/`, payload);
  return res.data;
}

/* =========================
 * POSTS
 * ========================= */
export async function fetchBoardPosts(params: {
  lecture: number;
  category?: number;
}): Promise<BoardPost[]> {
  const res = await api.get(`${PREFIX}/board-posts/`, { params });
  return unwrap<BoardPost>(res.data);
}

export async function createBoardPost(formData: FormData): Promise<BoardPost> {
  const res = await api.post(`${PREFIX}/board-posts/`, formData, {
    headers: { "Content-Type": "multipart/form-data" },
  });
  return res.data;
}

/* =========================
 * READ STATUS
 * ========================= */
export async function fetchBoardReadStatus(
  postId: number
): Promise<BoardReadStatus[]> {
  const res = await api.get(`${PREFIX}/board-read-status/`, {
    params: { post: postId },
  });
  return unwrap<BoardReadStatus>(res.data);
}


==========================================================================================
# FILE: api/ddays.ts
==========================================================================================
// PATH: src/features/lectures/api/ddays.ts
/**
 * ⚠️ D-DAY API
 * - 현재 backend 미구현
 * - 프론트 UI 유지용 stub
 */

export interface Dday {
  id: number;
  lecture: number;
  title: string;
  date: string;
  created_at: string;
}

export async function fetchDdays(_: number): Promise<Dday[]> {
  return [];
}

export async function createDday(_: {
  lecture: number;
  title: string;
  date: string;
}): Promise<Dday> {
  throw new Error("D-Day API not implemented");
}

export async function deleteDday(_: number): Promise<void> {
  throw new Error("D-Day API not implemented");
}


==========================================================================================
# FILE: api/enrollments.ts
==========================================================================================
// PATH: src/features/lectures/api/enrollments.ts
import api from "@/shared/api/axios";

export async function fetchLectureEnrollments(lectureId: number) {
  const res = await api.get("/enrollments/", {
    params: { lecture: lectureId },
  });

  return Array.isArray(res.data) ? res.data : res.data.results;
}

export async function bulkCreateEnrollments(
  lectureId: number,
  studentIds: number[]
) {
  const res = await api.post("/enrollments/bulk_create/", {
    lecture: lectureId,
    students: studentIds,
  });
  return res.data;
}


==========================================================================================
# FILE: api/materials.ts
==========================================================================================
// PATH: src/features/lectures/api/materials.ts
import api from "@/shared/api/axios";

const PREFIX = "/interactions";

/* =========================
 * TYPES
 * ========================= */
export interface MaterialCategory {
  id: number;
  lecture: number;
  name: string;
  order: number;
}

export interface Material {
  id: number;
  lecture: number;
  category: number | null;
  title: string;
  description: string;
  file: string | null;
  url: string | null;
  order: number;
  is_public: boolean;
  uploader_name?: string | null;
  created_at: string;
}

/* =========================
 * UTILS
 * ========================= */
function unwrap<T>(data: any): T[] {
  if (Array.isArray(data)) return data;
  if (Array.isArray(data?.results)) return data.results;
  return [];
}

/* =========================
 * CATEGORY
 * ========================= */
export async function fetchMaterialCategories(
  lectureId: number
): Promise<MaterialCategory[]> {
  const res = await api.get(`${PREFIX}/material-categories/`, {
    params: { lecture: lectureId },
  });
  return unwrap<MaterialCategory>(res.data);
}

export async function createMaterialCategory(payload: {
  lecture: number;
  name: string;
}): Promise<MaterialCategory> {
  const res = await api.post(`${PREFIX}/material-categories/`, payload);
  return res.data;
}

/* =========================
 * MATERIAL
 * ========================= */
export async function fetchMaterials(params: {
  lecture: number;
  category?: number;
}): Promise<Material[]> {
  const res = await api.get(`${PREFIX}/materials/`, { params });
  return unwrap<Material>(res.data);
}

export async function createMaterial(formData: FormData): Promise<Material> {
  const res = await api.post(`${PREFIX}/materials/`, formData, {
    headers: { "Content-Type": "multipart/form-data" },
  });
  return res.data;
}


==========================================================================================
# FILE: api/report.ts
==========================================================================================
// PATH: src/features/lectures/api/report.ts
import api from "@/shared/api/axios";

export interface LectureReportStudent {
  enrollment: number;
  student_id: number;
  student_name: string;
  avg_progress: number;
  completed_videos: number;
  total_videos: number;
  last_attendance_status: string | null;
}

export interface LectureReportSummary {
  total_students: number;
  total_sessions: number;
  total_videos: number;
  avg_video_progress: number;
  completed_students: number;
}

export interface LectureReportResponse {
  lecture: {
    id: number;
    title: string;
    name: string;
    subject: string;
  };
  summary: LectureReportSummary;
  attendance_by_status: Record<string, number>;
  students: LectureReportStudent[];
}

/**
 * ✅ FIX
 * ❌ /lectures/{id}/report/
 * ✅ /lectures/lectures/{id}/report/
 */
export async function fetchLectureReport(
  lectureId: number
): Promise<LectureReportResponse> {
  const res = await api.get(`/lectures/lectures/${lectureId}/report/`);
  return res.data;
}


==========================================================================================
# FILE: api/sessions.ts
==========================================================================================
// PATH: src/features/lectures/api/sessions.ts
import api from "@/shared/api/axios";

// ----------------------------------------
// TYPES
// ----------------------------------------
export interface Lecture {
  id: number;
  title: string;
  name: string;
  subject: string;
  description?: string;
  start_date?: string | null;
  end_date?: string | null;
  lecture_time?: string | null;
  color?: string | null;
  is_active: boolean;
  tenant: number;
  created_at: string;
  updated_at: string;
}

export interface Session {
  id: number;
  lecture: number;
  order: number;
  title: string;
  date?: string | null;
  created_at: string;
  updated_at: string;
}

// ----------------------------------------
// LECTURE 목록 가져오기
// ----------------------------------------
export async function fetchLectures(params?: {
  is_active?: boolean;
  subject?: string;
  search?: string;
}): Promise<Lecture[]> {
  const res = await api.get("/lectures/lectures/", { params });
  const data = res.data;
  return Array.isArray(data?.results) ? data.results : Array.isArray(data) ? data : [];
}

// ----------------------------------------
// LECTURE 상세 가져오기
// ----------------------------------------
export async function fetchLecture(lectureId: number): Promise<Lecture> {
  const res = await api.get(`/lectures/lectures/${lectureId}/`);
  return res.data;
}

// ----------------------------------------
// LECTURE 생성
// ----------------------------------------
export async function createLecture(payload: {
  title: string;
  name: string;
  subject: string;
  description?: string;
  start_date?: string | null;
  end_date?: string | null;
  lecture_time?: string | null;
  color?: string | null;
  is_active?: boolean;
}): Promise<Lecture> {
  const res = await api.post("/lectures/lectures/", payload);
  return res.data;
}

// ----------------------------------------
// LECTURE 수정
// ----------------------------------------
export async function updateLecture(
  lectureId: number,
  payload: Partial<Omit<Lecture, "id" | "tenant" | "created_at" | "updated_at">>
): Promise<Lecture> {
  const res = await api.patch(`/lectures/lectures/${lectureId}/`, payload);
  return res.data;
}

// ----------------------------------------
// LECTURE 삭제
// ----------------------------------------
export async function deleteLecture(lectureId: number): Promise<void> {
  await api.delete(`/lectures/lectures/${lectureId}/`);
}

// ----------------------------------------
// SESSION 상세 가져오기
// ----------------------------------------
export async function fetchSession(sessionId: number): Promise<Session> {
  const res = await api.get(`/lectures/sessions/${sessionId}/`);
  return res.data;
}

// ----------------------------------------
// SESSION 목록 가져오기 (lecture 기준)
// ----------------------------------------
export async function fetchSessions(lectureId: number): Promise<Session[]> {
  const res = await api.get(`/lectures/sessions/?lecture=${lectureId}`);
  const data = res.data;
  return Array.isArray(data?.results) ? data.results : Array.isArray(data) ? data : [];
}

// ----------------------------------------
// SESSION 생성
// ----------------------------------------
export async function createSession(
  lectureId: number,
  title: string,
  date?: string | null,
  order?: number | null
): Promise<Session> {
  const payload: {
    lecture: number;
    title: string;
    date?: string | null;
    order?: number | null;
  } = {
    lecture: lectureId,
    title,
  };
  
  if (date !== undefined) payload.date = date;
  if (order !== undefined) payload.order = order;

  const res = await api.post(`/lectures/sessions/`, payload);
  return res.data;
}

// ----------------------------------------
// SESSION 수정
// ----------------------------------------
export async function updateSession(
  sessionId: number,
  payload: Partial<Pick<Session, "title" | "date" | "order">>
): Promise<Session> {
  const res = await api.patch(`/lectures/sessions/${sessionId}/`, payload);
  return res.data;
}

// ----------------------------------------
// SESSION 삭제
// ----------------------------------------
export async function deleteSession(sessionId: number): Promise<void> {
  await api.delete(`/lectures/sessions/${sessionId}/`);
}

/**
 * ⚠️ ATTENDANCE는 여기서 조회하지 않는다.
 * - 경로 혼재(attendance vs attendances)로 404 폭탄 방지
 * - 출결 조회/수정/일괄등록은 반드시 `api/attendance.ts`만 사용
 */
// export async function fetchAttendance(sessionId: number) { ... }  // ❌ 제거


==========================================================================================
# FILE: api/students.ts
==========================================================================================
// PATH: src/features/lectures/api/students.ts
import api from "@/shared/api/axios";

/**
 * 수강 학생 (Lecture → Enrollment → Student)
 * 백엔드 기준:
 * - Enrollment 도메인을 통해 Lecture-Student 관계가 형성됨
 * - GET /api/v1/enrollments/?lecture={lectureId}
 */

export type LectureStudent = {
  id: number; // Student ID
  name: string;
  grade: number | null;
  school: string | null;
  status: string; // enrollment.status (raw)
  status_label: string; // enrollment.status_display (serializer 기반)
};

export async function fetchLectureStudents(lectureId: number): Promise<LectureStudent[]> {
  const res = await api.get("/enrollments/", {
    params: {
      lecture: lectureId,
    },
  });

  const list = Array.isArray(res.data?.results)
    ? res.data.results
    : Array.isArray(res.data)
    ? res.data
    : [];

  return list.map((enrollment: any) => ({
    id: enrollment.student.id,
    name: enrollment.student.name,
    grade: enrollment.student.grade ?? null,
    school: enrollment.student.high_school ?? enrollment.student.middle_school ?? null,
    status: enrollment.status,
    status_label:
      enrollment.status_label ?? enrollment.status_display ?? enrollment.status,
  }));
}


==========================================================================================
# FILE: components/BoardCategoryModal.tsx
==========================================================================================
// src/features/lectures/components/BoardCategoryModal.tsx
import { useEffect, useMemo, useState } from "react";
import { useMutation, useQueryClient } from "@tanstack/react-query";
import { createBoardCategory } from "../api/board";
import { AdminModal, ModalBody, ModalFooter, ModalHeader } from "@/shared/ui/modal";
import { Button } from "@/shared/ui/ds";

interface Props {
  lectureId: number;
  isOpen: boolean;
  onClose: () => void;
}

export default function BoardCategoryModal({ lectureId, isOpen, onClose }: Props) {
  const qc = useQueryClient();
  const [name, setName] = useState("");
  const [busy, setBusy] = useState(false);

  const title = useMemo(() => "게시판 카테고리 추가", []);

  const { mutate } = useMutation({
    mutationFn: async () => {
      setBusy(true);
      try {
        return await createBoardCategory({ lecture: lectureId, name });
      } finally {
        setBusy(false);
      }
    },
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["board-categories", lectureId] });
      onClose();
    },
  });

  useEffect(() => {
    if (!isOpen) return;
    function onKeyDown(e: KeyboardEvent) {
      if (e.key === "Escape") onClose();
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
        if (!busy && name.trim()) mutate();
      }
    }
    window.addEventListener("keydown", onKeyDown);
    return () => window.removeEventListener("keydown", onKeyDown);
  }, [isOpen, busy, name]);

  if (!isOpen) return null;

  return (
    <AdminModal open={true} onClose={onClose} type="action" width={560}>
      <ModalHeader type="action" title={title} description="⌘/Ctrl + Enter 저장" />
      <ModalBody>
        <input
          className="ds-input"
          value={name}
          onChange={(e) => setName(e.target.value)}
          disabled={busy}
          autoFocus
        />
      </ModalBody>
      <ModalFooter
        right={
          <>
            <Button intent="secondary" onClick={onClose}>취소</Button>
            <Button intent="primary" onClick={() => name.trim() && mutate()} disabled={!name.trim() || busy}>
              추가
            </Button>
          </>
        }
      />
    </AdminModal>
  );
}


==========================================================================================
# FILE: components/BoardPostDetail.tsx
==========================================================================================
// PATH: src/features/lectures/components/BoardPostDetail.tsx
import { useEffect, useMemo } from "react";
import { useQuery } from "@tanstack/react-query";
import { BoardPost, fetchBoardReadStatus } from "../api/board";
import { fetchLectureEnrollments } from "../api/enrollments";

import { AdminModal, ModalBody, ModalFooter, ModalHeader } from "@/shared/ui/modal";
import { Button, EmptyState } from "@/shared/ui/ds";

interface Props {
  lectureId: number;
  post: BoardPost;
  onClose: () => void;
}

export default function BoardPostDetail({ lectureId, post, onClose }: Props) {
  const { data: readStatus } = useQuery({
    queryKey: ["board-read-status", post.id],
    queryFn: () => fetchBoardReadStatus(post.id),
  });

  const { data: enrollments } = useQuery({
    queryKey: ["lecture-enrollments", lectureId],
    queryFn: () => fetchLectureEnrollments(lectureId),
  });

  useEffect(() => {
    function onKeyDown(e: KeyboardEvent) {
      if (e.key === "Escape") onClose();
    }
    window.addEventListener("keydown", onKeyDown);
    return () => window.removeEventListener("keydown", onKeyDown);
  }, [onClose]);

  const readMap = useMemo(() => {
    const m = new Map<number, string>();
    readStatus?.forEach((r) => m.set(r.enrollment, r.checked_at));
    return m;
  }, [readStatus]);

  const headerDesc = `작성일 ${post.created_at?.slice(0, 10) ?? "-"}`;

  return (
    <AdminModal open={true} onClose={onClose} type="inspect" width={1180}>
      <ModalHeader type="inspect" title={post.title} description={headerDesc} />

      <ModalBody>
        <div style={{ display: "grid", gridTemplateColumns: "1fr 280px", gap: 16 }}>
          {/* LEFT */}
          <div
            style={{
              borderRadius: "var(--radius-xl)",
              border: "1px solid var(--color-border-divider)",
              background: "var(--color-bg-surface)",
              padding: 16,
              minHeight: 360,
            }}
          >
            <div
              style={{
                whiteSpace: "pre-wrap",
                fontSize: 13,
                fontWeight: 850,
                color: "var(--color-text-primary)",
                lineHeight: 1.65,
              }}
            >
              {post.content}
            </div>

            {post.attachments?.length > 0 && (
              <div style={{ marginTop: 18 }}>
                <div
                  style={{
                    fontSize: 12,
                    fontWeight: 900,
                    color: "var(--color-text-secondary)",
                    marginBottom: 8,
                  }}
                >
                  첨부 파일
                </div>

                <div
                  style={{
                    borderRadius: 14,
                    border: "1px solid var(--color-border-divider)",
                    background: "var(--color-bg-surface-soft)",
                    padding: 12,
                    display: "grid",
                    gap: 6,
                  }}
                >
                  {post.attachments.map((a) => {
                    const name = a.file?.split("/").slice(-1)[0] ?? "파일";
                    return (
                      <a
                        key={a.id}
                        href={a.file}
                        target="_blank"
                        rel="noreferrer"
                        style={{
                          color: "var(--color-primary)",
                          fontWeight: 900,
                          fontSize: 12,
                        }}
                      >
                        {name}
                      </a>
                    );
                  })}
                </div>
              </div>
            )}
          </div>

          {/* RIGHT */}
          <div
            style={{
              borderRadius: "var(--radius-xl)",
              border: "1px solid var(--color-border-divider)",
              background: "var(--color-bg-surface)",
              padding: 14,
              overflow: "hidden",
            }}
          >
            <div style={{ display: "flex", alignItems: "baseline", justifyContent: "space-between" }}>
              <div style={{ fontSize: 12, fontWeight: 900, color: "var(--color-text-secondary)" }}>
                확인 현황
              </div>
              <div style={{ fontSize: 11, fontWeight: 850, color: "var(--color-text-muted)" }}>
                {readStatus?.length ?? 0}명 확인
              </div>
            </div>

            <div style={{ marginTop: 10, maxHeight: 420, overflow: "auto" }}>
              {!enrollments?.length ? (
                <EmptyState mode="embedded" scope="panel" title="수강생이 없습니다." />
              ) : (
                <div style={{ display: "grid", gap: 6 }}>
                  {enrollments.map((en: any) => {
                    const name = en.student_name || en.student?.name || "이름 없음";
                    const checkedAt = readMap.get(en.id);
                    const checked = !!checkedAt;

                    return (
                      <div
                        key={en.id}
                        style={{
                          display: "flex",
                          alignItems: "center",
                          justifyContent: "space-between",
                          gap: 10,
                          padding: "8px 10px",
                          borderRadius: 12,
                          border: "1px solid var(--color-border-divider)",
                          background: "var(--color-bg-surface-soft)",
                        }}
                      >
                        <div
                          style={{
                            minWidth: 0,
                            fontSize: 12,
                            fontWeight: 900,
                            color: "var(--color-text-primary)",
                            whiteSpace: "nowrap",
                            overflow: "hidden",
                            textOverflow: "ellipsis",
                          }}
                        >
                          {name}
                        </div>

                        <div
                          style={{
                            flex: "0 0 auto",
                            padding: "4px 8px",
                            borderRadius: 999,
                            fontSize: 11,
                            fontWeight: 900,
                            border: "1px solid var(--color-border-divider)",
                            background: checked
                              ? "color-mix(in srgb, var(--color-primary) 10%, var(--color-bg-surface))"
                              : "var(--color-bg-surface)",
                            color: checked ? "var(--color-primary)" : "var(--color-text-muted)",
                          }}
                        >
                          {checked ? checkedAt!.slice(5, 16) : "미확인"}
                        </div>
                      </div>
                    );
                  })}
                </div>
              )}
            </div>
          </div>
        </div>
      </ModalBody>

      <ModalFooter
        left={
          <span style={{ fontSize: 12, fontWeight: 850, color: "var(--color-text-muted)" }}>
            ESC 로 닫기
          </span>
        }
        right={
          <Button intent="secondary" onClick={onClose}>
            닫기
          </Button>
        }
      />
    </AdminModal>
  );
}


==========================================================================================
# FILE: components/BoardPostModal.tsx
==========================================================================================
// PATH: src/features/lectures/components/BoardPostModal.tsx
import { useEffect, useMemo, useState } from "react";
import { useMutation, useQueryClient } from "@tanstack/react-query";
import { BoardCategory, createBoardPost } from "../api/board";

import { AdminModal, ModalBody, ModalFooter, ModalHeader } from "@/shared/ui/modal";
import { Button } from "@/shared/ui/ds";

interface Props {
  lectureId: number;
  category: BoardCategory;
  onClose: () => void;
}

export default function BoardPostModal({ lectureId, category, onClose }: Props) {
  const qc = useQueryClient();

  const [titleInput, setTitleInput] = useState("");
  const [content, setContent] = useState("");
  const [files, setFiles] = useState<FileList | null>(null);
  const [busy, setBusy] = useState(false);

  const title = useMemo(() => `${category.name} - 글 작성`, [category.name]);

  const { mutate } = useMutation({
    mutationFn: async () => {
      setBusy(true);
      try {
        const fd = new FormData();
        fd.append("lecture", String(lectureId));
        fd.append("category", String(category.id));
        fd.append("title", titleInput);
        fd.append("content", content);
        if (files) Array.from(files).forEach((file) => fd.append("files", file));
        return await createBoardPost(fd);
      } finally {
        setBusy(false);
      }
    },
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["board-posts", lectureId, category.id] });
      onClose();
    },
  });

  useEffect(() => {
    function onKeyDown(e: KeyboardEvent) {
      if (e.key === "Escape") onClose();
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
        if (!busy && titleInput.trim()) mutate();
      }
    }
    window.addEventListener("keydown", onKeyDown);
    return () => window.removeEventListener("keydown", onKeyDown);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [busy, titleInput, content, files]);

  return (
    <AdminModal open={true} onClose={onClose} type="action" width={980}>
      <ModalHeader type="action" title={title} description="⌘/Ctrl + Enter 로 등록" />

      <ModalBody>
        <div style={{ display: "grid", gap: 12 }}>
          <div style={{ display: "grid", gap: 8 }}>
            <div style={{ fontSize: 12, fontWeight: 900, color: "var(--color-text-secondary)" }}>
              제목
            </div>
            <input
              className="ds-input"
              value={titleInput}
              onChange={(e) => setTitleInput(e.target.value)}
              disabled={busy}
              data-invalid={!titleInput.trim() ? "true" : "false"}
              autoFocus
            />
          </div>

          <div style={{ display: "grid", gap: 8 }}>
            <div style={{ fontSize: 12, fontWeight: 900, color: "var(--color-text-secondary)" }}>
              내용
            </div>
            <textarea
              className="ds-textarea"
              rows={14}
              style={{ resize: "none" }}
              value={content}
              onChange={(e) => setContent(e.target.value)}
              disabled={busy}
            />
          </div>

          <div style={{ display: "grid", gap: 8 }}>
            <div style={{ fontSize: 12, fontWeight: 900, color: "var(--color-text-secondary)" }}>
              첨부 파일
            </div>
            <input type="file" multiple onChange={(e) => setFiles(e.target.files)} disabled={busy} />
            <div style={{ fontSize: 11, fontWeight: 850, color: "var(--color-text-muted)" }}>
              파일을 여러 개 선택할 수 있습니다.
            </div>
          </div>
        </div>
      </ModalBody>

      <ModalFooter
        left={
          <span style={{ fontSize: 12, fontWeight: 850, color: "var(--color-text-muted)" }}>
            ESC 로 닫기 · ⌘/Ctrl + Enter 등록
          </span>
        }
        right={
          <>
            <Button intent="secondary" onClick={onClose} disabled={busy}>
              취소
            </Button>
            <Button
              intent="primary"
              onClick={() => {
                if (!titleInput.trim()) return;
                mutate();
              }}
              disabled={busy || !titleInput.trim()}
            >
              {busy ? "저장 중…" : "등록"}
            </Button>
          </>
        }
      />
    </AdminModal>
  );
}


==========================================================================================
# FILE: components/DdayModal.tsx
==========================================================================================
// PATH: src/features/lectures/components/DdayModal.tsx
import { useEffect, useMemo, useState } from "react";
import { useMutation, useQueryClient } from "@tanstack/react-query";
import { createDday } from "../api/ddays";

import { AdminModal, ModalBody, ModalFooter, ModalHeader } from "@/shared/ui/modal";
import { Button } from "@/shared/ui/ds";

interface Props {
  lectureId: number;
  onClose: () => void;
}

export default function DdayModal({ lectureId, onClose }: Props) {
  const qc = useQueryClient();

  const [titleInput, setTitleInput] = useState("");
  const [date, setDate] = useState<string>("");
  const [time, setTime] = useState<string>("12:00");
  const [busy, setBusy] = useState(false);

  const title = useMemo(() => "D-Day 추가", []);

  const { mutate } = useMutation({
    mutationFn: async () => {
      setBusy(true);
      try {
        const iso = date && time ? `${date}T${time}:00` : `${date}T00:00:00`;
        return await createDday({ lecture: lectureId, title: titleInput, date: iso });
      } finally {
        setBusy(false);
      }
    },
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["ddays", lectureId] });
      onClose();
    },
  });

  useEffect(() => {
    function onKeyDown(e: KeyboardEvent) {
      if (e.key === "Escape") onClose();
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
        if (!busy && titleInput.trim() && date) mutate();
      }
    }
    window.addEventListener("keydown", onKeyDown);
    return () => window.removeEventListener("keydown", onKeyDown);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [busy, titleInput, date, time]);

  return (
    <AdminModal open={true} onClose={onClose} type="action" width={720}>
      <ModalHeader type="action" title={title} description="⌘/Ctrl + Enter 로 저장" />

      <ModalBody>
        <div style={{ display: "grid", gap: 12 }}>
          <input
            className="ds-input"
            placeholder="제목"
            value={titleInput}
            onChange={(e) => setTitleInput(e.target.value)}
            disabled={busy}
            data-invalid={!titleInput.trim() ? "true" : "false"}
            autoFocus
          />

          <div style={{ display: "grid", gridTemplateColumns: "1fr 180px", gap: 10 }}>
            <input
              type="date"
              className="ds-input"
              value={date}
              onChange={(e) => setDate(e.target.value)}
              disabled={busy}
              data-invalid={!date ? "true" : "false"}
            />
            <input
              type="time"
              className="ds-input"
              value={time}
              onChange={(e) => setTime(e.target.value)}
              disabled={busy}
            />
          </div>

          <div style={{ fontSize: 11, fontWeight: 850, color: "var(--color-text-muted)" }}>
            날짜는 필수입니다.
          </div>
        </div>
      </ModalBody>

      <ModalFooter
        left={
          <span style={{ fontSize: 12, fontWeight: 850, color: "var(--color-text-muted)" }}>
            ESC 로 닫기 · ⌘/Ctrl + Enter 저장
          </span>
        }
        right={
          <>
            <Button intent="secondary" onClick={onClose} disabled={busy}>
              취소
            </Button>
            <Button
              intent="primary"
              onClick={() => {
                if (!titleInput.trim() || !date) return;
                mutate();
              }}
              disabled={busy || !titleInput.trim() || !date}
            >
              {busy ? "저장 중…" : "추가"}
            </Button>
          </>
        }
      />
    </AdminModal>
  );
}


==========================================================================================
# FILE: components/EnrollStudentModal.tsx
==========================================================================================
// PATH: src/features/lectures/components/EnrollStudentModal.tsx
import { useEffect, useMemo, useState } from "react";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";

import { bulkCreateAttendance } from "../api/attendance";
import { fetchStudents as fetchStudentList, type ClientStudent } from "@/features/students/api/students";

import { AdminModal, ModalBody, ModalFooter, ModalHeader } from "@/shared/ui/modal";
import { Button, EmptyState } from "@/shared/ui/ds";
import { formatPhone } from "@/shared/utils/formatPhone";

interface Props {
  sessionId: number;
  isOpen: boolean;
  onClose: () => void;
  onSuccess?: () => void;
}

type Student = {
  id: number;
  name: string;
  phone?: string | null;
};

export default function EnrollStudentModal({ sessionId, isOpen, onClose, onSuccess }: Props) {
  const qc = useQueryClient();

  const [keyword, setKeyword] = useState("");
  const [search, setSearch] = useState("");
  const [selectedIds, setSelectedIds] = useState<number[]>([]);

  useEffect(() => {
    const t = setTimeout(() => setSearch(keyword.trim()), 300);
    return () => clearTimeout(t);
  }, [keyword]);

  const mutation = useMutation({
    mutationFn: (ids: number[]) => bulkCreateAttendance(sessionId, ids),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["attendance", sessionId] });
      onSuccess?.();
      onClose();
      setSelectedIds([]);
    },
  });

  useEffect(() => {
    function onKeyDown(e: KeyboardEvent) {
      if (!isOpen) return;
      if (e.key === "Escape") onClose();
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
        if (selectedIds.length > 0 && !mutation.isPending) {
          mutation.mutate(selectedIds);
        }
      }
    }
    window.addEventListener("keydown", onKeyDown);
    return () => window.removeEventListener("keydown", onKeyDown);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [isOpen, selectedIds]);

  const { data: students = [], isLoading } = useQuery({
    queryKey: ["enroll-modal-students", search],
    queryFn: async (): Promise<Student[]> => {
      const list: ClientStudent[] = await fetchStudentList(search, {});
      return list.map((s) => ({
        id: s.id,
        name: s.name,
        phone: s.studentPhone,
      }));
    },
    enabled: isOpen,
  });

  const title = useMemo(() => "학생 추가 (세션 기준)", []);

  if (!isOpen) return null;

  const toggleSelect = (id: number) => {
    setSelectedIds((prev) => (prev.includes(id) ? prev.filter((x) => x !== id) : [...prev, id]));
  };

  return (
    <AdminModal open={true} onClose={onClose} type="action" width={720}>
      <ModalHeader
        type="action"
        title={title}
        description="검색 후 체크하여 세션 출결 대상 학생을 추가합니다. (⌘/Ctrl + Enter 추가)"
      />

      <ModalBody>
        <div style={{ display: "grid", gap: 12 }}>
          <input
            value={keyword}
            onChange={(e) => setKeyword(e.target.value)}
            placeholder="학생 이름 검색"
            className="ds-input"
            autoFocus
          />

          <div
            style={{
              borderRadius: 14,
              border: "1px solid var(--color-border-divider)",
              background: "var(--color-bg-surface)",
              overflow: "hidden",
            }}
          >
            <div style={{ maxHeight: 320, overflow: "auto" }}>
              {isLoading ? (
                <EmptyState mode="embedded" scope="panel" tone="loading" title="불러오는 중…" />
              ) : students.length === 0 ? (
                <EmptyState
                  mode="embedded"
                  scope="panel"
                  title="학생이 없습니다."
                  description="검색어를 변경해 보세요."
                />
              ) : (
                <div style={{ display: "grid" }}>
                  {students.map((st) => {
                    const checked = selectedIds.includes(st.id);
                    return (
                      <Button
                        key={st.id}
                        type="button"
                        intent="ghost"
                        size="md"
                        onClick={() => toggleSelect(st.id)}
                        className="!block !w-full !grid !grid-cols-[28px_1fr] !gap-2.5 !py-2.5 !px-3 !text-left !justify-start border-t border-[var(--color-border-divider)]"
                        style={{
                          background: checked ? "var(--color-bg-surface-soft)" : "transparent",
                        }}
                      >
                        <input type="checkbox" checked={checked} readOnly className="mt-0.5" />
                        <div style={{ minWidth: 0 }}>
                          <div
                            style={{
                              fontSize: 13,
                              fontWeight: 900,
                              color: "var(--color-text-primary)",
                              whiteSpace: "nowrap",
                              overflow: "hidden",
                              textOverflow: "ellipsis",
                            }}
                          >
                            {st.name}
                          </div>
                          <div style={{ fontSize: 11, fontWeight: 850, color: "var(--color-text-muted)" }}>
                            {formatPhone(st.phone)}
                          </div>
                        </div>
                      </Button>
                    );
                  })}
                </div>
              )}
            </div>
          </div>

          <div style={{ fontSize: 11, fontWeight: 850, color: "var(--color-text-muted)" }}>
            선택: {selectedIds.length}명
          </div>
        </div>
      </ModalBody>

      <ModalFooter
        left={
          <span style={{ fontSize: 12, fontWeight: 850, color: "var(--color-text-muted)" }}>
            ESC 로 닫기 · ⌘/Ctrl + Enter 추가
          </span>
        }
        right={
          <>
            <Button intent="secondary" onClick={onClose}>
              취소
            </Button>
            <Button
              intent="primary"
              onClick={() => mutation.mutate(selectedIds)}
              disabled={mutation.isPending || selectedIds.length === 0}
            >
              {mutation.isPending ? "추가 중…" : "추가"}
            </Button>
          </>
        }
      />
    </AdminModal>
  );
}


==========================================================================================
# FILE: components/LectureCreateModal.tsx
==========================================================================================
import { useEffect, useMemo, useState } from "react";
import { useMutation, useQueryClient } from "@tanstack/react-query";
import api from "@/shared/api/axios";

import { AdminModal, ModalBody, ModalFooter, ModalHeader } from "@/shared/ui/modal";
import { Button } from "@/shared/ui/ds";
import { ColorPickerField, getDefaultColorForPicker } from "@/shared/ui/domain";

interface Props {
  isOpen: boolean;
  onClose: () => void;
  /** 이미 사용 중인 강의 색상 — 기본값이 이들과 최대한 차이나도록 선택됨 */
  usedColors?: string[];
}

interface CreateLecturePayload {
  title: string;
  name: string;
  subject: string;
  description: string;
  start_date: string;
  end_date: string;
  lecture_time: string;
  color: string;
  is_active: boolean;
}

export default function LectureCreateModal({ isOpen, onClose, usedColors = [] }: Props) {
  const qc = useQueryClient();

  const [title, setTitle] = useState("");
  const [name, setName] = useState("");
  const [subject, setSubject] = useState("");
  const [description, setDescription] = useState("");
  const [startDate, setStartDate] = useState("");
  const [endDate, setEndDate] = useState("");
  const [lectureTime, setLectureTime] = useState("");
  const [color, setColor] = useState(() => getDefaultColorForPicker(usedColors));

  const modalTitle = useMemo(() => "강의 추가", []);

  const { mutate, isPending, isError } = useMutation({
    mutationFn: async (payload: CreateLecturePayload) => {
      await api.post("/lectures/lectures/", payload);
    },
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["lectures"] });
      onClose();
    },
  });

  useEffect(() => {
    if (!isOpen) return;
    setTitle("");
    setName("");
    setSubject("");
    setDescription("");
    setStartDate("");
    setEndDate("");
    setLectureTime("");
    setColor(getDefaultColorForPicker(usedColors));
  }, [isOpen, usedColors]);

  useEffect(() => {
    if (!isOpen) return;

    function onKeyDown(e: KeyboardEvent) {
      if (e.key === "Escape") onClose();
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
        if (!isPending && title.trim()) submit();
      }
    }

    window.addEventListener("keydown", onKeyDown);
    return () => window.removeEventListener("keydown", onKeyDown);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [isOpen, title, name, subject, description, startDate, endDate, lectureTime, color, isPending]);

  if (!isOpen) return null;

  function submit() {
    if (!title.trim()) return;
    mutate({
      title,
      name,
      subject,
      description,
      start_date: startDate,
      end_date: endDate,
      lecture_time: lectureTime.trim(),
      color,
      is_active: true,
    });
  }

  return (
    <AdminModal open={true} onClose={onClose} type="action" width={820}>
      <ModalHeader type="action" title={modalTitle} description="⌘/Ctrl + Enter 로 등록" />

      <ModalBody>
        {isError && (
          <div style={{ marginBottom: 10, fontSize: 12, fontWeight: 900, color: "var(--color-error)" }}>
            등록 중 오류가 발생했습니다.
          </div>
        )}

        {/* ⬇️ students 모달과 동일한 입력 래퍼 구조 */}
        <div style={{ display: "grid", gap: 12 }}>
          <input
            className="ds-input"
            placeholder="강의 이름"
            value={title}
            onChange={(e) => setTitle(e.target.value)}
            data-invalid={!title.trim() ? "true" : "false"}
            disabled={isPending}
            autoFocus
          />

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
            <input
              className="ds-input"
              placeholder="담당 강사"
              value={name}
              onChange={(e) => setName(e.target.value)}
              disabled={isPending}
            />
            <input
              className="ds-input"
              placeholder="과목"
              value={subject}
              onChange={(e) => setSubject(e.target.value)}
              disabled={isPending}
            />
          </div>

          <textarea
            className="ds-textarea"
            rows={5}
            placeholder="설명"
            value={description}
            onChange={(e) => setDescription(e.target.value)}
            disabled={isPending}
            style={{ resize: "none" }}
          />

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
            <input
              type="date"
              className="ds-input"
              value={startDate}
              onChange={(e) => setStartDate(e.target.value)}
              disabled={isPending}
            />
            <input
              type="date"
              className="ds-input"
              value={endDate}
              onChange={(e) => setEndDate(e.target.value)}
              disabled={isPending}
            />
          </div>

          <input
            className="ds-input"
            placeholder="강의 시간 (예: 토 12:00 ~ 13:00)"
            value={lectureTime}
            onChange={(e) => setLectureTime(e.target.value)}
            disabled={isPending}
          />

          <ColorPickerField
            label="아이콘 색상"
            value={color}
            onChange={setColor}
            disabled={isPending}
          />
        </div>
      </ModalBody>

      <ModalFooter
        left={
          <span style={{ fontSize: 12, fontWeight: 850, color: "var(--color-text-muted)" }}>
            ESC 로 닫기 · ⌘/Ctrl + Enter 등록
          </span>
        }
        right={
          <>
            <Button intent="secondary" onClick={onClose} disabled={isPending}>
              취소
            </Button>
            <Button intent="primary" onClick={submit} disabled={isPending || !title.trim()}>
              {isPending ? "등록 중…" : "등록"}
            </Button>
          </>
        }
      />
    </AdminModal>
  );
}


==========================================================================================
# FILE: components/LectureEnrollStudentModal.tsx
==========================================================================================
// PATH: src/features/lectures/components/LectureEnrollStudentModal.tsx
import { useEffect, useState } from "react";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";

import { bulkCreateEnrollments } from "../api/enrollments";
import { fetchStudents as fetchStudentList, type ClientStudent } from "@/features/students/api/students";

import { AdminModal, ModalBody, ModalFooter, ModalHeader } from "@/shared/ui/modal";
import { Button, EmptyState } from "@/shared/ui/ds";
import { formatPhone } from "@/shared/utils/formatPhone";

interface Props {
  lectureId: number;
  open: boolean;
  onClose: () => void;
  onSuccess?: () => void;
}

type Student = {
  id: number;
  name: string;
  phone?: string | null;
};

export default function LectureEnrollStudentModal({ lectureId, open, onClose, onSuccess }: Props) {
  const qc = useQueryClient();

  const [keyword, setKeyword] = useState("");
  const [search, setSearch] = useState("");
  const [selectedIds, setSelectedIds] = useState<number[]>([]);

  useEffect(() => {
    const t = setTimeout(() => setSearch(keyword.trim()), 300);
    return () => clearTimeout(t);
  }, [keyword]);

  const mutation = useMutation({
    mutationFn: (ids: number[]) => bulkCreateEnrollments(lectureId, ids),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["lecture-students", lectureId] });
      qc.invalidateQueries({ queryKey: ["lecture-enrollments", lectureId] });
      onSuccess?.();
      onClose();
      setSelectedIds([]);
    },
  });

  useEffect(() => {
    function onKeyDown(e: KeyboardEvent) {
      if (!open) return;
      if (e.key === "Escape") onClose();
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
        if (selectedIds.length > 0 && !mutation.isPending) mutation.mutate(selectedIds);
      }
    }
    window.addEventListener("keydown", onKeyDown);
    return () => window.removeEventListener("keydown", onKeyDown);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [open, selectedIds]);

  const { data: students = [], isLoading } = useQuery({
    queryKey: ["lecture-enroll-modal-students", search],
    queryFn: async (): Promise<Student[]> => {
      const list: ClientStudent[] = await fetchStudentList(search, {});
      return list.map((s) => ({
        id: s.id,
        name: s.name,
        phone: s.studentPhone,
      }));
    },
    enabled: open,
  });

  if (!open) return null;

  const toggleSelect = (id: number) => {
    setSelectedIds((prev) => (prev.includes(id) ? prev.filter((x) => x !== id) : [...prev, id]));
  };

  return (
    <AdminModal open onClose={onClose} type="action" width={720}>
      <ModalHeader
        type="action"
        title="수강생 등록"
        description="검색 후 체크하여 강의 수강생을 추가합니다. (⌘/Ctrl + Enter 추가)"
      />

      <ModalBody>
        <div style={{ display: "grid", gap: 12 }}>
          <input
            value={keyword}
            onChange={(e) => setKeyword(e.target.value)}
            placeholder="학생 이름 검색"
            className="ds-input"
            autoFocus
          />

          <div
            style={{
              borderRadius: 14,
              border: "1px solid var(--color-border-divider)",
              background: "var(--color-bg-surface)",
              overflow: "hidden",
            }}
          >
            <div style={{ maxHeight: 320, overflow: "auto" }}>
              {isLoading ? (
                <EmptyState mode="embedded" scope="panel" tone="loading" title="불러오는 중…" />
              ) : students.length === 0 ? (
                <EmptyState
                  mode="embedded"
                  scope="panel"
                  title="학생이 없습니다."
                  description="검색어를 변경해 보세요."
                />
              ) : (
                <div style={{ display: "grid" }}>
                  {students.map((st) => {
                    const checked = selectedIds.includes(st.id);
                    return (
                      <Button
                        key={st.id}
                        type="button"
                        intent="ghost"
                        size="md"
                        onClick={() => toggleSelect(st.id)}
                        className="!block !w-full !grid !grid-cols-[28px_1fr] !gap-2.5 !py-2.5 !px-3 !text-left !justify-start border-t border-[var(--color-border-divider)]"
                        style={{
                          background: checked ? "var(--color-bg-surface-soft)" : "transparent",
                        }}
                      >
                        <input type="checkbox" checked={checked} readOnly className="mt-0.5" />
                        <div style={{ minWidth: 0 }}>
                          <div
                            style={{
                              fontSize: 13,
                              fontWeight: 900,
                              color: "var(--color-text-primary)",
                              whiteSpace: "nowrap",
                              overflow: "hidden",
                              textOverflow: "ellipsis",
                            }}
                          >
                            {st.name}
                          </div>
                          <div style={{ fontSize: 11, fontWeight: 850, color: "var(--color-text-muted)" }}>
                            {formatPhone(st.phone)}
                          </div>
                        </div>
                      </Button>
                    );
                  })}
                </div>
              )}
            </div>
          </div>

          <div style={{ fontSize: 11, fontWeight: 850, color: "var(--color-text-muted)" }}>
            선택: {selectedIds.length}명
          </div>
        </div>
      </ModalBody>

      <ModalFooter
        left={
          <span style={{ fontSize: 12, fontWeight: 850, color: "var(--color-text-muted)" }}>
            ESC 로 닫기 · ⌘/Ctrl + Enter 추가
          </span>
        }
        right={
          <>
            <Button intent="secondary" onClick={onClose}>
              취소
            </Button>
            <Button
              intent="primary"
              onClick={() => mutation.mutate(selectedIds)}
              disabled={mutation.isPending || selectedIds.length === 0}
            >
              {mutation.isPending ? "추가 중…" : "추가"}
            </Button>
          </>
        }
      />
    </AdminModal>
  );
}


==========================================================================================
# FILE: components/LectureTabs.tsx
==========================================================================================
// PATH: src/features/lectures/components/LectureTabs.tsx
import { useLocation, useNavigate, useParams } from "react-router-dom";
import { Button } from "@/shared/ui/ds";

export default function LectureTabs() {
  const navigate = useNavigate();
  const location = useLocation();
  const { lectureId } = useParams<{ lectureId: string }>();
  if (!lectureId) return null;

  const base = `/admin/lectures/${lectureId}`;

  const activeKey = location.pathname.includes("/materials")
    ? "materials"
    : location.pathname.includes("/board")
    ? "board"
    : location.pathname.includes("/ddays")
    ? "ddays"
    : location.pathname.includes("/attendance")
    ? "attendance"
    : location.pathname.includes("/report")
    ? "report"
    : "students";

  const tabs = [
    { key: "students", label: "수강생", to: base },
    { key: "materials", label: "자료실", to: `${base}/materials` },
    { key: "board", label: "게시판", to: `${base}/board` },
    { key: "ddays", label: "디데이", to: `${base}/ddays` },
    { key: "attendance", label: "출결", to: `${base}/attendance` },
    { key: "report", label: "리포트", to: `${base}/report` },
  ];

  return (
    <div className="ds-tabs flex gap-2">
      {tabs.map((t) => (
        <Button
          key={t.key}
          type="button"
          intent={activeKey === t.key ? "primary" : "ghost"}
          size="sm"
          className="ds-tab text-[15px] font-semibold"
          onClick={() => navigate(t.to)}
        >
          {t.label}
        </Button>
      ))}
    </div>
  );
}


==========================================================================================
# FILE: components/MaterialCategoryModal.tsx
==========================================================================================
// PATH: src/features/lectures/components/MaterialCategoryModal.tsx
import { useEffect, useMemo, useState } from "react";
import { useMutation, useQueryClient } from "@tanstack/react-query";
import { createMaterialCategory } from "../api/materials";

import { AdminModal, ModalBody, ModalFooter, ModalHeader } from "@/shared/ui/modal";
import { Button } from "@/shared/ui/ds";

interface Props {
  lectureId: number;
  onClose: () => void;
}

export default function MaterialCategoryModal({ lectureId, onClose }: Props) {
  const qc = useQueryClient();
  const [name, setName] = useState("");
  const [busy, setBusy] = useState(false);

  const title = useMemo(() => "자료실 카테고리 추가", []);

  const { mutate } = useMutation({
    mutationFn: async () => {
      setBusy(true);
      try {
        return await createMaterialCategory({ lecture: lectureId, name });
      } finally {
        setBusy(false);
      }
    },
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["material-categories", lectureId] });
      onClose();
    },
  });

  useEffect(() => {
    function onKeyDown(e: KeyboardEvent) {
      if (e.key === "Escape") onClose();
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
        if (!busy && name.trim()) mutate();
      }
    }
    window.addEventListener("keydown", onKeyDown);
    return () => window.removeEventListener("keydown", onKeyDown);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [busy, name]);

  return (
    <AdminModal open={true} onClose={onClose} type="action" width={560}>
      <ModalHeader type="action" title={title} description="⌘/Ctrl + Enter 로 저장" />

      <ModalBody>
        <div style={{ display: "grid", gap: 10 }}>
          <input
            className="ds-input"
            placeholder="예: 숙제, 시험, 복습 과제..."
            value={name}
            onChange={(e) => setName(e.target.value)}
            disabled={busy}
            autoFocus
          />
          <div style={{ fontSize: 11, fontWeight: 850, color: "var(--color-text-muted)" }}>
            빈 값은 저장할 수 없습니다.
          </div>
        </div>
      </ModalBody>

      <ModalFooter
        left={
          <span style={{ fontSize: 12, fontWeight: 850, color: "var(--color-text-muted)" }}>
            ESC 로 닫기 · ⌘/Ctrl + Enter 저장
          </span>
        }
        right={
          <>
            <Button intent="secondary" onClick={onClose} disabled={busy}>
              취소
            </Button>
            <Button
              intent="primary"
              onClick={() => {
                if (!name.trim()) return;
                mutate();
              }}
              disabled={busy || !name.trim()}
            >
              {busy ? "저장 중…" : "추가"}
            </Button>
          </>
        }
      />
    </AdminModal>
  );
}


==========================================================================================
# FILE: components/MaterialUploadModal.tsx
==========================================================================================
// PATH: src/features/lectures/components/MaterialUploadModal.tsx
import { useEffect, useMemo, useState } from "react";
import { useMutation, useQueryClient } from "@tanstack/react-query";
import { createMaterial } from "../api/materials";

import { AdminModal, ModalBody, ModalFooter, ModalHeader } from "@/shared/ui/modal";
import { Button } from "@/shared/ui/ds";

interface Props {
  lectureId: number;
  categoryId: number | null;
  onClose: () => void;
}

export default function MaterialUploadModal({ lectureId, categoryId, onClose }: Props) {
  const qc = useQueryClient();

  const [titleInput, setTitleInput] = useState("");
  const [description, setDescription] = useState("");
  const [file, setFile] = useState<File | null>(null);
  const [url, setUrl] = useState("");
  const [busy, setBusy] = useState(false);

  const title = useMemo(() => "자료 추가하기", []);

  const { mutate } = useMutation({
    mutationFn: async () => {
      setBusy(true);
      try {
        const fd = new FormData();
        fd.append("lecture", String(lectureId));
        if (categoryId) fd.append("category", String(categoryId));
        fd.append("title", titleInput || (file ? file.name : "자료"));
        fd.append("description", description);
        if (file) fd.append("file", file);
        if (url) fd.append("url", url);
        fd.append("is_public", "true");
        return await createMaterial(fd);
      } finally {
        setBusy(false);
      }
    },
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["materials", lectureId, categoryId ?? "all"] });
      onClose();
    },
  });

  useEffect(() => {
    function onKeyDown(e: KeyboardEvent) {
      if (e.key === "Escape") onClose();
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
        if (!busy && (file || url.trim())) mutate();
      }
    }
    window.addEventListener("keydown", onKeyDown);
    return () => window.removeEventListener("keydown", onKeyDown);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [busy, file, url, titleInput, description]);

  return (
    <AdminModal open={true} onClose={onClose} type="action" width={920}>
      <ModalHeader type="action" title={title} description="⌘/Ctrl + Enter 로 추가" />

      <ModalBody>
        <div style={{ display: "grid", gap: 12 }}>
          <div style={{ display: "grid", gap: 8 }}>
            <div style={{ fontSize: 12, fontWeight: 900, color: "var(--color-text-secondary)" }}>
              제목
            </div>
            <input
              className="ds-input"
              value={titleInput}
              onChange={(e) => setTitleInput(e.target.value)}
              disabled={busy}
              placeholder="미입력 시 파일명/기본값 사용"
            />
          </div>

          <div style={{ display: "grid", gap: 8 }}>
            <div style={{ fontSize: 12, fontWeight: 900, color: "var(--color-text-secondary)" }}>
              설명
            </div>
            <textarea
              className="ds-textarea"
              rows={4}
              style={{ resize: "none" }}
              value={description}
              onChange={(e) => setDescription(e.target.value)}
              disabled={busy}
            />
          </div>

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
            <div style={{ display: "grid", gap: 8 }}>
              <div style={{ fontSize: 12, fontWeight: 900, color: "var(--color-text-secondary)" }}>
                파일 업로드
              </div>
              <input type="file" onChange={(e) => setFile(e.target.files?.[0] ?? null)} disabled={busy} />
              <div style={{ fontSize: 11, fontWeight: 850, color: "var(--color-text-muted)" }}>
                파일 또는 URL 중 하나 이상 필요합니다.
              </div>
            </div>

            <div style={{ display: "grid", gap: 8 }}>
              <div style={{ fontSize: 12, fontWeight: 900, color: "var(--color-text-secondary)" }}>
                외부 URL
              </div>
              <input
                className="ds-input"
                value={url}
                onChange={(e) => setUrl(e.target.value)}
                disabled={busy}
                placeholder="https://"
              />
            </div>
          </div>
        </div>
      </ModalBody>

      <ModalFooter
        left={
          <span style={{ fontSize: 12, fontWeight: 850, color: "var(--color-text-muted)" }}>
            ESC 로 닫기 · ⌘/Ctrl + Enter 추가
          </span>
        }
        right={
          <>
            <Button intent="secondary" onClick={onClose} disabled={busy}>
              취소
            </Button>
            <Button
              intent="primary"
              onClick={() => {
                if (!file && !url.trim()) return;
                mutate();
              }}
              disabled={busy || (!file && !url.trim())}
            >
              {busy ? "저장 중…" : "추가"}
            </Button>
          </>
        }
      />
    </AdminModal>
  );
}


==========================================================================================
# FILE: components/SessionBar.tsx
==========================================================================================
// PATH: src/features/lectures/components/SessionBar.tsx
import { Link, useLocation } from "react-router-dom";
import { useState } from "react";
import { useQuery } from "@tanstack/react-query";
import api from "@/shared/api/axios";
import SessionCreateModal from "./SessionCreateModal";
import { useLectureParams } from "../hooks/useLectureParams";
import { Button } from "@/shared/ui/ds";

export default function SessionBar() {
  const { lectureId } = useLectureParams();
  const location = useLocation();

  if (!Number.isFinite(lectureId)) return null;

  const [showModal, setShowModal] = useState(false);

  const { data: sessions = [] } = useQuery({
    queryKey: ["lecture-sessions", lectureId],
    queryFn: async () => {
      const res = await api.get(`/lectures/sessions/?lecture=${lectureId}`);
      return res.data.results ?? res.data;
    },
  });

  return (
    <div style={{ marginBottom: 14 }}>
      <div
        style={{
          display: "flex",
          gap: 10,
          overflowX: "auto",
          paddingBottom: 6,
        }}
      >
        {sessions.map((s: any) => {
          const active = location.pathname.includes(`/sessions/${s.id}`);

          return (
            <Link
              key={s.id}
              to={`sessions/${s.id}`}
              style={{
                flex: "0 0 auto",
                minWidth: 168,
                borderRadius: 999,
                border: active ? "1px solid var(--color-primary)" : "1px solid var(--color-border-divider)",
                background: active ? "var(--color-primary)" : "var(--color-bg-surface)",
                padding: "10px 14px",
                textDecoration: "none",
                boxShadow: active ? "0 1px 0 rgba(0,0,0,0.06)" : "none",
              }}
            >
              <div
                style={{
                  fontSize: 13,
                  fontWeight: 950,
                  color: active ? "#fff" : "var(--color-text-primary)",
                  lineHeight: 1.1,
                  whiteSpace: "nowrap",
                }}
              >
                {s.order ?? "?"}차시
              </div>

              <div
                style={{
                  marginTop: 4,
                  fontSize: 11,
                  fontWeight: 850,
                  color: active ? "rgba(255,255,255,0.85)" : "var(--color-text-muted)",
                  whiteSpace: "nowrap",
                  overflow: "hidden",
                  textOverflow: "ellipsis",
                }}
              >
                {s.date || "-"}
              </div>
            </Link>
          );
        })}

        <Button
          intent="ghost"
          onClick={() => setShowModal(true)}
          style={{
            flex: "0 0 auto",
            minWidth: 168,
            borderRadius: 999,
            border: "1px dashed var(--color-border-divider)",
            background: "var(--color-bg-surface)",
            color: "var(--color-text-muted)",
            fontWeight: 900,
          }}
        >
          + 차시 추가
        </Button>
      </div>

      {showModal && (
        <SessionCreateModal
          lectureId={lectureId}
          sessionCount={sessions.length}
          onClose={() => setShowModal(false)}
        />
      )}
    </div>
  );
}


==========================================================================================
# FILE: components/SessionCreateModal.tsx
==========================================================================================
// PATH: src/features/lectures/components/SessionCreateModal.tsx
import { useEffect, useState } from "react";
import { AdminModal, ModalBody, ModalFooter, ModalHeader } from "@/shared/ui/modal";
import { Button } from "@/shared/ui/ds";
import { createSession } from "../api/sessions";

interface Props {
  lectureId: number;
  onClose: () => void;
}

export default function SessionCreateModal({ lectureId, onClose }: Props) {
  const [busy, setBusy] = useState(false);
  const [form, setForm] = useState({
    title: "",
    date: "",
  });

  useEffect(() => {
    function onKeyDown(e: KeyboardEvent) {
      if (e.key === "Escape") onClose();
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") handleSubmit();
    }
    window.addEventListener("keydown", onKeyDown);
    return () => window.removeEventListener("keydown", onKeyDown);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [form, busy]);

  function handleChange(e: any) {
    const { name, value } = e.target;
    setForm((p) => ({ ...p, [name]: value }));
  }

  function validate(): string | null {
    if (!form.title.trim()) return "차시 제목은 필수입니다.";
    return null;
  }

  async function handleSubmit() {
    if (busy) return;
    const err = validate();
    if (err) return alert(err);

    setBusy(true);
    try {
      await createSession(lectureId, form.title, form.date);
      onClose();
    } finally {
      setBusy(false);
    }
  }

  return (
    <AdminModal open={true} onClose={onClose} type="action" width={560}>
      <ModalHeader
        type="action"
        title="차시 추가"
        description="⌘/Ctrl + Enter 로 저장"
      />

      <ModalBody>
        <div style={{ display: "grid", gap: 12 }}>
          <input
            name="title"
            placeholder="차시 제목"
            value={form.title}
            onChange={handleChange}
            className="ds-input"
            data-required="true"
            data-invalid={!form.title.trim() ? "true" : "false"}
            disabled={busy}
            autoFocus
          />

          <input
            name="date"
            type="date"
            value={form.date}
            onChange={handleChange}
            className="ds-input"
            disabled={busy}
          />
        </div>
      </ModalBody>

      <ModalFooter
        left={
          <span
            style={{
              fontSize: 12,
              fontWeight: 850,
              color: "var(--color-text-muted)",
            }}
          >
            ESC 로 닫기
          </span>
        }
        right={
          <>
            <Button intent="secondary" onClick={onClose} disabled={busy}>
              취소
            </Button>
            <Button intent="primary" onClick={handleSubmit} disabled={busy}>
              {busy ? "저장 중…" : "저장"}
            </Button>
          </>
        }
      />
    </AdminModal>
  );
}


==========================================================================================
# FILE: components/SessionVideosTab.tsx
==========================================================================================
// PATH: src/features/lectures/components/SessionVideosTab.tsx
import { useState } from "react";
import { Link } from "react-router-dom";
import { useMutation, useQueryClient } from "@tanstack/react-query";

import api from "@/shared/api/axios";
import VideoUploadModal from "@/features/videos/components/features/video-detail/modals/VideoUploadModal";
import VideoThumbnail from "@/features/videos/ui/VideoThumbnail";
import VideoStatusBadge from "@/features/videos/ui/VideoStatusBadge";

import { useSessionVideos } from "../hooks/useSessionVideos";
import { Button, EmptyState } from "@/shared/ui/ds";
import { DomainListToolbar } from "@/shared/ui/domain";

/**
 * media 도메인 기준 Video 타입 (관리자 목록용)
 * ⚠️ status 필드 반드시 포함
 */
export interface MediaVideo {
  id: number;
  title: string;
  file: string | null;
  file_key?: string | null;

  source_type: "s3" | "file" | "youtube" | "external" | "unknown";

  youtube_id?: string | null;
  external_url?: string | null;

  duration?: number | null;
  file_size?: number | null;
  thumbnail_url?: string | null;

  allow_skip: boolean;
  max_speed: number;
  show_watermark: boolean;

  status?: "PENDING" | "UPLOADED" | "PROCESSING" | "READY" | "FAILED";

  created_at: string;
}

interface SessionVideosTabProps {
  sessionId: number;
}

export default function SessionVideosTab({ sessionId }: SessionVideosTabProps) {
  const qc = useQueryClient();
  const [showModal, setShowModal] = useState(false);

  const { data: videos = [], isLoading } = useSessionVideos(sessionId);

  const deleteMutation = useMutation({
    mutationFn: async (id: number) => {
      await api.delete(`/media/videos/${id}/`);
    },
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["session-videos", sessionId] });
    },
  });

  const retryMutation = useMutation({
    mutationFn: async (id: number) => {
      await api.post(`/media/videos/${id}/retry/`);
    },
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: ["session-videos", sessionId] });
    },
  });

  return (
    <div className="flex flex-col gap-4">
      <DomainListToolbar
        totalLabel={isLoading ? "…" : `총 ${videos.length}개`}
        searchSlot={null}
        primaryAction={
          <Button intent="primary" onClick={() => setShowModal(true)}>
            영상 추가
          </Button>
        }
      />

      <div
        className="ds-panel"
        style={{
          borderRadius: "var(--radius-xl)",
          border: "1px solid var(--color-border-divider)",
          background: "var(--color-bg-surface)",
          padding: "var(--space-4)",
        }}
      >
        {isLoading ? (
          <EmptyState mode="embedded" scope="panel" tone="loading" title="불러오는 중…" />
        ) : videos.length === 0 ? (
          <EmptyState mode="embedded" scope="panel" title="등록된 영상이 없습니다." />
        ) : (
          <div
            style={{
              display: "grid",
              gridTemplateColumns: "repeat(auto-fill, minmax(280px, 1fr))",
              gap: "var(--space-4)",
            }}
          >
            {videos.map((video: MediaVideo) => {
              const fileSize =
                video.file_size && video.file_size > 0 ? `${(video.file_size / 1024 / 1024).toFixed(2)}MB` : "-";

              const uploadDate = video.created_at
                ? new Date(video.created_at).toLocaleString("ko-KR", {
                    year: "2-digit",
                    month: "2-digit",
                    day: "2-digit",
                    hour: "2-digit",
                    minute: "2-digit",
                    hour12: false,
                  })
                : "-";

              return (
                <div
                  key={video.id}
                  style={{
                    borderRadius: 14,
                    border: "1px solid var(--color-border-divider)",
                    background: "var(--color-bg-app)",
                    padding: 12,
                    transition: "background 120ms ease",
                  }}
                >
                  <Link to={`${video.id}`} style={{ textDecoration: "none" }}>
                    <VideoThumbnail
                      title={video.title}
                      status={video.status ?? "PENDING"}
                      thumbnail_url={video.thumbnail_url}
                    />
                  </Link>

                  <div style={{ marginTop: 10, display: "flex", alignItems: "flex-start", justifyContent: "space-between", gap: 10 }}>
                    <div style={{ minWidth: 0 }}>
                      <div
                        style={{
                          fontSize: 14,
                          fontWeight: 950,
                          color: "var(--color-text-primary)",
                          whiteSpace: "nowrap",
                          overflow: "hidden",
                          textOverflow: "ellipsis",
                        }}
                      >
                        {video.title}
                      </div>

                      {fileSize !== "-" && (
                        <div style={{ marginTop: 2, fontSize: 11, fontWeight: 850, color: "var(--color-text-muted)" }}>
                          {fileSize} · {uploadDate}
                        </div>
                      )}
                    </div>

                    <div style={{ flex: "0 0 auto" }}>
                      <VideoStatusBadge status={video.status} />
                    </div>
                  </div>

                  <div
                    style={{
                      marginTop: 8,
                      display: "flex",
                      flexWrap: "wrap",
                      alignItems: "center",
                      gap: 8,
                      fontSize: 11,
                      fontWeight: 850,
                      color: "var(--color-text-secondary)",
                    }}
                  >
                    <span>
                      워터마크:{" "}
                      <span style={{ fontWeight: 950, color: video.show_watermark ? "var(--color-primary)" : "var(--color-text-muted)" }}>
                        {video.show_watermark ? "표시" : "숨김"}
                      </span>
                    </span>

                    <span style={{ color: "var(--color-text-muted)" }}>·</span>

                    <span>
                      건너뛰기:{" "}
                      <span style={{ fontWeight: 950, color: video.allow_skip ? "var(--color-text-muted)" : "var(--color-primary)" }}>
                        {video.allow_skip ? "허용" : "금지"}
                      </span>
                    </span>

                    <span style={{ color: "var(--color-text-muted)" }}>·</span>

                    <span>
                      배속:{" "}
                      <span style={{ fontWeight: 950, color: video.max_speed > 1.0 ? "var(--color-text-muted)" : "var(--color-primary)" }}>
                        {video.max_speed.toFixed(2)}x
                      </span>
                    </span>
                  </div>

                  <div style={{ marginTop: 10, display: "flex", justifyContent: "flex-end", gap: 8 }}>
                    {video.status === "FAILED" && (
                      <Button
                        intent="primary"
                        size="sm"
                        disabled={retryMutation.isPending}
                        onClick={(e) => {
                          e.preventDefault();
                          e.stopPropagation();
                          if (window.confirm("영상 처리를 다시 시도할까요?")) {
                            retryMutation.mutate(video.id);
                          }
                        }}
                      >
                        재처리
                      </Button>
                    )}

                    <Button
                      intent="ghost"
                      size="sm"
                      disabled={deleteMutation.isPending}
                      onClick={(e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        if (window.confirm("정말 삭제하시겠습니까?")) {
                          deleteMutation.mutate(video.id);
                        }
                      }}
                    >
                      삭제
                    </Button>
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </div>

      <VideoUploadModal sessionId={sessionId} isOpen={showModal} onClose={() => setShowModal(false)} />
    </div>
  );
}


==========================================================================================
# FILE: hooks/useLectureEnrollments.ts
==========================================================================================
// PATH: src/features/lectures/hooks/useLectureEnrollments.ts
import { useQuery } from "@tanstack/react-query";
import { fetchLectureEnrollments } from "../api/enrollments";

export function useLectureEnrollments(lectureId: number) {
  return useQuery({
    queryKey: ["lecture-enrollments", lectureId],
    queryFn: () => fetchLectureEnrollments(lectureId),
    enabled: !!lectureId,
  });
}


==========================================================================================
# FILE: hooks/useLectureParams.ts
==========================================================================================
// PATH: src/features/lectures/hooks/useLectureParams.ts
import { useParams } from "react-router-dom";

export function useLectureParams() {
  const { lectureId, sessionId } = useParams<{
    lectureId?: string;
    sessionId?: string;
  }>();

  const parsedLectureId = Number(lectureId);
  const parsedSessionId = sessionId ? Number(sessionId) : undefined;

  return {
    lectureId: parsedLectureId,
    sessionId: parsedSessionId,
  };
}


==========================================================================================
# FILE: hooks/useSessionVideos.ts
==========================================================================================
// PATH: src/features/lectures/hooks/useSessionVideos.ts
import { useQuery } from "@tanstack/react-query";
import api from "@/shared/api/axios";

/**
 * Session 기준 media/videos 조회 + 상태 polling
 *
 * - READY / FAILED 아닌 영상이 있으면 2초 polling
 * - 전부 READY/FAILED면 polling 중단
 */
export function useSessionVideos(sessionId: number) {
  return useQuery({
    queryKey: ["session-videos", sessionId],
    enabled: !!sessionId,

    queryFn: async () => {
      const res = await api.get("/media/videos/", {
        params: { session_id: sessionId },
      });
      return res.data.results ?? res.data;
    },

    refetchInterval: (query) => {
      const videos = query.state.data as any[] | undefined;
      if (!videos || videos.length === 0) return false;

      const hasProcessing = videos.some(
        (v) => v.status === "PENDING" || v.status === "UPLOADED" || v.status === "PROCESSING"
      );

      return hasProcessing ? 2000 : false;
    },
  });
}


==========================================================================================
# FILE: layout/LectureLayout.tsx
==========================================================================================
// PATH: src/features/lectures/layout/LectureLayout.tsx
import { Outlet, useParams } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";
import { useMemo } from "react";
import api from "@/shared/api/axios";
import { DomainLayout } from "@/shared/ui/layout";
import SessionBlock from "@/features/sessions/components/SessionBlock";

function safeStr(v: any) {
  return typeof v === "string" ? v : v == null ? "" : String(v);
}

export default function LectureLayout() {
  const { lectureId } = useParams<{ lectureId: string }>();
  const lectureIdNum = Number(lectureId);

  if (!Number.isFinite(lectureIdNum)) {
    return (
      <DomainLayout title="강의" description="잘못된 강의 ID">
        <div className="p-4 text-sm" style={{ color: "var(--color-error)" }}>
          잘못된 강의 ID
        </div>
      </DomainLayout>
    );
  }

  const { data: lecture, isLoading } = useQuery({
    queryKey: ["lecture", lectureIdNum],
    queryFn: async () => (await api.get(`/lectures/lectures/${lectureIdNum}/`)).data,
    enabled: Number.isFinite(lectureIdNum),
  });

  const title = isLoading ? "강의 불러오는 중…" : safeStr(lecture?.title) || "강의";
  const desc = isLoading
    ? "데이터를 불러오는 중입니다."
    : [
        safeStr(lecture?.subject),
        safeStr(lecture?.name),
        lecture?.start_date && lecture?.end_date
          ? `${lecture.start_date} ~ ${lecture.end_date}`
          : "",
      ]
        .filter(Boolean)
        .join(" · ") || "수강생 · 자료 · 출결 · 리포트";

  const base = `/admin/lectures/${lectureId}`;
  const tabs = useMemo(
    () => [
      { key: "students", label: "수강생", path: base, exact: true },
      { key: "materials", label: "자료실", path: `${base}/materials` },
      { key: "board", label: "게시판", path: `${base}/board` },
      { key: "ddays", label: "디데이", path: `${base}/ddays` },
      { key: "attendance", label: "출결", path: `${base}/attendance` },
      { key: "report", label: "리포트", path: `${base}/report` },
    ],
    [base]
  );

  const breadcrumbs = useMemo(
    () => [
      { label: "강의", to: "/admin/lectures" },
      { label: title },
    ],
    [title]
  );

  return (
    <DomainLayout title={title} description={desc} breadcrumbs={breadcrumbs} tabs={tabs}>
      <SessionBlock lectureId={lectureIdNum} />
      <Outlet />
    </DomainLayout>
  );
}


==========================================================================================
# FILE: layout/LecturesLayout.tsx
==========================================================================================
// PATH: src/features/lectures/layout/LecturesLayout.tsx
import { Outlet } from "react-router-dom";
import { DomainLayout } from "@/shared/ui/layout";

const LECTURES_TABS = [
  { key: "list", label: "강의목록", path: "/admin/lectures", exact: true },
  { key: "past", label: "지난강의", path: "/admin/lectures/past" },
];

export default function LecturesLayout() {
  return (
    <DomainLayout
      title="강의 관리"
      description="강의 목록 · 지난 강의 · 수강생 · 출결 · 리포트"
      tabs={LECTURES_TABS}
    >
      <Outlet />
    </DomainLayout>
  );
}


==========================================================================================
# FILE: pages/attendance/LectureAttendanceMatrixPage.tsx
==========================================================================================
// PATH: src/features/lectures/pages/attendance/LectureAttendanceMatrixPage.tsx
import { useParams } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";
import { fetchAttendanceMatrix, type AttendanceMatrixRow } from "@/features/lectures/api/attendance";
import { EmptyState } from "@/shared/ui/ds";

const TH_STYLE = {
  background: "color-mix(in srgb, var(--color-primary) 12%, var(--bg-surface))",
  color: "var(--color-text-muted)",
};

export default function LectureAttendanceMatrixPage() {
  const { lectureId } = useParams<{ lectureId: string }>();
  const lectureIdNum = Number(lectureId);

  const { data, isLoading } = useQuery<AttendanceMatrixRow[]>({
    queryKey: ["attendance-matrix", lectureIdNum],
    queryFn: () => fetchAttendanceMatrix(lectureIdNum),
    enabled: Number.isFinite(lectureIdNum),
  });

  if (isLoading) return <EmptyState scope="panel" tone="loading" title="불러오는 중…" />;
  if (!data || data.length === 0)
    return (
      <EmptyState
        scope="panel"
        title="출결 데이터가 없습니다."
        description="차시 또는 출결 데이터가 아직 없습니다."
      />
    );

  return (
    <div style={{ overflowX: "auto" }}>
      <div style={{ overflow: "hidden", borderRadius: 14, border: "1px solid var(--color-border-divider)" }}>
        <table className="w-full" style={{ tableLayout: "fixed" }}>
          <thead>
            <tr>
              <th
                className="px-4 py-3 text-sm font-semibold border-b border-[var(--color-border-divider)]"
                style={{ textAlign: "left", whiteSpace: "nowrap", ...TH_STYLE }}
              >
                학생
              </th>

              {data[0].sessions.map((s) => (
                <th
                  key={s.session_id}
                  className="px-3 py-3 text-sm font-semibold border-b border-[var(--color-border-divider)]"
                  style={{ textAlign: "center", whiteSpace: "nowrap", ...TH_STYLE }}
                >
                  {s.title}
                </th>
              ))}
            </tr>
          </thead>

          <tbody className="divide-y divide-[var(--color-border-divider)]">
            {data.map((row) => (
              <tr key={row.student_id} className="hover:bg-[var(--color-bg-surface-soft)]">
                <td className="px-4 py-3 text-left text-[15px] font-bold text-[var(--color-text-primary)] truncate">
                  {row.student_name}
                </td>

                {row.sessions.map((s) => (
                  <td
                    key={s.session_id}
                    className="px-3 py-3 text-center text-[13px] font-semibold text-[var(--color-text-secondary)]"
                  >
                    {s.status_label ?? "-"}
                  </td>
                ))}
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: pages/attendance/SessionAttendancePage.tsx
==========================================================================================
// PATH: src/features/lectures/pages/attendance/SessionAttendancePage.tsx
import React, { useState, useMemo } from "react";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import { fetchAttendance, updateAttendance } from "@/features/lectures/api/attendance";
import { EmptyState, Button } from "@/shared/ui/ds";
import { DomainTable } from "@/shared/ui/domain";
import AttendanceStatusBadge from "@/shared/ui/badges/AttendanceStatusBadge";
import { formatPhone } from "@/shared/utils/formatPhone";

const STATUS_LIST = [
  "PRESENT",      // 현장
  "ONLINE",       // 영상
  "SUPPLEMENT",   // 보강
  "MATERIAL",     // 자료
  "LATE",         // 지각
  "EARLY_LEAVE",  // 조퇴
  "RUNAWAY",      // 출튀
  "ABSENT",       // 결석
] as const;

type AttendanceStatus = (typeof STATUS_LIST)[number];

export default function SessionAttendancePage({ sessionId }: { sessionId: number }) {
  const qc = useQueryClient();
  const [selectedIds, setSelectedIds] = useState<number[]>([]);

  const { data: attendance, isLoading } = useQuery({
    queryKey: ["attendance", sessionId],
    queryFn: () => fetchAttendance(sessionId),
    enabled: Number.isFinite(sessionId),
  });

  const updateStatus = useMutation({
    mutationFn: ({ id, status }: { id: number; status: AttendanceStatus }) =>
      updateAttendance(id, { status }),
    onSuccess: () => qc.invalidateQueries({ queryKey: ["attendance", sessionId] }),
  });

  const updateMemo = useMutation({
    mutationFn: ({ id, memo }: { id: number; memo: string }) =>
      updateAttendance(id, { memo }),
    onSuccess: () => qc.invalidateQueries({ queryKey: ["attendance", sessionId] }),
  });

  if (isLoading) return <EmptyState scope="panel" tone="loading" title="불러오는 중…" />;
  if (!attendance || attendance.length === 0) return <EmptyState scope="panel" title="출결 데이터 없음" />;

  const selectedSet = useMemo(() => new Set(selectedIds), [selectedIds]);
  const allIds = attendance.map((att: any) => att.id);
  const allSelected = attendance.length > 0 && allIds.every((id: number) => selectedSet.has(id));

  function toggleSelect(id: number) {
    if (selectedSet.has(id)) setSelectedIds(selectedIds.filter((x) => x !== id));
    else setSelectedIds([...selectedIds, id]);
  }
  function toggleSelectAll() {
    if (allSelected) setSelectedIds([]);
    else setSelectedIds([...allIds]);
  }

  const selectionBar = (
    <div className="flex flex-wrap items-center gap-2">
      <span
        className="text-[13px] font-semibold"
        style={{
          color: selectedIds.length > 0 ? "var(--color-primary)" : "var(--color-text-muted)",
        }}
      >
        {selectedIds.length}명 선택됨
      </span>
      <span className="text-[var(--color-border-divider)]">|</span>
      <Button intent="secondary" size="sm" onClick={() => setSelectedIds([])} disabled={selectedIds.length === 0}>
        선택 해제
      </Button>
    </div>
  );

  return (
    <div className="flex flex-col gap-4">
      {selectionBar}
      <DomainTable tableClassName="ds-table--flat" tableStyle={{ minWidth: 1232, width: "100%", tableLayout: "fixed" }}>
        <colgroup>
          <col style={{ width: 48 }} />
          <col style={{ width: 144 }} />
          <col style={{ width: 100 }} />
          <col style={{ width: 75 }} />
          <col style={{ width: 75 }} />
          <col style={{ width: 520 }} />
          <col style={{ width: 360 }} />
        </colgroup>
        <thead>
          <tr>
            <th scope="col" className="ds-checkbox-cell" style={{ width: 48 }} onClick={(e) => e.stopPropagation()}>
              <input
                type="checkbox"
                checked={allSelected}
                onChange={toggleSelectAll}
                aria-label="전체 선택"
                className="cursor-pointer"
              />
            </th>
            <th scope="col">이름</th>
            <th scope="col" className="text-center">상태</th>
            <th scope="col">학생 전화번호</th>
            <th scope="col">학부모 전화번호</th>
            <th scope="col">출결 변경</th>
            <th scope="col">메모</th>
          </tr>
        </thead>

          <tbody>
            {attendance.map((att: any) => (
              <tr key={att.id} className={selectedSet.has(att.id) ? "ds-row-selected" : ""}>
                <td className="ds-checkbox-cell" style={{ width: 48 }} onClick={(e) => e.stopPropagation()}>
                  <input
                    type="checkbox"
                    checked={selectedSet.has(att.id)}
                    onChange={() => toggleSelect(att.id)}
                    onClick={(e) => e.stopPropagation()}
                    aria-label={`${att.name} 선택`}
                    className="cursor-pointer"
                  />
                </td>
                <td className="text-left text-[15px] font-bold text-[var(--color-text-primary)] truncate">
                  {att.name}
                </td>

                <td className="text-center">
                  <AttendanceStatusBadge status={att.status} />
                </td>

                <td className="text-left text-[14px] text-[var(--color-text-secondary)] truncate">
                  {formatPhone(att.phone ?? att.student_phone)}
                </td>

                <td className="text-left text-[14px] text-[var(--color-text-muted)] truncate">
                  {formatPhone(att.parent_phone)}
                </td>

                <td>
                  <div style={{ display: "flex", flexWrap: "nowrap", gap: 8, width: "fit-content" }}>
                    {STATUS_LIST.map((code) => {
                      const active = att.status === code;
                      return (
                        <div
                          key={code}
                          role="button"
                          aria-pressed={active}
                          onClick={() => {
                            if (active) return;
                            updateStatus.mutate({ id: att.id, status: code });
                          }}
                          style={{
                            cursor: active ? "default" : "pointer",
                            opacity: active ? 1 : 0.7,
                            transition: "opacity 120ms ease",
                          }}
                          onMouseEnter={(e) => {
                            if (!active) (e.currentTarget as HTMLDivElement).style.opacity = "1";
                          }}
                          onMouseLeave={(e) => {
                            if (!active) (e.currentTarget as HTMLDivElement).style.opacity = "0.7";
                          }}
                        >
                          <AttendanceStatusBadge status={code} />
                        </div>
                      );
                    })}
                  </div>
                </td>

                <td>
                  <input
                    defaultValue={att.memo || ""}
                    placeholder="메모 입력"
                    className="ds-input w-full"
                    onBlur={(e) => updateMemo.mutate({ id: att.id, memo: e.target.value })}
                  />
                </td>
              </tr>
            ))}
          </tbody>
        </DomainTable>
    </div>
  );
}


==========================================================================================
# FILE: pages/attendance/attendanceMatrix.css
==========================================================================================
/* PATH: src/features/lectures/pages/attendance/attendanceMatrix.css */
/**
 * ⚠️ Legacy CSS (유지)
 * - 기능 로직 영향 없음
 * - 하드코딩 색상 제거 → 전역 디자인 토큰 기반으로 정합성 통일
 */

/* ===== 테이블 기본 ===== */
.attendance-table {
  min-width: 100%;
  border-collapse: collapse;
  font-size: 0.875rem;
}

.attendance-table th,
.attendance-table td {
  border: 1px solid var(--color-border-divider);
  padding: 0.5rem 0.75rem;
  text-align: center;
  color: var(--color-text-secondary);
}

.attendance-table th {
  background: var(--color-bg-surface-hover);
  color: var(--color-text-secondary);
  font-weight: 900;
}

/* ===== Sticky ===== */
.attendance-sticky-header {
  position: sticky;
  top: 0;
  background: var(--color-bg-surface-hover);
  z-index: 10;
}

.attendance-sticky-student {
  position: sticky;
  left: 0;
  background: var(--color-bg-surface);
  z-index: 20;
  font-weight: 900;
  color: var(--color-text-primary);
}

/* ===== Hover ===== */
.attendance-row:hover {
  background: var(--color-bg-surface-soft);
}

/* ===== Status Tokens (시각만 담당, 의미/코드 변경 없음) ===== */
/* NOTE:
 * 실제 상태 컬러는 "status pills / buttons"에서 이미 정의될 수 있음.
 * 여기 CSS는 매트릭스/레거시 테이블용 기본 톤만 제공.
 */
.status-present {
  background: color-mix(in srgb, var(--color-primary) 12%, var(--color-bg-surface));
  color: var(--color-primary);
  font-weight: 900;
}

.status-late {
  background: var(--color-bg-surface-soft);
  color: var(--color-text-secondary);
  font-weight: 900;
}

.status-online {
  background: var(--color-bg-surface-soft);
  color: var(--color-text-secondary);
  font-weight: 900;
}

.status-supplement {
  background: var(--color-bg-surface-soft);
  color: var(--color-text-secondary);
  font-weight: 900;
}

.status-early-leave {
  background: var(--color-bg-surface-soft);
  color: var(--color-text-secondary);
  font-weight: 900;
}

.status-absent {
  background: color-mix(in srgb, var(--color-error) 10%, var(--color-bg-surface));
  color: var(--color-error);
  font-weight: 900;
}

.status-runaway {
  background: color-mix(in srgb, var(--color-error) 12%, var(--color-bg-surface));
  color: var(--color-error);
  font-weight: 900;
}

.status-material {
  background: var(--color-bg-surface-soft);
  color: var(--color-text-secondary);
  font-weight: 900;
}

.status-inactive {
  background: var(--color-bg-surface-soft);
  color: var(--color-text-muted);
  font-weight: 900;
}

.status-secession {
  background: var(--color-bg-surface-soft);
  color: var(--color-text-muted);
  font-weight: 900;
  text-decoration: line-through;
}

/* ===== Interaction ===== */
.attendance-cell {
  cursor: pointer;
  user-select: none;
}

.attendance-cell.disabled {
  cursor: not-allowed;
}

.attendance-cell.updating {
  opacity: 0.5;
  cursor: wait;
}


==========================================================================================
# FILE: pages/boards/LectureBoardPage.tsx
==========================================================================================
// PATH: src/features/lectures/pages/boards/LectureBoardPage.tsx
import { useMemo, useState } from "react";
import { useParams } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";

import { BoardCategory, BoardPost, fetchBoardCategories, fetchBoardPosts } from "../../api/board";
import BoardCategoryModal from "../../components/BoardCategoryModal";
import BoardPostModal from "../../components/BoardPostModal";
import BoardPostDetail from "../../components/BoardPostDetail";
import { EmptyState, Button } from "@/shared/ui/ds";

const TH_STYLE = {
  background: "color-mix(in srgb, var(--color-primary) 12%, var(--bg-surface))",
  color: "var(--color-text-muted)",
};

export default function LectureBoardPage() {
  const { lectureId } = useParams<{ lectureId: string }>();
  const lectureIdNum = Number(lectureId);

  const [selectedCategory, setSelectedCategory] = useState<BoardCategory | null>(null);
  const [showCategoryModal, setShowCategoryModal] = useState(false);
  const [showPostModal, setShowPostModal] = useState(false);
  const [openedPost, setOpenedPost] = useState<BoardPost | null>(null);

  const { data: categories = [], isLoading: loadingCats } = useQuery<BoardCategory[]>({
    queryKey: ["board-categories", lectureIdNum],
    queryFn: () => fetchBoardCategories(lectureIdNum),
    enabled: Number.isFinite(lectureIdNum),
    onSuccess: (data) => {
      if (!selectedCategory && data.length > 0) setSelectedCategory(data[0]);
    },
  });

  const { data: posts = [], isLoading: loadingPosts } = useQuery<BoardPost[]>({
    queryKey: ["board-posts", lectureIdNum, selectedCategory?.id ?? "none"],
    queryFn: () =>
      fetchBoardPosts({
        lecture: lectureIdNum,
        category: selectedCategory?.id,
      }),
    enabled: Number.isFinite(lectureIdNum) && !!selectedCategory,
  });

  const categoryTitle = useMemo(() => selectedCategory?.name ?? "카테고리", [selectedCategory]);

  return (
    <>
      {/* 액션바 */}
      <div className="flex items-center gap-2 mb-3">
        <Button intent="secondary" onClick={() => setShowCategoryModal(true)}>
          카테고리 추가
        </Button>
        <Button intent="primary" onClick={() => setShowPostModal(true)} disabled={!selectedCategory}>
          글 작성
        </Button>

        <span className="ml-auto text-sm font-semibold text-[var(--color-text-muted)]">
          {loadingPosts ? "불러오는 중…" : `${posts.length}개`}
        </span>
      </div>

      <div style={{ display: "grid", gridTemplateColumns: "240px 1fr", gap: 16 }}>
        {/* LEFT */}
        <div
          style={{
            borderRadius: 18,
            border: "1px solid var(--color-border-divider)",
            background: "var(--color-bg-surface)",
            padding: 12,
          }}
        >
          <div className="flex items-center justify-between mb-2">
            <span style={{ fontSize: 12, fontWeight: 900, color: "var(--color-text-muted)" }}>
              게시판 목록
            </span>
            <Button intent="ghost" size="sm" onClick={() => setShowCategoryModal(true)}>
              + 추가
            </Button>
          </div>

          {loadingCats ? (
            <EmptyState mode="embedded" scope="panel" tone="loading" title="불러오는 중…" />
          ) : categories.length === 0 ? (
            <EmptyState
              mode="embedded"
              scope="panel"
              title="카테고리가 없습니다."
              description="카테고리를 먼저 추가해 주세요."
            />
          ) : (
            <div style={{ display: "grid", gap: 6 }}>
              {categories.map((cat) => {
                const active = selectedCategory?.id === cat.id;
                return (
                  <Button
                    key={cat.id}
                    intent={active ? "secondary" : "ghost"}
                    size="md"
                    onClick={() => setSelectedCategory(cat)}
                    aria-pressed={active}
                    style={{ justifyContent: "flex-start" }}
                  >
                    {cat.name}
                  </Button>
                );
              })}
            </div>
          )}
        </div>

        {/* RIGHT */}
        <div
          style={{
            borderRadius: 18,
            border: "1px solid var(--color-border-divider)",
            background: "var(--color-bg-surface)",
            padding: 12,
            overflow: "hidden",
          }}
        >
          <div className="flex items-baseline justify-between mb-2">
            <div style={{ fontSize: 12, fontWeight: 900, color: "var(--color-text-secondary)" }}>
              {selectedCategory ? `${categoryTitle}` : "게시글"}
            </div>
            <div style={{ fontSize: 11, fontWeight: 850, color: "var(--color-text-muted)" }}>
              {loadingPosts ? "불러오는 중…" : `${posts.length}개`}
            </div>
          </div>

          {loadingPosts ? (
            <EmptyState scope="panel" tone="loading" title="불러오는 중…" />
          ) : !selectedCategory || posts.length === 0 ? (
            <EmptyState title="등록된 글이 없습니다." description="게시글을 작성하면 여기에 표시됩니다." scope="panel" />
          ) : (
            <div style={{ overflow: "hidden", borderRadius: 14, border: "1px solid var(--color-border-divider)" }}>
              <table className="w-full" style={{ tableLayout: "fixed" }}>
                <thead>
                  <tr>
                    <th
                      className="px-4 py-3 text-sm font-semibold border-b border-[var(--color-border-divider)]"
                      style={{ textAlign: "left", whiteSpace: "nowrap", ...TH_STYLE }}
                    >
                      제목
                    </th>
                    <th
                      className="px-4 py-3 text-sm font-semibold border-b border-[var(--color-border-divider)]"
                      style={{ textAlign: "center", whiteSpace: "nowrap", width: 140, ...TH_STYLE }}
                    >
                      작성일
                    </th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-[var(--color-border-divider)]">
                  {posts.map((p) => (
                    <tr
                      key={p.id}
                      onClick={() => setOpenedPost(p)}
                      tabIndex={0}
                      role="button"
                      className="cursor-pointer hover:bg-[var(--color-bg-surface-soft)] focus:outline-none focus-visible:ring-2 focus-visible:ring-[var(--color-border-focus)]/40"
                    >
                      <td className="px-4 py-3 text-left text-[15px] font-bold text-[var(--color-text-primary)] truncate">
                        {p.title}
                      </td>
                      <td className="px-4 py-3 text-center text-[13px] font-semibold text-[var(--color-text-muted)] truncate">
                        {p.created_at.slice(0, 10)}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </div>
      </div>

      {showCategoryModal && <BoardCategoryModal lectureId={lectureIdNum} isOpen={true} onClose={() => setShowCategoryModal(false)} />}
      {showPostModal && selectedCategory && (
        <BoardPostModal lectureId={lectureIdNum} category={selectedCategory} onClose={() => setShowPostModal(false)} />
      )}
      {openedPost && <BoardPostDetail lectureId={lectureIdNum} post={openedPost} onClose={() => setOpenedPost(null)} />}
    </>
  );
}


==========================================================================================
# FILE: pages/ddays/LectureDdayPage.tsx
==========================================================================================
// PATH: src/features/lectures/pages/ddays/LectureDdayPage.tsx
import { useState } from "react";
import { useParams } from "react-router-dom";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";

import { fetchDdays, deleteDday, type Dday } from "@/features/lectures/api/ddays";
import DdayModal from "@/features/lectures/components/DdayModal";
import { EmptyState, Button } from "@/shared/ui/ds";

const TH_STYLE = {
  background: "color-mix(in srgb, var(--color-primary) 12%, var(--bg-surface))",
  color: "var(--color-text-muted)",
};

export default function LectureDdayPage() {
  const { lectureId } = useParams<{ lectureId: string }>();
  const lectureIdNum = Number(lectureId);
  const qc = useQueryClient();

  const [showModal, setShowModal] = useState(false);

  const { data: ddays = [], isLoading } = useQuery<Dday[]>({
    queryKey: ["ddays", lectureIdNum],
    queryFn: () => fetchDdays(lectureIdNum),
    enabled: Number.isFinite(lectureIdNum),
  });

  const deleteMutation = useMutation({
    mutationFn: (id: number) => deleteDday(id),
    onSuccess: () => qc.invalidateQueries({ queryKey: ["ddays", lectureIdNum] }),
  });

  return (
    <>
      <div className="flex items-center gap-2 mb-3">
        <Button intent="primary" onClick={() => setShowModal(true)}>
          D-Day 추가
        </Button>
        <span className="ml-auto text-sm font-semibold text-[var(--color-text-muted)]">
          {isLoading ? "불러오는 중…" : `${ddays.length}개`}
        </span>
      </div>

      {isLoading ? (
        <EmptyState scope="panel" tone="loading" title="불러오는 중…" />
      ) : ddays.length === 0 ? (
        <EmptyState scope="panel" title="등록된 D-Day가 없습니다." />
      ) : (
        <div style={{ overflow: "hidden", borderRadius: 14, border: "1px solid var(--color-border-divider)" }}>
          <table className="w-full" style={{ tableLayout: "fixed" }}>
            <thead>
              <tr>
                <th
                  className="px-4 py-3 text-sm font-semibold border-b border-[var(--color-border-divider)]"
                  style={{ textAlign: "left", whiteSpace: "nowrap", ...TH_STYLE }}
                >
                  제목
                </th>
                <th
                  className="px-4 py-3 text-sm font-semibold border-b border-[var(--color-border-divider)]"
                  style={{ textAlign: "center", whiteSpace: "nowrap", width: 220, ...TH_STYLE }}
                >
                  날짜
                </th>
                <th
                  className="px-4 py-3 text-sm font-semibold border-b border-[var(--color-border-divider)]"
                  style={{ textAlign: "center", whiteSpace: "nowrap", width: 120, ...TH_STYLE }}
                >
                  관리
                </th>
              </tr>
            </thead>

            <tbody className="divide-y divide-[var(--color-border-divider)]">
              {ddays.map((d) => (
                <tr key={d.id} className="hover:bg-[var(--color-bg-surface-soft)]">
                  <td className="px-4 py-3 text-left text-[15px] font-bold text-[var(--color-text-primary)] truncate">
                    {d.title}
                  </td>
                  <td className="px-4 py-3 text-center text-[14px] text-[var(--color-text-secondary)] truncate">
                    {new Date(d.date).toLocaleString("ko-KR")}
                  </td>
                  <td className="px-4 py-3 text-center">
                    <Button
                      intent="danger"
                      size="sm"
                      disabled={deleteMutation.isPending}
                      onClick={() => {
                        if (window.confirm("삭제하시겠습니까?")) deleteMutation.mutate(d.id);
                      }}
                    >
                      삭제
                    </Button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      )}

      {showModal && <DdayModal lectureId={lectureIdNum} onClose={() => setShowModal(false)} />}
    </>
  );
}


==========================================================================================
# FILE: pages/exams/SessionExamsRoute.tsx
==========================================================================================
// PATH: src/features/lectures/pages/exams/SessionExamsRoute.tsx
import { useParams } from "react-router-dom";
import SessionExamsPage from "./SessionExamsPage";

export default function SessionExamsRoute() {
  const { sessionId } = useParams<{ sessionId: string }>();
  const sid = Number(sessionId);

  if (!Number.isFinite(sid)) {
    return <div className="p-4 text-sm" style={{ color: "var(--color-error)" }}>잘못된 sessionId</div>;
  }

  return <SessionExamsPage sessionId={sid} />;
}


==========================================================================================
# FILE: pages/lectures/LectureReportPage.tsx
==========================================================================================
// PATH: src/features/lectures/pages/lectures/LectureReportPage.tsx
import { useParams } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";
import { EmptyState } from "@/shared/ui/ds";
import { fetchLectureReport, type LectureReportResponse } from "@/features/lectures/api/report";

const TH_STYLE = {
  background: "color-mix(in srgb, var(--color-primary) 12%, var(--bg-surface))",
  color: "var(--color-text-muted)",
};

export default function LectureReportPage() {
  const { lectureId } = useParams<{ lectureId: string }>();
  const lectureIdNum = Number(lectureId);

  const { data, isLoading } = useQuery<LectureReportResponse>({
    queryKey: ["lecture-report", lectureIdNum],
    queryFn: () => fetchLectureReport(lectureIdNum),
    enabled: Number.isFinite(lectureIdNum),
  });

  if (isLoading) return <EmptyState scope="panel" tone="loading" title="불러오는 중…" />;
  if (!data)
    return (
      <EmptyState
        scope="panel"
        title="리포트 데이터가 없습니다."
        description="강의 데이터가 충분하지 않습니다."
      />
    );

  const students = data.students ?? [];

  return (
    <div style={{ display: "grid", gap: 16 }}>
      {/* 요약 (카드 톤 통일) */}
      <div style={{ display: "grid", gridTemplateColumns: "repeat(3, 1fr)", gap: 12 }}>
        {[
          { label: "전체 수강생", value: data.summary?.total_students ?? "-" },
          { label: "전체 차시", value: data.summary?.total_sessions ?? "-" },
          { label: "평균 진도", value: `${data.summary?.avg_video_progress ?? 0}%` },
        ].map((m) => (
          <div
            key={m.label}
            style={{
              borderRadius: 14,
              border: "1px solid var(--color-border-divider)",
              background: "var(--color-bg-surface)",
              padding: 14,
            }}
          >
            <div style={{ fontSize: 11, fontWeight: 900, color: "var(--color-text-muted)" }}>{m.label}</div>
            <div style={{ marginTop: 4, fontSize: 20, fontWeight: 950, color: "var(--color-text-primary)" }}>
              {m.value}
            </div>
          </div>
        ))}
      </div>

      {/* 학생별 */}
      {!students.length ? (
        <EmptyState mode="embedded" scope="panel" title="학생 데이터가 없습니다." />
      ) : (
        <div style={{ overflow: "hidden", borderRadius: 14, border: "1px solid var(--color-border-divider)" }}>
          <table className="w-full" style={{ tableLayout: "fixed" }}>
            <thead>
              <tr>
                <th
                  className="px-4 py-3 text-sm font-semibold border-b border-[var(--color-border-divider)]"
                  style={{ textAlign: "left", ...TH_STYLE }}
                >
                  이름
                </th>
                <th
                  className="px-4 py-3 text-sm font-semibold border-b border-[var(--color-border-divider)]"
                  style={{ textAlign: "center", width: 160, ...TH_STYLE }}
                >
                  평균 진도
                </th>
                <th
                  className="px-4 py-3 text-sm font-semibold border-b border-[var(--color-border-divider)]"
                  style={{ textAlign: "center", width: 160, ...TH_STYLE }}
                >
                  최근 출결
                </th>
              </tr>
            </thead>

            <tbody className="divide-y divide-[var(--color-border-divider)]">
              {students.map((s) => (
                <tr key={s.student_id} className="hover:bg-[var(--color-bg-surface-soft)]">
                  <td className="px-4 py-3 text-left text-[15px] font-bold text-[var(--color-text-primary)] truncate">
                    {s.student_name}
                  </td>
                  <td className="px-4 py-3 text-center text-[14px] text-[var(--color-text-secondary)]">
                    {s.avg_progress ?? 0}%
                  </td>
                  <td className="px-4 py-3 text-center text-[13px] font-semibold text-[var(--color-text-muted)]">
                    {s.last_attendance_status ?? "-"}
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      )}
    </div>
  );
}


==========================================================================================
# FILE: pages/lectures/LectureStudentsPage.tsx
==========================================================================================
// PATH: src/features/lectures/pages/lectures/LectureStudentsPage.tsx
import { useEffect, useMemo, useState } from "react";
import { useNavigate, useParams } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";

import { fetchLectureStudents, type LectureStudent } from "@/features/lectures/api/students";
import LectureEnrollStudentModal from "@/features/lectures/components/LectureEnrollStudentModal";

import { Button, EmptyState } from "@/shared/ui/ds";
import { DomainListToolbar, DomainTable } from "@/shared/ui/domain";
import { feedback } from "@/shared/ui/feedback/feedback";

export default function LectureStudentsPage() {
  const navigate = useNavigate();
  const { lectureId } = useParams<{ lectureId: string }>();
  const lectureIdNum = Number(lectureId);

  const [searchInput, setSearchInput] = useState("");
  const [search, setSearch] = useState("");
  const [showEnroll, setShowEnroll] = useState(false);
  const [selectedIds, setSelectedIds] = useState<number[]>([]);

  useEffect(() => {
    const t = setTimeout(() => setSearch(searchInput), 250);
    return () => clearTimeout(t);
  }, [searchInput]);

  const { data: students = [], isLoading } = useQuery<LectureStudent[]>({
    queryKey: ["lecture-students", lectureIdNum],
    queryFn: () => fetchLectureStudents(lectureIdNum),
    enabled: Number.isFinite(lectureIdNum),
  });

  const filtered = useMemo(() => {
    if (!search.trim()) return students;
    const k = search.trim().toLowerCase();
    return students.filter(
      (s) =>
        (s.name || "").toLowerCase().includes(k) ||
        (s.school || "").toLowerCase().includes(k) ||
        String(s.grade ?? "").includes(k)
    );
  }, [students, search]);

  const selectedSet = useMemo(() => new Set(selectedIds), [selectedIds]);
  const allIds = useMemo(() => filtered.map((s) => s.id), [filtered]);
  const allSelected = filtered.length > 0 && allIds.every((id) => selectedSet.has(id));

  function toggleSelect(id: number) {
    if (selectedSet.has(id)) setSelectedIds(selectedIds.filter((x) => x !== id));
    else setSelectedIds([...selectedIds, id]);
  }
  function toggleSelectAll() {
    if (allSelected) setSelectedIds([]);
    else setSelectedIds([...allIds]);
  }

  const selectionBar = (
    <div className="flex flex-wrap items-center gap-2 pl-1">
      <span
        className="text-[13px] font-semibold"
        style={{
          color: selectedIds.length > 0 ? "var(--color-primary)" : "var(--color-text-muted)",
        }}
      >
        {selectedIds.length}명 선택됨
      </span>
      <span className="text-[var(--color-border-divider)]">|</span>
        <Button intent="secondary" size="sm" onClick={() => feedback.info("메시지 발송 기능 준비 중입니다.")}>
          메시지 발송
        </Button>
        <Button intent="secondary" size="sm" onClick={() => feedback.info("엑셀 다운로드 기능 준비 중입니다.")}>
          엑셀 다운로드
        </Button>
        <Button intent="secondary" size="sm" onClick={() => feedback.info("태그 추가 기능 준비 중입니다.")}>
          태그 추가
        </Button>
        <Button intent="secondary" size="sm" onClick={() => feedback.info("비밀번호 변경 기능 준비 중입니다.")}>
          비밀번호 변경
        </Button>
        <Button intent="danger" size="sm" onClick={() => feedback.info("일괄 삭제 기능 준비 중입니다.")}>
          삭제
        </Button>
      </div>
  );

  if (!Number.isFinite(lectureIdNum)) {
    return (
      <div className="p-2 text-sm" style={{ color: "var(--color-error)" }}>
        잘못된 lectureId
      </div>
    );
  }

  return (
    <>
      <div className="flex flex-col gap-4">
        <DomainListToolbar
          totalLabel={isLoading ? "…" : `총 ${filtered.length}명`}
          searchSlot={
            <input
              className="ds-input"
              placeholder="이름 / 학교 / 학년 검색"
              value={searchInput}
              onChange={(e) => setSearchInput(e.target.value)}
              style={{ maxWidth: 360 }}
            />
          }
          primaryAction={
            <Button intent="primary" onClick={() => setShowEnroll(true)}>
              수강생 등록
            </Button>
          }
          belowSlot={selectionBar}
        />

        <div>
          {isLoading ? (
            <EmptyState scope="panel" tone="loading" title="불러오는 중…" />
          ) : !filtered.length ? (
            <EmptyState
              scope="panel"
              tone="empty"
              title="수강 중인 학생이 없습니다."
              description="수강생 등록 버튼으로 학생을 추가하거나, 검색 조건을 변경해 보세요."
              actions={
                <Button intent="primary" onClick={() => setShowEnroll(true)}>
                  수강생 등록
                </Button>
              }
            />
          ) : (
            <DomainTable tableClassName="ds-table--flat" tableStyle={{ tableLayout: "fixed" }}>
              <colgroup>
                <col style={{ width: 48 }} />
                <col style={{ width: 256 }} />
                <col style={{ width: 100 }} />
                <col />
                <col style={{ width: 120 }} />
              </colgroup>
              <thead>
                <tr>
                  <th scope="col" className="ds-checkbox-cell" style={{ width: 48 }} onClick={(e) => e.stopPropagation()}>
                    <input
                      type="checkbox"
                      checked={allSelected}
                      onChange={toggleSelectAll}
                      aria-label="전체 선택"
                      className="cursor-pointer"
                    />
                  </th>
                  <th scope="col">이름</th>
                  <th scope="col">학년</th>
                  <th scope="col">학교</th>
                  <th scope="col">상태</th>
                </tr>
              </thead>
              <tbody>
                {filtered.map((s) => (
                  <tr
                    key={s.id}
                    onClick={() => navigate(`/admin/students/${s.id}`)}
                    tabIndex={0}
                    role="button"
                    className={`cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-[var(--color-border-focus)]/40 ${selectedSet.has(s.id) ? "ds-row-selected" : ""}`}
                  >
                    <td className="ds-checkbox-cell" style={{ width: 48 }} onClick={(e) => e.stopPropagation()}>
                      <input
                        type="checkbox"
                        checked={selectedSet.has(s.id)}
                        onChange={() => toggleSelect(s.id)}
                        onClick={(e) => e.stopPropagation()}
                        aria-label={`${s.name} 선택`}
                        className="cursor-pointer"
                      />
                    </td>
                    <td className="text-[15px] font-bold text-[var(--color-text-primary)] truncate">
                      {s.name}
                    </td>
                    <td className="text-[14px] text-[var(--color-text-secondary)] truncate text-center">
                      {s.grade ?? "-"}
                    </td>
                    <td className="text-[14px] text-[var(--color-text-secondary)] truncate">
                      {s.school ?? "-"}
                    </td>
                    <td className="text-[13px] font-semibold text-[var(--color-text-muted)] truncate text-center">
                      {s.status_label}
                    </td>
                  </tr>
                ))}
              </tbody>
            </DomainTable>
          )}
        </div>
      </div>

      <LectureEnrollStudentModal
        lectureId={lectureIdNum}
        open={showEnroll}
        onClose={() => setShowEnroll(false)}
        onSuccess={() => setShowEnroll(false)}
      />
    </>
  );
}


==========================================================================================
# FILE: pages/lectures/LecturesPage.tsx
==========================================================================================
// PATH: src/features/lectures/pages/lectures/LecturesPage.tsx
// Design SSOT — students 도메인 패턴 준수

import { useMemo, useState } from "react";
import { useQuery } from "@tanstack/react-query";
import { useNavigate } from "react-router-dom";

import api from "@/shared/api/axios";
import { EmptyState, Button } from "@/shared/ui/ds";
import { DomainListToolbar, DomainTable, DEFAULT_PRESET_COLOR } from "@/shared/ui/domain";
import LectureCreateModal from "../../components/LectureCreateModal";

type LecturesPageProps = {
  tab?: "active" | "past";
};

type LectureItem = {
  id: number;
  title: string;
  subject?: string | null;
  name?: string | null;
  start_date?: string | null;
  end_date?: string | null;
  lecture_time?: string | null;
  color?: string | null;
  is_active?: boolean;
};

type TabKey = "active" | "past";

function isPastLecture(lec: LectureItem) {
  const activeFlag =
    typeof lec.is_active === "boolean" ? lec.is_active : undefined;
  if (activeFlag === false) return true;
  if (!lec.end_date) return false;

  const end = new Date(lec.end_date);
  if (Number.isNaN(end.getTime())) return false;

  const today = new Date();
  today.setHours(0, 0, 0, 0);
  end.setHours(0, 0, 0, 0);

  return end.getTime() < today.getTime();
}

export default function LecturesPage({ tab = "active" }: LecturesPageProps = {}) {
  const navigate = useNavigate();
  const [showModal, setShowModal] = useState(false);
  const [q, setQ] = useState("");
  const [selectedIds, setSelectedIds] = useState<number[]>([]);

  const { data = [], isLoading, error, isFetching } = useQuery({
    queryKey: ["lectures"],
    queryFn: async (): Promise<LectureItem[]> => {
      const res = await api.get("/lectures/lectures/");
      const list = (res.data?.results ?? res.data) as LectureItem[] | any;
      return Array.isArray(list) ? list : [];
    },
  });

  const { activeLectures, pastLectures } = useMemo(() => {
    const active: LectureItem[] = [];
    const past: LectureItem[] = [];

    for (const lec of data) {
      if (isPastLecture(lec)) past.push(lec);
      else active.push(lec);
    }

    const toTime = (v?: string | null) => {
      if (!v) return 0;
      const t = new Date(v).getTime();
      return Number.isFinite(t) ? t : 0;
    };

    active.sort((a, b) => toTime(b.start_date) - toTime(a.start_date));
    past.sort((a, b) => toTime(b.end_date) - toTime(a.end_date));

    return { activeLectures: active, pastLectures: past };
  }, [data]);

  function isLightColor(hex: string): boolean {
  const c = String(hex || "").toLowerCase();
  return ["#eab308", "#06b6d4"].includes(c);
}

  const list = useMemo(() => {
    const base = tab === "active" ? activeLectures : pastLectures;
    const keyword = q.trim().toLowerCase();
    if (!keyword) return base;

    return base.filter((lec) =>
      [
        lec.title,
        lec.subject ?? "",
        lec.name ?? "",
        lec.lecture_time ?? "",
        lec.start_date ?? "",
        lec.end_date ?? "",
      ]
        .join(" ")
        .toLowerCase()
        .includes(keyword)
    );
  }, [tab, activeLectures, pastLectures, q]);

  const selectedSet = useMemo(() => new Set(selectedIds), [selectedIds]);
  const allIds = useMemo(() => list.map((l) => l.id), [list]);
  const allSelected = list.length > 0 && allIds.every((id) => selectedSet.has(id));

  function toggleSelect(id: number) {
    if (selectedSet.has(id)) setSelectedIds(selectedIds.filter((x) => x !== id));
    else setSelectedIds([...selectedIds, id]);
  }
  function toggleSelectAll() {
    if (allSelected) setSelectedIds([]);
    else setSelectedIds([...allIds]);
  }

  const selectionBar = (
    <div className="flex flex-wrap items-center gap-2 pl-1">
      <span
        className="text-[13px] font-semibold"
        style={{
          color: selectedIds.length > 0 ? "var(--color-primary)" : "var(--color-text-muted)",
        }}
      >
        {selectedIds.length}개 선택됨
      </span>
      <span className="text-[var(--color-border-divider)]">|</span>
      <Button intent="secondary" size="sm" onClick={() => setSelectedIds([])} disabled={selectedIds.length === 0}>
        선택 해제
      </Button>
    </div>
  );

  return (
    <>
      <div className="flex flex-col gap-4">
        <DomainListToolbar
          totalLabel={
            isLoading ? "…" : isFetching ? "동기화 중…" : `총 ${list.length}개`
          }
          searchSlot={
            <input
              className="ds-input"
              placeholder="강의 검색 (강의명/과목/강사/기간)"
              value={q}
              onChange={(e) => setQ(e.target.value)}
              style={{ maxWidth: 360 }}
            />
          }
          primaryAction={
            <Button intent="primary" onClick={() => setShowModal(true)}>
              강의 추가
            </Button>
          }
          belowSlot={selectionBar}
        />

        <div>
          {isLoading ? (
            <EmptyState scope="panel" tone="loading" title="불러오는 중…" />
          ) : error ? (
            <EmptyState scope="panel" tone="error" title="에러가 발생했습니다." />
          ) : list.length === 0 ? (
            <EmptyState scope="panel" tone="empty" title="표시할 강의가 없습니다." />
          ) : (
            <div style={{ width: "fit-content" }}>
              <DomainTable tableClassName="ds-table--flat" tableStyle={{ tableLayout: "auto" }}>
                <colgroup>
                  <col style={{ width: 48 }} />
                  <col style={{ width: 192 }} />
                  <col />
                  <col />
                  <col style={{ width: 160 }} />
                  <col />
                </colgroup>
                <thead>
                  <tr>
                    <th scope="col" className="ds-checkbox-cell" style={{ width: 48 }} onClick={(e) => e.stopPropagation()}>
                      <input
                        type="checkbox"
                        checked={allSelected}
                        onChange={toggleSelectAll}
                        aria-label="전체 선택"
                        className="cursor-pointer"
                      />
                    </th>
                    <th scope="col">강의 이름</th>
                    <th scope="col">과목</th>
                    <th scope="col">강사</th>
                    <th scope="col">강의 시간</th>
                    <th scope="col">기간</th>
                  </tr>
                </thead>
                <tbody>
                  {list.map((lec) => (
                    <tr
                      key={lec.id}
                      onClick={() => navigate(`/admin/lectures/${lec.id}`)}
                      tabIndex={0}
                      role="button"
                      className={`cursor-pointer ${selectedSet.has(lec.id) ? "ds-row-selected" : ""}`}
                    >
                      <td className="ds-checkbox-cell" style={{ width: 48 }} onClick={(e) => e.stopPropagation()}>
                        <input
                          type="checkbox"
                          checked={selectedSet.has(lec.id)}
                          onChange={() => toggleSelect(lec.id)}
                          onClick={(e) => e.stopPropagation()}
                          aria-label={`${lec.title} 선택`}
                          className="cursor-pointer"
                        />
                      </td>
                      <td style={{ fontWeight: 600 }}>
                        <span
                          style={{
                            display: "inline-flex",
                            alignItems: "center",
                            gap: 10,
                          }}
                        >
                          <span
                            style={{
                              width: 32,
                              height: 32,
                              borderRadius: 8,
                              flexShrink: 0,
                              display: "grid",
                              placeItems: "center",
                              fontSize: 12,
                              fontWeight: 800,
                              letterSpacing: "-0.02em",
                              color: isLightColor(lec.color || "") ? "#1a1a1a" : "#fff",
                              background: lec.color || DEFAULT_PRESET_COLOR,
                              border: "none",
                              boxShadow: "0 1px 2px rgba(0,0,0,0.15)",
                              textShadow: "0 0 1px rgba(0,0,0,0.2)",
                            }}
                          >
                            {(lec.title || "??").slice(0, 2)}
                          </span>
                          {lec.title}
                        </span>
                      </td>
                      <td>{lec.subject || "-"}</td>
                      <td>{lec.name || "-"}</td>
                      <td>{lec.lecture_time || "-"}</td>
                      <td style={{ fontWeight: 600 }}>
                        {lec.start_date && lec.end_date
                          ? `${lec.start_date} ~ ${lec.end_date}`
                          : "-"}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </DomainTable>
            </div>
          )}
        </div>
      </div>

      {showModal && (
        <LectureCreateModal
          isOpen
          onClose={() => setShowModal(false)}
          usedColors={data?.map((l) => l.color).filter(Boolean) ?? []}
        />
      )}
    </>
  );
}


==========================================================================================
# FILE: pages/lectures/LecturesPastPage.tsx
==========================================================================================
// PATH: src/features/lectures/pages/lectures/LecturesPastPage.tsx
import { EmptyState } from "@/shared/ui/ds";

export default function LecturesPastPage() {
  return (
    <>
      {/* CARD HEADER */}
      <div className="px-5 py-4 border-b border-[var(--border-divider)]">
        <div className="text-base font-semibold">지난 강의</div>
      </div>

      {/* CARD BODY */}
      <div className="p-4">
        <EmptyState
          scope="panel"
          title="지난 강의가 없습니다."
          description="종료된 강의가 이곳에 표시됩니다."
        />
      </div>
    </>
  );
}


==========================================================================================
# FILE: pages/materials/MaterialsPage.tsx
==========================================================================================
// PATH: src/features/lectures/pages/materials/MaterialsPage.tsx
import { useMemo, useState } from "react";
import { useParams } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";

import {
  fetchMaterialCategories,
  fetchMaterials,
  MaterialCategory,
  Material,
} from "../../api/materials";

import MaterialCategoryModal from "../../components/MaterialCategoryModal";
import MaterialUploadModal from "../../components/MaterialUploadModal";

import { EmptyState, Button } from "@/shared/ui/ds";

const TH_STYLE = {
  background: "color-mix(in srgb, var(--color-primary) 12%, var(--bg-surface))",
  color: "var(--color-text-muted)",
};

export default function MaterialsPage() {
  const { lectureId } = useParams<{ lectureId: string }>();
  const lectureIdNum = Number(lectureId);

  const [selectedCategory, setSelectedCategory] = useState<number | null>(null);
  const [showCategoryModal, setShowCategoryModal] = useState(false);
  const [showUploadModal, setShowUploadModal] = useState(false);

  const { data: categories = [], isLoading: loadingCats } = useQuery<MaterialCategory[]>({
    queryKey: ["material-categories", lectureIdNum],
    queryFn: () => fetchMaterialCategories(lectureIdNum),
    enabled: Number.isFinite(lectureIdNum),
  });

  const { data: materials = [], isLoading: loadingMaterials } = useQuery<Material[]>({
    queryKey: ["materials", lectureIdNum, selectedCategory ?? "all"],
    queryFn: () =>
      fetchMaterials({
        lecture: lectureIdNum,
        category: selectedCategory ?? undefined,
      }),
    enabled: Number.isFinite(lectureIdNum),
  });

  const currentCategoryName = useMemo(() => {
    return selectedCategory === null
      ? "전체 자료"
      : categories.find((c) => c.id === selectedCategory)?.name ?? "전체 자료";
  }, [selectedCategory, categories]);

  return (
    <>
      {/* 상단 액션바 (중첩 카드 없이 단일 블록) */}
      <div className="flex items-center gap-2 mb-3">
        <Button intent="secondary" onClick={() => setShowCategoryModal(true)}>
          카테고리 추가
        </Button>
        <Button intent="primary" onClick={() => setShowUploadModal(true)}>
          자료 추가
        </Button>

        <span className="ml-auto text-sm font-semibold text-[var(--color-text-muted)]">
          {loadingMaterials ? "불러오는 중…" : `${materials.length}개`}
        </span>
      </div>

      <div style={{ display: "grid", gridTemplateColumns: "240px 1fr", gap: 16 }}>
        {/* LEFT */}
        <div
          style={{
            borderRadius: 18,
            padding: 12,
            background: "var(--color-bg-surface)",
            border: "1px solid var(--color-border-divider)",
          }}
        >
          <div className="flex items-center justify-between mb-2">
            <span style={{ fontSize: 12, fontWeight: 900, color: "var(--color-text-muted)" }}>
              자료 분류
            </span>
            <Button intent="ghost" size="sm" onClick={() => setShowCategoryModal(true)}>
              + 추가
            </Button>
          </div>

          {loadingCats ? (
            <EmptyState mode="embedded" scope="panel" tone="loading" title="불러오는 중…" />
          ) : (
            <div style={{ display: "grid", gap: 6 }}>
              <Button
                intent={selectedCategory === null ? "secondary" : "ghost"}
                size="md"
                aria-pressed={selectedCategory === null}
                onClick={() => setSelectedCategory(null)}
                style={{ justifyContent: "flex-start" }}
              >
                전체 자료
              </Button>

              {categories.map((cat) => {
                const active = selectedCategory === cat.id;
                return (
                  <Button
                    key={cat.id}
                    intent={active ? "secondary" : "ghost"}
                    size="md"
                    aria-pressed={active}
                    onClick={() => setSelectedCategory(cat.id)}
                    style={{ justifyContent: "flex-start" }}
                  >
                    {cat.name}
                  </Button>
                );
              })}
            </div>
          )}
        </div>

        {/* RIGHT */}
        <div
          style={{
            borderRadius: 18,
            padding: 12,
            background: "var(--color-bg-surface)",
            border: "1px solid var(--color-border-divider)",
            overflow: "hidden",
          }}
        >
          <div className="flex items-baseline justify-between mb-2">
            <div style={{ fontSize: 12, fontWeight: 900, color: "var(--color-text-secondary)" }}>
              {currentCategoryName}
            </div>
            <div style={{ fontSize: 11, fontWeight: 850, color: "var(--color-text-muted)" }}>
              {loadingMaterials ? "불러오는 중…" : `${materials.length}개`}
            </div>
          </div>

          {loadingMaterials ? (
            <EmptyState scope="panel" tone="loading" title="불러오는 중…" />
          ) : materials.length === 0 ? (
            <EmptyState
              title="등록된 자료가 없습니다."
              description="자료를 업로드하면 여기에 표시됩니다."
              scope="panel"
            />
          ) : (
            <div style={{ overflow: "hidden", borderRadius: 14, border: "1px solid var(--color-border-divider)" }}>
              <table className="w-full" style={{ tableLayout: "fixed" }}>
                <thead>
                  <tr>
                    <th
                      className="px-4 py-3 text-sm font-semibold border-b border-[var(--color-border-divider)]"
                      style={{ textAlign: "left", whiteSpace: "nowrap", ...TH_STYLE }}
                    >
                      제목
                    </th>
                    <th
                      className="px-4 py-3 text-sm font-semibold border-b border-[var(--color-border-divider)]"
                      style={{ textAlign: "center", whiteSpace: "nowrap", width: 160, ...TH_STYLE }}
                    >
                      등록자
                    </th>
                    <th
                      className="px-4 py-3 text-sm font-semibold border-b border-[var(--color-border-divider)]"
                      style={{ textAlign: "center", whiteSpace: "nowrap", width: 140, ...TH_STYLE }}
                    >
                      등록일
                    </th>
                  </tr>
                </thead>

                <tbody className="divide-y divide-[var(--color-border-divider)]">
                  {materials.map((m) => (
                    <tr key={m.id} className="hover:bg-[var(--color-bg-surface-soft)]">
                      <td className="px-4 py-3 text-left text-[15px] font-bold truncate">
                        <a
                          href={m.file || m.url || "#"}
                          target="_blank"
                          rel="noreferrer"
                          style={{ color: "var(--color-primary)", fontWeight: 900 }}
                        >
                          {m.title}
                        </a>
                      </td>
                      <td className="px-4 py-3 text-center text-[14px] text-[var(--color-text-secondary)] truncate">
                        {m.uploader_name || "-"}
                      </td>
                      <td className="px-4 py-3 text-center text-[13px] font-semibold text-[var(--color-text-muted)] truncate">
                        {m.created_at?.slice(0, 10)}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </div>
      </div>

      {showCategoryModal && (
        <MaterialCategoryModal lectureId={lectureIdNum} onClose={() => setShowCategoryModal(false)} />
      )}

      {showUploadModal && (
        <MaterialUploadModal
          lectureId={lectureIdNum}
          categoryId={selectedCategory}
          onClose={() => setShowUploadModal(false)}
        />
      )}
    </>
  );
}


==========================================================================================
# FILE: pages/scores/SessionScoresEntryPage.tsx
==========================================================================================
// PATH: src/features/lectures/pages/scores/SessionScoresEntryPage.tsx
/**
 * ✅ SessionScoresEntryPage (ENTRY PAGE)
 *
 * 책임:
 * - sessionId 라우팅 파싱
 * - 세션 단위 시험 요약 표시 (viewer)
 * - 실제 성적 테이블은 scores 도메인에 위임
 *
 * ❌ 학생별 점수 렌더 ❌
 * ❌ mock 데이터 ❌
 * ❌ 점수 입력 ❌
 */

import { useParams } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";
import api from "@/shared/api/axios";

import SessionScoresPanel from "@/features/scores/panels/SessionScoresPanel";
import { PageHeader, Section, Panel, EmptyState } from "@/shared/ui/ds";

// ------------------------------------------------------------
// Types (요약용)
// ------------------------------------------------------------

type SessionExamSummary = {
  exam_id: number;
  title: string;
  pass_score: number;

  participant_count: number;
  avg_score: number;
  min_score: number;
  max_score: number;

  pass_count: number;
  fail_count: number;
  pass_rate: number;
};

type SessionExamsSummaryResponse = {
  session_id: number;
  participant_count: number;
  pass_rate: number;
  clinic_rate: number;

  strategy: string;
  pass_source: string;

  exams: SessionExamSummary[];
};

// ------------------------------------------------------------
// API (viewer only)
// ------------------------------------------------------------

async function fetchSessionExamsSummary(sessionId: number): Promise<SessionExamsSummaryResponse> {
  const res = await api.get(`/results/admin/sessions/${sessionId}/exams/summary/`);
  return res.data;
}

// ------------------------------------------------------------
// Component
// ------------------------------------------------------------

export default function SessionScoresEntryPage() {
  const { sessionId } = useParams<{ sessionId: string }>();
  const numericSessionId = Number(sessionId);

  const { data, isLoading, isError } = useQuery({
    queryKey: ["session-exams-summary", numericSessionId],
    queryFn: () => fetchSessionExamsSummary(numericSessionId),
    enabled: Number.isFinite(numericSessionId),
  });

  if (!Number.isFinite(numericSessionId)) {
    return (
      <div className="p-6 text-sm" style={{ color: "var(--color-error)" }}>
        유효하지 않은 sessionId 입니다.
      </div>
    );
  }

  return (
    <Section>
      <PageHeader
        title="세션 성적"
        description="세션 시험 요약과 성적 패널을 확인합니다."
        actions={null}
      />

      <Panel>
        {isLoading ? (
          <EmptyState scope="panel" tone="loading" title="불러오는 중…" />
        ) : isError ? (
          <EmptyState scope="panel" tone="error" title="성적 요약을 불러올 수 없습니다." />
        ) : !data ? (
          <EmptyState scope="panel" title="표시할 데이터가 없습니다." />
        ) : (
          <div style={{ display: "grid", gap: 14 }}>
            {/* ===================== */}
            {/* Session Exam Summary */}
            {/* ===================== */}
            <div style={{ display: "grid", gap: 10 }}>
              <div style={{ display: "flex", alignItems: "baseline", justifyContent: "space-between" }}>
                <div style={{ fontSize: 12, fontWeight: 900, color: "var(--color-text-secondary)" }}>
                  세션 시험 요약
                </div>
                <div style={{ fontSize: 11, fontWeight: 850, color: "var(--color-text-muted)" }}>
                  {data.exams?.length ?? 0}개
                </div>
              </div>

              {data.exams && data.exams.length > 0 ? (
                <div
                  style={{
                    borderRadius: 14,
                    border: "1px solid var(--color-border-divider)",
                    background: "var(--color-bg-surface)",
                    padding: 12,
                  }}
                >
                  <div
                    style={{
                      display: "grid",
                      gridTemplateColumns: "repeat(auto-fill, minmax(260px, 1fr))",
                      gap: 10,
                    }}
                  >
                    {data.exams.map((exam) => (
                      <div
                        key={exam.exam_id}
                        style={{
                          borderRadius: 14,
                          border: "1px solid var(--color-border-divider)",
                          background: "var(--color-bg-surface-soft)",
                          padding: 12,
                        }}
                      >
                        <div
                          style={{
                            fontSize: 13,
                            fontWeight: 950,
                            color: "var(--color-text-primary)",
                            whiteSpace: "nowrap",
                            overflow: "hidden",
                            textOverflow: "ellipsis",
                          }}
                        >
                          {exam.title}
                        </div>

                        <div style={{ marginTop: 6, display: "flex", gap: 8, flexWrap: "wrap" }}>
                          <span style={{ fontSize: 11, fontWeight: 850, color: "var(--color-text-muted)" }}>
                            평균 <span style={{ fontWeight: 950, color: "var(--color-text-secondary)" }}>{exam.avg_score}</span>
                          </span>

                          <span style={{ fontSize: 11, fontWeight: 850, color: "var(--color-text-muted)" }}>·</span>

                          <span style={{ fontSize: 11, fontWeight: 850, color: "var(--color-text-muted)" }}>
                            합격률{" "}
                            <span style={{ fontWeight: 950, color: "var(--color-text-secondary)" }}>
                              {exam.pass_rate}%
                            </span>
                          </span>

                          <span style={{ fontSize: 11, fontWeight: 850, color: "var(--color-text-muted)" }}>·</span>

                          <span style={{ fontSize: 11, fontWeight: 850, color: "var(--color-text-muted)" }}>
                            기준{" "}
                            <span style={{ fontWeight: 950, color: "var(--color-text-secondary)" }}>
                              {exam.pass_score}
                            </span>
                          </span>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              ) : (
                <EmptyState
                  scope="panel"
                  mode="embedded"
                  title="이 세션에는 성적 대상 시험이 없습니다."
                />
              )}
            </div>

            {/* ===================== */}
            {/* Scores Domain Entry */}
            {/* ===================== */}
            <SessionScoresPanel sessionId={numericSessionId} />
          </div>
        )}
      </Panel>
    </Section>
  );
}


==========================================================================================
# FILE: pages/sessions/LectureSessionsPage.tsx
==========================================================================================
// PATH: src/features/lectures/pages/sessions/LectureSessionsPage.tsx
import { useState, useMemo, useCallback } from "react";
import { useParams, useNavigate, Link } from "react-router-dom";
import { useQuery, useQueryClient } from "@tanstack/react-query";

import { fetchSessions, type Session } from "../../api/sessions";
import SessionCreateModal from "../../components/SessionCreateModal";
import { EmptyState, Button } from "@/shared/ui/ds";
import { DomainListToolbar, DomainTable } from "@/shared/ui/domain";

export default function LectureSessionsPage() {
  const navigate = useNavigate();
  const qc = useQueryClient();
  const { lectureId } = useParams<{ lectureId: string }>();
  const lecId = Number(lectureId);

  const [open, setOpen] = useState(false);
  const [selectedIds, setSelectedIds] = useState<number[]>([]);

  const { data: sessions = [], isLoading, isError } = useQuery<Session[]>({
    queryKey: ["lecture-sessions", lecId],
    queryFn: () => fetchSessions(lecId),
    enabled: Number.isFinite(lecId),
  });

  const selectedSet = useMemo(() => new Set(selectedIds), [selectedIds]);
  const allIds = useMemo(() => sessions.map((s) => s.id), [sessions]);
  const allSelected = useMemo(
    () => sessions.length > 0 && allIds.length > 0 && allIds.every((id) => selectedIds.includes(id)),
    [sessions.length, allIds, selectedIds]
  );

  const toggleSelect = useCallback(
    (id: number) => {
      setSelectedIds((prev) => {
        if (prev.includes(id)) {
          return prev.filter((x) => x !== id);
        } else {
          return [...prev, id];
        }
      });
    },
    []
  );

  const toggleSelectAll = useCallback(() => {
    setSelectedIds((prev) => {
      if (allSelected) {
        return [];
      } else {
        return [...allIds];
      }
    });
  }, [allSelected, allIds]);

  const handleClearSelection = useCallback(() => {
    setSelectedIds([]);
  }, []);

  const selectionBar = useMemo(
    () => (
      <div className="flex flex-wrap items-center gap-2 pl-1">
        <span
          className="text-[13px] font-semibold"
          style={{
            color: selectedIds.length > 0 ? "var(--color-primary)" : "var(--color-text-muted)",
          }}
        >
          {selectedIds.length}개 선택됨
        </span>
        <span className="text-[var(--color-border-divider)]">|</span>
        <Button intent="secondary" size="sm" onClick={handleClearSelection} disabled={selectedIds.length === 0}>
          선택 해제
        </Button>
      </div>
    ),
    [selectedIds.length, handleClearSelection]
  );

  const handleClose = useCallback(() => {
    setOpen(false);
    qc.invalidateQueries({ queryKey: ["lecture-sessions", lecId] });
  }, [qc, lecId]);

  if (!Number.isFinite(lecId)) {
    return <div className="p-2 text-sm" style={{ color: "var(--color-error)" }}>잘못된 강의 ID</div>;
  }

  return (
    <>
      <div className="flex flex-col gap-4">
        {isLoading ? (
          <EmptyState scope="panel" tone="loading" title="불러오는 중…" />
        ) : isError ? (
          <EmptyState scope="panel" tone="error" title="차시 데이터를 불러올 수 없습니다." />
        ) : sessions.length === 0 ? (
          <EmptyState
            scope="panel"
            title="등록된 차시가 없습니다."
            description="차시를 추가하면 여기에 표시됩니다."
            actions={
              <Button intent="primary" onClick={() => setOpen(true)}>
                + 차시 추가
              </Button>
            }
          />
        ) : (
          <>
            <DomainListToolbar
              totalLabel={`총 ${sessions.length}개`}
              searchSlot={null}
              primaryAction={
                <Button intent="primary" onClick={() => setOpen(true)}>
                  + 차시 추가
                </Button>
              }
              belowSlot={selectionBar}
            />
            <DomainTable tableClassName="ds-table--flat" tableStyle={{ tableLayout: "fixed" }}>
              <colgroup>
                <col style={{ width: 48 }} />
                <col style={{ width: 120 }} />
                <col style={{ width: 192 }} />
                <col style={{ width: 160 }} />
                <col style={{ width: 100 }} />
              </colgroup>
              <thead>
                <tr>
                  <th scope="col" className="ds-checkbox-cell" style={{ width: 48 }} onClick={(e) => e.stopPropagation()}>
                    <input
                      type="checkbox"
                      checked={allSelected}
                      onChange={toggleSelectAll}
                      aria-label="전체 선택"
                      className="cursor-pointer"
                    />
                  </th>
                  <th scope="col">차시</th>
                  <th scope="col">제목</th>
                  <th scope="col">날짜</th>
                  <th scope="col">ID</th>
                </tr>
              </thead>
              <tbody>
                {sessions.map((s) => (
                  <tr
                    key={s.id}
                    className={`cursor-pointer hover:bg-[var(--color-bg-surface-hover)] ${selectedSet.has(s.id) ? "ds-row-selected" : ""}`}
                    onClick={() => navigate(`/admin/lectures/${lectureId}/sessions/${s.id}`)}
                  >
                    <td className="ds-checkbox-cell" style={{ width: 48 }} onClick={(e) => e.stopPropagation()}>
                      <input
                        type="checkbox"
                        checked={selectedSet.has(s.id)}
                        onChange={() => toggleSelect(s.id)}
                        onClick={(e) => e.stopPropagation()}
                        aria-label={`${s.title} 선택`}
                        className="cursor-pointer"
                      />
                    </td>
                    <td className="text-[15px] font-bold text-[var(--color-text-primary)] truncate">
                      <Link
                        to={`/admin/lectures/${lectureId}/sessions/${s.id}`}
                        style={{ color: "inherit", textDecoration: "none" }}
                        onClick={(e) => e.stopPropagation()}
                      >
                        {s.order ?? "-"}차시
                      </Link>
                    </td>
                    <td className="text-[14px] text-[var(--color-text-secondary)] truncate">
                      {s.title || "-"}
                    </td>
                    <td className="text-[14px] text-[var(--color-text-secondary)] truncate text-center">
                      {s.date || "-"}
                    </td>
                    <td className="text-[13px] font-semibold text-[var(--color-text-muted)] truncate text-center">
                      {s.id}
                    </td>
                  </tr>
                ))}
              </tbody>
            </DomainTable>
          </>
        )}
      </div>

      {open && <SessionCreateModal lectureId={lecId} onClose={handleClose} />}
    </>
  );
}
