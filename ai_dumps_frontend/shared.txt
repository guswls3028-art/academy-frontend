====================================================================================================
# FRONTEND FOLDER: shared
# ROOT PATH: C:\academyfront\src\shared
====================================================================================================


==========================================================================================
# FILE: api/axios.ts
==========================================================================================
// PATH: src/shared/api/axios.ts
import axios, {
  AxiosError,
  AxiosInstance,
  AxiosRequestConfig,
  AxiosResponse,
} from "axios";
import { asyncStatusStore } from "@/shared/ui/asyncStatus/asyncStatusStore";
import { getTenantCodeForApiRequest } from "@/shared/tenant";

type RetryConfig = AxiosRequestConfig & {
  _retry?: boolean;
  _asyncId?: string;
};

type RefreshResponse = { access: string };

const API_BASE = String(import.meta.env.VITE_API_BASE_URL || "").trim();

function getAccessToken(): string | null {
  try {
    const t = localStorage.getItem("access");
    return t ? t : null;
  } catch {
    return null;
  }
}

function getRefreshToken(): string | null {
  try {
    const t = localStorage.getItem("refresh");
    return t ? t : null;
  } catch {
    return null;
  }
}

function setAccessToken(token: string) {
  try {
    localStorage.setItem("access", token);
  } catch {
    // ignore
  }
}

function clearTokens() {
  try {
    localStorage.removeItem("access");
    localStorage.removeItem("refresh");
  } catch {
    // ignore
  }
}

/**
 * Enterprise Refresh Concurrency Control
 * - multiple requests may fail with 401 simultaneously
 * - refresh only once, queue others, then replay
 */
let isRefreshing = false;
let refreshQueue: Array<(token: string | null) => void> = [];

function enqueueRefresh(cb: (token: string | null) => void) {
  refreshQueue.push(cb);
}

function flushRefreshQueue(token: string | null) {
  const q = [...refreshQueue];
  refreshQueue = [];
  q.forEach((cb) => cb(token));
}

function shouldSkipAuth(url?: string) {
  const u = String(url || "");
  return u.includes("/token/") || u.includes("/token/refresh/");
}

function isAxiosError(e: any): e is AxiosError {
  return !!e?.isAxiosError;
}

const api: AxiosInstance = axios.create({
  baseURL: `${API_BASE}/api/v1`,
  timeout: 20_000,
  // JWT-only contract: do NOT rely on cookies
  withCredentials: false,
});

/**
 * í…Œë„ŒíŠ¸ ì½”ë“œ: shared/tenant SSOT ì‚¬ìš© (hostname â†’ config â†’ X-Tenant-Code)
 * ì¤‘ì•™ API(api.hakwonplus.com)ë¡œ ìš”ì²­ ì‹œ í•„ìˆ˜.
 */

/**
 * Request interceptor
 * - attach JWT Bearer (if available)
 * - X-Tenant-Code: í…Œë„ŒíŠ¸ ì½”ë“œê°€ ìˆìœ¼ë©´ í•­ìƒ ì „ì†¡. ì¤‘ì•™ API(api.hakwonplus.com)ëŠ” ì´ê±¸ë¡œ í…Œë„ŒíŠ¸ íŒë³„.
 *   (1í…Œë„ŒíŠ¸=1ë„ë©”ì¸ì´ë©´ ë°±ì—”ë“œê°€ Hostë¡œ íŒë³„í•˜ê³  í—¤ë”ëŠ” ë¬´ì‹œë¨)
 */
api.interceptors.request.use((config) => {
  const cfg = config;

  // Attach Authorization if access exists (JWT)
  if (!shouldSkipAuth(cfg.url)) {
    const access = getAccessToken();
    if (access) {
      cfg.headers = cfg.headers ?? {};
      (cfg.headers as any).Authorization = `Bearer ${access}`;
    }
  }

  // Optional operational headers
  cfg.headers = cfg.headers ?? {};
  (cfg.headers as any)["X-Client"] = "academyfront";
  (cfg.headers as any)["X-Client-Version"] = String(
    import.meta.env.VITE_APP_VERSION || "dev"
  );

  // í…Œë„ŒíŠ¸ ì½”ë“œê°€ ìˆìœ¼ë©´ í•­ìƒ ì „ì†¡ (B êµ¬ì¡°: tchul.com â†’ api.hakwonplus.com ì—ì„œ í•„ìˆ˜)
  const tenantCode = getTenantCodeForApiRequest();
  if (tenantCode) {
    (cfg.headers as any)["X-Tenant-Code"] = tenantCode;
  }

  // ì „ì—­ ë¹„ë™ê¸° ìƒíƒœ SSOT: ìš”ì²­ ì‹œì‘ ì‹œ Pending ë“±ë¡
  const asyncId = asyncStatusStore.trackRequest(
    cfg.method ?? "get",
    cfg.url,
    cfg as AxiosRequestConfig & { meta?: { asyncLabel?: string } }
  );
  if (asyncId) (cfg as RetryConfig)._asyncId = asyncId;

  return cfg;
});

/**
 * Refresh token (raw axios instance without interceptors to avoid loops)
 */
async function refreshAccessToken(): Promise<string | null> {
  const refresh = getRefreshToken();
  if (!refresh) return null;

  try {
    const res = await axios.post<RefreshResponse>(
      `${API_BASE}/api/v1/token/refresh/`,
      { refresh },
      { timeout: 20_000, withCredentials: false }
    );

    const newAccess = String(res.data?.access || "").trim();
    if (!newAccess) return null;

    setAccessToken(newAccess);
    return newAccess;
  } catch {
    return null;
  }
}

/**
 * Response interceptor
 * - ë¹„ë™ê¸° SSOT: ì„±ê³µ/ì‹¤íŒ¨ ì‹œ í•´ë‹¹ ìš”ì²­ ì™„ë£Œ ì²˜ë¦¬
 * - 401: attempt refresh ONCE, then replay original request
 * - 403: do not refresh (membership/role), fail-fast
 */
api.interceptors.response.use(
  (res: AxiosResponse) => {
    const id = (res.config as RetryConfig)._asyncId;
    if (id) asyncStatusStore.completeTask(id, "success");
    return res;
  },
  async (err: any) => {
    const config = err?.config as RetryConfig | undefined;
    const asyncId = config?._asyncId;
    if (asyncId)
      asyncStatusStore.completeTask(
        asyncId,
        "error",
        err?.response?.data?.detail ?? err?.message ?? "ì˜¤ë¥˜"
      );
    if (!isAxiosError(err)) throw err;

    const status = err.response?.status;
    const original = err.config as RetryConfig | undefined;

    if (!original) throw err;

    if (status === 403) {
      throw err;
    }

    if (status === 401 && !original._retry && !shouldSkipAuth(original.url)) {
      original._retry = true;

      if (isRefreshing) {
        return new Promise((resolve, reject) => {
          enqueueRefresh((token) => {
            if (!token) {
              clearTokens();
              reject(err);
              return;
            }
            original.headers = original.headers ?? {};
            (original.headers as any).Authorization = `Bearer ${token}`;
            resolve(api.request(original));
          });
        });
      }

      isRefreshing = true;
      const newAccess = await refreshAccessToken();
      isRefreshing = false;

      flushRefreshQueue(newAccess);

      if (!newAccess) {
        clearTokens();
        throw err;
      }

      original.headers = original.headers ?? {};
      (original.headers as any).Authorization = `Bearer ${newAccess}`;
      return api.request(original);
    }

    throw err;
  }
);

export default api;


==========================================================================================
# FILE: api/jobExport.ts
==========================================================================================
// PATH: src/shared/api/jobExport.ts
// ì—‘ì…€ ë‚´ë³´ë‚´ê¸° ë“± ë¹„ë™ê¸° job: í´ë§ í›„ download_url ë°˜í™˜

import api from "@/shared/api/axios";

export type JobStatusResponse = {
  job_id: string;
  job_type?: string;
  status: string;
  result?: { download_url?: string; filename?: string };
  error_message?: string | null;
  progress?: unknown;
};

const POLL_INTERVAL_MS = 1500;
const POLL_MAX_ATTEMPTS = 120; // 3ë¶„

/**
 * job_id ìƒíƒœ í´ë§. DONE ì‹œ result, FAILED ì‹œ throw.
 */
export async function pollJobUntilDone(jobId: string): Promise<JobStatusResponse> {
  for (let i = 0; i < POLL_MAX_ATTEMPTS; i++) {
    const res = await api.get<JobStatusResponse>(`/jobs/${encodeURIComponent(jobId)}/`);
    const data = res.data;

    if (data.status === "DONE") {
      return data;
    }
    if (data.status === "FAILED") {
      const msg = data.error_message || "Export failed.";
      throw new Error(msg);
    }

    await new Promise((r) => setTimeout(r, POLL_INTERVAL_MS));
  }
  throw new Error("Export timed out. Try again later.");
}

/**
 * ì™„ë£Œ ì‹œ result.download_url ë¡œ ë¸Œë¼ìš°ì € ë‹¤ìš´ë¡œë“œ íŠ¸ë¦¬ê±°
 */
export function downloadFromUrl(url: string, filename?: string) {
  const a = document.createElement("a");
  a.href = url;
  a.download = filename || "download";
  a.rel = "noopener";
  document.body.appendChild(a);
  a.click();
  a.remove();
}


==========================================================================================
# FILE: api/jobStatus.ts
==========================================================================================
// PATH: src/shared/api/jobStatus.ts
// AI ì›Œì»¤ job ìƒíƒœ ì¡°íšŒ (ì—‘ì…€ íŒŒì‹± ë“±) â€” ë‹¨ì¼ ì§„ì‹¤. GET /api/v1/jobs/<job_id>/

import api from "@/shared/api/axios";

export type JobStatusResponse = {
  job_id: string;
  job_type: string;
  status: string;
  result?: Record<string, unknown>;
  error_message?: string | null;
  progress?: {
    step?: string;
    percent?: number;
    step_index?: number | null;
    step_total?: number | null;
    step_name?: string | null;
    step_name_display?: string | null;
    step_percent?: number | null;
  } | null;
};

export async function getJobStatus(jobId: string): Promise<JobStatusResponse> {
  const res = await api.get(
    `/jobs/${encodeURIComponent(jobId)}/`
  );
  return res.data as JobStatusResponse;
}


==========================================================================================
# FILE: appConfig/api.ts
==========================================================================================
// PATH: src/shared/appConfig/api.ts
import api from "@/shared/api/axios";
import type { AppConfig } from "./types";

/**
 * âŒ DEPRECATED / LOCKED
 *
 * Backend SSOT ê¸°ì¤€:
 * - AppConfig ë‹¨ë… ì—”ë“œí¬ì¸íŠ¸ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤.
 * - Program SSOTëŠ” /core/program/ ë‹¨ì¼ ì§„ì‹¤ì´ë‹¤.
 *
 * ì´ í•¨ìˆ˜ëŠ” ê³¼ê±° ì‹¤í—˜ í”ì ìœ¼ë¡œ ìœ ì§€ë˜ë©°,
 * í˜¸ì¶œë  ê²½ìš° ì¦‰ì‹œ ì‹¤íŒ¨í•˜ë„ë¡ ë´‰ì¸í•œë‹¤.
 *
 * âš ï¸ ì ˆëŒ€ ë³µêµ¬/í™•ì¥ ê¸ˆì§€
 */
export async function fetchAppConfig(): Promise<AppConfig> {
  throw new Error(
    "[SSOT VIOLATION] fetchAppConfig() is deprecated. Use /core/program/ only."
  );
}


==========================================================================================
# FILE: appConfig/types.ts
==========================================================================================
// PATH: src/shared/appConfig/types.ts

/**
 * âŒ DEPRECATED TYPE
 *
 * ë³¸ íƒ€ì…ì€ ê³¼ê±° AppConfig ì‹¤í—˜ ë‹¨ê³„ì—ì„œ ì‚¬ìš©ë˜ì—ˆìœ¼ë©°,
 * í˜„ì¬ Backend SSOT (Program)ì™€ ê°œë…ì ìœ¼ë¡œ ì¤‘ë³µëœë‹¤.
 *
 * - ì‹¤ì œ UI/Feature/Brand ì„¤ì •ì€ Program SSOTì—ì„œë§Œ ì œê³µëœë‹¤.
 * - ì‹ ê·œ ì½”ë“œì—ì„œ ì´ íƒ€ì… ì‚¬ìš© ê¸ˆì§€
 *
 * âš ï¸ ì‚­ì œ ëŒ€ì‹  ë´‰ì¸ ìœ ì§€ (ê³¼ê±° import ì•ˆì •ì„± ëª©ì )
 */
export type AppConfig = {
  programName: string;
  logoUrl?: string;
  primaryColor?: string;

  login: {
    title: string;
    subtitle?: string;
  };

  features?: {
    [key: string]: boolean;
  };
};


==========================================================================================
# FILE: constants/api.ts
==========================================================================================
// src/shared/constants/api.ts
export const API = {
  ATTENDANCE: "/lectures/attendance/",
};


==========================================================================================
# FILE: docs/HakwonPlus Admin Design System.md
==========================================================================================
# HakwonPlus Admin Design System

> **Code-First / SSOT ê¸°ë°˜ ì—”í„°í”„ë¼ì´ì¦ˆ ë””ìì¸ ì‹œìŠ¤í…œ**

ì´ ë¬¸ì„œëŠ” **ë””ìì´ë„ˆì™€ ê°œë°œìê°€ ë™ì¼í•œ ê·œì¹™ìœ¼ë¡œ UIë¥¼ ë§Œë“¤ê¸° ìœ„í•œ ë‹¨ì¼ ê¸°ì¤€(Single Source of Truth)**ì´ë‹¤.
Figma ë˜ëŠ” ì™¸ë¶€ ë””ìì¸ íˆ´ì„ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ì´ ë¬¸ì„œì™€ CSS í† í°ë§Œìœ¼ë¡œ ëª¨ë“  UI ì˜ì‚¬ê²°ì •ì„ ì™„ë£Œí•  ìˆ˜ ìˆë‹¤.

---

## 1. ì´ ë””ìì¸ ì‹œìŠ¤í…œì˜ í•µì‹¬ ì² í•™

### 1.1 Code-First (ë„êµ¬ ë…ë¦½)

* ë””ìì¸ì˜ ìµœì¢… ê²°ê³¼ë¬¼ì€ **ì½”ë“œ(CSS Token)**ì´ë‹¤
* ì‹œê° ë„êµ¬(Figma ë“±)ëŠ” ì„ íƒ ì‚¬í•­ì´ë©°, ë³¸ ì‹œìŠ¤í…œì€ **íˆ´ ì—†ì´ë„ ì™„ê²°**ëœë‹¤

### 1.2 SSOT (Single Source of Truth)

* ìƒ‰ìƒ, ë°€ë„, íƒ€ì´í¬, ì¸í„°ë™ì…˜ì€ **ê°ê° í•˜ë‚˜ì˜ ì§„ì‹¤ë§Œ ì¡´ì¬**í•œë‹¤
* ì»´í¬ë„ŒíŠ¸ëŠ” ì ˆëŒ€ ê°’ì„ ì •ì˜í•˜ì§€ ì•Šê³  **í•­ìƒ í† í°ë§Œ ì°¸ì¡°**í•œë‹¤

### 1.3 ì—­í•  ë¶„ë¦¬

* **Scale**: ìƒ‰ì˜ ì›ì¬ë£Œ (ì§ì ‘ ì‚¬ìš© ê¸ˆì§€)
* **Role**: ì˜ë¯¸ ìˆëŠ” ìƒ‰ (ì»´í¬ë„ŒíŠ¸ê°€ ì‚¬ìš©í•˜ëŠ” ìœ ì¼í•œ ìƒ‰)
* **Surface / Area / Layer**: í™”ë©´ êµ¬ì¡°ì™€ ê¹Šì´
* **Pattern**: ë°˜ë³µë˜ëŠ” UI ì¡°í•©
* **Component**: ì‹¤ì œ React UI

---

## 2. ë””ë ‰í† ë¦¬ êµ¬ì¡°ì™€ ì±…ì„

```
styles/design-system/
â”œâ”€ colors/
â”‚  â”œâ”€ scale/        # âŒ ì§ì ‘ ì‚¬ìš© ê¸ˆì§€
â”‚  â”œâ”€ role/         # âœ… ì»´í¬ë„ŒíŠ¸ê°€ ì‚¬ìš©í•˜ëŠ” ìƒ‰
â”‚  â””â”€ themes/       # í…Œë§ˆë³„ scale ì¬ì •ì˜
â”‚
â”œâ”€ density/         # spacing / radius / size
â”œâ”€ typography/      # font / size / weight
â”œâ”€ state/           # hover / active / focus / motion
â”œâ”€ surface/         # layer / area / elevation
â”œâ”€ patterns/        # panel / button / table / layout
â””â”€ antd/            # AntD control override
```

---

## 3. ìƒ‰ìƒ ì‚¬ìš© ê·œì¹™ (ì¤‘ìš”)

### 3.1 ì ˆëŒ€ ê¸ˆì§€ ì‚¬í•­

* âŒ `--scale-*` í† í°ì„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì§ì ‘ ì‚¬ìš©
* âŒ HEX / RGB / ìƒ‰ìƒ ë¦¬í„°ëŸ´ ì‚¬ìš©
* âŒ í…Œë§ˆ ìƒ‰ì„ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ë¶„ê¸° ì²˜ë¦¬

### 3.2 í—ˆìš© ê·œì¹™

* âœ… ì»´í¬ë„ŒíŠ¸ëŠ” **role tokenë§Œ ì‚¬ìš©**

ì˜ˆ:

```
--color-text-primary
--color-bg-surface
--color-border-divider
--color-brand-primary
```

---

## 4. í…Œë§ˆ ì‹œìŠ¤í…œ ê·œì¹™

### 4.1 í…Œë§ˆì˜ ì—­í• 

* í…Œë§ˆëŠ” **ê³µê°„(space)** ì„ ì •ì˜í•œë‹¤
* Page / Header / Sidebar / Panel ìƒ‰ì€ ëª¨ë‘ í…Œë§ˆ ì±…ì„

### 4.2 í…Œë§ˆ ìˆ˜

* Light: 8
* Dark: 4
* Brand: 4 (Kakao / Naver / Samsung / Purple)

### 4.3 ì»´í¬ë„ŒíŠ¸ ê·œì¹™

* ì»´í¬ë„ŒíŠ¸ëŠ” í…Œë§ˆë¥¼ **ì ˆëŒ€ ì¸ì§€í•˜ì§€ ì•ŠëŠ”ë‹¤**
* ê°™ì€ ì»´í¬ë„ŒíŠ¸ëŠ” ëª¨ë“  í…Œë§ˆì—ì„œ ë™ì¼í•œ ì½”ë“œë¡œ ë™ì‘í•œë‹¤

---

## 5. Area / Layer / Surface ê°œë…

### 5.1 Area (ê°•ì œ ìƒ‰ ë¶„ë¦¬)

* Page / Section / Panelì€ **ë¬´ì¡°ê±´ ë‹¤ë¥¸ ìƒ‰**ì´ì–´ì•¼ í•œë‹¤
* ë™ì¼ ìƒ‰ì´ë©´ ì„¤ê³„ ì˜¤ë¥˜

### 5.2 Layer (ì˜ë¯¸ ë ˆë²¨)

* `layer-page` : í˜ì´ì§€ ë°”ë‹¥
* `layer-panel` : ì¼ë°˜ ì‘ì—… ì˜ì—­
* `layer-focus` : í•œ í™”ë©´ 1ê°œ í•µì‹¬ ì‘ì—…

### 5.3 Dark Theme ë³´ì •

* Dark í…Œë§ˆì—ì„œëŠ” ë‹¨ê³„(step)ë¥¼ ê±´ë„ˆë›°ì–´ ëŒ€ë¹„ í™•ë³´

---

## 6. Button ì‚¬ìš© ê°€ì´ë“œ (ë””ìì´ë„ˆ í•µì‹¬)

### Intent ê·œì¹™

* `primary` : í™”ë©´ ë‚´ **1ê°œ** ê¶Œì¥ (ëª…ì‹œì  CTA)
* `secondary` : ì¼ë°˜ ì‘ì—…
* `ghost` : ì €ê°•ë„ ë³´ì¡° ì•¡ì…˜
* `danger` : íŒŒê´´ì  ì•¡ì…˜

### ê¸ˆì§€

* âŒ primary ë²„íŠ¼ ë‚¨ìš©
* âŒ dangerë¥¼ ê°•ì¡°ìƒ‰ì²˜ëŸ¼ ì‚¬ìš©

---

## 7. Panel / Section ê·œì¹™

* Primary Panel (`panel--focus`) : í•œ í™”ë©´ 1ê°œ
* Card Panel : ë³´ì¡° ì •ë³´
* Panel ìƒ‰ì€ ì ˆëŒ€ ì§ì ‘ ì§€ì •í•˜ì§€ ì•ŠëŠ”ë‹¤

---

## 8. Sidebar / Header ê·œì¹™

* Sidebar ìƒ‰ì€ **layout token ì „ìš©**
* Componentì—ì„œ sidebar ìƒ‰ ë³€ê²½ ê¸ˆì§€
* Brand í…Œë§ˆëŠ” sidebarê°€ ë¸Œëœë“œ ë©´

---

## 9. Ant Design ì‚¬ìš© ì›ì¹™

* AntDëŠ” **ê¸°ëŠ¥ ì»´í¬ë„ŒíŠ¸**ì¼ ë¿
* ì‹œê° ìŠ¤íƒ€ì¼ì€ ë””ìì¸ ì‹œìŠ¤í…œì´ ë®ì–´ì“´ë‹¤
* AntD ê¸°ë³¸ ìƒ‰ìƒ/ìŠ¤íƒ€ì¼ ì‹ ë¢° âŒ

---

## 10. QA ì²´í¬ë¦¬ìŠ¤íŠ¸ (ì¶œì‹œ ì „)

* [ ] Page / Section / Panel ìƒ‰ì´ ëª…í™•íˆ êµ¬ë¶„ë˜ëŠ”ê°€
* [ ] Sidebar activeê°€ 1ì´ˆ ë‚´ ì¸ì§€ë˜ëŠ”ê°€
* [ ] Primary ë²„íŠ¼ì´ ê³¼ë„í•˜ì§€ ì•Šì€ê°€
* [ ] Dark í…Œë§ˆì—ì„œ Panel êµ¬ë¶„ì´ ë˜ëŠ”ê°€
* [ ] Brand í…Œë§ˆ ê·œì¹™ ìœ„ë°˜ ì—†ìŒ

---

## 11. ì´ ì‹œìŠ¤í…œì˜ ëª©í‘œ

* ë””ìì´ë„ˆ ì—†ì´ë„ ìœ ì§€ ê°€ëŠ¥
* ì‹ ê·œ ì¸ì› íˆ¬ì… ì‹œ ì‚¬ê³  ë°©ì§€
* í…Œë§ˆ 20ê°œë¡œ í™•ì¥ ê°€ëŠ¥
* AI / ìë™í™” ë„êµ¬ê°€ ì‹¤ìˆ˜í•˜ì§€ ì•Šê²Œ ê°€ë“œ

---

**ì´ ë¬¸ì„œëŠ” ë³€ê²½ ì‹œ ë°˜ë“œì‹œ ì•„í‚¤í…íŠ¸ ìŠ¹ì¸ í•„ìš”**

â€” HakwonPlus Design System


==========================================================================================
# FILE: docs/KOREAN_ADMIN_DS_SEAL.md
==========================================================================================
# KOREAN ADMIN DESIGN SYSTEM â€” SEALED

## Core Principle
ìƒ‰ì€ ì¥ì‹ì´ ì•„ë‹ˆë‹¤.
í•œêµ­í˜• Adminì—ì„œ ìƒ‰ì€ "ì—…ë¬´ ìƒíƒœ ì‹ í˜¸"ë‹¤.

## Area Ownership
ë°°ê²½ìƒ‰ì€ ì˜¤ì§ Area Ownerë§Œ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.

Allowed:
- Page
- Section
- WorkZone
- MetaZone

Forbidden:
- Panel
- Card
- Table
- Form
- KPI

## Area Role Mapping
roleë§Œ ì„ ì–¸í•œë‹¤. ìƒ‰ì€ ìë™ì´ë‹¤.

- work â†’ ì‘ì—… ì˜ì—­
- kpi â†’ ìš”ì•½ / ì„±ê³¼
- log â†’ ê¸°ë¡ / ë³´ì¡° ì •ë³´

## Violation Policy
Area ì—†ì´ ë°°ê²½ì„ ê°€ì§€ë©´
â†’ ì‹œê°ì  íŒ¨í„´ìœ¼ë¡œ ì‹¤íŒ¨ë¥¼ ë“œëŸ¬ë‚¸ë‹¤.

## This Rule Is FINAL
- ë””ìì´ë„ˆ ì·¨í–¥ìœ¼ë¡œ ë³€ê²½ ë¶ˆê°€
- ê°œë°œì í¸ì˜ë¡œ ì˜ˆì™¸ ë¶ˆê°€
- AI ìë™ ìƒì„± ì½”ë“œë„ ì´ ê·œì¹™ì„ ë”°ë¥¸ë‹¤


==========================================================================================
# FILE: docs/MODAL CREATION RULES â€” SSOT (SEALED).md
==========================================================================================
ğŸ“˜ MODAL CREATION RULES â€” SSOT (SEALED)
ëª©ì 

ì´ ë¬¸ì„œëŠ” **ê´€ë¦¬ì(Admin) UIì—ì„œ ìƒì„±ë˜ëŠ” ëª¨ë“  ëª¨ë‹¬ì˜ ë‹¨ì¼ ìƒì„± ê·œì¹™(Single Source of Truth)**ì„ ì •ì˜í•œë‹¤.
í•™ìƒ(Student) ë„ë©”ì¸ì—ì„œ ì‚¬ìš© ì¤‘ì¸ ëª¨ë‹¬ êµ¬í˜„ì„ **í‘œì¤€(reference implementation)**ìœ¼ë¡œ ì‚¼ìœ¼ë©°,
ìŠ¤íƒœí”„Â·ê°•ì˜Â·ì‹œí—˜Â·ê¸°íƒ€ ëª¨ë“  ë„ë©”ì¸ì€ ì´ë¥¼ ê·¸ëŒ€ë¡œ ë”°ë¥¸ë‹¤.

ğŸ”’ ìµœìƒìœ„ ì„ ì–¸ (FINAL)

ëª¨ë‹¬ì€ í•™ìƒì´ í‘œì¤€ì´ë‹¤.
ëª¨ë“  Admin ëª¨ë‹¬ì€ í•™ìƒ ë„ë©”ì¸ì—ì„œ ì‚¬ìš© ì¤‘ì¸
AdminModal + ModalHeader + ModalBody + ModalFooter íŒ¨í„´ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•œë‹¤.

ì˜ˆì™¸, ì»¤ìŠ¤í…€, ì¬í•´ì„ ë¶ˆê°€.

1. ì ìš© ë²”ìœ„

ë‹¤ìŒì— í•´ë‹¹í•˜ëŠ” UIëŠ” ì „ë¶€ ë³¸ ê·œì¹™ì„ ë”°ë¥¸ë‹¤.

ìƒì„±(Create)

ìˆ˜ì •(Edit)

ìƒì„¸(Inspect)

ì‚­ì œ(Delete)

í™•ì¸(Confirm)

ìƒíƒœ ë³€ê²½ / ë¹„í™œì„±í™” / ë³µêµ¬ ë“± ë˜ëŒë¦´ ìˆ˜ ì—†ëŠ” ì•¡ì…˜

2. í•„ìˆ˜ ì‚¬ìš© ì»´í¬ë„ŒíŠ¸ (ê°•ì œ)
âœ… ë°˜ë“œì‹œ import í•´ì„œ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ì»´í¬ë„ŒíŠ¸
import {
  AdminModal,
  ModalHeader,
  ModalBody,
  ModalFooter,
} from "@/shared/ui/modal";


âŒ ê¸ˆì§€:

antd Modal ì§ì ‘ ì‚¬ìš©

footer/header ì§ì ‘ êµ¬í˜„

padding / border / shadow ê°œë³„ ì •ì˜

3. ê¸°ë³¸ êµ¬ì¡° (ë³€ê²½ ë¶ˆê°€)

ëª¨ë“  ëª¨ë‹¬ì€ ì•„ë˜ êµ¬ì¡°ë¥¼ ë°˜ë“œì‹œ ìœ ì§€í•´ì•¼ í•œë‹¤.

<AdminModal open={open} onClose={onClose} type="action | confirm | inspect">
  <ModalHeader
    type="action | confirm | inspect"
    title="ëª¨ë‹¬ ì œëª©"
    description="ì„ íƒ ì„¤ëª…"
  />

  <ModalBody>
    {/* ì‹¤ì œ í¼ / ì»¨í…ì¸  */}
  </ModalBody>

  <ModalFooter
    left={optional}
    right={required}
  />
</AdminModal>


ModalHeader âŒ ìƒëµ ë¶ˆê°€

ModalFooter âŒ ìƒëµ ë¶ˆê°€ (ë²„íŠ¼ì€ ì—¬ê¸°ë§Œ ìœ„ì¹˜)

4. ëª¨ë‹¬ íƒ€ì… ê·œì¹™
4.1 Action ëª¨ë‹¬ (ê¸°ë³¸)

ìƒì„± / ìˆ˜ì • / ì¼ë°˜ ì‘ì—…

ê¸°ë³¸ê°’

<AdminModal type="action" />
<ModalHeader type="action" />

4.2 Confirm ëª¨ë‹¬ (íŒŒê´´ì  ì•¡ì…˜)

ì‚­ì œ, ë¹„í™œì„±í™”, ë³µêµ¬ ë¶ˆê°€ ì‘ì—…ì€ ë¬´ì¡°ê±´ confirm.

<AdminModal type="confirm" />
<ModalHeader type="confirm" />


confirm íƒ€ì… íš¨ê³¼:

ESC âŒ

mask click âŒ

ë¹¨ê°„ accent rail

â€œë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤â€ ê²½ê³  ìë™ í‘œì‹œ

âŒ confirm ì—†ì´ delete ë²„íŠ¼ ë°°ì¹˜ ê¸ˆì§€

4.3 Inspect ëª¨ë‹¬

ì¡°íšŒ/ë¯¸ë¦¬ë³´ê¸°/ì½ê¸° ì „ìš©

<AdminModal type="inspect" />
<ModalHeader type="inspect" />

5. ë²„íŠ¼ ê·œì¹™ (SSOT)
5.1 ë²„íŠ¼ ìœ„ì¹˜

âŒ ModalBody ì•ˆì— ë²„íŠ¼ ë°°ì¹˜ ê¸ˆì§€

âŒ ì„ì˜ ìœ„ì¹˜ ë²„íŠ¼ ê¸ˆì§€

âœ… ModalFooter ì•ˆì—ì„œë§Œ ë²„íŠ¼ ë°°ì¹˜

5.2 ë²„íŠ¼ ì»´í¬ë„ŒíŠ¸
ê¸°ë³¸ ì›ì¹™

í•™ìƒ ë„ë©”ì¸ê³¼ ë™ì¼í•˜ê²Œ ì‚¬ìš©

DS ë²„íŠ¼ë§Œ í—ˆìš©

import { ActionButton } from "@/shared/ui/ds";


ë˜ëŠ” (í•™ìƒê³¼ ë™ì¼í•œ ê²½ìš°):

import { Button } from "@/shared/ui/ds";


âŒ antd Button ì§ì ‘ ì‚¬ìš© ê¸ˆì§€

5.3 ActionButton ë§¤í•‘ (ê¶Œì¥)
í–‰ìœ„	ActionButton
ìƒì„±	action="create"
ìˆ˜ì •	action="edit"
ì‚­ì œ	action="delete"
ë‹«ê¸°/ì·¨ì†Œ	action="close"
ê´€ë¦¬	action="manage"

ë¼ë²¨ ë³€ê²½ì€ í—ˆìš©:

<ActionButton action="create">ì§ì› ë“±ë¡</ActionButton>

6. ì…ë ¥ í•„ë“œ ê·œì¹™ (ì¤‘ìš”)
6.1 ì…ë ¥ ì»´í¬ë„ŒíŠ¸

í•™ìƒ ëª¨ë‹¬ ê¸°ì¤€ì„ ê·¸ëŒ€ë¡œ ë”°ë¥¸ë‹¤.

<input className="ds-input" />
<select className="ds-input" />
<textarea className="ds-textarea" />


âŒ .input, .form-control ë“± legacy class ì‚¬ìš© ê¸ˆì§€

6.2 í•„ìˆ˜ í•„ë“œ í‘œì‹œ
<input
  className="ds-input"
  data-required="true"
  data-invalid="true | false"
/>


í•„ìˆ˜ í•„ë“œëŠ” ë°˜ë“œì‹œ data-required="true"

ê²€ì¦ ì‹¤íŒ¨ ì‹œ data-invalid="true"

7. ê¸°ëŠ¥ ë³´ì¡´ ì›ì¹™ (ì ˆëŒ€ ê·œì¹™)

ëª¨ë‹¬ ë¦¬íŒ©í„°ë§ ì‹œ ë‹¤ìŒì€ ì ˆëŒ€ ë³€ê²½ ê¸ˆì§€:

API í˜¸ì¶œ

mutation ë¡œì§

ê¶Œí•œ ì²´í¬

validation ë¡œì§

alert / error ë©”ì‹œì§€ ë‚´ìš©

í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ë™ì‘

ğŸ‘‰ ê»ë°ê¸°(UI)ë§Œ êµì²´í•œë‹¤.

8. ê¸ˆì§€ ì‚¬í•­ ìš”ì•½ (ìœ„ë°˜ ì‹œ ë¡¤ë°±)

âŒ í•™ìƒê³¼ ë‹¤ë¥¸ ëª¨ë‹¬ ë ˆì´ì•„ì›ƒ

âŒ ë„ë©”ì¸ë³„ ì»¤ìŠ¤í…€ ëª¨ë‹¬ ê·œì¹™

âŒ â€œì´ ëª¨ë‹¬ì€ ì˜ˆì™¸ì…ë‹ˆë‹¤â€ ì£¼ì¥

âŒ AdminModal ì™¸ ëª¨ë‹¬ ë„ì…

9. ê¸°ì¤€ êµ¬í˜„ (Reference)

src/features/students/components/StudentCreateModal.tsx

ì´ íŒŒì¼ì´ **ëª¨ë“  ëª¨ë‹¬ì˜ ê¸°ì¤€ êµ¬í˜„(reference implementation)**ì´ë‹¤.
ì˜ì‹¬ë  ê²½ìš° í•­ìƒ ì´ íŒŒì¼ì„ ë¨¼ì € ë³¸ë‹¤.

10. ë³€ê²½ ì •ì±… (SEALED)

ë³¸ ë¬¸ì„œëŠ” ì•„í‚¤í…íŠ¸ ìŠ¹ì¸ ì—†ì´ ë³€ê²½ ë¶ˆê°€

ë””ìì¸ ì·¨í–¥, ê°œì¸ ì„ í˜¸, ë‹¨ê¸° í¸ì˜ ì‚¬ìœ ë¡œ ì˜ˆì™¸ ë¶ˆê°€

AI ìë™ ìƒì„± ì½”ë“œë„ ì´ ê·œì¹™ì„ ê°•ì œ ì ìš©

END OF DOCUMENT â€” MODAL CREATION RULES (SSOT)


==========================================================================================
# FILE: hooks/useDocumentTitle.tsx
==========================================================================================
// PATH: src/shared/hooks/useDocumentTitle.tsx
// ë¸Œë¼ìš°ì € íƒ€ì´í‹€ ë™ì  ì„¤ì • Hook

import { useEffect } from "react";
import { useProgram } from "@/shared/program";

export function useDocumentTitle(title?: string) {
  const { program } = useProgram();

  useEffect(() => {
    // ëª…ì‹œì  titleì´ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš©
    if (title) {
      document.title = title;
      return;
    }

    // Programì˜ ui_config.window_title ë˜ëŠ” display_name ì‚¬ìš©
    const windowTitle = program?.ui_config?.window_title;
    const displayName = program?.display_name;
    
    if (windowTitle) {
      document.title = windowTitle;
    } else if (displayName) {
      document.title = displayName;
    } else {
      document.title = "HakwonPlus";
    }
  }, [title, program]);
}


==========================================================================================
# FILE: hooks/useFavicon.tsx
==========================================================================================
// PATH: src/shared/hooks/useFavicon.tsx
// Favicon ë™ì  ì„¤ì • Hook

import { useEffect } from "react";
import { resolveTenantCode } from "@/shared/tenant";
import { getTenantIdFromCode } from "@/shared/tenant";
import TchulLogoIcon from "@/features/auth/pages/logos/TchulLogoIcon.png";

/**
 * í…Œë„ŒíŠ¸ì— ë”°ë¼ faviconì„ ë™ì ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
 * tchul.com í…Œë„ŒíŠ¸ì¼ ê²½ìš° Tchul ë¡œê³ ë¥¼ faviconìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
 */
export function useFavicon() {
  useEffect(() => {
    const tenantResult = resolveTenantCode();
    if (!tenantResult.ok) return;

    const tenantId = getTenantIdFromCode(tenantResult.code);
    
    // tchul í…Œë„ŒíŠ¸ (2ë²ˆ ë˜ëŠ” 9999 ë¡œì»¬)ì¸ ê²½ìš°
    const isTchul = tenantResult.code === "tchul" || tenantResult.code === "9999" || tenantId === 2;
    
    if (isTchul) {
      // ê¸°ì¡´ favicon ë§í¬ ì°¾ê¸° ë˜ëŠ” ìƒì„±
      let faviconLink = document.querySelector("link[rel='icon']") as HTMLLinkElement;
      
      if (!faviconLink) {
        faviconLink = document.createElement("link");
        faviconLink.rel = "icon";
        document.head.appendChild(faviconLink);
      }
      
      // Tchul ë¡œê³ ë¥¼ faviconìœ¼ë¡œ ì„¤ì • (ë°°ê²½ ì œê±° ì•„ì´ì½˜ ë²„ì „)
      faviconLink.href = TchulLogoIcon;
      faviconLink.type = "image/png";
    }
  }, []);
}


==========================================================================================
# FILE: hooks/useIsMobile.ts
==========================================================================================
/**
 * ì„ ìƒì•±(ê´€ë¦¬ì) ì „ìš©: ë·°í¬íŠ¸ê°€ ëª¨ë°”ì¼ í­ì´ë©´ true.
 * TeacherViewContextì˜ forceViewê°€ ìˆìœ¼ë©´ ê·¸ì— ë”°ë¦„(ëª¨ë°”ì¼/PC ë²„ì „ ê°•ì œ ë³´ê¸°).
 */
import { useEffect, useState } from "react";
import { useTeacherView } from "@/shared/ui/layout/TeacherViewContext";

/** 1024px ì´í•˜ = ëª¨ë°”ì¼ ë ˆì´ì•„ì›ƒ. í°ì—ì„œ 'ë°ìŠ¤í¬í†± ì‚¬ì´íŠ¸' ì¼œë„ ~980pxë¼ ëª¨ë°”ì¼ë¡œ ê°. */
const QUERY = "(max-width: 1023px)";

export function useIsMobile(): boolean {
  const view = useTeacherView();
  const [realMobile, setRealMobile] = useState<boolean>(() => {
    if (typeof window === "undefined") return false;
    return window.matchMedia(QUERY).matches;
  });

  useEffect(() => {
    const mql = window.matchMedia(QUERY);
    const handler = () => setRealMobile(mql.matches);
    mql.addEventListener("change", handler);
    return () => mql.removeEventListener("change", handler);
  }, []);

  if (view?.forceView === "mobile") return true;
  if (view?.forceView === "desktop") return false;
  return realMobile;
}


==========================================================================================
# FILE: program/index.tsx
==========================================================================================
// PATH: src/shared/program/index.tsx
import React, { createContext, useContext, useEffect, useState } from "react";
import api from "@/shared/api/axios";

export type Program = {
  tenantCode: string;
  display_name: string;

  ui_config: {
    logo_url?: string;
    primary_color?: string;
    login_title?: string;
    login_subtitle?: string;
    window_title?: string;
  };

  feature_flags: Record<string, boolean>;
  is_active: boolean;
};

type ProgramState = {
  program: Program | null;
  isLoading: boolean;
  refetch: () => Promise<void>;
};

const ProgramContext = createContext<ProgramState | null>(null);

export function ProgramProvider({ children }: { children: React.ReactNode }) {
  const [program, setProgram] = useState<Program | null>(null);
  const [isLoading, setIsLoading] = useState(true);

  const load = async () => {
    try {
      const res = await api.get<Program>("/core/program/");
      setProgram(res.data ?? null);
    } catch {
      setProgram(null);
    }
  };

  useEffect(() => {
    (async () => {
      try {
        await load();
      } finally {
        setIsLoading(false);
      }
    })();
  }, []);

  return (
    <ProgramContext.Provider value={{ program, isLoading, refetch: load }}>
      {children}
    </ProgramContext.Provider>
  );
}

export function useProgram() {
  const ctx = useContext(ProgramContext);
  if (!ctx) {
    throw new Error("useProgram must be used within ProgramProvider");
  }
  return ctx;
}


==========================================================================================
# FILE: tenant/config.ts
==========================================================================================
// PATH: src/shared/tenant/config.ts
/**
 * ë©€í‹°í…Œë„ŒíŠ¸ IDÂ·ë¸Œëœë”© SSOT â€” tenants/ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ íŒŒìƒ
 * 1=í•™ì›í”ŒëŸ¬ìŠ¤, 2=tchul, 3=limglish, 4=ymath, 9999=ë¡œì»¬ê°œë°œ
 */
export {
  getTenantIdFromCode,
  getTenantBranding,
  HOSTNAME_TO_TENANT_CODE,
  getLoginPathForTenantId,
  getTenantIdsWithDedicatedLogin,
  TENANTS,
} from "./tenants";
export type { TenantId, TenantBranding } from "./tenants";


==========================================================================================
# FILE: tenant/index.ts
==========================================================================================
// PATH: src/shared/tenant/index.ts
/**
 * Tenant Resolution SSOT (Enterprise / Backend-First)
 *
 * âœ… Backend SSOT:
 * - Tenant is resolved by request host (request.get_host()).
 * - Tenant.code must match host (normalized, without port).
 * - No backend fallback resolver.
 *
 * âœ… Frontend SSOT:
 * - Do NOT invent tenant codes (no aliases like "default", "2_limglish").
 * - Canonical tenant code in production = current hostname (normalized).
 *
 * Allowed explicit overrides (dev/bootstrap only):
 * - Local storage override (TENANT_STORAGE_KEY)
 * - VITE_TENANT_CODE (explicit dev override)
 *
 * Notes:
 * - Even if backend ignores X-Tenant-Code (host-based resolution), sending it is harmless
 *   and helps transitional tooling / diagnostics.
 */

import { HOSTNAME_TO_TENANT_CODE } from "./config";

export const TENANT_STORAGE_KEY = "tenant_code";

export type TenantResolveResult =
  | { ok: true; code: string; source: "storage" | "env" | "hostname" }
  | { ok: false; reason: "missing" | "invalid_host" };

function normalizeHost(host: string): string {
  const v = String(host || "").trim().toLowerCase();
  if (!v) return "";
  return v.split(":")[0].trim();
}

function safeGetHostname(): string {
  try {
    return normalizeHost(window.location.hostname || "");
  } catch {
    return "";
  }
}

export function getTenantCodeFromStorage(): string | null {
  try {
    const v = localStorage.getItem(TENANT_STORAGE_KEY);
    const code = String(v || "").trim();
    return code ? code : null;
  } catch {
    return null;
  }
}

export function setTenantCodeToStorage(code: string) {
  const v = String(code || "").trim();
  if (!v) return;
  try {
    localStorage.setItem(TENANT_STORAGE_KEY, v);
  } catch {
    // ignore
  }
}

export function clearTenantCodeFromStorage() {
  try {
    localStorage.removeItem(TENANT_STORAGE_KEY);
  } catch {
    // ignore
  }
}

export function getTenantCodeFromEnv(): string | null {
  const code = String(import.meta.env.VITE_TENANT_CODE || "").trim();
  return code ? code : null;
}

/**
 * Canonical hostname contract (prod):
 * - If hostname exists and is not local/dev-like: tenant code == hostname.
 * - For localhost/dev preview domains: require explicit override (storage/env).
 */
export function getTenantCodeFromHostname(hostname?: string): TenantResolveResult {
  const host = normalizeHost(hostname ?? safeGetHostname());
  if (!host) return { ok: false, reason: "invalid_host" };

  // Local/dev: use dev tenant 9999 from config so localhost works without env/storage.
  if (host === "localhost" || host === "127.0.0.1") {
    const devCode = HOSTNAME_TO_TENANT_CODE[host];
    if (devCode) return { ok: true, code: devCode, source: "hostname" };
    return { ok: false, reason: "missing" };
  }

  // Preview/temporary domains: require explicit override unless you truly use them as tenant codes.
  if (host.endsWith(".pages.dev") || host.endsWith(".trycloudflare.com")) {
    return { ok: false, reason: "missing" };
  }

  return { ok: true, code: host, source: "hostname" };
}

/**
 * Resolve tenant in deterministic priority order:
 * 1) storage (operator choice)
 * 2) env (explicit dev setting)
 * 3) hostname (prod canonical)
 */
export function resolveTenantCode(): TenantResolveResult {
  const stored = getTenantCodeFromStorage();
  if (stored) return { ok: true, code: stored, source: "storage" };

  const env = getTenantCodeFromEnv();
  if (env) return { ok: true, code: env, source: "env" };

  const fromHost = getTenantCodeFromHostname();
  if (fromHost.ok) return fromHost;

  return { ok: false, reason: "missing" };
}

/**
 * Header helper (API layer use):
 * - Must be deterministic and non-magical.
 * - Prefer explicit sources; do not infer from hostname here.
 */
export function getTenantCodeForHeader(): string | null {
  const stored = getTenantCodeFromStorage();
  if (stored) return stored;

  const env = getTenantCodeFromEnv();
  if (env) return env;

  return null;
}

/**
 * API ìš”ì²­ ì‹œ X-Tenant-Code ê°’ (SSOT)
 * - ì¤‘ì•™ API(api.hakwonplus.com)ë¡œ ìš”ì²­í•  ë•Œ í•„ìˆ˜.
 * - ë¡œì»¬(localhost/127.0.0.1): ê²½ë¡œ(/login/xxx)Â·sessionStorage ìš°ì„  â†’ íƒœë„ŒíŠ¸ë³„ ì™„ì „ ê²©ë¦¬(1 vs 9999).
 * - ê·¸ ì™¸: 1) hostname(ë„ë©”ì¸) 2) /login/xxx ê²½ë¡œ 3) sessionStorage
 */
export function getTenantCodeForApiRequest(): string | null {
  try {
    if (typeof window === "undefined") return null;
    const hostname = (window.location.hostname || "").trim().toLowerCase();
    const isLocal = hostname === "localhost" || hostname === "127.0.0.1";

    if (isLocal) {
      // ë¡œì»¬ì—ì„œëŠ” ê²½ë¡œÂ·sessionStorage ìš°ì„  â€” 1ë²ˆ/9999 ë“± í…Œë„ŒíŠ¸ êµ¬ë¶„
      const pathname = window.location.pathname || "";
      const parts = pathname.split("/").filter(Boolean);
      const loginIdx = parts.indexOf("login");
      const fromPath =
        loginIdx >= 0 && parts[loginIdx + 1] ? parts[loginIdx + 1] : null;
      if (fromPath) {
        try {
          sessionStorage.setItem("tenantCode", fromPath);
        } catch {}
        return fromPath;
      }
      try {
        const stored = sessionStorage.getItem("tenantCode");
        if (stored) return stored;
      } catch {}
      return HOSTNAME_TO_TENANT_CODE[hostname] ?? null;
    }

    const fromHost =
      HOSTNAME_TO_TENANT_CODE[hostname] ||
      HOSTNAME_TO_TENANT_CODE[hostname.replace(/^www\./, "")];
    if (fromHost) {
      try {
        sessionStorage.setItem("tenantCode", fromHost);
      } catch {}
      return fromHost;
    }
    // ì„œë¸Œë„ë©”ì¸(ì˜ˆ: student.hakwonplus.com) â†’ ë¶€ëª¨ ë„ë©”ì¸ í…Œë„ŒíŠ¸ ì½”ë“œ ì‚¬ìš© (í•™ìƒì•± 403 ë°©ì§€)
    const parts = hostname.split(".");
    if (parts.length >= 2) {
      const parentDomain = parts.slice(-2).join(".");
      const fromParent = HOSTNAME_TO_TENANT_CODE[parentDomain];
      if (fromParent) {
        try {
          sessionStorage.setItem("tenantCode", fromParent);
        } catch {}
        return fromParent;
      }
    }
    const pathname = window.location.pathname || "";
    const pathParts = pathname.split("/").filter(Boolean);
    const loginIdx = pathParts.indexOf("login");
    const fromPath =
      loginIdx >= 0 && pathParts[loginIdx + 1] ? pathParts[loginIdx + 1] : null;
    if (fromPath) {
      try {
        sessionStorage.setItem("tenantCode", fromPath);
      } catch {}
      return fromPath;
    }
    try {
      return sessionStorage.getItem("tenantCode");
    } catch {
      return null;
    }
  } catch {
    return null;
  }
}

export type { TenantId } from "./config";
export {
  getTenantIdFromCode,
  getTenantBranding,
  HOSTNAME_TO_TENANT_CODE,
  getLoginPathForTenantId,
  getTenantIdsWithDedicatedLogin,
  TENANTS,
} from "./config";


==========================================================================================
# FILE: tenant/tenants/hakwonplus.ts
==========================================================================================
// PATH: src/shared/tenant/tenants/hakwonplus.ts
// í…Œë„ŒíŠ¸ 1: í•™ì›í”ŒëŸ¬ìŠ¤ (ë©”ì¸)
import type { TenantDef } from "./types";

export const hakwonplus: TenantDef = {
  id: 1,
  code: "hakwonplus",
  name: "í•™ì›í”ŒëŸ¬ìŠ¤",
  hostnames: ["hakwonplus.com", "www.hakwonplus.com"],
  loginPath: "/login/hakwonplus",
  branding: {
    loginTitle: "HakwonPlus ê´€ë¦¬ì ë¡œê·¸ì¸",
    loginSubtitle: undefined,
    logoUrl: undefined,
  },
  dedicatedLoginPage: false,
};


==========================================================================================
# FILE: tenant/tenants/index.ts
==========================================================================================
// PATH: src/shared/tenant/tenants/index.ts
/**
 * í…Œë„ŒíŠ¸ ë ˆì§€ìŠ¤íŠ¸ë¦¬ SSOT â€” 5ê°œ í…Œë„ŒíŠ¸ ì •ì˜ ì§‘ê³„
 * ì¶”ê°€/ë¶„ë¦¬ ì‹œ ì´ ë””ë ‰í„°ë¦¬ ë‚´ íŒŒì¼ë§Œ ìˆ˜ì •.
 */
import type { TenantId, TenantBranding, TenantDef } from "./types";
import { hakwonplus } from "./hakwonplus";
import { tchul } from "./tchul";
import { limglish } from "./limglish";
import { ymath } from "./ymath";
import { local } from "./local";

export type { TenantId, TenantBranding, TenantDef };

export const TENANTS: readonly TenantDef[] = [
  hakwonplus,
  tchul,
  limglish,
  ymath,
  local,
] as const;

function buildMaps() {
  const hostToId: Record<string, TenantId> = {};
  const codeToId: Record<string, TenantId> = {};
  const hostnameToCode: Record<string, string> = {};
  const idToBranding: Record<TenantId, TenantBranding> = {} as Record<TenantId, TenantBranding>;

  for (const t of TENANTS) {
    codeToId[t.code] = t.id;
    codeToId[t.code.toLowerCase()] = t.id;
    idToBranding[t.id] = t.branding;
    for (const h of t.hostnames) {
      hostToId[h] = t.id;
      hostToId[h.toLowerCase()] = t.id;
      hostnameToCode[h] = t.code;
      hostnameToCode[h.toLowerCase()] = t.code;
    }
  }

  return { hostToId, codeToId, hostnameToCode, idToBranding };
}

const { hostToId, codeToId, hostnameToCode, idToBranding } = buildMaps();

export const HOST_TO_ID = hostToId;
export const CODE_TO_ID = codeToId;
/** í˜¸ìŠ¤íŠ¸ëª… â†’ ë°±ì—”ë“œ í…Œë„ŒíŠ¸ ì½”ë“œ (X-Tenant-Code í—¤ë”ìš©). ë¡œì»¬ ê°œë°œìš© 9999 í¬í•¨. */
export const HOSTNAME_TO_TENANT_CODE = hostnameToCode;
export const ID_TO_BRANDING = idToBranding;

export function getTenantIdFromCode(code: string): TenantId | null {
  const normalized = String(code ?? "").trim().toLowerCase();
  return (hostToId[normalized] ?? codeToId[normalized]) ?? null;
}

export function getTenantBranding(id: TenantId): TenantBranding {
  return idToBranding[id];
}

/** ë¡œê·¸ì¸ ë¦¬ë‹¤ì´ë ‰íŠ¸ìš©: tenantId â†’ loginPath */
export function getLoginPathForTenantId(id: TenantId): string {
  const t = TENANTS.find((x) => x.id === id);
  return t?.loginPath ?? "/login/hakwonplus";
}

/** ì „ìš© ë¡œê·¸ì¸ í˜ì´ì§€ë¥¼ ì“°ëŠ” í…Œë„ŒíŠ¸ ID ëª©ë¡ (ì˜ˆ: tchul) */
export function getTenantIdsWithDedicatedLogin(): readonly TenantId[] {
  return TENANTS.filter((t) => t.dedicatedLoginPage).map((t) => t.id);
}


==========================================================================================
# FILE: tenant/tenants/limglish.ts
==========================================================================================
// PATH: src/shared/tenant/tenants/limglish.ts
// í…Œë„ŒíŠ¸ 3: limglish
import type { TenantDef } from "./types";

export const limglish: TenantDef = {
  id: 3,
  code: "limglish",
  name: "limglish",
  hostnames: ["limglish.kr", "www.limglish.kr"],
  loginPath: "/login/limglish",
  branding: {
    loginTitle: "limglish ë¡œê·¸ì¸",
    loginSubtitle: undefined,
    logoUrl: undefined,
  },
  dedicatedLoginPage: false,
};


==========================================================================================
# FILE: tenant/tenants/local.ts
==========================================================================================
// PATH: src/shared/tenant/tenants/local.ts
// í…Œë„ŒíŠ¸ 9999: í•™ì›í”ŒëŸ¬ìŠ¤ ë¡œì»¬ ê°œë°œ/í…ŒìŠ¤íŠ¸ìš© (1ê³¼ ë™ì¼ ì•±, tenantCodeë§Œ 9999)
import type { TenantDef } from "./types";

export const local: TenantDef = {
  id: 9999,
  code: "9999",
  name: "í•™ì›í”ŒëŸ¬ìŠ¤ (ë¡œì»¬)",
  hostnames: ["localhost", "127.0.0.1"],
  loginPath: "/login/tchul",
  branding: {
    loginTitle: "ë¡œì»¬ ê°œë°œ (9999)",
    loginSubtitle: undefined,
    logoUrl: undefined,
  },
  dedicatedLoginPage: false,
};


==========================================================================================
# FILE: tenant/tenants/tchul.ts
==========================================================================================
// PATH: src/shared/tenant/tenants/tchul.ts
// í…Œë„ŒíŠ¸ 2: ë°•ì² ê³¼í•™ (tchul.com)
// ìƒ‰ìƒ/í…Œë§ˆ SSOT: @/features/auth/themes/tchul.css (í™”ì´íŠ¸í†¤ + ê·¸ë¼ë°ì´ì…˜)
import type { TenantDef } from "./types";

export const tchul: TenantDef = {
  id: 2,
  code: "tchul",
  name: "ë°•ì² ê³¼í•™",
  hostnames: ["tchul.com", "www.tchul.com"],
  loginPath: "/login/tchul",
  branding: {
    loginTitle: "ë°•ì² ê³¼í•™",
    loginSubtitle: "ê´€ë¦¬ì ë¡œê·¸ì¸",
    logoUrl: "/tenants/tchul/logo.png",
  },
  dedicatedLoginPage: true,
};


==========================================================================================
# FILE: tenant/tenants/types.ts
==========================================================================================
// PATH: src/shared/tenant/tenants/types.ts
/** í…Œë„ŒíŠ¸ ID (1=í•™ì›í”ŒëŸ¬ìŠ¤, 2=tchul, 3=limglish, 4=ymath, 9999=ë¡œì»¬ê°œë°œ) */
export type TenantId = 1 | 2 | 3 | 4 | 9999;

export type TenantBranding = {
  loginTitle: string;
  loginSubtitle?: string;
  logoUrl?: string;
};

/** ë‹¨ì¼ í…Œë„ŒíŠ¸ ì •ì˜ â€” tenants/*.ts ì—ì„œ ì‚¬ìš© */
export type TenantDef = {
  id: TenantId;
  code: string;
  name: string;
  hostnames: string[];
  loginPath: string;
  branding: TenantBranding;
  /** ì „ìš© ë¡œê·¸ì¸ í˜ì´ì§€ ì‚¬ìš© ì—¬ë¶€ (ì˜ˆ: tchul 2ì»¬ëŸ¼ ë¸Œëœë“œ í˜ì´ì§€) */
  dedicatedLoginPage: boolean;
};


==========================================================================================
# FILE: tenant/tenants/ymath.ts
==========================================================================================
// PATH: src/shared/tenant/tenants/ymath.ts
// í…Œë„ŒíŠ¸ 4: ymath
import type { TenantDef } from "./types";

export const ymath: TenantDef = {
  id: 4,
  code: "ymath",
  name: "ymath",
  hostnames: ["ymath.co.kr", "www.ymath.co.kr"],
  loginPath: "/login/ymath",
  branding: {
    loginTitle: "ymath ë¡œê·¸ì¸",
    loginSubtitle: undefined,
    logoUrl: undefined,
  },
  dedicatedLoginPage: false,
};


==========================================================================================
# FILE: ui/asyncStatus/AsyncStatusBar.tsx
==========================================================================================
// PATH: src/shared/ui/asyncStatus/AsyncStatusBar.tsx
// ìš°í•˜ë‹¨ Windows ìŠ¤íƒ€ì¼ ë¹„ë™ê¸° ìƒíƒœ ë°” â€” ì›Œì»¤ ì‘ì—… í”„ë¡œê·¸ë˜ìŠ¤ë°”ë§Œ í‘œì‹œ

import { useEffect, useRef, useState } from "react";
import { useNavigate } from "react-router-dom";
import { useQueryClient } from "@tanstack/react-query";
import api from "@/shared/api/axios";
import { feedback } from "@/shared/ui/feedback/feedback";
import { fetchInProgressVideos } from "@/features/videos/api/videos";
import { getTenantCodeForApiRequest } from "@/shared/tenant";
import { useAsyncStatus } from "./useAsyncStatus";
import { useWorkerJobPoller } from "./useWorkerJobPoller";
import { asyncStatusStore, type AsyncTask, type AsyncTaskStatus } from "./asyncStatusStore";
import "@/styles/design-system/components/AsyncStatusBar.css";
import "@/styles/design-system/ds/status.css";

function IconVideo({ className, size = 18 }: { className?: string; size?: number }) {
  return (
    <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
      <polygon points="23 7 16 12 23 17 23 7" />
      <rect x="1" y="5" width="15" height="14" rx="2" ry="2" />
    </svg>
  );
}

function IconExcel({ className, size = 18 }: { className?: string; size?: number }) {
  return (
    <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
      <path d="M14 2v6h6M8 13h2M8 17h2M16 13h2M16 17h2" />
    </svg>
  );
}

function IconOmr({ className, size = 18 }: { className?: string; size?: number }) {
  return (
    <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
      <path d="M9 11l3 3L22 4" />
      <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
    </svg>
  );
}

function IconMessage({ className, size = 18 }: { className?: string; size?: number }) {
  return (
    <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
    </svg>
  );
}

/** ì‘ì—… ìœ í˜• â†’ ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸ (ë™ì˜ìƒ, ì—‘ì…€, OMR, ë©”ì‹œì§€) */
const JOB_TYPE_ICONS: Record<string, React.ComponentType<{ className?: string; size?: number }>> = {
  message: IconMessage,
  messaging: IconMessage,
  excel_parsing: IconExcel,
  video_processing: IconVideo,
  omr: IconOmr,
  omr_scan: IconOmr,
};

/** ìƒíƒœ ë±ƒì§€: ì™„ë£Œ/ì‹¤íŒ¨ë§Œ í‘œì‹œ (ì§„í–‰ ì¤‘ì€ ë±ƒì§€ ì—†ìŒ) */
const STATUS_BADGE: Record<AsyncTaskStatus, string> = {
  pending: "",
  success: "ì™„ë£Œ",
  error: "ì‹¤íŒ¨",
};

/** ë‚¨ì€ ì˜ˆìƒì‹œê°„: API(ì›Œì»¤)ì—ì„œ ì˜¤ë©´ ìš°ì„  ì‚¬ìš©, ì—†ìœ¼ë©´ ì§„í–‰ë¥  ê¸°ë°˜ ì„ í˜• ì¶”ì •. */
function getRemainingLabel(task: AsyncTask, nowMs: number): string | null {
  if (task.status !== "pending" || task.progress == null || task.progress <= 0 || task.progress >= 100)
    return null;
  const sec = task.remainingSeconds;
  if (typeof sec === "number" && Number.isFinite(sec) && sec >= 0) {
    if (sec < 60) return `ì•½ ${Math.max(1, Math.round(sec))}ì´ˆ ë‚¨ìŒ`;
    return `ì•½ ${Math.round(sec / 60)}ë¶„ ë‚¨ìŒ`;
  }
  const created = Number(task.createdAt);
  if (!Number.isFinite(created) || !Number.isFinite(nowMs)) return null;
  const elapsedSec = (nowMs - created) / 1000;
  if (elapsedSec <= 0) return null;
  const p = Number(task.progress);
  if (!Number.isFinite(p)) return null;
  const remainingSec = (elapsedSec * (100 - p)) / p;
  if (!Number.isFinite(remainingSec) || remainingSec < 0) return null;
  if (remainingSec < 60) return `ì•½ ${Math.max(1, Math.round(remainingSec))}ì´ˆ ë‚¨ìŒ`;
  return `ì•½ ${Math.round(remainingSec / 60)}ë¶„ ë‚¨ìŒ`;
}

function StatusIcon({ status }: { status: AsyncTaskStatus }) {
  if (status === "pending")
    return (
      <svg className="async-status-bar__item-icon async-status-bar__item-icon--pending" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83" />
      </svg>
    );
  if (status === "success")
    return (
      <svg className="async-status-bar__item-icon async-status-bar__item-icon--success" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5">
        <path d="M5 13l4 4L19 7" />
      </svg>
    );
  return (
    <svg className="async-status-bar__item-icon async-status-bar__item-icon--error" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <path d="M18 6L6 18M6 6l12 12" />
    </svg>
  );
}

function TrashIcon({ className, size = 16 }: { className?: string; size?: number }) {
  return (
    <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" aria-hidden>
      <path d="M3 6h18v2l-2 14H5L3 8V6zm4 2v12h10V8H7zm2 2h2v8H9v-8zm4 0h2v8h-2v-8zM8 4h8v2H8V4z" />
    </svg>
  );
}

function RetryIcon({ className, size = 16 }: { className?: string; size?: number }) {
  return (
    <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" aria-hidden>
      <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
      <path d="M3 3v5h5" />
      <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16" />
      <path d="M16 21h5v-5" />
    </svg>
  );
}

function CancelIcon({ className, size = 16 }: { className?: string; size?: number }) {
  return (
    <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" aria-hidden>
      <circle cx="12" cy="12" r="10" />
      <path d="M15 9l-6 6M9 9l6 6" />
    </svg>
  );
}

function StopIcon({ className, size = 16 }: { className?: string; size?: number }) {
  return (
    <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="currentColor" aria-hidden>
      <rect x="6" y="6" width="12" height="12" rx="2" />
    </svg>
  );
}

function TaskItem({ task, now }: { task: AsyncTask; now: number }) {
  const navigate = useNavigate();
  const TypeIcon = task.meta?.jobType ? JOB_TYPE_ICONS[task.meta.jobType] : null;
  const remainingLabel = getRemainingLabel(task, now);
  const canRetry =
    task.meta?.jobType === "video_processing" &&
    task.meta?.jobId &&
    (task.status === "error" || task.status === "success");
  const canCancel = task.status === "pending" && task.meta?.jobId;
  const [retrying, setRetrying] = useState(false);
  const [cancelling, setCancelling] = useState(false);
  const [showActions, setShowActions] = useState(false);
  const progressNum = task.progress != null ? Math.round(task.progress) : null;
  const actionsRef = useRef<HTMLDivElement>(null);

  // âœ… ì™¸ë¶€ í´ë¦­ ì‹œ ë©”ë‰´ ë‹«ê¸°
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (actionsRef.current && !actionsRef.current.contains(event.target as Node)) {
        setShowActions(false);
      }
    };
    if (showActions) {
      document.addEventListener("mousedown", handleClickOutside);
      return () => document.removeEventListener("mousedown", handleClickOutside);
    }
  }, [showActions]);

  // âœ… ì‘ì—… í´ë¦­ ì‹œ í•´ë‹¹ í˜ì´ì§€ë¡œ ì´ë™
  const handleTaskClick = () => {
    if (!task.meta?.jobType || !task.meta?.jobId) return;
    
    const jobType = task.meta.jobType;
    const jobId = task.meta.jobId;
    
    if (jobType === "video_processing") {
      // ë¹„ë””ì˜¤ì˜ ê²½ìš° ì„¸ì…˜ ì •ë³´ê°€ í•„ìš”í•˜ì§€ë§Œ, ì¼ë‹¨ ë¹„ë””ì˜¤ IDë¡œ ì´ë™ ì‹œë„
      // ì‹¤ì œë¡œëŠ” ë¹„ë””ì˜¤ ìƒì„¸ í˜ì´ì§€ë‚˜ ì„¸ì…˜ ë¹„ë””ì˜¤ íƒ­ìœ¼ë¡œ ì´ë™í•´ì•¼ í•¨
      navigate(`/admin/videos/${jobId}`);
    } else if (jobType === "excel_parsing") {
      // ì—‘ì…€ íŒŒì‹±ì€ í•™ìƒ ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™
      navigate("/admin/students/home");
    } else if (jobType === "messaging") {
      // ë©”ì‹œì§€ í˜ì´ì§€ë¡œ ì´ë™
      navigate("/admin/messages");
    } else {
      // ê¸°íƒ€ ì‘ì—…ì€ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
      navigate("/admin/dashboard");
    }
  };

  const handleRetry = async (e: React.MouseEvent) => {
    e.stopPropagation(); // í´ë¦­ ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€
    if (task.meta?.jobType !== "video_processing" || !task.meta?.jobId || retrying) return;
    setRetrying(true);
    try {
      await api.post(`/media/videos/${task.meta.jobId}/retry/`);
      asyncStatusStore.retryTask(task.id);
      feedback.success("ì¬ì²˜ë¦¬ ìš”ì²­ì„ ë³´ëƒˆìŠµë‹ˆë‹¤.");
    } catch (e: unknown) {
      const msg =
        (e as { response?: { data?: { detail?: string } } })?.response?.data?.detail ||
        (e as Error)?.message ||
        "ì¬ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
      feedback.error(msg);
    } finally {
      setRetrying(false);
    }
  };

  const handleCancel = async (e: React.MouseEvent) => {
    e.stopPropagation(); // í´ë¦­ ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€
    if (!task.meta?.jobId || cancelling) return;
    
    const confirmed = window.confirm("ì‘ì—…ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
    if (!confirmed) return;
    
    setCancelling(true);
    try {
      const jobType = task.meta.jobType;
      if (jobType === "video_processing") {
        // ë¹„ë””ì˜¤ ì‘ì—… ì·¨ì†Œ (ì‚­ì œ)
        await api.delete(`/media/videos/${task.meta.jobId}/`);
        asyncStatusStore.removeTask(task.id);
        feedback.success("ì‘ì—…ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.");
      } else if (jobType === "excel_parsing") {
        // ì—‘ì…€ ì‘ì—… ì·¨ì†Œ (API í™•ì¸ í•„ìš”)
        // ì¼ë‹¨ ì‘ì—…ë§Œ ì œê±°
        asyncStatusStore.removeTask(task.id);
        feedback.success("ì‘ì—…ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.");
      } else {
        // ê¸°íƒ€ ì‘ì—…ì€ ì‘ì—…ë§Œ ì œê±°
        asyncStatusStore.removeTask(task.id);
        feedback.success("ì‘ì—…ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.");
      }
    } catch (e: unknown) {
      const msg =
        (e as { response?: { data?: { detail?: string } } })?.response?.data?.detail ||
        (e as Error)?.message ||
        "ì‘ì—… ì·¨ì†Œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
      feedback.error(msg);
    } finally {
      setCancelling(false);
    }
  };

  return (
    <div 
      className="async-status-bar__item"
      onClick={handleTaskClick}
      style={{ cursor: "pointer" }}
    >
      <div className="async-status-bar__item-row">
        <StatusIcon status={task.status} />
        <div className="async-status-bar__item-body">
          <div className="async-status-bar__item-top">
            {STATUS_BADGE[task.status] && (
              <span
                className="async-status-bar__status-badge ds-status-badge"
                data-tone={task.status === "success" ? "success" : "danger"}
                aria-hidden
              >
                {STATUS_BADGE[task.status]}
              </span>
            )}
            {TypeIcon && (
              <span className="async-status-bar__type-icon" aria-hidden>
                <TypeIcon className="async-status-bar__type-icon-svg" size={18} />
              </span>
            )}
            <span className="async-status-bar__item-label-text">{task.label}</span>
            {remainingLabel != null && (
              <span className="async-status-bar__item-remaining">{remainingLabel}</span>
            )}
            {task.status === "pending" && progressNum == null && (
              <span className="async-status-bar__item-waiting">ëŒ€ê¸° ì¤‘</span>
            )}
          </div>
          {task.error && <div className="async-status-bar__item-error">{task.error}</div>}
        </div>
        <div 
          className="async-status-bar__item-actions" 
          onClick={(e) => e.stopPropagation()}
          ref={actionsRef}
          style={{ position: "relative" }}
        >
          {/* âœ… ì§„í–‰ ì¤‘ì¸ ì‘ì—…: ì¤‘ì§€ ë²„íŠ¼ë§Œ í‘œì‹œ */}
          {canCancel && (
            <>
              <button
                type="button"
                className="async-status-bar__item-btn async-status-bar__item-btn--stop"
                onClick={(e) => {
                  e.stopPropagation();
                  setShowActions(!showActions);
                }}
                title="ì¤‘ì§€"
                aria-label="ì¤‘ì§€"
              >
                <StopIcon size={14} />
              </button>
              {/* âœ… ì¤‘ì§€ í´ë¦­ ì‹œ ë‚˜íƒ€ë‚˜ëŠ” ë©”ë‰´ */}
              {showActions && (
                <div className="async-status-bar__actions-menu">
                  <button
                    type="button"
                    className="async-status-bar__actions-menu-item"
                    onClick={(e) => {
                      e.stopPropagation();
                      setShowActions(false);
                      handleCancel(e);
                    }}
                    disabled={cancelling}
                  >
                    <CancelIcon size={14} />
                    <span>ì·¨ì†Œ</span>
                  </button>
                  <button
                    type="button"
                    className="async-status-bar__actions-menu-item"
                    onClick={(e) => {
                      e.stopPropagation();
                      setShowActions(false);
                      asyncStatusStore.removeTask(task.id);
                    }}
                  >
                    <TrashIcon size={14} />
                    <span>ì‚­ì œ</span>
                  </button>
                </div>
              )}
            </>
          )}
          {/* âœ… ì™„ë£Œ/ì‹¤íŒ¨ ì‘ì—…: ì¬ì‹œë„ ë²„íŠ¼ë§Œ í‘œì‹œ */}
          {canRetry && (
            <>
              <button
                type="button"
                className="async-status-bar__item-btn async-status-bar__item-btn--stop"
                onClick={(e) => {
                  e.stopPropagation();
                  setShowActions(!showActions);
                }}
                title="ì¤‘ì§€"
                aria-label="ì¤‘ì§€"
              >
                <StopIcon size={14} />
              </button>
              {/* âœ… ì¤‘ì§€ í´ë¦­ ì‹œ ë‚˜íƒ€ë‚˜ëŠ” ë©”ë‰´ */}
              {showActions && (
                <div className="async-status-bar__actions-menu">
                  <button
                    type="button"
                    className="async-status-bar__actions-menu-item"
                    onClick={(e) => {
                      e.stopPropagation();
                      setShowActions(false);
                      handleRetry(e);
                    }}
                    disabled={retrying}
                  >
                    <RetryIcon size={14} />
                    <span>ì¬ì‹œë„</span>
                  </button>
                  <button
                    type="button"
                    className="async-status-bar__actions-menu-item"
                    onClick={(e) => {
                      e.stopPropagation();
                      setShowActions(false);
                      asyncStatusStore.removeTask(task.id);
                    }}
                  >
                    <TrashIcon size={14} />
                    <span>ì‚­ì œ</span>
                  </button>
                </div>
              )}
            </>
          )}
          {/* âœ… ì™„ë£Œëœ ì‘ì—…: ì‚­ì œ ë²„íŠ¼ë§Œ í‘œì‹œ */}
          {!canCancel && !canRetry && (
            <button
              type="button"
              className="async-status-bar__item-btn async-status-bar__item-btn--delete"
              onClick={(e) => {
                e.stopPropagation();
                asyncStatusStore.removeTask(task.id);
              }}
              title="ì‚­ì œ"
              aria-label="ì‚­ì œ"
            >
              <TrashIcon size={14} />
            </button>
          )}
        </div>
      </div>
      {task.status === "pending" && (
        <div className="async-status-bar__progress-wrap">
          {task.encodingStep ? (
            <>
              {/* âœ… ë‹¨ê³„ë³„ í”„ë¡œê·¸ë˜ìŠ¤ë°”: ê° ë‹¨ê³„ë§ˆë‹¤ 0~100% ì§„í–‰ */}
              {/* ì˜ˆ: [1/7] íŒŒì¼ ë‹¤ìš´ë¡œë“œ */}
              <div className="async-status-bar__step-label">
                <span className="async-status-bar__step-prefix">[{task.encodingStep.index}/{task.encodingStep.total}]</span>{" "}
                <span className="async-status-bar__step-name">{task.encodingStep.name}</span>
              </div>
              <div className="async-status-bar__progress-row">
                <div className="async-status-bar__progress">
                  <div
                    className="async-status-bar__progress-fill"
                    style={{ width: `${task.encodingStep.percent}%` }}
                  />
                </div>
                <span className="async-status-bar__progress-pct">
                  {task.encodingStep.percent}%
                </span>
              </div>
              {/* âœ… ì „ì²´ ì§„í–‰ë¥ ë„ í•¨ê»˜ í‘œì‹œ (ì„ íƒì ) */}
              {task.progress != null && task.progress > 0 && (
                <div className="async-status-bar__overall-progress">
                  ì „ì²´ ì§„í–‰ë¥ : {Math.round(task.progress)}%
                </div>
              )}
            </>
          ) : (
            /* ë‹¨ê³„ ì •ë³´ê°€ ì—†ì„ ë•Œ ì „ì²´ ì§„í–‰ë¥  í‘œì‹œ */
            <div className="async-status-bar__progress-row">
              <div className="async-status-bar__progress">
                <div
                  className={
                    task.progress != null
                      ? "async-status-bar__progress-fill"
                      : "async-status-bar__progress-fill async-status-bar__progress-fill--indeterminate"
                  }
                  style={
                    task.progress != null
                      ? { width: `${task.progress}%` }
                      : undefined
                  }
                />
              </div>
              {task.progress != null && (
                <span className="async-status-bar__progress-pct" aria-hidden>
                  {Math.round(task.progress)}%
                </span>
              )}
            </div>
          )}
        </div>
      )}
    </div>
  );
}

export default function AsyncStatusBar() {
  const queryClient = useQueryClient();
  const tasks = useAsyncStatus();
  const [expanded, setExpanded] = useState(false);
  const prevPendingCountRef = useRef(0);
  const hydratedRef = useRef(false);

  const displayTasks = tasks;
  const pendingCount = displayTasks.filter((t) => t.status === "pending").length;

  const [now, setNow] = useState(() => Date.now());
  useEffect(() => {
    if (pendingCount === 0) return;
    const id = setInterval(() => setNow(Date.now()), 1000);
    return () => clearInterval(id);
  }, [pendingCount]);

  // ìƒˆë¡œê³ ì¹¨ í›„ì—ë„ ì§„í–‰ ì¤‘ì¸ ì˜ìƒ ì¸ì½”ë”©ì„ ì‘ì—… ë°•ìŠ¤ì— ë³µì› (íƒœë„ŒíŠ¸ë³„)
  // 9999(ë¡œì»¬ ê°œë°œ)ì—ì„œëŠ” ë³µì› ìƒëµ â€” ì˜¬ë¦¬ì§€ ì•Šì€ ì‘ì—…ì´ ëœ¨ëŠ” í˜„ìƒ ë°©ì§€
  useEffect(() => {
    if (hydratedRef.current) return;
    hydratedRef.current = true;
    const tenant = getTenantCodeForApiRequest() ?? "";
    if (tenant === "9999") return;

    fetchInProgressVideos()
      .then((videos) => {
        const existing = new Set(
          asyncStatusStore
            .getState()
            .filter(
              (t) =>
                t.meta?.jobType === "video_processing" &&
                (t.tenantScope ?? "") === tenant
            )
            .map((t) => t.id)
        );
        videos.forEach((v) => {
          const id = String(v.id);
          if (existing.has(id)) return;
          asyncStatusStore.addWorkerJob(v.title || `ì˜ìƒ ${id}`, id, "video_processing");
        });
      })
      .catch(() => {});
  }, []);

  // ìƒˆ ì‘ì—…ì´ ì¶”ê°€ë˜ë©´ ì‘ì—… ë°•ìŠ¤ ìë™ í¼ì¹˜ê¸° â€” ì‚¬ìš©ìê°€ ë°±ê·¸ë¼ìš´ë“œ ì§„í–‰ì„ ë°”ë¡œ í™•ì¸í•  ìˆ˜ ìˆê²Œ
  useEffect(() => {
    if (pendingCount > prevPendingCountRef.current && pendingCount > 0) {
      setExpanded(true);
    }
    prevPendingCountRef.current = pendingCount;
  }, [pendingCount]);

  const workerTasks = tasks.filter((t) => t.meta?.jobId);
  useWorkerJobPoller(tasks, {
    onExcelSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["lecture-enrollments"] });
      queryClient.invalidateQueries({ queryKey: ["attendance-matrix"] });
      queryClient.invalidateQueries({ queryKey: ["sessions"] });
      queryClient.invalidateQueries({ queryKey: ["lecture"] });
      queryClient.invalidateQueries({ queryKey: ["students"] });
    },
    onVideoSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["session-videos"] });
    },
  });

  const errorCount = displayTasks.filter((t) => t.status === "error").length;

  const triggerLabel =
    displayTasks.length === 0
      ? "ì‘ì—…"
      : pendingCount > 0
        ? `ì§„í–‰ ì¤‘ ${displayTasks.length}ê±´`
        : errorCount > 0
          ? `ì‹¤íŒ¨ ${errorCount}ê±´`
          : `${displayTasks.length}ê±´ ì™„ë£Œ`;

  // í•­ìƒ ìš°í•˜ë‹¨ì— ì‘ì—… ë°•ìŠ¤ í‘œì‹œ (ì‘ì—… ì—†ì„ ë•Œë„ ì ‘íŒ ìƒíƒœë¡œ ìœ ì§€)
  return (
    <div
      className={`async-status-bar ${expanded ? "async-status-bar--expanded" : "async-status-bar--collapsed"} ${errorCount > 0 ? "async-status-bar--has-error" : ""}`}
      role="region"
      aria-label="ë¹„ë™ê¸° ì‘ì—… ìƒíƒœ"
    >
      {/* ì ‘ì—ˆì„ ë•Œ: Windows ì•Œë¦¼ì²˜ëŸ¼ ì‘ì€ ì°½ */}
      <button
        type="button"
        className="async-status-bar__trigger"
        onClick={() => setExpanded(true)}
        aria-expanded={expanded}
      >
        <svg className="async-status-bar__trigger-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83" />
        </svg>
        <span className="async-status-bar__trigger-count">{triggerLabel}</span>
      </button>

      {/* í¼ì³¤ì„ ë•Œ: ëª©ë¡ íŒ¨ë„ */}
      <div className="async-status-bar__panel">
        <div className="async-status-bar__header">
          <span>ì‘ì—…</span>
          <div className="async-status-bar__header-actions">
            <button
              type="button"
              className="async-status-bar__header-btn"
              onClick={() => asyncStatusStore.clearCompleted()}
              title="ì™„ë£Œëœ í•­ëª© ì§€ìš°ê¸°"
              aria-label="ì™„ë£Œëœ í•­ëª© ì§€ìš°ê¸°"
            >
              <TrashIcon size={18} />
            </button>
            <button
              type="button"
              className="async-status-bar__header-btn"
              onClick={() => setExpanded(false)}
              title="ì ‘ê¸°"
              aria-label="ì ‘ê¸°"
            >
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M18 15l-6-6-6 6" />
              </svg>
            </button>
          </div>
        </div>
        <div className="async-status-bar__list">
          {displayTasks.length === 0 ? (
            <div className="async-status-bar__empty">ì§„í–‰ ì¤‘ì¸ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</div>
          ) : (
            displayTasks.map((task) => <TaskItem key={task.id} task={task} now={now} />)
          )}
        </div>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: ui/asyncStatus/asyncStatusStore.ts
==========================================================================================
// PATH: src/shared/ui/asyncStatus/asyncStatusStore.ts
// ì „ì—­ ë¹„ë™ê¸° ìƒíƒœ SSOT â€” ì›Œì»¤ ì‘ì—… í”„ë¡œê·¸ë˜ìŠ¤ë°”ë§Œ ìš°í•˜ë‹¨ì— í‘œì‹œ
//
// ì›Œì»¤ ì‘ì—…(ì—‘ì…€ ìˆ˜ê°•ë“±ë¡, ë¹„ë””ì˜¤ ì¸ì½”ë”© ë“±): ì—…ë¡œë“œ í›„ ëª¨ë‹¬ ë‹«ê³  ìš°í•˜ë‹¨ì—ì„œ ì§„í–‰ë¥  í‘œì‹œ
//   const taskId = asyncStatusStore.addWorkerJob('ì—‘ì…€ ìˆ˜ê°•ë“±ë¡', jobId, 'excel_parsing');
//   // ì „ì—­ í´ë§ì´ progress/status ê°±ì‹  í›„ completeTask í˜¸ì¶œ
// ì‘ì—… ëª©ë¡ì€ íƒœë„ŒíŠ¸(ë„ë©”ì¸)ë³„ë¡œ ê²©ë¦¬ â€” í˜„ì¬ í…Œë„ŒíŠ¸ ì‘ì—…ë§Œ í‘œì‹œ

import { getTenantCodeForApiRequest } from "@/shared/tenant";

export type AsyncTaskStatus = "pending" | "success" | "error";

export interface AsyncTaskMeta {
  jobId: string;
  jobType: string;
}

/** ì˜ìƒ ì¸ì½”ë”© êµ¬ê°„ë³„ ì§„í–‰ (n/7) ë‹¨ê³„ëª… + êµ¬ê°„ ë‚´ 0~100% */
export interface EncodingStep {
  index: number;
  total: number;
  name: string;
  percent: number;
}

export interface AsyncTask {
  id: string;
  label: string;
  status: AsyncTaskStatus;
  /** 0..100, ì§„í–‰ ì¤‘ì¼ ë•Œë§Œ ì‚¬ìš© (ì›Œì»¤ Redis progress) */
  progress?: number;
  /** ì˜ˆìƒ ë‚¨ì€ ì‹œê°„(ì´ˆ). APIì—ì„œ ì˜¤ë©´ ì´ê±¸ ìš°ì„  í‘œì‹œ */
  remainingSeconds?: number | null;
  /** ì˜ìƒ ì¸ì½”ë”© ì‹œ êµ¬ê°„ë³„ í‘œì‹œ (2/7 ì¸ì½”ë”© 45% ë“±) */
  encodingStep?: EncodingStep | null;
  error?: string;
  createdAt: number;
  /** ìˆìœ¼ë©´ ì›Œì»¤ ì‘ì—… â€” ìš°í•˜ë‹¨ ì‘ì—… ì•ŒëŒì°½ì—ë§Œ í‘œì‹œ, í´ë§ ëŒ€ìƒ */
  meta?: AsyncTaskMeta;
  /** íƒœë„ŒíŠ¸(ë„ë©”ì¸)ë³„ ê²©ë¦¬ â€” ì´ í‚¤ì™€ ì¼ì¹˜í•˜ëŠ” í…Œë„ŒíŠ¸ì—ì„œë§Œ ì‘ì—… í‘œì‹œ */
  tenantScope?: string;
}

type Listener = (tasks: AsyncTask[]) => void;

let tasks: AsyncTask[] = [];
const listeners = new Set<Listener>();

function emit() {
  const snapshot = [...tasks];
  listeners.forEach((cb) => cb(snapshot));
}

function generateId(): string {
  return `async-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;
}

/** ë¼ë²¨ ì¶”ë¡ : URL ê²½ë¡œ ë§ˆì§€ë§‰ ë˜ëŠ” ë©”ì„œë“œ+ê²½ë¡œ */
function defaultLabel(method: string, url?: string): string {
  if (!url) return "ìš”ì²­ ì¤‘â€¦";
  const path = url.replace(/^.*\/api\/v1/, "").split("?")[0].trim() || "/";
  const parts = path.split("/").filter(Boolean);
  const last = parts[parts.length - 1];
  if (last && !/^\d+$/.test(last)) return `${method.toUpperCase()} ${last}`;
  const resource = parts[parts.length - 2] || "ìš”ì²­";
  return `${method.toUpperCase()} ${resource}`;
}

export const asyncStatusStore = {
  getState(): AsyncTask[] {
    return [...tasks];
  },

  subscribe(listener: Listener): () => void {
    listeners.add(listener);
    return () => listeners.delete(listener);
  },

  /** í˜„ì¬ í…Œë„ŒíŠ¸ ì½”ë“œ (ì‘ì—… ì¶”ê°€ ì‹œì ì— ì €ì¥ë˜ì–´ í‘œì‹œ ì‹œ í•„í„°ì— ì‚¬ìš©) */
  _getTenantScope(): string {
    return getTenantCodeForApiRequest() ?? "";
  },

  /**
   * ìƒˆ ì‘ì—… ì¶”ê°€ (ì¼ë°˜)
   */
  addTask(label: string, id?: string): string {
    const taskId = id ?? generateId();
    tasks = [
      ...tasks.filter((t) => t.id !== taskId),
      {
        id: taskId,
        label,
        status: "pending" as const,
        createdAt: Date.now(),
        tenantScope: this._getTenantScope(),
      },
    ];
    emit();
    return taskId;
  },

  /**
   * ì›Œì»¤ ì‘ì—… ì¶”ê°€ â€” ìš°í•˜ë‹¨ ì‘ì—… ì•ŒëŒì°½ì— ì‹¤ì‹œê°„ í”„ë¡œê·¸ë˜ìŠ¤ë°”ë¡œ í‘œì‹œë¨.
   * jobIdë¥¼ idë¡œ ì‚¬ìš©í•˜ì—¬ í´ë§ ì‹œ status/progress ê°±ì‹ .
   */
  addWorkerJob(label: string, jobId: string, jobType: string): string {
    tasks = [
      ...tasks.filter((t) => t.id !== jobId),
      {
        id: jobId,
        label,
        status: "pending" as const,
        createdAt: Date.now(),
        meta: { jobId, jobType },
        tenantScope: this._getTenantScope(),
      },
    ];
    emit();
    return jobId;
  },

  /** ì™„ë£Œ ì²˜ë¦¬ (ì„±ê³µ/ì‹¤íŒ¨) */
  completeTask(id: string, status: "success" | "error", error?: string): void {
    tasks = tasks.map((t) =>
      t.id === id ? { ...t, status, progress: 100, error } : t
    );
    emit();
  },

  /** ì§„í–‰ë¥  ê°±ì‹  (ë‚¨ì€ ì‹œê°„Â·êµ¬ê°„ ì •ë³´ ìˆìœ¼ë©´ í•¨ê»˜ ì €ì¥) */
  updateProgress(
    id: string,
    progress: number,
    remainingSeconds?: number | null,
    encodingStep?: EncodingStep | null
  ): void {
    tasks = tasks.map((t) =>
      t.id === id
        ? {
            ...t,
            progress: Math.min(100, Math.max(0, progress)),
            remainingSeconds: remainingSeconds ?? t.remainingSeconds,
            encodingStep: encodingStep ?? t.encodingStep,
          }
        : t
    );
    emit();
  },

  /** ë¼ë²¨ë§Œ ë³€ê²½ */
  setTaskLabel(id: string, label: string): void {
    tasks = tasks.map((t) => (t.id === id ? { ...t, label } : t));
    emit();
  },

  /** í•­ëª© ì œê±° (ì‚¬ìš©ìê°€ íœ´ì§€í†µìœ¼ë¡œ ì‚­ì œ) */
  removeTask(id: string): void {
    tasks = tasks.filter((t) => t.id !== id);
    emit();
  },

  /** ì—…ë¡œë“œ íƒœìŠ¤í¬ë¥¼ ì›Œì»¤ ì‘ì—…ìœ¼ë¡œ ì „í™˜ (ì˜ìƒ: ì—…ë¡œë“œ ì™„ë£Œ í›„ í´ë§ ëŒ€ìƒìœ¼ë¡œ ì—°ê²°) */
  attachWorkerMeta(tempId: string, jobId: string, jobType: string): void {
    const idx = tasks.findIndex((t) => t.id === tempId);
    if (idx === -1) return;
    const t = tasks[idx];
    const next = {
      ...t,
      id: jobId,
      progress: t.progress ?? 0,
      meta: { jobId, jobType },
      tenantScope: t.tenantScope ?? this._getTenantScope(),
    };
    tasks = [...tasks.slice(0, idx), ...tasks.slice(idx + 1)].filter((x) => x.id !== jobId);
    tasks = [...tasks, next];
    emit();
  },

  /** ì¬ì²˜ë¦¬: í•´ë‹¹ í•­ëª©ì„ ë‹¤ì‹œ pendingìœ¼ë¡œ (API ì¬í˜¸ì¶œì€ í˜¸ì¶œì¸¡ì—ì„œ ìˆ˜í–‰) */
  retryTask(id: string): void {
    tasks = tasks.map((t) =>
      t.id === id ? { ...t, status: "pending" as const, progress: 0, error: undefined } : t
    );
    emit();
  },

  /** ì™„ë£Œëœ í•­ëª© ì¼ê´„ ì œê±° (íœ´ì§€í†µ) â€” í˜„ì¬ í…Œë„ŒíŠ¸ ì†Œì†ë§Œ ì œê±°, í…Œë„ŒíŠ¸ ê²©ë¦¬ */
  clearCompleted(): void {
    const scope = this._getTenantScope();
    tasks = tasks.filter(
      (t) => t.status === "pending" || (t.tenantScope ?? "") !== scope
    );
    emit();
  },

  /** API ìš”ì²­ìš©: meta.asyncTrack === true ì¼ ë•Œë§Œ ë“±ë¡ (ê¸°ë³¸ì€ ë¯¸ë“±ë¡ â€” ì›Œì»¤ ì‘ì—…ë§Œ ì•ŒëŒì°½ì— í‘œì‹œ) */
  trackRequest(method: string, url?: string, config?: { meta?: { asyncLabel?: string; asyncTrack?: boolean }; _asyncId?: string }): string | null {
    if (!config?.meta?.asyncTrack) return null;
    const id = config?._asyncId ?? generateId();
    const label = config?.meta?.asyncLabel ?? defaultLabel(method, url);
    this.addTask(label, id);
    return id;
  },
};


==========================================================================================
# FILE: ui/asyncStatus/index.ts
==========================================================================================
// PATH: src/shared/ui/asyncStatus/index.ts
export { default as AsyncStatusBar } from "./AsyncStatusBar";
export { useAsyncStatus, asyncStatusStore } from "./useAsyncStatus";
export type { AsyncTask, AsyncTaskStatus, AsyncTaskMeta } from "./asyncStatusStore";


==========================================================================================
# FILE: ui/asyncStatus/useAsyncStatus.ts
==========================================================================================
// PATH: src/shared/ui/asyncStatus/useAsyncStatus.ts
// í˜„ì¬ í…Œë„ŒíŠ¸(ë„ë©”ì¸)ì— í•´ë‹¹í•˜ëŠ” ì‘ì—…ë§Œ ë°˜í™˜ â€” ë‹¤ë¥¸ íƒœë„ŒíŠ¸ íƒ­/ì „í™˜ ì‹œ ê²©ë¦¬
import { useEffect, useState } from "react";
import { getTenantCodeForApiRequest } from "@/shared/tenant";
import { asyncStatusStore, type AsyncTask } from "./asyncStatusStore";

export function useAsyncStatus(): AsyncTask[] {
  const [state, setState] = useState<AsyncTask[]>(() => asyncStatusStore.getState());

  useEffect(() => {
    return asyncStatusStore.subscribe(setState);
  }, []);

  const currentTenant = getTenantCodeForApiRequest() ?? "";
  // í…Œë„ŒíŠ¸ë³„ ì™„ì „ ê²©ë¦¬: í˜„ì¬ í…Œë„ŒíŠ¸ì™€ tenantScopeê°€ ì¼ì¹˜í•˜ëŠ” ì‘ì—…ë§Œ í‘œì‹œ
  return state.filter((t) => {
    const scope = t.tenantScope ?? "";
    return scope === currentTenant;
  });
}

export { asyncStatusStore };


==========================================================================================
# FILE: ui/asyncStatus/useWorkerJobPoller.ts
==========================================================================================
// PATH: src/shared/ui/asyncStatus/useWorkerJobPoller.ts
// ì›Œì»¤ ì‘ì—…(ì—‘ì…€Â·ì˜ìƒ ë“±) ìƒíƒœ/ì§„í–‰ë¥  í´ë§ â€” ìš°í•˜ë‹¨ í”„ë¡œê·¸ë˜ìŠ¤ë°” ê°±ì‹  ë° ì™„ë£Œ ì²˜ë¦¬
// âœ… Redis-only ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš© (DB ë¶€í•˜ 0)
// ì—‘ì…€: GET /jobs/<id>/progress/. ì˜ìƒ: GET /media/videos/<id>/progress/.
// í˜„ì¬ í…Œë„ŒíŠ¸ ì‘ì—…ë§Œ í´ë§ (íƒœë„ŒíŠ¸ ê²©ë¦¬).

import { useEffect, useRef } from "react";
import { getTenantCodeForApiRequest } from "@/shared/tenant";
import { asyncStatusStore } from "./asyncStatusStore";
// âœ… getJobStatusëŠ” ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ (progress ì—”ë“œí¬ì¸íŠ¸ë¡œ ì „í™˜)
import api from "@/shared/api/axios";

const POLL_INTERVAL_MS = 1000;

function pollExcelJob(
  taskId: string,
  onSuccess?: () => void
) {
  // âœ… Redis-only ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš© (DB ë¶€í•˜ 0)
  api
    .get<{
      job_id: string;
      job_type: string;
      status: string;
      progress?: {
        step?: string;
        percent?: number;
        step_index?: number | null;
        step_total?: number | null;
        step_name?: string | null;
        step_name_display?: string | null;
        step_percent?: number | null;
      } | null;
      result?: Record<string, unknown>;
      error_message?: string | null;
    }>(`/jobs/${encodeURIComponent(taskId)}/progress/`)
    .then((res) => {
      const status = res.data?.status;
      
      // âœ… UNKNOWN ìƒíƒœ ì²˜ë¦¬ (Redis TTL ë§Œë£Œ ë“±)
      if (status === "UNKNOWN") {
        // ë‹¤ìŒ í´ë§ì—ì„œ ì¬ì‹œë„ (í´ë§ ê³„ì† ì§„í–‰)
        return;
      }
      
      const progress = res.data?.progress;
      const percent = progress?.percent;
      const stepIndex = progress?.step_index;
      const stepTotal = progress?.step_total;
      const stepName = progress?.step_name_display || progress?.step_name;
      const stepPercent = progress?.step_percent;
      
      // âœ… ë‹¨ê³„ ì •ë³´ êµ¬ì„± (ë‹¨ê³„ ì •ë³´ê°€ ìˆìœ¼ë©´ í•­ìƒ ì „ë‹¬)
      const encodingStep =
        typeof stepIndex === "number" &&
        typeof stepTotal === "number" &&
        typeof stepName === "string" &&
        typeof stepPercent === "number"
          ? { index: stepIndex, total: stepTotal, name: stepName, percent: stepPercent }
          : null;
      
      // âœ… RUNNING ìƒíƒœì—ì„œ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ (ë‹¨ê³„ ì •ë³´ê°€ ìˆìœ¼ë©´ í•­ìƒ ì „ë‹¬)
      if (status === "RUNNING") {
        // percentê°€ ì—†ì–´ë„ ë‹¨ê³„ ì •ë³´ë§Œ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸ (ë‹¨ê³„ë³„ ì§„í–‰ë¥  í‘œì‹œ)
        const finalPercent = typeof percent === "number" ? percent : (encodingStep ? Math.round((encodingStep.index - 1) / encodingStep.total * 100 + (encodingStep.percent / encodingStep.total)) : undefined);
        if (finalPercent !== undefined || encodingStep) {
          asyncStatusStore.updateProgress(taskId, finalPercent ?? 0, undefined, encodingStep);
        }
      }
      
      // âœ… ì™„ë£Œ/ì‹¤íŒ¨ ìƒíƒœ ì²˜ë¦¬
      const errMsg = res.data?.error_message?.trim();
      const isFailed = status === "FAILED" || 
                       status === "REJECTED_BAD_INPUT" || 
                       status === "FALLBACK_TO_GPU" || 
                       status === "REVIEW_REQUIRED" ||
                       (status === "DONE" && errMsg);
      
      if (isFailed) {
        asyncStatusStore.completeTask(
          taskId,
          "error",
          errMsg || "ì²˜ë¦¬ ì‹¤íŒ¨"
        );
      } else if (status === "DONE") {
        onSuccess?.();
        asyncStatusStore.completeTask(taskId, "success");
      }
    })
    .catch(() => {
      // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ì¬ì‹œë„ëŠ” ë‹¤ìŒ í´ë§ì—ì„œ
    });
}

function pollVideoJob(taskId: string, videoId: string, onSuccess?: () => void) {
  // âœ… Redis-only ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš© (DB ë¶€í•˜ 0)
  api
    .get<{
      id: number;
      status: string;
      encoding_progress?: number | null;
      encoding_remaining_seconds?: number | null;
      encoding_step_index?: number | null;
      encoding_step_total?: number | null;
      encoding_step_name?: string | null;
      encoding_step_percent?: number | null;
      hls_path?: string | null;
      duration?: number | null;
      error_reason?: string | null;
      message?: string; // UNKNOWN ìƒíƒœ ì‹œ
    }>(`/media/videos/${videoId}/progress/`)
    .then((res) => {
      const status = res.data?.status;
      
      // âœ… UNKNOWN ìƒíƒœ ì²˜ë¦¬ (Redis TTL ë§Œë£Œ ë“±)
      if (status === "UNKNOWN") {
        // ë‹¤ìŒ í´ë§ì—ì„œ ì¬ì‹œë„ (í´ë§ ê³„ì† ì§„í–‰)
        return;
      }
      
      const encodingProgress = res.data?.encoding_progress;
      const remainingSeconds = res.data?.encoding_remaining_seconds ?? null;
      const stepIndex = res.data?.encoding_step_index;
      const stepTotal = res.data?.encoding_step_total;
      const stepName = res.data?.encoding_step_name;
      const stepPercent = res.data?.encoding_step_percent;
      
      // âœ… ë‹¨ê³„ ì •ë³´ êµ¬ì„± (ë‹¨ê³„ ì •ë³´ê°€ ìˆìœ¼ë©´ í•­ìƒ ì „ë‹¬)
      const encodingStep =
        typeof stepIndex === "number" &&
        typeof stepTotal === "number" &&
        typeof stepName === "string" &&
        typeof stepPercent === "number"
          ? { index: stepIndex, total: stepTotal, name: stepName, percent: stepPercent }
          : null;
      
      // âœ… PROCESSING ìƒíƒœì—ì„œ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ (ë‹¨ê³„ ì •ë³´ê°€ ìˆìœ¼ë©´ í•­ìƒ ì „ë‹¬)
      if (status === "PROCESSING") {
        // encodingProgressê°€ ì—†ì–´ë„ ë‹¨ê³„ ì •ë³´ë§Œ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸
        const finalProgress = typeof encodingProgress === "number" 
          ? Math.min(99, Math.max(1, encodingProgress))
          : (encodingStep ? Math.round((encodingStep.index - 1) / encodingStep.total * 100 + (encodingStep.percent / encodingStep.total)) : undefined);
        if (finalProgress !== undefined || encodingStep) {
          asyncStatusStore.updateProgress(
            taskId,
            finalProgress ?? 0,
            remainingSeconds ?? undefined,
            encodingStep
          );
        }
      } else if (status === "UPLOADED") {
        // UPLOADED ìƒíƒœëŠ” progress ì—”ë“œí¬ì¸íŠ¸ì—ì„œ ë°˜í™˜ë˜ì§€ ì•Šì§€ë§Œ, í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€
        asyncStatusStore.updateProgress(taskId, 10);
      }
      
      // âœ… ì™„ë£Œ/ì‹¤íŒ¨ ìƒíƒœ ì²˜ë¦¬
      if (status === "READY") {
        onSuccess?.();
        asyncStatusStore.completeTask(taskId, "success");
      } else if (status === "FAILED") {
        const errorReason = res.data?.error_reason?.trim();
        asyncStatusStore.completeTask(
          taskId, 
          "error", 
          errorReason || "ì˜ìƒ ì²˜ë¦¬ ì‹¤íŒ¨"
        );
      }
    })
    .catch(() => {
      // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ì¬ì‹œë„ëŠ” ë‹¤ìŒ í´ë§ì—ì„œ
    });
}

export function useWorkerJobPoller(
  tasks: { id: string; status: string; meta?: { jobId: string; jobType: string } }[],
  options?: { onExcelSuccess?: () => void; onVideoSuccess?: () => void }
) {
  const pending = tasks.filter(
    (t) => t.status === "pending" && t.meta?.jobId
  );
  const intervalRef = useRef<ReturnType<typeof setInterval> | null>(null);
  const onExcelSuccessRef = useRef(options?.onExcelSuccess);
  const onVideoSuccessRef = useRef(options?.onVideoSuccess);
  onExcelSuccessRef.current = options?.onExcelSuccess;
  onVideoSuccessRef.current = options?.onVideoSuccess;

  const currentTenant = getTenantCodeForApiRequest() ?? "";

  useEffect(() => {
    if (pending.length === 0) {
      if (intervalRef.current) {
        clearInterval(intervalRef.current);
        intervalRef.current = null;
      }
      return;
    }
    const tick = () => {
      const all = asyncStatusStore.getState();
      const forCurrentTenant = all.filter(
        (t) =>
          t.status === "pending" &&
          t.meta?.jobId &&
          (t.tenantScope ?? "") === currentTenant
      );
      const excelCb = onExcelSuccessRef.current;
      const videoCb = onVideoSuccessRef.current;
      forCurrentTenant.forEach((t) => {
        if (t.meta!.jobType === "excel_parsing") {
          // âœ… taskIdëŠ” async status storeì˜ task ID (t.id), jobIdëŠ” API í˜¸ì¶œìš©
          pollExcelJob(t.id, excelCb);
        } else if (t.meta!.jobType === "video_processing") {
          // âœ… taskIdëŠ” async status storeì˜ task ID (t.id), videoIdëŠ” ë¹„ë””ì˜¤ ID (t.meta!.jobId)
          pollVideoJob(t.id, t.meta!.jobId, videoCb);
        } else {
          // âœ… SSOT: ëª¨ë“  ì›Œì»¤ ì‘ì—…ì€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬
          // messaging, omr, omr_scan ë“±ë„ /jobs/{id}/progress/ ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©
          pollExcelJob(t.id); // ë™ì¼í•œ ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš© (job_id ê¸°ë°˜)
        }
      });
    };
    tick();
    intervalRef.current = setInterval(tick, POLL_INTERVAL_MS);
    return () => {
      if (intervalRef.current) {
        clearInterval(intervalRef.current);
        intervalRef.current = null;
      }
    };
  }, [currentTenant, pending.length, pending.map((p) => p.id).join(",")]);
}


==========================================================================================
# FILE: ui/avatars/StaffRoleAvatar.tsx
==========================================================================================
// PATH: src/shared/ui/avatars/StaffRoleAvatar.tsx
// ì§ì› ì—­í•  ì•„ë°”íƒ€ â€” ëŒ€í‘œ(ì™•ê´€) / ê°•ì‚¬(í•™ì‚¬ëª¨) / ì¡°êµ (ì§ì›ê´€ë¦¬Â·ì„¤ì • ë‚´ ì •ë³´ ê³µìš©)

import { Crown, GraduationCap, UserCog } from "lucide-react";

export type StaffRoleType = "owner" | "TEACHER" | "ASSISTANT";

type StaffRoleAvatarProps = {
  role: StaffRoleType;
  size?: number;
  className?: string;
  "aria-label"?: string;
};

const LABELS: Record<StaffRoleType, string> = {
  owner: "ëŒ€í‘œ",
  TEACHER: "ê°•ì‚¬",
  ASSISTANT: "ì¡°êµ",
};

export default function StaffRoleAvatar({
  role,
  size = 24,
  className = "",
  "aria-label": ariaLabel,
}: StaffRoleAvatarProps) {
  const label = ariaLabel ?? LABELS[role];
  const cn = `shrink-0 text-[var(--color-text-secondary)] ${className}`.trim();
  if (role === "owner") return <Crown size={size} className={cn} aria-label={label} />;
  if (role === "TEACHER") return <GraduationCap size={size} className={cn} aria-label={label} />;
  return <UserCog size={size} className={cn} aria-label={label} />;
}


==========================================================================================
# FILE: ui/avatars/index.ts
==========================================================================================
export { default as StaffRoleAvatar } from "./StaffRoleAvatar";
export type { StaffRoleType } from "./StaffRoleAvatar";


==========================================================================================
# FILE: ui/badges/AttendanceStatusBadge.tsx
==========================================================================================
// PATH: src/shared/ui/badges/AttendanceStatusBadge.tsx
// í•œê¸€ì(short) = ë‘ê¸€ì(label) ì²«ê¸€ì/ì•½ìë¡œ í†µì¼, ì—­í• ë³„ ìˆœì„œÂ·ìƒ‰ìƒ

import React from "react";

export type AttendanceStatus =
  | "PRESENT"
  | "LATE"
  | "ONLINE"
  | "SUPPLEMENT"
  | "EARLY_LEAVE"
  | "ABSENT"
  | "RUNAWAY"
  | "MATERIAL"
  | "INACTIVE"
  | "SECESSION";

/** ì—­í• ë³„ ìˆœì„œ: ì¶œì„ì¸ì • â†’ ê²½ê³  â†’ ë¶€ì • â†’ ì¤‘ë¦½ */
export const ORDERED_ATTENDANCE_STATUS: AttendanceStatus[] = [
  "PRESENT",
  "ONLINE",
  "SUPPLEMENT",
  "LATE",
  "EARLY_LEAVE",
  "ABSENT",
  "RUNAWAY",
  "MATERIAL",
  "INACTIVE",
  "SECESSION",
];

/** ì¶œê²° ìƒíƒœë³„ ë‘ê¸€ì ë¼ë²¨Â·í•œê¸€ì(ì•ê¸€ì)Â·ìƒ‰ìƒ â€” í•œê¸€ìëŠ” ë‘ê¸€ì ì•ê¸€ìë§Œ ì‚¬ìš© */
const STATUS_META: Record<
  AttendanceStatus,
  { label: string; short: string; style: React.CSSProperties }
> = {
  PRESENT: { label: "í˜„ì¥", short: "í˜„", style: { backgroundColor: "#22c55e", color: "#fff" } },
  ONLINE: { label: "ì˜ìƒ", short: "ì˜", style: { backgroundColor: "#3b82f6", color: "#fff" } },
  SUPPLEMENT: { label: "ë³´ê°•", short: "ë³´", style: { backgroundColor: "#14b8a6", color: "#fff" } },
  LATE: { label: "ì§€ê°", short: "ì§€", style: { backgroundColor: "#f59e0b", color: "#fff" } },
  EARLY_LEAVE: { label: "ì¡°í‡´", short: "ì¡°", style: { backgroundColor: "#eab308", color: "#1f2937" } },
  ABSENT: { label: "ê²°ì„", short: "ê²°", style: { backgroundColor: "#ef4444", color: "#fff" } },
  RUNAWAY: { label: "ì¶œíŠ€", short: "ì¶œ", style: { backgroundColor: "#dc2626", color: "#fff" } },
  MATERIAL: { label: "ìë£Œ", short: "ì", style: { backgroundColor: "#94a3b8", color: "#fff" } },
  INACTIVE: { label: "ë¶€ì¬", short: "ë¶€", style: { backgroundColor: "#cbd5e1", color: "#475569" } },
  SECESSION: { label: "í‡´ì›", short: "í‡´", style: { backgroundColor: "#64748b", color: "#fff" } },
};

/** í•œê¸€ì ì¶œê²° ë±ƒì§€ìš© â€” ë§¤íŠ¸ë¦­ìŠ¤ í…Œì´ë¸” ì…€ ë“± */
export function getAttendanceShortLabel(status: string | null | undefined): string {
  if (!status) return "ï¼";
  const meta = STATUS_META[status as AttendanceStatus];
  return meta?.short ?? "ï¼";
}

export function getAttendanceStyle(status: string | null | undefined): React.CSSProperties | null {
  if (!status) return null;
  const meta = STATUS_META[status as AttendanceStatus];
  return meta?.style ?? null;
}

/** ì‚¬ì´ì¦ˆ SSOT: 1ch(í•œê¸€ì) | 2ch(ë‘ê¸€ì) â€” styles/design-system/ds/status.css */
export default function AttendanceStatusBadge({
  status,
  variant = "2ch",
}: {
  status: AttendanceStatus;
  /** 1ch: í•œê¸€ì(ë§¤íŠ¸ë¦­ìŠ¤ ì…€ ë“±), 2ch: ë‘ê¸€ì(ì¶œê²° í…Œì´ë¸”Â·ë¼ë²¨) */
  variant?: "1ch" | "2ch";
}) {
  const meta = STATUS_META[status];
  if (!meta) return null;

  const text = variant === "1ch" ? meta.short : meta.label;
  const sizeClass = variant === "1ch" ? "ds-status-badge ds-status-badge--1ch" : "ds-status-badge";

  return (
    <span
      className={sizeClass}
      style={meta.style}
      title={meta.label}
    >
      {text}
    </span>
  );
}


==========================================================================================
# FILE: ui/badges/index.ts
==========================================================================================
// PATH: src/shared/ui/badges/index.ts
export { default as AttendanceStatusBadge } from "./AttendanceStatusBadge";


==========================================================================================
# FILE: ui/chips/LectureChip.tsx
==========================================================================================
// PATH: src/shared/ui/chips/LectureChip.tsx
// ìˆ˜ê°• ê°•ì˜ ë”±ì§€ â€” ë„¤ëª¨(ì •ì‚¬ê°í˜•), ë‘ ê¸€ì ì¤‘ì•™ì •ë ¬, ì•„ë°”íƒ€ì™€ ë™ì¼ í¬ê¸°ë¡œ ë§ì¶œ ë•Œ size=avatarSize

const DEFAULT_LECTURE_COLOR = "#3b82f6";

function isLightColor(hex: string): boolean {
  const c = String(hex || "").toLowerCase();
  return ["#eab308", "#06b6d4"].includes(c);
}

export default function LectureChip({
  lectureName,
  color,
  size = 18,
  chipLabel,
}: {
  lectureName: string;
  color?: string;
  size?: number;
  /** ê°•ì˜ ìƒì„± ì‹œ ì§€ì •í•œ 2ê¸€ì (ë¯¸ì§€ì • ì‹œ ì œëª© ì• 2ì) */
  chipLabel?: string | null;
}) {
  const bg = color || DEFAULT_LECTURE_COLOR;
  const textColor = isLightColor(bg) ? "#1a1a1a" : "#fff";
  const two = (chipLabel && chipLabel.length >= 1)
    ? String(chipLabel).slice(0, 2)
    : (lectureName || "??").slice(0, 2);
  const fontSize = size <= 18 ? 8 : size <= 24 ? 9 : 10;

  return (
    <span
      data-lecture-chip
      title={lectureName}
      style={{
        width: size,
        height: size,
        minWidth: size,
        borderRadius: 4,
        flexShrink: 0,
        display: "inline-flex",
        alignItems: "center",
        justifyContent: "center",
        fontSize,
        fontWeight: 800,
        letterSpacing: "-0.02em",
        lineHeight: 1,
        color: textColor,
        background: bg,
        boxShadow: "0 1px 2px rgba(0,0,0,0.12)",
      }}
    >
      {two}
    </span>
  );
}


==========================================================================================
# FILE: ui/chips/StudentNameWithLectureChip.tsx
==========================================================================================
// PATH: src/shared/ui/chips/StudentNameWithLectureChip.tsx
// ì „ì—­ ê·œì¹™: í•™ìƒ ì´ë¦„ì´ ë“±ì¥í•˜ëŠ” ëª¨ë“  ê³³ì—ì„œ [ì•„ë°”íƒ€] + [ì´ë¦„] + [ê°•ì˜ ë”±ì§€]
// ê°•ì˜ ì—†ìœ¼ë©´ ë”±ì§€ ì—†ìŒ. í•™ìƒ 1ëª…ì´ Nê°œ ê°•ì˜ ìˆ˜ê°• ì‹œ ë”±ì§€ Nê°œ í‘œì‹œ.

import React from "react";
import LectureChip from "./LectureChip";

export type LectureInfo = {
  lectureName: string;
  color?: string | null;
  /** ê°•ì˜ ìƒì„± ëª¨ë‹¬ì—ì„œ ì§€ì •í•œ 2ê¸€ì ë”±ì§€ (ë¯¸ì§€ì • ì‹œ ì œëª© ì• 2ì) */
  chipLabel?: string | null;
};

type Props = {
  name: string;
  /** ê°•ì˜ ë”±ì§€(ë“¤). ìˆ˜ê°• ê°•ì˜ 1:1 â€” ì—†ìœ¼ë©´ ì•„ë¬´ ì¹©ë„ ì•ˆ ëœ¸ */
  lectures?: LectureInfo[] | null;
  /** ë”±ì§€ í¬ê¸° */
  chipSize?: number;
  /** í”„ë¡œí•„ ì‚¬ì§„ URL (ìˆìœ¼ë©´ í‘œì‹œ, ì—†ìœ¼ë©´ ì´ë¦„ ì´ë‹ˆì…œ) */
  profilePhotoUrl?: string | null;
  /** ì•„ë°”íƒ€ í¬ê¸°(px). ì§€ì • ì‹œ ì´ë¦„ ì™¼ìª½ì— ì•„ë°”íƒ€ í‘œì‹œ. ë¯¸ì§€ì • ì‹œ ì•„ë°”íƒ€ ì—†ìŒ */
  avatarSize?: number;
  className?: string;
  highlight?: (text: string) => React.ReactNode;
};

const DEFAULT_COLOR = "#3b82f6";

export default function StudentNameWithLectureChip({
  name,
  lectures,
  chipSize = 16,
  profilePhotoUrl,
  avatarSize,
  className,
  highlight,
}: Props) {
  const list = Array.isArray(lectures) && lectures.length > 0
    ? lectures
    : [];
  const chipSizeResolved = chipSize;

  return (
    <span className={`inline-flex items-center gap-2 min-w-0 ${className ?? ""}`.trim()}>
      {avatarSize != null && avatarSize > 0 && (
        <span
          className="flex-shrink-0 rounded-full overflow-hidden bg-[var(--color-brand-primary)]/15 text-[var(--color-brand-primary)] text-xs font-bold flex items-center justify-center"
          style={{ width: avatarSize, height: avatarSize }}
          aria-hidden
        >
          {profilePhotoUrl ? (
            <img src={profilePhotoUrl} alt="" className="w-full h-full object-cover" />
          ) : (
            (name || "?")[0]
          )}
        </span>
      )}
      <span className="truncate">
        {highlight ? highlight(name || "-") : (name || "-")}
      </span>
      {list.map((lec, i) => (
        <LectureChip
          key={`${lec.lectureName ?? ""}-${i}`}
          lectureName={lec.lectureName || "??"}
          color={lec.color ?? DEFAULT_COLOR}
          size={chipSizeResolved}
          chipLabel={lec.chipLabel}
        />
      ))}
    </span>
  );
}


==========================================================================================
# FILE: ui/date/DatePicker.tsx
==========================================================================================
// PATH: src/shared/ui/date/DatePicker.tsx
// ì „ì—­ SSOT: í”„ë¡œì íŠ¸ ë‚´ ëª¨ë“  ë‚ ì§œ ì„ íƒì—ì„œ ì‚¬ìš©í•˜ëŠ” í†µì¼ëœ ë‹¬ë ¥ UI (í¼ì§€ë§‰í•œ ì…€, ì¼ê´€ëœ ë””ìì¸)

import { useEffect, useLayoutEffect, useRef, useState } from "react";
import ReactDOM from "react-dom";
import dayjs, { type Dayjs } from "dayjs";
import { Calendar } from "lucide-react";
import "@/styles/design-system/components/DatePicker.css";

const WEEKDAYS = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];
const CELL_SIZE = 44;
const CALENDAR_MIN_WIDTH = 336;

export interface DatePickerProps {
  value: string; // YYYY-MM-DD
  onChange: (value: string) => void;
  placeholder?: string;
  disabled?: boolean;
  id?: string;
  "data-testid"?: string;
}

function toDayjs(s: string): Dayjs | null {
  if (!s?.trim()) return null;
  const d = dayjs(s, "YYYY-MM-DD", true);
  return d.isValid() ? d : null;
}

function toValue(d: Dayjs): string {
  return d.format("YYYY-MM-DD");
}

export default function DatePicker({
  value,
  onChange,
  placeholder = "ë‚ ì§œ ì„ íƒ",
  disabled = false,
  id,
  "data-testid": dataTestId,
}: DatePickerProps) {
  const [open, setOpen] = useState(false);
  const [viewMonth, setViewMonth] = useState<Dayjs>(() => toDayjs(value) || dayjs());
  const containerRef = useRef<HTMLDivElement>(null);
  const triggerRef = useRef<HTMLButtonElement>(null);
  const [dropdownStyle, setDropdownStyle] = useState<{ top?: number; bottom?: number; left: number } | null>(null);

  const selected = toDayjs(value);
  const today = dayjs();

  // valueê°€ ë°”ë€Œë©´ viewMonth ë™ê¸°í™”
  useEffect(() => {
    const v = toDayjs(value);
    if (v) setViewMonth(v);
  }, [value]);

  // í¬í„¸ë¡œ bodyì— ë Œë”í•´ overflow ì˜ë¦¼ ë°©ì§€. position: fixed ì¢Œí‘œ ê³„ì‚°
  useLayoutEffect(() => {
    if (!open) {
      setDropdownStyle(null);
      return;
    }
    if (!triggerRef.current) return;
    const rect = triggerRef.current.getBoundingClientRect();
    const space = 8;
    const dropdownHeight = 380; // ëŒ€ëµì  ë‹¬ë ¥ ë†’ì´
    const viewportTop = rect.top;
    const fitsAbove = viewportTop >= dropdownHeight + space;
    // ê¸°ë³¸: ìœ„ë¡œ ì—´ë¦¼. ê³µê°„ ë¶€ì¡± ì‹œì—ë§Œ ì•„ë˜ë¡œ
    if (fitsAbove) {
      setDropdownStyle({ bottom: window.innerHeight - rect.top + space, left: rect.left });
    } else {
      setDropdownStyle({ top: rect.bottom + space, left: rect.left });
    }
  }, [open]);

  useEffect(() => {
    if (!open) return;
    function handleClickOutside(e: MouseEvent) {
      const target = e.target as Node;
      if (containerRef.current && !containerRef.current.contains(target)) {
        const popup = document.querySelector(".shared-date-picker-dropdown--portaled");
        if (!popup?.contains(target)) setOpen(false);
      }
    }
    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, [open]);

  const start = viewMonth.startOf("month");
  const end = viewMonth.endOf("month");
  const startCell = start.day();
  const daysInMonth = end.date();
  const prevMonth = viewMonth.subtract(1, "month");
  const nextMonth = viewMonth.add(1, "month");

  const cells: (number | null)[] = [];
  for (let i = 0; i < startCell; i++) cells.push(null);
  for (let d = 1; d <= daysInMonth; d++) cells.push(d);

  function handleSelect(d: number) {
    const d2 = viewMonth.date(d);
    onChange(toValue(d2));
    setOpen(false);
  }

  const displayText = value ? dayjs(value).format("YYYYë…„ MMì›” DDì¼") : placeholder;

  return (
    <div ref={containerRef} className="shared-date-picker" style={{ position: "relative" }}>
      <button
        ref={triggerRef}
        type="button"
        id={id}
        data-testid={dataTestId}
        onClick={() => !disabled && setOpen((o) => !o)}
        disabled={disabled}
        className="shared-date-picker-trigger"
        aria-haspopup="dialog"
        aria-expanded={open}
      >
        <Calendar className="shared-date-picker-trigger-icon" size={18} aria-hidden />
        <span className={value ? "" : "shared-date-picker-placeholder"}>{displayText}</span>
      </button>

      {open && dropdownStyle && ReactDOM.createPortal(
        <div
          className="shared-date-picker-dropdown shared-date-picker-dropdown--portaled"
          role="dialog"
          aria-label="ë‚ ì§œ ì„ íƒ"
          style={{
            minWidth: CALENDAR_MIN_WIDTH,
            width: "max-content",
            position: "fixed",
            zIndex: 1200,
            backgroundColor: "var(--color-bg-surface, #ffffff)",
            ...(dropdownStyle.top != null
              ? { top: dropdownStyle.top, left: dropdownStyle.left }
              : { bottom: dropdownStyle.bottom, left: dropdownStyle.left }),
          }}
        >
          <div className="shared-date-picker-header">
            <button
              type="button"
              className="shared-date-picker-nav"
              onClick={() => setViewMonth(prevMonth)}
              aria-label="ì´ì „ ë‹¬"
            >
              â€¹
            </button>
            <span className="shared-date-picker-title" aria-live="polite">
              {viewMonth.format("YYYYë…„ MMì›”")}
            </span>
            <button
              type="button"
              className="shared-date-picker-nav"
              onClick={() => setViewMonth(nextMonth)}
              aria-label="ë‹¤ìŒ ë‹¬"
            >
              â€º
            </button>
          </div>

          <div className="shared-date-picker-weekdays">
            {WEEKDAYS.map((w) => (
              <span key={w} className="shared-date-picker-weekday">
                {w}
              </span>
            ))}
          </div>

          <div
            className="shared-date-picker-grid"
            style={{
              display: "grid",
              gridTemplateColumns: "repeat(7, 1fr)",
              gap: 4,
            }}
          >
            {cells.map((d, i) => {
              if (d === null) return <div key={`empty-${i}`} />;
              const cellDate = viewMonth.date(d);
              const valueStr = toValue(cellDate);
              const isSelected = selected && toValue(selected) === valueStr;
              const isToday = toValue(today) === valueStr;
              return (
                <button
                  key={valueStr}
                  type="button"
                  className={`shared-date-picker-cell ${isSelected ? "shared-date-picker-cell-selected" : ""} ${isToday ? "shared-date-picker-cell-today" : ""}`}
                  onClick={() => handleSelect(d)}
                  style={{ width: CELL_SIZE, height: CELL_SIZE }}
                >
                  {d}
                </button>
              );
            })}
          </div>
        </div>,
        document.body
      )}
    </div>
  );
}


==========================================================================================
# FILE: ui/date/index.ts
==========================================================================================
export { default as DatePicker } from "./DatePicker";
export type { DatePickerProps } from "./DatePicker";


==========================================================================================
# FILE: ui/domain/ColorPickerField.tsx
==========================================================================================
// PATH: src/shared/ui/domain/ColorPickerField.tsx
// ìƒ‰ìƒ ì„ íƒ UI â€” íƒœê·¸Â·ê°•ì˜ ì•„ì´ì½˜ ë“± ê³µí†µ

import { PRESET_COLORS } from "./constants";

type ColorPickerFieldProps = {
  value: string;
  onChange: (color: string) => void;
  label?: string;
  disabled?: boolean;
};

export default function ColorPickerField({
  value,
  onChange,
  label = "ìƒ‰ìƒ",
  disabled,
}: ColorPickerFieldProps) {
  return (
    <div>
      {label && (
        <label
          style={{
            display: "block",
            fontSize: 12,
            fontWeight: 700,
            color: "var(--color-text-muted)",
            marginBottom: 10,
            letterSpacing: "0.04em",
          }}
        >
          {label}
        </label>
      )}
      <div
        style={{
          display: "flex",
          flexWrap: "wrap",
          gap: 8,
          alignItems: "center",
        }}
      >
        {PRESET_COLORS.map((c) => (
          <button
            key={c}
            type="button"
            onClick={() => onChange(c)}
            disabled={disabled}
            style={{
              width: 32,
              height: 32,
              borderRadius: 10,
              background: c,
              border:
                value === c
                  ? "2px solid var(--color-text-primary)"
                  : "2px solid transparent",
              boxShadow:
                value === c
                  ? "0 0 0 2px var(--color-bg-surface)"
                  : "0 1px 3px rgba(0,0,0,0.2)",
              cursor: disabled ? "default" : "pointer",
              opacity: disabled ? 0.6 : 1,
            }}
            aria-label={`ìƒ‰ìƒ ${c} ì„ íƒ`}
          />
        ))}
        <div style={{ display: "flex", alignItems: "center", gap: 6 }}>
          <input
            type="color"
            value={value}
            onChange={(e) => onChange(e.target.value)}
            disabled={disabled}
            style={{
              width: 32,
              height: 32,
              padding: 0,
              border: "none",
              cursor: disabled ? "default" : "pointer",
              background: "transparent",
            }}
          />
          <span
            style={{
              fontSize: 12,
              fontWeight: 600,
              color: "var(--color-text-muted)",
            }}
          >
            ì§ì ‘ ì„ íƒ
          </span>
        </div>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: ui/domain/DomainLayout.tsx
==========================================================================================
// PATH: src/shared/ui/domain/DomainLayout.tsx
// í˜ì´ì§€ í—¤ë” SSOT â€” ë„ë©”ì¸ë³„ ì œëª©Â·ì„¤ëª…Â·íƒ­ì€ ì—¬ê¸°ì„œë§Œ ë‹´ë‹¹.
// ë ˆì´ì•„ì›ƒì„ ì“°ëŠ” í˜ì´ì§€ëŠ” íƒ­ ì•„ë˜ì— SectionHeader ë“± "ë‚´ë¶€ í—¤ë”"ë¥¼ ë„£ì§€ ë§ ê²ƒ.

import { ReactNode } from "react";
import { useNavigate, useLocation } from "react-router-dom";

import DomainTabs, { type DomainTab } from "./DomainTabs";
import DomainPanel from "./DomainPanel";

export type { DomainTab } from "./DomainTabs";

export type DomainCrumb = { label: string; to?: string };

type DomainLayoutProps = {
  title: string;
  description?: string;
  /** ë„ë©”ì¸ í—¤ë” ìƒë‹¨ ë¸Œë ˆë“œí¬ëŸ¼ (ì˜ˆ: ê°•ì˜ â€º ë°•ì² ì˜ ìƒëª…ê³¼í•™) */
  breadcrumbs?: DomainCrumb[];
  tabs?: DomainTab[];
  children: ReactNode;
};

export default function DomainLayout({
  title,
  description,
  breadcrumbs,
  tabs,
  children,
}: DomainLayoutProps) {
  const navigate = useNavigate();
  const location = useLocation();

  return (
    <div className="min-h-full bg-[var(--bg-page)]" data-app="admin">
      {/* DOMAIN HEADER â€” ì€ì€í•œ primary í†¤ + ì¢Œì¸¡ ì•¡ì„¼íŠ¸, íƒ­ ìˆìœ¼ë©´ ë§¨ ë°”ë‹¥ì— ì—¬ë°± ì—†ì´ */}
      <div
        className={`relative flex flex-col ${tabs != null && tabs.length > 0 ? "domain-header--with-tabs" : ""}`}
        style={{
          background: "color-mix(in srgb, var(--color-primary) 8%, var(--bg-surface))",
          borderBottom: "1px solid var(--color-border-divider-strong)",
          paddingLeft: "var(--space-6)",
          paddingRight: "var(--space-6)",
          paddingTop: "var(--space-7)",
          paddingBottom: tabs != null && tabs.length > 0 ? 0 : "var(--space-4)",
        }}
      >
        <div className="relative flex-shrink-0">
          <div
            className="absolute left-0 top-1 rounded-full bg-[var(--color-primary)]"
            style={{ width: 4, height: 24 }}
            aria-hidden
          />
          <div style={{ paddingLeft: "var(--space-4)" }}>
            {breadcrumbs != null && breadcrumbs.length > 0 ? (
              <div
                className="flex items-center gap-2 flex-wrap text-2xl tracking-tight"
                style={{ fontWeight: 700, color: "var(--color-text-primary)" }}
              >
                {breadcrumbs.map((c, idx) => (
                  <span key={`${c.label}-${idx}`} className="flex items-center gap-2">
                    {c.to ? (
                      <span
                        role="button"
                        tabIndex={0}
                        onClick={() => navigate(c.to!)}
                        onKeyDown={(e) => e.key === "Enter" && navigate(c.to!)}
                        style={{
                          cursor: "pointer",
                          color: "var(--color-text-secondary)",
                        }}
                      >
                        {c.label}
                      </span>
                    ) : (
                      <span>{c.label}</span>
                    )}
                    {idx < breadcrumbs.length - 1 && (
                      <span
                        style={{
                          color: "var(--color-text-disabled)",
                          fontWeight: 500,
                        }}
                      >
                        â€º
                      </span>
                    )}
                  </span>
                ))}
              </div>
            ) : (
              <div
                className="text-2xl tracking-tight"
                style={{ fontWeight: 700, color: "var(--color-text-primary)" }}
              >
                {title}
              </div>
            )}
            {description != null && (
              <div
                className="text-base mt-1"
                style={{
                  color: "var(--color-text-muted)",
                  opacity: 0.9,
                }}
              >
                {description}
              </div>
            )}
          </div>
        </div>

        {tabs != null && tabs.length > 0 && (
          <div className="domain-header__tabs-wrap">
            <DomainTabs
              tabs={tabs}
              pathname={location.pathname}
              onNavigate={(path) => navigate(path)}
            />
          </div>
        )}
      </div>

      {/* DOMAIN CONTENT (ds-panel) */}
      <div
        style={{
          padding: "var(--space-6)",
        }}
      >
        <DomainPanel>{children}</DomainPanel>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: ui/domain/DomainListToolbar.tsx
==========================================================================================
// PATH: src/shared/ui/domain/DomainListToolbar.tsx
// Design SSOT â€” ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ íˆ´ë°” (ì´ê³„ | ê²€ìƒ‰ | í•„í„° | ì¶”ê°€)

import { ReactNode } from "react";

type DomainListToolbarProps = {
  /** ì¢Œì¸¡ ì´ê³„ í‘œì‹œ (ì˜ˆ: "ì´ 12ëª…", "ì´ 5ê°œ") */
  totalLabel: ReactNode;
  /** ê²€ìƒ‰ input (ds-input) */
  searchSlot: ReactNode;
  /** í•„í„° ë²„íŠ¼ (ì„ íƒ) */
  filterSlot?: ReactNode;
  /** ë©”ì¸ ì¶”ê°€ ë²„íŠ¼ (í•„ìˆ˜) */
  primaryAction: ReactNode;
  /** ê²€ìƒ‰ì°½ ë°‘ì— í‘œì‹œ (ì˜ˆ: Nëª… ì„ íƒë¨ + ì•¡ì…˜ ë²„íŠ¼) */
  belowSlot?: ReactNode;
};

export default function DomainListToolbar({
  totalLabel,
  searchSlot,
  filterSlot,
  primaryAction,
  belowSlot,
}: DomainListToolbarProps) {
  return (
    <div className="flex flex-col gap-3">
    <div className="flex flex-wrap items-center gap-3">
      <span
        style={{
          fontSize: 15,
          fontWeight: 700,
          color: "var(--color-text-primary)",
          paddingRight: 12,
          borderRight: "1px solid var(--color-border-divider)",
          marginRight: 4,
        }}
      >
        {totalLabel}
      </span>
      {searchSlot}
      {filterSlot}
      {primaryAction}
    </div>
    {belowSlot}
    </div>
  );
}


==========================================================================================
# FILE: ui/domain/DomainPanel.tsx
==========================================================================================
// PATH: src/shared/ui/domain/DomainPanel.tsx
// ë„ë©”ì¸ ì½˜í…ì¸  ìŠ¤í…Œì´ì§€ â€” ì¹´ë“œê°€ ì•„ë‹Œ â€œë°”ë‹¥â€. í…Œë‘ë¦¬Â·ê·¸ë¦¼ì ì—†ì´ ë°°ê²½ë§Œ.

import { ReactNode } from "react";

type DomainPanelProps = {
  children: ReactNode;
};

export default function DomainPanel({ children }: DomainPanelProps) {
  return (
    <div
      className="domain-panel"
      style={{
        background: "transparent",
      }}
    >
      {children}
    </div>
  );
}


==========================================================================================
# FILE: ui/domain/DomainTable.tsx
==========================================================================================
// PATH: src/shared/ui/domain/DomainTable.tsx
// Students ë„ë©”ì¸ UI SSOT â€” ds-table-wrap + table.ds-table ê³µí†µ ë˜í¼

import { ReactNode, CSSProperties } from "react";

type DomainTableProps = {
  children: ReactNode;
  /** tableì— ì¶”ê°€í•  className */
  tableClassName?: string;
  /** table ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ (ì˜ˆ: tableLayout: "fixed") */
  tableStyle?: CSSProperties;
};

export default function DomainTable({
  children,
  tableClassName,
  tableStyle,
}: DomainTableProps) {
  return (
    <div className="ds-table-wrap" style={{ overflow: "hidden" }}>
      <table
        className={`ds-table w-full ${tableClassName ?? ""}`.trim()}
        style={tableStyle}
      >
        {children}
      </table>
    </div>
  );
}


==========================================================================================
# FILE: ui/domain/DomainTabs.tsx
==========================================================================================
// PATH: src/shared/ui/domain/DomainTabs.tsx
// Students ë„ë©”ì¸ UI SSOT â€” ds-tabs ê³µí†µ ì»´í¬ë„ŒíŠ¸

export type DomainTab = {
  key: string;
  label: string;
  path?: string;
  locked?: boolean;
  /** trueë©´ pathì™€ ì™„ì „ ì¼ì¹˜í•  ë•Œë§Œ active */
  exact?: boolean;
};

const LOCKED_TAB_CLASS =
  "opacity-40 cursor-not-allowed pointer-events-none";

type DomainTabsProps = {
  tabs: DomainTab[];
  pathname: string;
  onNavigate: (path: string) => void;
};

export default function DomainTabs({
  tabs,
  pathname,
  onNavigate,
}: DomainTabsProps) {
  return (
    <div className="ds-tabs ds-tabs--flat" role="tablist">
      {tabs.map((tab) =>
        tab.locked ? (
          <button
            key={tab.key}
            type="button"
            disabled
            title="ì¤€ë¹„ ì¤‘ì¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤"
            className={`ds-tab ${LOCKED_TAB_CLASS}`}
          >
            {tab.label}
          </button>
        ) : (
          <button
            key={tab.key}
            type="button"
            className={`ds-tab ${
              tab.path != null &&
              (tab.exact
                ? pathname === tab.path || pathname === tab.path + "/"
                : pathname === tab.path ||
                  pathname.startsWith(tab.path + "/"))
                ? "is-active"
                : ""
            }`}
            onClick={() => tab.path != null && onNavigate(tab.path)}
          >
            {tab.label}
          </button>
        )
      )}
    </div>
  );
}


==========================================================================================
# FILE: ui/domain/StorageStyleTabs.module.css
==========================================================================================
/* ì €ì¥ì†Œ ì–‘ì‹ íƒ­ â€” ë©”ì‹œì§€Â·ì˜ìƒ ë“± ë„ë©”ì¸ ê³µí†µ */

.wrap {
  display: flex;
  flex-direction: column;
  gap: var(--space-4);
  min-height: 0;
}

.tabs {
  display: flex;
  gap: 0;
  padding: 0;
  border-bottom: 1px solid var(--color-border-divider);
  background: color-mix(in srgb, var(--color-border-divider) 6%, transparent);
  border-radius: var(--radius-md) var(--radius-md) 0 0;
}

.tab {
  padding: var(--space-2) var(--space-4);
  font-size: 13px;
  font-weight: 600;
  color: var(--color-text-secondary);
  background: transparent;
  border: none;
  border-bottom: 2px solid transparent;
  cursor: pointer;
  transition: color 0.15s, background 0.15s, border-color 0.15s;
}

.tab:hover {
  color: var(--color-text-primary);
  background: var(--color-bg-surface-hover);
}

.tabActive {
  color: var(--color-brand-primary);
  background: var(--color-bg-surface);
  border-bottom-color: var(--color-brand-primary);
}


==========================================================================================
# FILE: ui/domain/StorageStyleTabs.tsx
==========================================================================================
// ì €ì¥ì†Œ ì–‘ì‹ íƒ­ â€” DomainLayout ë‚´ë¶€ ì½˜í…ì¸  ìƒë‹¨ìš© (ë©”ì‹œì§€Â·ì €ì¥ì†Œ ë“± ê³µí†µ)

import { useLocation, useNavigate } from "react-router-dom";
import styles from "./StorageStyleTabs.module.css";

export type StorageStyleTab = {
  key: string;
  label: string;
  path: string;
};

type Props = {
  tabs: StorageStyleTab[];
};

export default function StorageStyleTabs({ tabs }: Props) {
  const location = useLocation();
  const navigate = useNavigate();

  return (
    <div className={styles.tabs}>
      {tabs.map((tab) => {
        const isActive =
          location.pathname === tab.path || location.pathname.startsWith(tab.path + "/");
        return (
          <button
            key={tab.key}
            type="button"
            className={styles.tab + (isActive ? " " + styles.tabActive : "")}
            onClick={() => navigate(tab.path)}
          >
            {tab.label}
          </button>
        );
      })}
    </div>
  );
}


==========================================================================================
# FILE: ui/domain/constants.ts
==========================================================================================
// PATH: src/shared/ui/domain/constants.ts
// Design SSOT â€” ìƒ‰ìƒ ìƒìˆ˜ (íƒœê·¸Â·ì•„ì´ì½˜Â·ê¼¬ë¦¬í‘œ ë“± ê³µí†µ)

/** í™œì„± ìƒíƒœ â€” ì´ˆë¡ */
export const STATUS_ACTIVE_COLOR = "#22c55e";

/** ë¹„í™œì„± ìƒíƒœ â€” ë¹¨ê°• */
export const STATUS_INACTIVE_COLOR = "#ef4444";

/** í”„ë¦¬ì…‹ ìƒ‰ìƒ (íƒœê·¸Â·ê°•ì˜ ì•„ì´ì½˜Â·ê¼¬ë¦¬í‘œ ë“±) */
export const PRESET_COLORS = [
  "#3b82f6",
  "#22c55e",
  "#eab308",
  "#ef4444",
  "#8b5cf6",
  "#ec4899",
  "#06b6d4",
  "#f97316",
  "#6366f1",
  "#14b8a6",
] as const;

/** í”„ë¦¬ì…‹ ê¸°ë³¸ê°’ (ì²« ë²ˆì§¸) */
export const DEFAULT_PRESET_COLOR = PRESET_COLORS[0];

function hexToRgb(hex: string): [number, number, number] {
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result
    ? [parseInt(result[1], 16), parseInt(result[2], 16), parseInt(result[3], 16)]
    : [0, 0, 0];
}

function colorDistance(a: string, b: string): number {
  const [r1, g1, b1] = hexToRgb(a);
  const [r2, g2, b2] = hexToRgb(b);
  return Math.sqrt((r1 - r2) ** 2 + (g1 - g2) ** 2 + (b1 - b2) ** 2);
}

/** ì‚¬ìš© ì¤‘ì¸ ìƒ‰ìƒê³¼ ìµœëŒ€í•œ ì°¨ì´ë‚˜ëŠ” í”„ë¦¬ì…‹ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ë°˜í™˜ */
export function getDefaultColorForPicker(usedColors: string[]): string {
  const used = usedColors.filter(Boolean);
  if (used.length === 0) return DEFAULT_PRESET_COLOR;

  let best = PRESET_COLORS[0];
  let bestMinDist = -1;

  for (const preset of PRESET_COLORS) {
    const minDist = Math.min(...used.map((c) => colorDistance(preset, c)));
    if (minDist > bestMinDist) {
      bestMinDist = minDist;
      best = preset;
    }
  }
  return best;
}


==========================================================================================
# FILE: ui/domain/index.ts
==========================================================================================
// src/shared/ui/domain/index.ts
// ë„ë©”ì¸ ê³µí†µ UI Â· Design SSOT: docs/DESIGN_SSOT.md

export { default as DomainLayout } from "./DomainLayout";
export { default as DomainTabs } from "./DomainTabs";
export { default as DomainPanel } from "./DomainPanel";
export { default as DomainTable } from "./DomainTable";
export { default as DomainListToolbar } from "./DomainListToolbar";
export type { DomainTab } from "./DomainTabs";
export type { DomainCrumb } from "./DomainLayout";
export {
  STATUS_ACTIVE_COLOR,
  STATUS_INACTIVE_COLOR,
  PRESET_COLORS,
  DEFAULT_PRESET_COLOR,
  getDefaultColorForPicker,
} from "./constants";
export { default as ColorPickerField } from "./ColorPickerField";
export { default as StorageStyleTabs } from "./StorageStyleTabs";
export type { StorageStyleTab } from "./StorageStyleTabs";
export { TABLE_COL, STUDENTS_TABLE_COL } from "./tableColumnSpec";
export type { TableColKey } from "./tableColumnSpec";


==========================================================================================
# FILE: ui/domain/tableColumnSpec.ts
==========================================================================================
/**
 * í…Œì´ë¸” ì»¬ëŸ¼ ë„ˆë¹„ ë‹¨ì¼ì§„ì‹¤ (SSOT)
 * @see docs/DESIGN_SSOT.md
 *
 * - ì»¬ëŸ¼ ë„ˆë¹„ëŠ” ì´ íŒŒì¼ë§Œ ì •ì˜. ë‹¤ë¥¸ ê³³ì— ì¤‘ë³µ ì •ì˜ ê¸ˆì§€.
 * - í•™ìƒÂ·ì¶œê²° ê³„ì—´: STUDENTS_TABLE_COL. ê·¸ ì™¸: TABLE_COLì—ì„œ í‚¤ ì„ íƒ.
 * - tableLayout: "fixed" + <colgroup> ê¶Œì¥.
 */
export const TABLE_COL = {
  /** ì²´í¬ë°•ìŠ¤ ì „ìš© (í•™ìƒ í…Œì´ë¸” ê¸°ì¤€) */
  checkbox: 28,
  /** ì´ë¦„Â·ì£¼ìš” ì‹ë³„ ì»¬ëŸ¼ (ë”±ì§€+ì´ë¦„ ë“±) â€” í•™ìƒ í…Œì´ë¸” ê¸°ì¤€ */
  name: 140,
  /** ì¶œê²°/ê°•ì˜ ëª©ë¡ ë“± ì´ë¦„ë§Œ ì§§ê²Œ (ë ˆê±°ì‹œÂ·ëª¨ë‹¬ìš©, ì‹ ê·œëŠ” name ì‚¬ìš©) */
  nameCompact: 116,
  /** ëª¨ë‹¬ ë‚´ ì´ë¦„ ì—´ â€” nameCompactë³´ë‹¤ ì•„ì£¼ ì¡°ê¸ˆ ë„“ê²Œ */
  nameCompactModal: 124,
  /** ì „í™”ë²ˆí˜¸ (í•™ë¶€ëª¨/í•™ìƒ ë™ì¼ â€” í•™ìƒ í…Œì´ë¸” ê¸°ì¤€) */
  phone: 130,
  /** ëª¨ë‹¬ ë‚´ ì „í™” ì—´ â€” phoneë³´ë‹¤ ì¢ê²Œ, ì „í™”ë²ˆí˜¸ ì˜ë¦¬ì§€ ì•Šë„ë¡ */
  phoneCompact: 108,
  /** ë°˜, 2ê¸€ì ë±ƒì§€ ë“± */
  short: 65,
  /** ëª¨ë‹¬ ë‚´ í•™ë…„ ì—´ â€” shortë³´ë‹¤ ì•½ê°„ ë„“ê²Œ (í•™ë…„ ì»¬ëŸ¼ ê°€ì‹œì„±) */
  shortModal: 72,
  /** ë‚ ì§œ, í•™êµ, ì‹œê¸‰ ë“± */
  medium: 110,
  /** ëª¨ë‹¬ ë‚´ í•™êµ ì´ë¦„ ì—´ â€” mediumë³´ë‹¤ ì¢ê²Œ (í•™ë…„ ì—´ ê°€ì‹œì„±) */
  mediumModal: 88,
  /** ì „í™”Â·ë‚ ì§œ ì•½ê°„ ë„“ê²Œ */
  mediumAlt: 120,
  /** íƒœê·¸ ì¹¸ */
  tag: 100,
  /** ìƒíƒœ(í™œì„±/ë¹„í™œì„± ë“±) */
  status: 92,
  /** ì¶œê²° 2ê¸€ì ë±ƒì§€ ë“± */
  statusBadge: 68,
  /** ì°¨ì‹œ í•œ ì¹¸ (1ì°¨ì‹œ, 2ì°¨ì‹œâ€¦) */
  sessionCol: 34,
  /** ë©”ëª¨Â·ë¹„ê³  */
  memo: 280,
  /** ê³¼ì œÂ·ì…ë ¥ ì˜ì—­ ë“± */
  wide: 360,
  /** ì¶œê²° ë³€ê²½ 10ë±ƒì§€ ë“± ë„“ì€ ì˜ì—­ */
  extraWide: 460,
  /** ê´€ë¦¬(ìˆ˜ì •/ì‚­ì œ) ë²„íŠ¼ */
  actions: 72,
  /** ê°•ì˜ëª…Â·ì œëª© ë“± */
  title: 192,
  /** ê³¼ëª©Â·í•­ëª© ë“± */
  subject: 140,
  /** ê°•ì˜ ì‹œê°„Â·ê·¼ë¬´ì‹œê°„ ë“± */
  timeRange: 160,
  /** ê¸°ê°„ (ì‹œì‘ì¼~ì¢…ë£Œì¼) */
  dateRange: 200,
} as const;

/** í•™ìƒ í…Œì´ë¸” ê¸°ì¤€ SSOT â€” ì²´í¬ë°•ìŠ¤Â·ì´ë¦„Â·í•™ë¶€ëª¨ì „í™”Â·í•™ìƒì „í™” ë™ì¼ í¬ê¸°/ì–‘ì‹. ì¶œê²°/ê°•ì˜ì¶œê²°/ì„¸ì…˜ì¶œê²° ë“±ì—ì„œ ì‚¬ìš© */
export const STUDENTS_TABLE_COL = {
  checkbox: TABLE_COL.checkbox,
  name: TABLE_COL.name,
  parentPhone: TABLE_COL.phone,
  studentPhone: TABLE_COL.phone,
  sessionCol: TABLE_COL.sessionCol,
  statusBadge: TABLE_COL.statusBadge,
  attendanceChange: TABLE_COL.extraWide,
  memo: TABLE_COL.memo,
} as const;

export type TableColKey = keyof typeof TABLE_COL;


==========================================================================================
# FILE: ui/ds/Button.tsx
==========================================================================================
// PATH: src/shared/ui/ds/Button.tsx
import React from "react";

export type ButtonIntent = "primary" | "secondary" | "danger" | "ghost";
export type ButtonSize = "sm" | "md" | "lg";

type ButtonProps = Omit<React.ButtonHTMLAttributes<HTMLButtonElement>, "color"> & {
  intent?: ButtonIntent;
  size?: ButtonSize;

  iconOnly?: boolean;
  leftIcon?: React.ReactNode;
  rightIcon?: React.ReactNode;

  loading?: boolean;
  className?: string;
};

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

export default function Button({
  intent = "secondary",
  size = "md",
  iconOnly,
  leftIcon,
  rightIcon,
  loading,
  disabled,
  className,
  children,
  ...props
}: ButtonProps) {
  const isDisabled = !!disabled || !!loading;

  return (
    <button
      {...props}
      type={(props.type as any) ?? "button"}
      disabled={isDisabled}
      className={cx("ds-button", className)}
      data-intent={intent}
      data-size={size}
      data-icon-only={iconOnly ? "true" : "false"}
      data-loading={loading ? "true" : "false"}
      data-disabled={isDisabled ? "true" : "false"}
    >
      {loading && <span className="ds-button__spinner" aria-hidden />}

      {!loading && leftIcon && (
        <span className="ds-button__left" aria-hidden>
          {leftIcon}
        </span>
      )}

      {!iconOnly && <span className="ds-button__label">{children}</span>}

      {!loading && rightIcon && (
        <span className="ds-button__right" aria-hidden>
          {rightIcon}
        </span>
      )}
    </button>
  );
}


==========================================================================================
# FILE: ui/ds/CloseButton.tsx
==========================================================================================
// PATH: src/shared/ui/ds/CloseButton.tsx
// ì „ì—­ ë‹«ê¸° ë²„íŠ¼ SSOT â€” ëª¨ë‹¬Â·ì˜¤ë²„ë ˆì´ ë“± ëª¨ë“  ë‹«ê¸°ì— ìš°ìƒë‹¨ X ë²„íŠ¼ í†µì¼

import React from "react";

type CloseButtonProps = {
  onClick: () => void;
  "aria-label"?: string;
  className?: string;
};

export default function CloseButton({
  onClick,
  "aria-label": ariaLabel = "ë‹«ê¸°",
  className = "",
}: CloseButtonProps) {
  return (
    <button
      type="button"
      className={`ds-close-btn ${className}`.trim()}
      onClick={onClick}
      aria-label={ariaLabel}
    >
      <span aria-hidden>
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
          <path d="M18 6 6 18M6 6l12 12" />
        </svg>
      </span>
    </button>
  );
}


==========================================================================================
# FILE: ui/ds/EmptyState.tsx
==========================================================================================
// PATH: src/shared/ui/ds/EmptyState.tsx
import React from "react";

export type EmptyStateTone = "empty" | "error" | "loading";
export type EmptyStateScope = "page" | "panel" | "modal";
export type EmptyStateMode = "panel" | "embedded";

type EmptyStateProps = {
  title?: string;
  description?: string;
  tone?: EmptyStateTone;
  scope?: EmptyStateScope;

  mode?: EmptyStateMode;
  actions?: React.ReactNode;
  extra?: React.ReactNode;
  showIcon?: boolean;
  className?: string;
};

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

function Icon({ tone }: { tone: EmptyStateTone }) {
  const common = {
    width: 18,
    height: 18,
    viewBox: "0 0 24 24",
    fill: "none" as const,
  };

  if (tone === "loading") {
    return (
      <svg {...common}>
        <path
          d="M12 3a9 9 0 1 0 9 9"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
        />
      </svg>
    );
  }

  if (tone === "error") {
    return (
      <svg {...common}>
        <path
          d="M12 9v4"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
        />
        <path
          d="M12 17h0"
          stroke="currentColor"
          strokeWidth="3"
          strokeLinecap="round"
        />
        <path
          d="M10.3 4.4 2.5 18a2 2 0 0 0 1.7 3h15.6a2 2 0 0 0 1.7-3L13.7 4.4a2 2 0 0 0-3.4 0Z"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinejoin="round"
        />
      </svg>
    );
  }

  return (
    <svg {...common}>
      <path
        d="M4 7h16M6 11h12M8 15h8"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
      />
      <path
        d="M6 19h12"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        opacity="0.6"
      />
    </svg>
  );
}

export default function EmptyState({
  title = "ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤",
  description,
  tone = "empty",
  scope = "panel",
  mode = "panel",
  actions,
  extra,
  showIcon = true,
  className,
}: EmptyStateProps) {
  const isError = tone === "error";
  const isLoading = tone === "loading";

  const padY = scope === "page" ? 34 : scope === "modal" ? 26 : 22;
  const titleSize = scope === "page" ? 15 : 14;
  const descSize = scope === "page" ? 13 : 12;

  const toneText = "var(--color-text-primary)";
  const toneMuted = isError
    ? "var(--color-text-secondary)"
    : "var(--color-text-muted)";

  const iconColor = isError
    ? "var(--color-error)"
    : isLoading
    ? "var(--color-text-muted)"
    : "var(--color-text-secondary)";

  const outerStyle: React.CSSProperties =
    mode === "panel"
      ? {
          borderRadius: "var(--radius-xl)",
          border: "1px solid var(--color-border-divider)",
          background: "var(--ui-log-bg)",
          boxShadow: "var(--elevation-1)",
          overflow: "hidden",
        }
      : {};

  const innerStyle: React.CSSProperties = {
    padding: `${padY}px var(--space-7)`,
    textAlign: "center",
    background: "transparent",
  };

  const badgeStyle: React.CSSProperties = {
    display: "inline-flex",
    alignItems: "center",
    justifyContent: "center",
    width: 36,
    height: 36,
    borderRadius: 12,
    border: "1px solid var(--color-border-divider)",
    background: "var(--bg-surface-soft)",
    color: iconColor,
    boxShadow: "var(--elevation-1)",
  };

  const titleStyle: React.CSSProperties = {
    marginTop: showIcon ? 12 : 0,
    fontSize: titleSize,
    fontWeight: "var(--font-title)",
    letterSpacing: "-0.18px",
    color: toneText,
  };

  const descStyle: React.CSSProperties = {
    marginTop: 8,
    fontSize: descSize,
    fontWeight: "var(--font-meta)",
    color: toneMuted,
    lineHeight: 1.55,
    whiteSpace: "pre-line",
  };

  const actionsStyle: React.CSSProperties = {
    marginTop: 16,
    display: "flex",
    justifyContent: "center",
  };

  const extraStyle: React.CSSProperties = {
    marginTop: 12,
    fontSize: 11,
    fontWeight: "var(--font-meta)",
    color: "var(--color-text-muted)",
  };

  const content = (
    <div style={innerStyle} className={cx("ds-empty", className)}>
      {showIcon && (
        <div style={{ display: "flex", justifyContent: "center" }}>
          <div style={badgeStyle}>
            <Icon tone={tone} />
          </div>
        </div>
      )}

      <div style={titleStyle}>{title}</div>
      {!!description && <div style={descStyle}>{description}</div>}
      {!!actions && <div style={actionsStyle}>{actions}</div>}
      {!!extra && <div style={extraStyle}>{extra}</div>}
    </div>
  );

  if (mode === "embedded") return content;

  return (
    <div className="ds-empty-panel" style={outerStyle}>
      {content}
    </div>
  );
}


==========================================================================================
# FILE: ui/ds/KPI.tsx
==========================================================================================
// PATH: src/shared/ui/ds/KPI.tsx
/**
 * ======================================================
 * KPI (SSOT)
 * - ê´€ë¦¬ì í™ˆ/ë¦¬í¬íŠ¸ì—ì„œ "ìˆ«ì ì¹´ë“œ"ë¥¼ í†µì¼
 * ======================================================
 */
export default function KPI({
  label,
  value,
  hint,
}: {
  label: string;
  value: string | number;
  hint?: string;
}) {
  return (
    <div className="kpi ds-kpi" data-kpi="true">
      <div
        className="kpi-label"
        style={{
          fontSize: "var(--text-sm)",
          color: "var(--color-text-muted)",
          fontWeight: "var(--font-title)",
        }}
      >
        {label}
      </div>

      <div
        className="kpi-value"
        style={{
          marginTop: 6,
          fontSize: "var(--text-2xl)",
          fontWeight: 700,
          letterSpacing: "-0.4px",
          color: "var(--color-text-primary)",
        }}
      >
        {value}
      </div>

      {hint && (
        <div
          style={{
            marginTop: 8,
            fontSize: "var(--text-sm)",
            fontWeight: "var(--font-meta)",
            color: "var(--color-text-secondary)",
          }}
        >
          {hint}
        </div>
      )}
    </div>
  );
}


==========================================================================================
# FILE: ui/ds/Page.tsx
==========================================================================================
// PATH: src/shared/ui/ds/Page.tsx
import React from "react";

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

export type PageDensity = "focus" | "browse" | "inspect";

type PageProps = React.PropsWithChildren<{
  width?: "default" | "wide" | "full";
  padding?: "default" | "compact";
  background?: "app" | "transparent";
  density?: PageDensity;
  className?: string;
}>;

export default function Page({
  width = "default",
  padding = "default",
  background = "transparent",
  density = "inspect",
  className,
  children,
}: PageProps) {
  const widthCls =
    width === "full"
      ? "max-w-none"
      : width === "wide"
      ? "max-w-[1440px]"
      : "max-w-[1200px]";

  const padCls = padding === "compact" ? "px-5 py-5" : "px-6 py-6";
  const bgCls = background === "app" ? "bg-[var(--bg-app)]" : "";

  const densityGap =
    density === "focus"
      ? "space-y-8"
      : density === "browse"
      ? "space-y-6"
      : "space-y-5";

  return (
    <div
      className={cx("ds-page", bgCls, className)}
      data-page-density={density}
      data-page-width={width}
      data-page-padding={padding}
      data-page-background={background}
    >
      <div className={cx("mx-auto w-full", widthCls, padCls)}>
        <div className={densityGap}>{children}</div>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: ui/ds/PageHeader.tsx
==========================================================================================
// PATH: src/shared/ui/ds/PageHeader.tsx
import React from "react";

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

type PageHeaderProps = {
  title: React.ReactNode;
  description?: React.ReactNode;
  badge?: React.ReactNode;
  actions?: React.ReactNode;
  meta?: React.ReactNode;
  bottom?: React.ReactNode;

  variant?: "hero" | "card" | "plain";
  importance?: "primary" | "normal";
  sticky?: boolean;
  className?: string;
};

export default function PageHeader({
  title,
  description,
  badge,
  actions,
  meta,
  bottom,
  variant = "hero",
  importance = "primary",
  sticky,
  className,
}: PageHeaderProps) {
  const isHero = variant === "hero";
  const isCard = variant === "card";

  const shell =
    isHero || isCard
      ? cx(
          "border border-[var(--border-divider)] bg-[var(--bg-surface)]",
          isHero ? "rounded-3xl shadow-sm" : "rounded-2xl"
        )
      : "";

  const pad = isHero ? "px-8 py-8" : isCard ? "px-6 py-5" : "px-0 py-0";

  const titleCls =
    importance === "primary"
      ? "text-2xl font-bold tracking-[-0.35px]"
      : "text-xl font-semibold tracking-[-0.25px]";

  const stickyCls = sticky
    ? "sticky top-0 z-30 backdrop-blur supports-[backdrop-filter]:bg-[color-mix(in_srgb,var(--bg-surface)_82%,transparent)]"
    : "";

  const heroStyle: React.CSSProperties | undefined = isHero
    ? { background: "var(--bg-surface)" }
    : undefined;

  return (
    <div className={cx(shell, stickyCls, className)} style={heroStyle}>
      <div className={pad}>
        <div className="flex items-start justify-between gap-6">
          <div className="min-w-0 space-y-2">
            <div className="flex items-center gap-2 min-w-0">
              <div className={cx(titleCls, "text-[var(--text-primary)] truncate")}>
                {title}
              </div>
              {badge}
            </div>

            {!!description && (
              <div className="text-sm text-[var(--text-muted)] leading-relaxed">
                {description}
              </div>
            )}
          </div>

          {!!actions && <div className="shrink-0">{actions}</div>}
        </div>

        {!!meta && (
          <div className="mt-5 text-[11px] font-semibold text-[var(--text-muted)]">
            {meta}
          </div>
        )}
      </div>

      {!!bottom && (
        <div className="border-t border-[var(--border-divider)] px-8 py-5">
          {bottom}
        </div>
      )}
    </div>
  );
}


==========================================================================================
# FILE: ui/ds/Panel.tsx
==========================================================================================
// PATH: src/shared/ui/ds/Panel.tsx
import React from "react";

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

export type PanelVariant = "primary" | "default" | "subtle";
export type PanelDensity = "default" | "compact";

type PanelProps = React.PropsWithChildren<{
  title?: React.ReactNode;
  description?: React.ReactNode;
  right?: React.ReactNode;
  footer?: React.ReactNode;

  variant?: PanelVariant;
  density?: PanelDensity;
  className?: string;
}>;

export default function Panel({
  title,
  description,
  right,
  footer,
  variant = "default",
  density = "default",
  className,
  children,
}: PanelProps) {
  const pad = density === "compact" ? "px-5 py-4" : "px-6 py-5";

  const headerBorder =
    variant === "primary"
      ? "border-b border-[color-mix(in_srgb,var(--color-brand-primary)_18%,var(--border-divider))]"
      : "border-b border-[var(--border-divider)]";

  return (
    <div
      className={cx("ds-panel", className)}
      data-panel-variant={variant}
      data-variant={variant}
      data-panel-density={density}
      data-density={density}
    >
      {(title || description || right) && (
        <div className={cx(pad, headerBorder)}>
          <div className="flex items-start justify-between gap-4">
            <div className="min-w-0 space-y-1">
              {!!title && (
                <div className="text-sm font-semibold text-[var(--text-primary)] tracking-[-0.15px]">
                  {title}
                </div>
              )}
              {!!description && (
                <div className="text-xs font-medium text-[var(--text-muted)]">
                  {description}
                </div>
              )}
            </div>
            {!!right && <div className="shrink-0">{right}</div>}
          </div>
        </div>
      )}

      <div className={cx(pad)}>
        <div className="space-y-4">{children}</div>
      </div>

      {!!footer && (
        <div className="border-t border-[var(--border-divider)] px-6 py-4">
          {footer}
        </div>
      )}
    </div>
  );
}


==========================================================================================
# FILE: ui/ds/Section.tsx
==========================================================================================
// PATH: src/shared/ui/ds/Section.tsx
import React from "react";

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

export type SectionLevel = "primary" | "secondary" | "tertiary";

type SectionProps = React.PropsWithChildren<{
  title?: React.ReactNode;
  description?: React.ReactNode;
  right?: React.ReactNode;
  hint?: React.ReactNode;

  level?: SectionLevel;
  className?: string;
}>;

export default function Section({
  title,
  description,
  right,
  hint,
  level = "secondary",
  className,
  children,
}: SectionProps) {
  const gap =
    level === "primary"
      ? "space-y-6"
      : level === "secondary"
      ? "space-y-4"
      : "space-y-3";

  const titleCls =
    level === "primary"
      ? "text-lg font-semibold tracking-[-0.25px]"
      : level === "secondary"
      ? "text-sm font-semibold tracking-[-0.15px]"
      : "text-xs font-semibold tracking-[-0.1px]";

  const metaTextCls =
    level === "tertiary"
      ? "text-[11px] text-[var(--text-muted)]"
      : "text-xs text-[var(--text-muted)]";

  return (
    <section
      className={cx("ds-section", gap, className)}
      data-section-level={level}
      data-level={level}
    >
      {(title || description || right || hint) && (
        <div
          className="ds-section__header"
          style={{
            paddingTop: "var(--space-7)",
            paddingLeft: "var(--space-7)",
            paddingRight: "var(--space-7)",
          }}
        >
          <div className="flex items-start justify-between gap-4">
            <div className="min-w-0 space-y-1">
              {!!title && (
                <div className={cx(titleCls, "text-[var(--text-primary)]")}>
                  {title}
                </div>
              )}
              {!!description && <div className={metaTextCls}>{description}</div>}
              {!!hint && (
                <div className="text-[11px] font-medium text-[var(--text-muted)]">
                  {hint}
                </div>
              )}
            </div>

            {!!right && <div className="shrink-0">{right}</div>}
          </div>
        </div>
      )}

      <div
        className="ds-section__body"
        style={{
          paddingBottom: "var(--space-7)",
          paddingLeft: "var(--space-7)",
          paddingRight: "var(--space-7)",
        }}
      >
        <div className={gap}>{children}</div>
      </div>
    </section>
  );
}


==========================================================================================
# FILE: ui/ds/SectionHeader.tsx
==========================================================================================
// PATH: src/shared/ui/ds/SectionHeader.tsx
// ì„¹ì…˜ ë‚´ë¶€ ì œëª©ìš©. í˜ì´ì§€ ìƒë‹¨ ì œëª©(ë„ë©”ì¸ í—¤ë”)ì—ëŠ” ì‚¬ìš© ê¸ˆì§€.
// í˜ì´ì§€ ì œëª©Â·íƒ­ì€ DomainLayoutì—ì„œë§Œ ë‹´ë‹¹. (íƒ­ ì•„ë˜ì— "ê·¼íƒœ" ê°™ì€ í° í—¤ë” ì¤‘ë³µ ê¸ˆì§€)
import React from "react";

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

type SectionHeaderProps = {
  title: React.ReactNode;
  description?: React.ReactNode;
  navigation?: React.ReactNode;
  actions?: React.ReactNode;
  className?: string;
};

export default function SectionHeader({
  title,
  description,
  navigation,
  actions,
  className,
}: SectionHeaderProps) {
  return (
    <div
      className={cx("ds-section-header", className)}
      style={{
        borderRadius: "var(--radius-2xl)",
        border: "1px solid var(--color-border-divider)",
        background: "color-mix(in srgb, var(--color-primary) 6%, var(--bg-surface))",
        boxShadow: "var(--elevation-1)",
      }}
    >
      <div
        style={{
          padding: "var(--space-7) var(--space-8)",
          display: "flex",
          alignItems: "flex-start",
          justifyContent: "space-between",
          gap: "var(--space-6)",
        }}
      >
        <div style={{ minWidth: 0 }}>
          <div
            style={{
              fontSize: 20,
              fontWeight: "var(--font-title)",
              letterSpacing: "-0.35px",
              color: "var(--color-text-primary)",
            }}
          >
            {title}
          </div>

          {description && (
            <div
              style={{
                marginTop: 6,
                fontSize: 13,
                fontWeight: "var(--font-meta)",
                color: "var(--color-text-muted)",
                lineHeight: 1.5,
              }}
            >
              {description}
            </div>
          )}
        </div>

        {actions && <div style={{ flexShrink: 0 }}>{actions}</div>}
      </div>

      {navigation && (
        <div
          style={{
            borderTop: "1px solid var(--color-border-divider)",
            padding: "12px 20px",
            background: "var(--color-bg-surface)",
          }}
        >
          {navigation}
        </div>
      )}
    </div>
  );
}


==========================================================================================
# FILE: ui/ds/Tabs.tsx
==========================================================================================
// PATH: src/shared/ui/ds/Tabs.tsx
import React from "react";

export interface TabItem {
  key: string;
  label: React.ReactNode;
  disabled?: boolean;
}

interface TabsProps {
  value: string;
  items: TabItem[];
  onChange: (key: string) => void;
}

export function Tabs({ value, items, onChange }: TabsProps) {
  return (
    <div className="ds-tabs" role="tablist" aria-orientation="horizontal">
      {items.map((t) => {
        const active = value === t.key;
        return (
          <button
            key={t.key}
            type="button"
            role="tab"
            aria-selected={active}
            aria-disabled={t.disabled || false}
            disabled={t.disabled}
            onClick={() => !t.disabled && onChange(t.key)}
            className={`ds-tab ${active ? "is-active" : ""}`}
          >
            {t.label}
          </button>
        );
      })}
    </div>
  );
}


==========================================================================================
# FILE: ui/ds/index.ts
==========================================================================================
// PATH: src/shared/ui/ds/index.ts

/* ===============================
 * DS GLOBAL STYLES â€” design-systemì—ì„œ ë‹¨ì¼ ë¡œë“œ (src/styles/design-system/)
 * =============================== */
import "@/styles/design-system/ds/input.css";
import "@/styles/design-system/ds/action-bar.css";
import "@/styles/design-system/ds/panel.css";
import "@/styles/design-system/ds/card-modal-style.css";
import "@/styles/design-system/ds/page.css";
import "@/styles/design-system/ds/page-header.css";
import "@/styles/design-system/ds/list-page.css";

/* ===============================
 * DS COMPONENT EXPORTS
 * =============================== */
export { default as Page } from "./Page";
export { default as PageHeader } from "./PageHeader";
export { default as SectionHeader } from "./SectionHeader";
export { default as Section } from "./Section";
export { default as Panel } from "./Panel";
export { default as EmptyState } from "./EmptyState";
export { default as KPI } from "./KPI";
export { default as Button } from "./Button";
export * from "./Tabs";

export { default as ActionBar } from "./components/ActionBar";
export { default as ActionButton } from "./components/ActionButton";
export { default as StatusBadge } from "./components/StatusBadge";
export { default as StatusToggle } from "./components/StatusToggle";
export { default as CloseButton } from "./CloseButton";


==========================================================================================
# FILE: ui/ds/components/ActionBar.tsx
==========================================================================================
// PATH: src/shared/ui/ds/components/ActionBar.tsx
import { ReactNode } from "react";

export default function ActionBar({
  children,
  align = "right",
}: {
  children: ReactNode;
  align?: "left" | "right";
}) {
  return (
    <div
      className="ds-action-bar"
      data-align={align}
    >
      {children}
    </div>
  );
}


==========================================================================================
# FILE: ui/ds/components/ActionButton.tsx
==========================================================================================
// PATH: src/shared/ui/ds/components/ActionButton.tsx
import { Button } from "@/shared/ui/ds";
import type { ButtonIntent, ButtonSize } from "@/shared/ui/ds/Button";

type Action =
  | "create"
  | "edit"
  | "delete"
  | "close"
  | "manage";

const ACTION_PRESET: Record<
  Action,
  { intent: ButtonIntent; label: string }
> = {
  create: { intent: "primary", label: "ìƒì„±" },
  edit: { intent: "secondary", label: "ìˆ˜ì •" },
  manage: { intent: "secondary", label: "ê´€ë¦¬" },
  close: { intent: "ghost", label: "ë‹«ê¸°" },
  delete: { intent: "danger", label: "ì‚­ì œ" },
};

export default function ActionButton({
  action,
  size = "md",
  children,
  ...props
}: {
  action: Action;
  size?: ButtonSize;
} & React.ComponentProps<typeof Button>) {
  const preset = ACTION_PRESET[action];

  return (
    <Button
      intent={preset.intent}
      size={size}
      {...props}
    >
      {children ?? preset.label}
    </Button>
  );
}


==========================================================================================
# FILE: ui/ds/components/StatusBadge.tsx
==========================================================================================
// PATH: src/shared/ui/ds/components/StatusBadge.tsx
export type Status = "active" | "inactive" | "archived";

const LABEL: Record<Status, string> = {
  active: "í™œì„±",
  inactive: "ë¹„í™œì„±",
  archived: "ì¢…ë£Œ",
};

export default function StatusBadge({ status }: { status: Status }) {
  return (
    <span
      className="ds-status-badge"
      data-status={status}
    >
      {LABEL[status]}
    </span>
  );
}


==========================================================================================
# FILE: ui/ds/components/StatusToggle.tsx
==========================================================================================
// PATH: src/shared/ui/ds/components/StatusToggle.tsx
import { Button } from "@/shared/ui/ds";

export default function StatusToggle({
  active,
  onToggle,
  disabled,
}: {
  active: boolean;
  onToggle: () => void;
  disabled?: boolean;
}) {
  return (
    <Button
      intent={active ? "secondary" : "ghost"}
      size="sm"
      aria-pressed={active}
      disabled={disabled}
      onClick={onToggle}
    >
      {active ? "í™œì„±" : "ë¹„í™œì„±"}
    </Button>
  );
}


==========================================================================================
# FILE: ui/excel/ExcelUploadZone.tsx
==========================================================================================
// PATH: src/shared/ui/excel/ExcelUploadZone.tsx
// ì—‘ì…€ ì—…ë¡œë“œ ë“œë˜ê·¸ ì˜ì—­ SSOT â€” ì „ì—­ í†µì¼: "Drag or Click" + ì—…ë¡œë“œ(ì•„ì´ì½˜) (docs/DESIGN_SSOT.md Â§8)

import { useRef, useState } from "react";
import { feedback } from "@/shared/ui/feedback/feedback";

const DEFAULT_ACCEPT = ".xlsx,.xls";
const INVALID_FILE_MSG = "ì—‘ì…€ íŒŒì¼(.xlsx, .xls)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.";

function ExcelIcon({ className, size = 24 }: { className?: string; size?: number }) {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      strokeWidth="2"
      strokeLinecap="round"
      strokeLinejoin="round"
      className={className}
      width={size}
      height={size}
      aria-hidden
    >
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
      <polyline points="14 2 14 8 20 8" />
      <line x1="16" y1="13" x2="8" y2="13" />
      <line x1="16" y1="17" x2="8" y2="17" />
      <line x1="10" y1="9" x2="8" y2="9" />
    </svg>
  );
}

function UploadIcon({ className, size = 24 }: { className?: string; size?: number }) {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      strokeWidth="2"
      strokeLinecap="round"
      strokeLinejoin="round"
      className={className}
      width={size}
      height={size}
      aria-hidden
    >
      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
      <polyline points="17 8 12 3 7 8" />
      <line x1="12" y1="3" x2="12" y2="15" />
    </svg>
  );
}

export interface ExcelUploadZoneProps {
  /** ë¶€ëª¨ì—ì„œ ì „ë‹¬í•œ file input ref (ì œì–´ ë¶ˆí•„ìš” ì‹œ ë‚´ë¶€ ref ì‚¬ìš©) */
  inputRef?: React.RefObject<HTMLInputElement | null>;
  /** íŒŒì¼ ì„ íƒ ì‹œ (ìœ íš¨í•œ íŒŒì¼ë§Œ í˜¸ì¶œ) */
  onFileSelect: (file: File) => void;
  /** accept (ê¸°ë³¸ .xlsx,.xls) */
  accept?: string;
  /** í•˜ë‹¨ ë³´ì¡° ì•ˆë‚´ (ì„ íƒ, ë¯¸ì§€ì • ì‹œ .xlsx, .xlsë§Œ í‘œì‹œ) */
  hintText?: string;
  /** ë¹„í™œì„±í™” */
  disabled?: boolean;
  /** ì˜ëª»ëœ íŒŒì¼ ì‹œ (ë¯¸ì§€ì • ì‹œ feedback.error) */
  onInvalidFile?: (message: string) => void;
}

export default function ExcelUploadZone({
  inputRef: externalRef,
  onFileSelect,
  accept = DEFAULT_ACCEPT,
  hintText = ".xlsx, .xls",
  disabled = false,
  onInvalidFile = (msg) => feedback.error(msg),
}: ExcelUploadZoneProps) {
  const internalRef = useRef<HTMLInputElement>(null);
  const inputRef = externalRef ?? internalRef;
  const [dragover, setDragover] = useState(false);

  const handleFile = (file: File | null) => {
    if (!file) return;
    if (!/\.(xlsx|xls)$/i.test(file.name)) {
      onInvalidFile(INVALID_FILE_MSG);
      return;
    }
    onFileSelect(file);
  };

  return (
    <div
      role="button"
      tabIndex={0}
      onClick={() => !disabled && inputRef.current?.click()}
      onKeyDown={(e) => e.key === "Enter" && !disabled && inputRef.current?.click()}
      className={`excel-upload-zone ${dragover ? "excel-upload-zone--dragover" : ""}`}
      onDragOver={(e) => {
        e.preventDefault();
        e.stopPropagation();
        if (!disabled) setDragover(true);
      }}
      onDragLeave={(e) => {
        e.preventDefault();
        setDragover(false);
      }}
      onDrop={(e) => {
        e.preventDefault();
        setDragover(false);
        if (disabled) return;
        const file = e.dataTransfer.files[0];
        handleFile(file ?? null);
      }}
    >
      <input
        ref={inputRef}
        type="file"
        accept={accept}
        style={{ display: "none" }}
        onChange={(e) => {
          const file = e.target.files?.[0];
          if (file) handleFile(file);
          e.target.value = "";
        }}
      />
      <div className="excel-upload-zone__head">
        <ExcelIcon size={22} style={{ color: "var(--color-text-secondary)" }} />
        <span className="excel-upload-zone__title">Excel</span>
      </div>
      <div className="excel-upload-zone__drag-label">Drag or Click</div>
      <div className="excel-upload-zone__upload" style={{ marginBottom: hintText ? undefined : 0 }}>
        <UploadIcon size={16} className="excel-upload-zone__upload-icon" />
        <span className="excel-upload-zone__upload-label">ì—…ë¡œë“œ</span>
      </div>
      {hintText ? (
        <div className="modal-hint" style={{ marginTop: "var(--space-1)" }}>
          {hintText}
        </div>
      ) : null}
    </div>
  );
}


==========================================================================================
# FILE: ui/feedback/feedback.ts
==========================================================================================
// PATH: src/shared/ui/feedback/feedback.ts
import { message } from "antd";

message.config({
  duration: 2,
  maxCount: 3,
});

export const feedback = {
  success(text: string) {
    message.success({ content: text });
  },
  error(text: string) {
    message.error({ content: text });
  },
  info(text: string) {
    message.info({ content: text });
  },
};


==========================================================================================
# FILE: ui/feedback/index.ts
==========================================================================================
// PATH: src/shared/ui/feedback/index.ts
export { feedback } from "./feedback";


==========================================================================================
# FILE: ui/layout/AdminLayoutContext.tsx
==========================================================================================
/**
 * ì„ ìƒì•± ëª¨ë°”ì¼: ë“œë¡œì–´ ì—´ê¸°/ë‹«ê¸°. AppLayout(ëª¨ë°”ì¼)ì—ì„œë§Œ ì œê³µ.
 */
import { createContext, useContext, useCallback, useState } from "react";

type AdminLayoutContextValue = {
  openDrawer: () => void;
  closeDrawer: () => void;
  drawerOpen: boolean;
};

const AdminLayoutContext = createContext<AdminLayoutContextValue | null>(null);

export function AdminLayoutProvider({
  children,
}: {
  children: React.ReactNode;
}) {
  const [drawerOpen, setDrawerOpen] = useState(false);
  const openDrawer = useCallback(() => setDrawerOpen(true), []);
  const closeDrawer = useCallback(() => setDrawerOpen(false), []);
  return (
    <AdminLayoutContext.Provider
      value={{ openDrawer, closeDrawer, drawerOpen }}
    >
      {children}
    </AdminLayoutContext.Provider>
  );
}

export function useAdminLayout() {
  const ctx = useContext(AdminLayoutContext);
  return ctx;
}


==========================================================================================
# FILE: ui/layout/AdminNavDrawer.tsx
==========================================================================================
/**
 * ì„ ìƒì•± ëª¨ë°”ì¼: ì¢Œì¸¡ ë“œë¡œì–´ì— í‘œì‹œí•  ì „ì²´ ë©”ë‰´. ë§í¬ í´ë¦­ ì‹œ ë“œë¡œì–´ ë‹«í˜.
 */
import { NavLink, useLocation } from "react-router-dom";
import { Drawer } from "antd";
import { useAdminLayout } from "./AdminLayoutContext";
import { ADMIN_NAV_GROUPS, NavIcon } from "./adminNavConfig";

export default function AdminNavDrawer() {
  const layout = useAdminLayout();
  const loc = useLocation();
  const open = layout?.drawerOpen ?? false;
  const onClose = layout?.closeDrawer ?? (() => {});

  const isActive = (to: string) =>
    to !== "" && (loc.pathname === to || loc.pathname.startsWith(to + "/"));

  return (
    <Drawer
      title="ë©”ë‰´"
      placement="left"
      open={open}
      onClose={onClose}
      width={280}
      styles={{ body: { padding: "8px 0" } }}
    >
      <div className="nav" style={{ display: "flex", flexDirection: "column", gap: 10 }}>
        {ADMIN_NAV_GROUPS.map((g, gi) => (
          <div key={gi} className="sidebar-group">
            {g.title ? (
              <div className="sidebar-group-title">{g.title}</div>
            ) : null}
            {g.items.map((it) => {
              const active = isActive(it.to);
              return (
                <NavLink
                  key={it.to}
                  to={it.to}
                  onClick={onClose}
                  className={`nav-item ${active ? "active" : ""}`}
                  style={{
                    display: "flex",
                    alignItems: "center",
                    gap: 12,
                    padding: "10px 12px",
                    borderRadius: 12,
                    marginBottom: 4,
                    textDecoration: "none",
                    color: "var(--sidebar-muted)",
                  }}
                >
                  <span style={{ display: "grid", placeItems: "center", width: 22, flex: "0 0 auto" }}>
                    <NavIcon d={it.iconPath} />
                  </span>
                  <span>{it.label}</span>
                </NavLink>
              );
            })}
          </div>
        ))}
      </div>
    </Drawer>
  );
}


==========================================================================================
# FILE: ui/layout/AppLayout.tsx
==========================================================================================
// PATH: src/shared/ui/layout/AppLayout.tsx
import { Outlet } from "react-router-dom";
import { ConfigProvider } from "antd";
import Sidebar from "./Sidebar";
import Header from "./Header";
import AppLayoutMobile from "./AppLayoutMobile";
import { AdminLayoutProvider } from "./AdminLayoutContext";
import { TeacherViewProvider } from "./TeacherViewContext";
import { AsyncStatusBar } from "@/shared/ui/asyncStatus";
import { ThemeProvider } from "@/context/ThemeContext";
import { ProgramProvider } from "@/shared/program";
import { NoticeProvider } from "@/features/notice/context/NoticeContext";
import { SendMessageModalProvider } from "@/features/messages/context/SendMessageModalContext";
import { useIsMobile } from "@/shared/hooks/useIsMobile";
import { useFavicon } from "@/shared/hooks/useFavicon";

function AppLayoutContent() {
  const isMobile = useIsMobile();
  useFavicon();

  return (
    <>
      {isMobile ? (
        <AdminLayoutProvider>
          <AppLayoutMobile />
        </AdminLayoutProvider>
      ) : (
    <div
      data-app="admin"
      style={{
        height: "100vh",
        minHeight: "100vh",
        overflow: "hidden",
        background: "var(--layout-canvas-bg)",
        color: "var(--color-text-primary)",
      }}
    >
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "var(--sidebar-width) 1fr",
          gridTemplateRows: "auto 1fr",
          height: "100%",
          minHeight: 0,
        }}
      >
        <header
          style={{
            gridColumn: "1 / -1",
            position: "sticky",
            top: 0,
            zIndex: 80,
            background:
              "color-mix(in srgb, var(--layout-header-bg) 92%, transparent)",
            backdropFilter: "blur(14px)",
            WebkitBackdropFilter: "blur(14px)",
          }}
        >
          <Header />
        </header>

        <aside
          className="sidebar"
          style={{
            gridRow: "2",
            position: "sticky",
            top: "var(--panel-header)",
            height: "calc(100vh - var(--panel-header))",
            overflow: "hidden",
          }}
        >
          <Sidebar />
        </aside>

        <main
          style={{
            gridRow: "2",
            minWidth: 0,
            minHeight: 0,
            overflowY: "auto",
            overflowX: "hidden",
            overscrollBehavior: "contain",
            WebkitOverflowScrolling: "touch",
            background: "var(--layout-page-bg)",
          }}
        >
          <div
            style={{
              padding: "var(--space-6)",
              maxWidth: 1520,
              margin: "0 auto",
            }}
          >
            <Outlet />
          </div>
        </main>
      </div>
      <AsyncStatusBar />
    </div>
      )}
    </>
  );
}

export default function AppLayout() {
  return (
    <TeacherViewProvider>
      <ThemeProvider>
      <ProgramProvider>
        <NoticeProvider>
          <ConfigProvider
            theme={{
              algorithm: false,
              token: {
                colorPrimary: "var(--color-brand-primary)",

                colorBgBase: "var(--layout-canvas-bg)",
                colorBgLayout: "var(--layout-page-bg)",
                colorBgContainer: "var(--color-bg-surface)",
                colorBgElevated: "var(--color-bg-surface)",

                colorBorder: "var(--color-border-divider)",

                colorText: "var(--color-text-primary)",
                colorTextSecondary: "var(--color-text-secondary)",
                colorTextTertiary: "var(--color-text-muted)",
                colorTextQuaternary: "var(--color-text-disabled)",
                colorTextPlaceholder: "var(--color-text-muted)",

                colorFillSecondary: "var(--color-bg-surface-hover)",
                colorFillTertiary: "var(--color-bg-surface-hover)",
              },
              components: {
                Segmented: {
                  itemColor: "var(--color-text-secondary)",
                  itemHoverColor: "var(--color-text-primary)",
                  itemSelectedColor: "var(--color-text-inverse)",
                  itemSelectedBg: "var(--color-brand-primary)",
                  trackBg: "var(--color-bg-surface-hover)",
                  borderRadius: 10,
                },
                Button: {
                  colorPrimary: "var(--color-brand-primary)",
                  colorTextLightSolid: "var(--color-text-inverse)",
                  borderRadius: 10,
                },
                Checkbox: {
                  colorPrimary: "var(--color-brand-primary)",
                },
                Table: {
                  headerBg: "var(--color-bg-surface-hover)",
                  headerColor: "var(--color-text-secondary)",
                  headerSplitColor: "var(--color-border-divider)",
                  rowHoverBg: "var(--color-bg-surface-hover)",
                  borderColor: "var(--color-border-divider)",
                },
              },
            }}
          >
            <SendMessageModalProvider>
              <AppLayoutContent />
            </SendMessageModalProvider>
          </ConfigProvider>
        </NoticeProvider>
      </ProgramProvider>
    </ThemeProvider>
    </TeacherViewProvider>
  );
}


==========================================================================================
# FILE: ui/layout/AppLayoutMobile.tsx
==========================================================================================
/**
 * ì„ ìƒì•± ëª¨ë°”ì¼ ì „ìš© ë ˆì´ì•„ì›ƒ: ìƒë‹¨ í—¤ë” + ë©”ì¸ ìŠ¤í¬ë¡¤ + í•˜ë‹¨ íƒ­ë°”. ë„¤ë¹„ëŠ” ë“œë¡œì–´ë¡œ.
 */
import { Outlet } from "react-router-dom";
import Header from "./Header";
import AdminNavDrawer from "./AdminNavDrawer";
import TeacherBottomBar from "./TeacherBottomBar";
import { AsyncStatusBar } from "@/shared/ui/asyncStatus";

const TABBAR_HEIGHT = 56;
const SAFE_BOTTOM = "env(safe-area-inset-bottom, 0)";

export default function AppLayoutMobile() {
  return (
    <div
      data-app="admin"
      style={{
        height: "100vh",
        minHeight: "100vh",
        overflow: "hidden",
        background: "var(--layout-canvas-bg)",
        color: "var(--color-text-primary)",
        display: "flex",
        flexDirection: "column",
      }}
    >
      <header
        style={{
          flexShrink: 0,
          position: "sticky",
          top: 0,
          zIndex: 80,
          background: "color-mix(in srgb, var(--layout-header-bg) 92%, transparent)",
          backdropFilter: "blur(14px)",
          WebkitBackdropFilter: "blur(14px)",
        }}
      >
        <Header />
      </header>

      <main
        style={{
          flex: 1,
          minHeight: 0,
          overflowY: "auto",
          overflowX: "hidden",
          WebkitOverflowScrolling: "touch",
          background: "var(--layout-page-bg)",
          padding: "var(--space-4)",
          paddingBottom: `calc(${TABBAR_HEIGHT}px + ${SAFE_BOTTOM} + var(--space-4))`,
        }}
      >
        <Outlet />
      </main>

      <AdminNavDrawer />
      <TeacherBottomBar />
      <AsyncStatusBar />
    </div>
  );
}


==========================================================================================
# FILE: ui/layout/DomainLayout.tsx
==========================================================================================
// PATH: src/shared/ui/layout/DomainLayout.tsx
// Re-export from domain (SSOT) â€” ê¸°ì¡´ import ê²½ë¡œ ìœ ì§€

export { DomainLayout as default } from "@/shared/ui/domain";
export type { DomainTab } from "@/shared/ui/domain";


==========================================================================================
# FILE: ui/layout/Header.tsx
==========================================================================================
// PATH: src/shared/ui/layout/Header.tsx
import { useState, useEffect } from "react";
import { useLocation, useNavigate, useSearchParams } from "react-router-dom";
import { useQuery } from "@tanstack/react-query";
import { Dropdown, Input, Badge } from "antd";
import ThemeOverlay from "@/features/settings/overlays/ThemeOverlay";
import NoticeOverlay from "@/features/notice/overlays/NoticeOverlay";
import { useNotices } from "@/features/notice/context/NoticeContext";
import { useAdminNotificationCounts } from "@/features/admin-notifications";
import { useProgram } from "@/shared/program";
import { useAdminLayout } from "@/shared/ui/layout/AdminLayoutContext";
import { useTeacherView } from "@/shared/ui/layout/TeacherViewContext";
import { Button } from "@/shared/ui/ds";
import { useMessagingInfo } from "@/features/messages/hooks/useMessagingInfo";
import { fetchMe, displayUsername, meToStaffRole } from "@/features/profile/api/profile.api";
import { StaffRoleAvatar } from "@/shared/ui/avatars";
import { useDocumentTitle } from "@/shared/hooks/useDocumentTitle";
import { resolveTenantCode } from "@/shared/tenant";
import { getTenantIdFromCode } from "@/shared/tenant";
import TchulLogoIcon from "@/features/auth/pages/logos/TchulLogoIcon.png";

function IconMenu() {
  return (
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
      <path
        d="M4 6h16M4 12h16M4 18h16"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
      />
    </svg>
  );
}

function IconSmartphone() {
  return (
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
      <rect x="5" y="2" width="14" height="20" rx="2" ry="2" />
      <path d="M12 18h.01" />
    </svg>
  );
}

function IconMonitor() {
  return (
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
      <rect x="2" y="3" width="20" height="14" rx="2" ry="2" />
      <path d="M8 21h8M12 17v4" />
    </svg>
  );
}

function IconSearch() {
  return (
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
      <path
        d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z"
        stroke="currentColor"
        strokeWidth="2"
      />
      <path
        d="M16.5 16.5 21 21"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
      />
    </svg>
  );
}

function IconPlus() {
  return (
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
      <path
        d="M12 5v14M5 12h14"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
      />
    </svg>
  );
}

function IconUser() {
  return (
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
      <path
        d="M20 21a8 8 0 1 0-16 0"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
      />
      <path
        d="M12 13a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z"
        stroke="currentColor"
        strokeWidth="2"
      />
    </svg>
  );
}

function IconBell() {
  return (
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
      <path
        d="M18 8a6 6 0 1 0-12 0c0 7-3 7-3 7h18s-3 0-3-7Z"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinejoin="round"
      />
      <path
        d="M13.73 21a2 2 0 0 1-3.46 0"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
      />
    </svg>
  );
}

function IconPalette() {
  return (
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
      <path
        d="M12 22a10 10 0 1 1 7.07-17.07c1.38 1.38.43 3.74-1.52 3.74H15a3 3 0 0 0 0 6h1.56c1.62 0 2.66 1.72 1.86 3.14A10 10 0 0 1 12 22Z"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinejoin="round"
      />
      <path
        d="M7.5 10.5h0"
        stroke="currentColor"
        strokeWidth="3"
        strokeLinecap="round"
      />
      <path
        d="M10.5 7.5h0"
        stroke="currentColor"
        strokeWidth="3"
        strokeLinecap="round"
      />
      <path
        d="M13.5 7.5h0"
        stroke="currentColor"
        strokeWidth="3"
        strokeLinecap="round"
      />
      <path
        d="M16.5 10.5h0"
        stroke="currentColor"
        strokeWidth="3"
        strokeLinecap="round"
      />
    </svg>
  );
}

function IconCredit() {
  return (
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
      <circle cx="12" cy="12" r="10" />
      <path d="M12 6v12M8 10h8M8 14h8" />
    </svg>
  );
}

export default function Header() {
  const loc = useLocation();
  const nav = useNavigate();
  const adminLayout = useAdminLayout();
  const teacherView = useTeacherView();
  const isMobile = adminLayout != null;
  const { program } = useProgram();
  const { data: messagingInfo } = useMessagingInfo();
  const { data: me } = useQuery({ queryKey: ["me"], queryFn: fetchMe });

  const [searchParams] = useSearchParams();
  const searchFromUrl = searchParams.get("search") ?? "";
  const isOnDashboard = loc.pathname.includes("/dashboard");
  const [q, setQ] = useState(searchFromUrl);
  const [openTheme, setOpenTheme] = useState(false);

  useEffect(() => {
    if (isOnDashboard && searchFromUrl !== q) setQ(searchFromUrl);
  }, [isOnDashboard, searchFromUrl]);
  const [openNotice, setOpenNotice] = useState(false);
  const [alarmDropdownOpen, setAlarmDropdownOpen] = useState(false);
  const { notices } = useNotices();
  const { counts: adminCounts, items: adminNotificationItems } = useAdminNotificationCounts();
  const unreadCount = adminCounts.total;

  const openNoticeAndCloseAlarm = () => {
    setAlarmDropdownOpen(false);
    setOpenNotice(true);
  };









  // ë¸Œë¼ìš°ì € íƒ€ì´í‹€ ë™ì  ì„¤ì •
  useDocumentTitle();

  // í•™ì› ì´ë¦„: Programì˜ display_name ì‚¬ìš©
  const academyName = program?.display_name || "HakwonPlus";
  
  









  
  
  // ë¡œê³  URL: Programì˜ ui_config.logo_url ìš°ì„ , ì—†ìœ¼ë©´ í…Œë„ŒíŠ¸ë³„ ê¸°ë³¸ ë¡œê³  ì‚¬ìš©
  const tenantResult = resolveTenantCode();
  const tenantId = tenantResult.ok ? getTenantIdFromCode(tenantResult.code) : null;
  const isTchul = tenantResult.ok && (tenantResult.code === "tchul" || tenantResult.code === "9999" || tenantId === 2);
  
  const logoUrl = program?.ui_config?.logo_url || (isTchul ? TchulLogoIcon : null);

  const userMenu = {
    items: [
      { key: "settings", label: "ì„¤ì •" },
      { key: "theme", label: "í…Œë§ˆ" },
      { key: "divider-1", type: "divider" as const },
      { key: "logout", label: "ë¡œê·¸ì•„ì›ƒ" },
    ],
    onClick: ({ key }: { key: string }) => {
      if (key === "settings") nav("/admin/settings");
      if (key === "theme") setOpenTheme(true);
      if (key === "logout") nav("/login");
    },
  };

  const quickMenu = {
    items: [
      { key: "student", label: "í•™ìƒ ë“±ë¡" },
      { key: "lecture", label: "ê°•ì˜ ìƒì„±" },
      { key: "exam", label: "ì‹œí—˜ ìƒì„±" },
      { key: "divider-1", type: "divider" as const },
      { key: "clinic", label: "í´ë¦¬ë‹‰ ìƒì„±" },
    ],
    onClick: ({ key }: { key: string }) => {
      if (key === "student") nav("/admin/students");
      if (key === "lecture") nav("/admin/lectures");
      if (key === "exam") nav("/admin/exams");
      if (key === "clinic") nav("/admin/clinic");
    },
  };

  return (
    <>
      <div className="app-header" data-mobile={isMobile || undefined}>
        {/* LEFT */}
        <div className="app-header__left">
          <Button
            intent="ghost"
            size="lg"
            iconOnly
            className="app-header__iconBtn"
            onClick={() =>
              isMobile
                ? adminLayout?.openDrawer()
                : document.dispatchEvent(new Event("ui:sidebar:toggle"))
            }
            aria-label={isMobile ? "ë©”ë‰´ ì—´ê¸°" : "ì‚¬ì´ë“œë°” í† ê¸€"}
            leftIcon={<IconMenu />}
          />

          <div className="app-header__brand">
            <span className="app-header__brandMark" aria-hidden>
              {logoUrl ? (
                <img src={logoUrl} alt="logo" />
              ) : (
                <span style={{ width: 8, height: 8, borderRadius: 999 }} />
              )}
            </span>
            <span className="app-header__brandName">{academyName}</span>
          </div>
        </div>

        {/* CENTER: ì¤‘ì•™ í†µí•© ê²€ìƒ‰ì°½ */}
        {!isMobile && (
        <div className="app-header__center">
          <div className="app-header__searchWrap">
            <Input
              value={q}
              onChange={(e) => setQ(e.target.value)}
              placeholder="Q ì „ì²´ ê²€ìƒ‰ (í•™ìƒ/ê°•ì˜/ì‹œí—˜/í´ë¦¬ë‹‰/ì§ì›)â€¦"
              allowClear
              prefix={
                <span style={{ color: "var(--color-text-muted)" }}>
                  <IconSearch />
                </span>
              }
              onPressEnter={() =>
                nav(`/admin/dashboard?search=${encodeURIComponent(q.trim())}`)
              }
              className="app-header__searchInput"
            />
          </div>
        </div>
        )}

        {/* RIGHT: í¬ë ˆë”§ | ë§Œë“¤ê¸° | ëª¨ë°”ì¼/PC | ì•ŒëŒ ë“œë¡­ë‹¤ìš´ | ì ‘ì†ì ì•„ë°”íƒ€+ì´ë¦„ */}
        <div className="app-header__right">
          {!isMobile && (
            <div className="app-header__credit" title="ì•Œë¦¼í†¡ í¬ë ˆë”§">
              <span className="app-header__creditIcon"><IconCredit /></span>
              <span className="app-header__creditValue">
                {messagingInfo != null
                  ? Number(messagingInfo.credit_balance).toLocaleString()
                  : "0"}
              </span>
            </div>
          )}

          {!isMobile && (
          <Dropdown menu={quickMenu} trigger={["click"]} placement="bottomRight">
            <span>
              <Button
                intent="secondary"
                size="lg"
                className="app-header__menuBtn"
                leftIcon={<IconPlus />}
              >
                ë§Œë“¤ê¸°
              </Button>
            </span>
          </Dropdown>
          )}

          {teacherView && (
            <Button
              intent="secondary"
              size="lg"
              iconOnly
              className="app-header__iconBtn"
              onClick={() => teacherView.setForceView(isMobile ? "desktop" : "mobile")}
              aria-label={isMobile ? "PC ë²„ì „ìœ¼ë¡œ ë³´ê¸°" : "ëª¨ë°”ì¼ ë²„ì „ìœ¼ë¡œ ë³´ê¸°"}
              title={isMobile ? "PC ë²„ì „ìœ¼ë¡œ ë³´ê¸°" : "ëª¨ë°”ì¼ ë²„ì „ìœ¼ë¡œ ë³´ê¸°"}
              leftIcon={isMobile ? <IconMonitor /> : <IconSmartphone />}
            />
          )}

          <Dropdown
            open={alarmDropdownOpen}
            onOpenChange={setAlarmDropdownOpen}
            trigger={["click"]}
            placement="bottomRight"
            dropdownRender={() => (
              <div className="app-header__alarmDropdown">
                <div className="app-header__alarmDropdownHeader">
                  <span>ì•Œë¦¼</span>
                  <button
                    type="button"
                    className="app-header__alarmDropdownHeaderLink"
                    onClick={openNoticeAndCloseAlarm}
                  >
                    ì•Œë¦¼ ì „ì²´ ë³´ê¸°
                  </button>
                </div>
                <div className="app-header__alarmDropdownList">
                  {adminNotificationItems.length === 0 ? (
                    <div className="app-header__alarmDropdownEmpty">ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤</div>
                  ) : (
                    adminNotificationItems.map((item) => (
                      <div
                        key={item.type}
                        className="app-header__alarmDropdownItem"
                        data-level="info"
                        onClick={() => {
                          setAlarmDropdownOpen(false);
                          nav(item.to);
                        }}
                        role="button"
                        tabIndex={0}
                        onKeyDown={(e) => {
                          if (e.key === "Enter" || e.key === " ") {
                            e.preventDefault();
                            setAlarmDropdownOpen(false);
                            nav(item.to);
                          }
                        }}
                      >
                        <div className="app-header__alarmDropdownItemInner">
                          <span className="app-header__alarmDropdownItemAccent" aria-hidden />
                          <div className="app-header__alarmDropdownItemContent">
                            <strong>{item.label}</strong>
                            <span className="app-header__alarmDropdownItemBody">{item.count}ê±´</span>
                          </div>
                        </div>
                      </div>
                    ))
                  )}
                </div>
              </div>
            )}
          >
            <span>
              <Button
                intent="secondary"
                size="lg"
                iconOnly
                className="app-header__iconBtn"
                aria-label="ì•Œë¦¼"
                leftIcon={
                  <Badge count={unreadCount} size="small">
                    <IconBell />
                  </Badge>
                }
              />
            </span>
          </Dropdown>

          <Dropdown menu={userMenu} trigger={["click"]} placement="bottomRight">
            <span>
              <Button
                intent="secondary"
                size="lg"
                className="app-header__userBtn"
                aria-label="í”„ë¡œí•„"
                leftIcon={
                  me ? (
                    <StaffRoleAvatar
                      role={meToStaffRole(me)}
                      size={20}
                      className="text-[var(--color-text-secondary)]"
                    />
                  ) : (
                    <IconUser />
                  )
                }
              >
                {me?.name || me?.username ? (me.name || displayUsername(me.username) || "ì‚¬ìš©ì") : "í”„ë¡œí•„"}
              </Button>
            </span>
          </Dropdown>
        </div>
      </div>

      {openTheme && <ThemeOverlay onClose={() => setOpenTheme(false)} />}
      {openNotice && <NoticeOverlay onClose={() => setOpenNotice(false)} />}
    </>
  );
}


==========================================================================================
# FILE: ui/layout/MetaZone.tsx
==========================================================================================
// PATH: src/shared/ui/layout/MetaZone.tsx
import { PropsWithChildren } from "react";

export function MetaZone({ children }: PropsWithChildren) {
  return (
    <aside data-area="meta">
      {children}
    </aside>
  );
}


==========================================================================================
# FILE: ui/layout/Sidebar.tsx
==========================================================================================
// PATH: src/shared/ui/layout/Sidebar.tsx
import { NavLink, useLocation } from "react-router-dom";
import { useEffect, useState } from "react";
import {
  ADMIN_NAV_BASE,
  ADMIN_NAV_GROUPS,
  NavIcon,
} from "./adminNavConfig";

const SIDEBAR_STORAGE_KEY = "ui.sidebar.collapsed";

function safeGetCollapsed(): boolean {
  try {
    const v = localStorage.getItem(SIDEBAR_STORAGE_KEY);
    return v === "1";
  } catch {
    return false;
  }
}

function safeSetCollapsed(v: boolean) {
  try {
    localStorage.setItem(SIDEBAR_STORAGE_KEY, v ? "1" : "0");
  } catch {
    // ignore
  }
}

function applySidebarLayout(collapsed: boolean) {
  const root = document.documentElement;
  root.setAttribute("data-sidebar", collapsed ? "collapsed" : "expanded");
  root.style.setProperty(
    "--sidebar-width",
    collapsed ? "var(--sidebar-width-collapsed)" : "260px"
  );
}

export default function Sidebar() {
  const loc = useLocation();
  const [collapsed, setCollapsed] = useState<boolean>(() => safeGetCollapsed());

  useEffect(() => {
    applySidebarLayout(collapsed);
    safeSetCollapsed(collapsed);
  }, [collapsed]);

  useEffect(() => {
    const onToggle = () => setCollapsed((v) => !v);
    document.addEventListener("ui:sidebar:toggle", onToggle);
    return () => document.removeEventListener("ui:sidebar:toggle", onToggle);
  }, []);

  const groups = ADMIN_NAV_GROUPS;

  const isActive = (to: string) =>
    loc.pathname === to || loc.pathname.startsWith(to + "/");

  return (
    <aside
      className="sidebar sidebar-shell"
      style={{
        height: "100vh",
        display: "flex",
        flexDirection: "column",
        overflow: "hidden",
        background:
          "linear-gradient(180deg, var(--sidebar-bg), color-mix(in srgb, var(--sidebar-bg) 78%, var(--layout-canvas-bg)))",
      }}
    >
      <div style={{ flex: 1, overflow: "hidden", padding: "12px" }}>
        <div className="nav">
          {groups.map((g, gi) => (
            <div key={gi} className="sidebar-group">
              {g.title ? (
                <div className="sidebar-group-title">{g.title}</div>
              ) : null}

              {g.items.map((it) => {
                const active = isActive(it.to);

                return (
                  <NavLink
                    key={it.to}
                    to={it.to}
                    className={`nav-item ${active ? "active" : ""}`}
                    title={it.label}
                  >
                    <span
                      style={{
                        display: "grid",
                        placeItems: "center",
                        width: 22,
                        flex: "0 0 auto",
                      }}
                    >
                      <NavIcon d={it.iconPath} />
                    </span>

                    {!collapsed && (
                      <span className="label" style={{ minWidth: 0 }}>
                        {it.label}
                      </span>
                    )}
                  </NavLink>
                );
              })}
            </div>
          ))}
        </div>
      </div>
    </aside>
  );
}


==========================================================================================
# FILE: ui/layout/TeacherBottomBar.tsx
==========================================================================================
/**
 * ì„ ìƒì•± ëª¨ë°”ì¼ ì „ìš©: í•˜ë‹¨ íƒ­ë°”. í™ˆ/í•™ìƒ/ê°•ì˜/ì»¤ë®¤ë‹ˆí‹°/ë©”ë‰´(ë“œë¡œì–´)
 */
import { NavLink } from "react-router-dom";
import { useAdminLayout } from "./AdminLayoutContext";
import { ADMIN_MOBILE_TABS, NavIcon } from "./adminNavConfig";

export default function TeacherBottomBar() {
  const layout = useAdminLayout();

  return (
    <nav
      aria-label="í•˜ë‹¨ ë©”ë‰´"
      className="teacher-tabbar"
      style={{
        position: "fixed",
        left: 0,
        right: 0,
        bottom: 0,
        zIndex: 70,
        paddingBottom: "env(safe-area-inset-bottom, 0)",
        background: "color-mix(in srgb, var(--layout-header-bg) 96%, transparent)",
        backdropFilter: "blur(14px)",
        borderTop: "1px solid var(--color-border-divider)",
        boxShadow: "0 -2px 12px rgba(0,0,0,0.06)",
      }}
    >
      <div
        style={{
          height: 56,
          display: "grid",
          gridTemplateColumns: `repeat(${ADMIN_MOBILE_TABS.length}, 1fr)`,
          alignItems: "center",
          maxWidth: 480,
          margin: "0 auto",
          padding: "0 8px",
        }}
      >
        {ADMIN_MOBILE_TABS.map((t) => {
          if (t.to === "") {
            return (
              <button
                key="menu"
                type="button"
                onClick={() => layout?.openDrawer()}
                style={{
                  display: "flex",
                  flexDirection: "column",
                  alignItems: "center",
                  justifyContent: "center",
                  gap: 2,
                  height: "100%",
                  color: "var(--color-text-secondary)",
                  background: "none",
                  border: "none",
                  cursor: "pointer",
                }}
              >
                <span style={{ width: 24, height: 24, display: "flex", alignItems: "center", justifyContent: "center" }}>
                  <NavIcon d={t.iconPath} />
                </span>
                <span style={{ fontSize: 10, fontWeight: 600 }}>{t.label}</span>
              </button>
            );
          }
          return (
            <NavLink
              key={t.to}
              to={t.to}
              style={({ isActive }) => ({
                display: "flex",
                flexDirection: "column",
                alignItems: "center",
                justifyContent: "center",
                gap: 2,
                height: "100%",
                color: isActive ? "var(--color-brand-primary)" : "var(--color-text-muted)",
                textDecoration: "none",
                transition: "color 0.15s ease",
              })}
            >
              <span style={{ width: 24, height: 24, display: "flex", alignItems: "center", justifyContent: "center" }}>
                <NavIcon d={t.iconPath} />
              </span>
              <span style={{ fontSize: 10, fontWeight: 600 }}>{t.label}</span>
            </NavLink>
          );
        })}
      </div>
    </nav>
  );
}


==========================================================================================
# FILE: ui/layout/TeacherViewContext.tsx
==========================================================================================
/**
 * ì„ ìƒì•±: ëª¨ë°”ì¼/PC ë²„ì „ ê°•ì œ ë³´ê¸°. ìƒë‹¨ "ëª¨ë°”ì¼ ë²„ì „ìœ¼ë¡œ ë³´ê¸°" / "PC ë²„ì „ìœ¼ë¡œ ë³´ê¸°" í† ê¸€ìš©.
 */
import { createContext, useContext, useCallback, useState, useEffect } from "react";

const STORAGE_KEY = "teacher-app-view";

export type ForceView = "mobile" | "desktop" | null;

function readStored(): ForceView {
  try {
    const v = localStorage.getItem(STORAGE_KEY);
    if (v === "mobile" || v === "desktop") return v;
  } catch {
    // ignore
  }
  return null;
}

function writeStored(v: ForceView) {
  try {
    if (v) localStorage.setItem(STORAGE_KEY, v);
    else localStorage.removeItem(STORAGE_KEY);
  } catch {
    // ignore
  }
}

type TeacherViewContextValue = {
  forceView: ForceView;
  setForceView: (v: ForceView) => void;
};

const TeacherViewContext = createContext<TeacherViewContextValue | null>(null);

export function TeacherViewProvider({ children }: { children: React.ReactNode }) {
  const [forceView, setState] = useState<ForceView>(readStored);

  useEffect(() => {
    writeStored(forceView);
  }, [forceView]);

  const setForceView = useCallback((v: ForceView) => {
    setState(v);
  }, []);

  return (
    <TeacherViewContext.Provider value={{ forceView, setForceView }}>
      {children}
    </TeacherViewContext.Provider>
  );
}

export function useTeacherView() {
  return useContext(TeacherViewContext);
}


==========================================================================================
# FILE: ui/layout/adminNavConfig.tsx
==========================================================================================
/**
 * ì„ ìƒì•±(ê´€ë¦¬ì) ì‚¬ì´ë“œë°”/ëª¨ë°”ì¼ ë“œë¡œì–´ ë„¤ë¹„ ê³µí†µ ì„¤ì •.
 * Sidebar.tsx, TeacherBottomBar, ëª¨ë°”ì¼ Drawerì—ì„œ ì‚¬ìš©.
 */
export const ADMIN_NAV_BASE = "/admin";

export function NavIcon({ d }: { d: string }) {
  return (
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
      <path
        d={d}
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
    </svg>
  );
}

export type AdminNavItem = {
  to: string;
  label: string;
  iconPath: string;
};

export type AdminNavGroup = {
  title?: string;
  items: AdminNavItem[];
};

export const ADMIN_NAV_GROUPS: AdminNavGroup[] = [
  {
    items: [
      { to: `${ADMIN_NAV_BASE}/dashboard`, label: "ëŒ€ì‹œë³´ë“œ", iconPath: "M3 11l9-7 9 7v9H3z" },
      { to: `${ADMIN_NAV_BASE}/students`, label: "í•™ìƒ", iconPath: "M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Zm-7 8a7 7 0 0 1 14 0" },
      { to: `${ADMIN_NAV_BASE}/lectures`, label: "ê°•ì˜", iconPath: "M4 4h16v12H4zM8 20h8" },
      { to: `${ADMIN_NAV_BASE}/clinic`, label: "í´ë¦¬ë‹‰", iconPath: "M12 21s7-4 7-10a7 7 0 0 0-14 0c0 6 7 10 7 10Z" },
    ],
  },
  {
    items: [
      { to: `${ADMIN_NAV_BASE}/exams`, label: "ì‹œí—˜", iconPath: "M7 3h10v18H7zM9 7h6M9 11h6M9 15h4" },
      { to: `${ADMIN_NAV_BASE}/results`, label: "ì„±ì ", iconPath: "M4 18h16M6 15V9M12 15V5M18 15v-7" },
      { to: `${ADMIN_NAV_BASE}/videos`, label: "ì˜ìƒ", iconPath: "M3 6h14v12H3zM17 10l4-2v8l-4-2z" },
      { to: `${ADMIN_NAV_BASE}/message`, label: "ë©”ì‹œì§€", iconPath: "M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" },
      { to: `${ADMIN_NAV_BASE}/storage`, label: "ì €ì¥ì†Œ", iconPath: "M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" },
    ],
  },
  {
    items: [
      { to: `${ADMIN_NAV_BASE}/community`, label: "ì»¤ë®¤ë‹ˆí‹°", iconPath: "M4 4h16v12H7l-3 3z" },
      { to: `${ADMIN_NAV_BASE}/staff`, label: "ì§ì›ê´€ë¦¬", iconPath: "M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Zm-7 8a7 7 0 0 1 14 0" },
    ],
  },
  {
    items: [
      { to: `${ADMIN_NAV_BASE}/settings`, label: "ì„¤ì •", iconPath: "M12 15.5a3.5 3.5 0 1 0 0-7M19.4 15a8 8 0 0 0 0-6l2-1-2-4-2.3.5a8 8 0 0 0-3.4-2L11 1h-4l-.7 2.5a8 8 0 0 0-3.4 2L1.6 5l-2 4 2 1a8 8 0 0 0 0 6l-2 1 2 4 2.3-.5a8 8 0 0 0 3.4 2L7 23h4l.7-2.5a8 8 0 0 0 3.4-2l2.3.5 2-4Z" },
    ],
  },
];

/** ëª¨ë°”ì¼ í•˜ë‹¨ íƒ­ì— ë…¸ì¶œí•  í•­ëª© (ê²½ë¡œ, ë¼ë²¨, ì•„ì´ì½˜ path d) */
export const ADMIN_MOBILE_TABS: { to: string; label: string; iconPath: string }[] = [
  { to: `${ADMIN_NAV_BASE}/dashboard`, label: "í™ˆ", iconPath: "M3 11l9-7 9 7v9H3z" },
  { to: `${ADMIN_NAV_BASE}/students`, label: "í•™ìƒ", iconPath: "M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Zm-7 8a7 7 0 0 1 14 0" },
  { to: `${ADMIN_NAV_BASE}/lectures`, label: "ê°•ì˜", iconPath: "M4 4h16v12H4zM8 20h8" },
  { to: `${ADMIN_NAV_BASE}/community`, label: "ì»¤ë®¤ë‹ˆí‹°", iconPath: "M4 4h16v12H7l-3 3z" },
  { to: "", label: "ë©”ë‰´", iconPath: "M4 6h16M4 12h16M4 18h16" },
];


==========================================================================================
# FILE: ui/layout/index.ts
==========================================================================================
// src/shared/ui/layout/index.ts

/**
 * ======================================================
 * Layout Exports (SSOT)
 *
 * â— Layout ì€ ë ˆì´ì•„ì›ƒë§Œ export í•œë‹¤
 * â— Design System(ds)ì€ ì ˆëŒ€ ì—¬ê¸°ì„œ export í•˜ì§€ ì•ŠëŠ”ë‹¤
 *
 * - Sidebar
 * - Header
 * - AppLayout
 * ======================================================
 */

export { default as AppLayout } from "./AppLayout";
export { default as Sidebar } from "./Sidebar";
export { default as Header } from "./Header";
export { default as DomainLayout } from "./DomainLayout";
export type { DomainTab } from "./DomainLayout";


==========================================================================================
# FILE: ui/modal/AdminModal.tsx
==========================================================================================
// PATH: src/shared/ui/modal/AdminModal.tsx
import { Modal } from "antd";
import React from "react";

import { BRAND_AND_LIGHT_THEMES, MODAL_DEFAULT_WIDTH } from "./constants";

export type AdminModalType = "action" | "confirm" | "inspect";

function getModalBackground(): string {
  const theme = document.documentElement.getAttribute("data-theme") || "";
  return BRAND_AND_LIGHT_THEMES.has(theme) ? "#ffffff" : "var(--color-modal-bg)";
}

type AdminModalProps = {
  open: boolean;
  onClose: () => void;
  type?: AdminModalType;
  width?: number;
  children: React.ReactNode;
};

export default function AdminModal({
  open,
  onClose,
  type = "action",
  width = MODAL_DEFAULT_WIDTH,
  children,
}: AdminModalProps) {
  const isConfirm = type === "confirm";
  const contentBg = getModalBackground();

  return (
    <Modal
      open={open}
      onCancel={onClose}
      footer={null}
      width={width}
      centered
      destroyOnHidden
      maskClosable={!isConfirm}
      closable={!isConfirm}
      keyboard={!isConfirm}
      styles={{
        content: {
          padding: 0,
          overflow: "hidden",
          /* border, borderRadius, boxShadow, background â†’ modal.css SSOT */
        },
        mask: {
          backdropFilter: "blur(3px)",
          backgroundColor: isConfirm ? "rgba(0,0,0,0.58)" : "rgba(0,0,0,0.42)",
        },
      }}
      className={`admin-modal admin-modal--${type}`}
    >
      <div
        className="admin-modal__inner"
        style={
          contentBg === "#ffffff"
            ? ({
                "--color-modal-bg": "#ffffff",
                "--color-bg-surface": "#ffffff",
                "--color-bg-surface-hover": "#f8fafc",
              } as React.CSSProperties)
            : undefined
        }
      >
        {children}
      </div>
    </Modal>
  );
}


==========================================================================================
# FILE: ui/modal/ModalBody.tsx
==========================================================================================
// PATH: src/shared/ui/modal/ModalBody.tsx
import React from "react";

export default function ModalBody({
  children,
}: {
  children: React.ReactNode;
}) {
  return <div className="modal-body">{children}</div>;
}


==========================================================================================
# FILE: ui/modal/ModalDateSection.tsx
==========================================================================================
// PATH: src/shared/ui/modal/ModalDateSection.tsx
// ëª¨ë‹¬ SSOT â€” ë‚ ì§œ ì„¹ì…˜: ê¸°ë³¸ê°’ ì‚¬ìš© | ì§ì ‘ì„ íƒ(ì „ì—­ DatePicker)

import { DatePicker } from "@/shared/ui/date";
import ModalOptionRow from "./ModalOptionRow";
import { ModalOptionRowWithContent } from "./ModalOptionRow";

export interface ModalDateSectionProps {
  /** ë¼ë””ì˜¤ name */
  name?: string;
  /** ê¸°ë³¸ê°’ ì‚¬ìš© ì„ íƒ ì—¬ë¶€ */
  useDefault: boolean;
  onUseDefaultChange: (use: boolean) => void;
  /** ì§ì ‘ì„ íƒ ì‹œ ê°’ */
  customDate: string;
  onCustomDateChange: (value: string) => void;
  /** ê¸°ë³¸ê°’ ì˜µì…˜ í‘œì‹œ ì—¬ë¶€ (ì˜ˆ: ë³´ê°• ì‹œ ìˆ¨ê¹€) */
  showDefaultOption: boolean;
  /** ê¸°ë³¸ê°’ ì˜µì…˜ ë¹„í™œì„±í™” (ì˜ˆ: ë³´ê°• ì‹œ) */
  disableDefaultOption?: boolean;
  /** ê¸°ë³¸ê°’ ì„¤ëª… (ì˜ˆ: "ë‹¤ìŒ ì£¼ ê°™ì€ ìš”ì¼ (2025-02-21)") */
  defaultLabel?: string;
  placeholder?: string;
  disabled?: boolean;
}

export default function ModalDateSection({
  name = "dateMode",
  useDefault,
  onUseDefaultChange,
  customDate,
  onCustomDateChange,
  showDefaultOption,
  disableDefaultOption = false,
  defaultLabel = "ë¯¸ì„¤ì •",
  placeholder = "ë‚ ì§œ ì„ íƒ",
  disabled = false,
}: ModalDateSectionProps) {
  const showCustom = !useDefault || disableDefaultOption;

  return (
    <div>
      <label className="modal-section-label">ë‚ ì§œ</label>
      <div className="flex flex-col gap-2">
        {showDefaultOption && (
          <ModalOptionRow
            name={name}
            value="default"
            checked={useDefault && !disableDefaultOption}
            onChange={() => onUseDefaultChange(true)}
            disabled={disableDefaultOption}
            primaryLabel="ê°•ì˜ ê¸°ë³¸ê°’ ì‚¬ìš©"
            secondaryLabel={defaultLabel}
          />
        )}
        <ModalOptionRowWithContent
          name={name}
          value="custom"
          checked={showCustom}
          onChange={() => onUseDefaultChange(false)}
          primaryLabel="ì§ì ‘ì„ íƒ"
          showContent={showCustom}
          content={
            <DatePicker
              value={customDate}
              onChange={onCustomDateChange}
              placeholder={placeholder}
              disabled={disabled}
            />
          }
        />
      </div>
    </div>
  );
}


==========================================================================================
# FILE: ui/modal/ModalFooter.tsx
==========================================================================================
// PATH: src/shared/ui/modal/ModalFooter.tsx
import React from "react";

export default function ModalFooter({
  left,
  right,
}: {
  left?: React.ReactNode;
  right?: React.ReactNode;
}) {
  return (
    <div className="modal-footer">
      <div>{left}</div>
      <div style={{ display: "flex", gap: 8 }}>{right}</div>
    </div>
  );
}


==========================================================================================
# FILE: ui/modal/ModalHeader.tsx
==========================================================================================
// PATH: src/shared/ui/modal/ModalHeader.tsx
import React from "react";

type ModalHeaderProps = {
  title: React.ReactNode;
  description?: React.ReactNode;
  type?: "action" | "confirm" | "inspect";
};

function Icon({ type }: { type: "action" | "confirm" | "inspect" }) {
  const common = {
    width: 16,
    height: 16,
    viewBox: "0 0 24 24",
    fill: "none" as const,
  };

  if (type === "confirm") {
    return (
      <svg {...common}>
        <path
          d="M12 9v4"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
        />
        <path
          d="M12 17h0"
          stroke="currentColor"
          strokeWidth="3"
          strokeLinecap="round"
        />
        <path
          d="M10.3 4.4 2.5 18a2 2 0 0 0 1.7 3h15.6a2 2 0 0 0 1.7-3L13.7 4.4a2 2 0 0 0-3.4 0Z"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinejoin="round"
        />
      </svg>
    );
  }

  if (type === "inspect") {
    return (
      <svg {...common}>
        <path
          d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z"
          stroke="currentColor"
          strokeWidth="2"
        />
        <path
          d="M16.5 16.5 21 21"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
        />
      </svg>
    );
  }

  return (
    <svg {...common}>
      <path
        d="M12 3v18"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        opacity="0.25"
      />
      <path
        d="M7 12h10"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
      />
      <path
        d="M12 7v10"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
      />
    </svg>
  );
}

export default function ModalHeader({
  title,
  description,
  type = "action",
}: ModalHeaderProps) {
  const isConfirm = type === "confirm";

  const accentColor =
    type === "confirm"
      ? "var(--color-error)"
      : type === "inspect"
      ? "var(--color-text-muted)"
      : "var(--color-brand-primary)";

  return (
    <div
      className={`modal-header modal-header--${type}`}
    >
      <div aria-hidden className="modal-header__accent" />

      <div style={{ display: "flex", alignItems: "flex-start", gap: 10 }}>
        <div
          aria-hidden
          style={{
            width: 28,
            height: 28,
            borderRadius: 10,
            display: "grid",
            placeItems: "center",
            border: "1px solid var(--color-border-divider)",
            background: "var(--color-modal-bg)",
            color: accentColor,
            boxShadow: "var(--elevation-1)",
            flex: "0 0 auto",
          }}
        >
          <Icon type={type} />
        </div>

        <div style={{ minWidth: 0, flex: 1 }}>
          <div
            style={{
              fontSize: 14,
              fontWeight: "var(--font-title)",
              letterSpacing: "-0.2px",
              color: "var(--color-text-primary)",
              lineHeight: 1.3,
            }}
          >
            {title}
          </div>

          {description && (
            <div
              style={{
                marginTop: 4,
                fontSize: 12,
                fontWeight: "var(--font-meta)",
                color: isConfirm ? "var(--color-text-secondary)" : "var(--color-text-muted)",
                lineHeight: 1.45,
              }}
            >
              {description}
            </div>
          )}

          {/* confirm-only: subtle warning cue */}
          {isConfirm && (
            <div
              style={{
                marginTop: 8,
                display: "inline-flex",
                alignItems: "center",
                gap: 8,
                padding: "6px 10px",
                borderRadius: 12,
                border:
                  "1px solid color-mix(in srgb, var(--color-error) 22%, var(--color-border-divider))",
                background:
                  "color-mix(in srgb, var(--color-error) 6%, var(--color-modal-bg))",
                color: "var(--color-text-secondary)",
                fontSize: 12,
                fontWeight: "var(--font-meta)",
                letterSpacing: "-0.12px",
              }}
            >
              <span
                aria-hidden
                style={{
                  width: 8,
                  height: 8,
                  borderRadius: 999,
                  background: "var(--color-error)",
                  boxShadow:
                    "0 0 0 3px color-mix(in srgb, var(--color-error) 14%, transparent)",
                }}
              />
              ë³€ê²½ ì‚¬í•­ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
            </div>
          )}
        </div>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: ui/modal/ModalOptionRow.tsx
==========================================================================================
// PATH: src/shared/ui/modal/ModalOptionRow.tsx
// ëª¨ë‹¬ SSOT â€” ë‚ ì§œ/ì‹œê°„ ë“± ì˜µì…˜ í•œ í–‰ (ë¼ë””ì˜¤ + ë ˆì´ë¸” + ì„¤ëª…/ì»¤ìŠ¤í…€ ì˜ì—­)

import type { ReactNode } from "react";

export interface ModalOptionRowProps {
  name: string;
  value: string;
  checked: boolean;
  onChange: () => void;
  disabled?: boolean;
  primaryLabel: ReactNode;
  secondaryLabel?: ReactNode;
  children?: ReactNode;
  /** children í´ë¦­ ì‹œ ë¼ë””ì˜¤ ì „íŒŒ ë§‰ìŒ */
  stopPropagationForContent?: boolean;
  className?: string;
}

export default function ModalOptionRow({
  name,
  value,
  checked,
  onChange,
  disabled = false,
  primaryLabel,
  secondaryLabel,
  children,
  stopPropagationForContent = true,
  className = "",
}: ModalOptionRowProps) {
  const baseClass = "modal-option-row flex items-center gap-3 rounded-xl border border-[var(--border-divider)] p-3 transition";
  const interactiveClass = disabled
    ? "modal-option-row--disabled cursor-not-allowed bg-[var(--color-bg-surface-soft)]"
    : "cursor-pointer hover:bg-[var(--color-bg-surface-soft)]";
  const fullClass = `${baseClass} ${interactiveClass} ${className}`.trim();

  return (
    <label className={fullClass}>
      <input
        type="radio"
        name={name}
        value={value}
        checked={checked}
        onChange={onChange}
        disabled={disabled}
        className="w-4 h-4 shrink-0"
      />
      <span className="text-[14px] font-medium text-[var(--color-text-primary)] shrink-0">
        {primaryLabel}
      </span>
      {secondaryLabel != null && (
        <span className="text-[13px] text-[var(--color-text-muted)] truncate min-w-0">
          {secondaryLabel}
        </span>
      )}
      {children}
    </label>
  );
}

/** ì§ì ‘ì„ íƒ + ì¸ë¼ì¸ ì»¨í…ì¸ (ë‹¬ë ¥/ì‹œê°„ ë“±) â€” ì»¨í…ì¸  ì˜ì—­ í´ë¦­ ì‹œ ë¼ë””ì˜¤ ì „íŒŒ ë°©ì§€ */
export interface ModalOptionRowWithContentProps extends Omit<ModalOptionRowProps, "children" | "secondaryLabel"> {
  primaryLabel: ReactNode;
  showContent: boolean;
  content: ReactNode;
  className?: string;
}

export function ModalOptionRowWithContent({
  name,
  value,
  checked,
  onChange,
  disabled,
  primaryLabel,
  showContent,
  content,
  className = "",
}: ModalOptionRowWithContentProps) {
  const baseClass = "modal-option-row flex flex-col gap-2 rounded-xl border border-[var(--border-divider)] p-3 transition hover:bg-[var(--color-bg-surface-soft)]";
  const fullClass = `${baseClass} ${className}`.trim();

  return (
    <label className={fullClass}>
      <div className="flex items-center gap-3 cursor-pointer" onClick={() => !disabled && onChange()}>
        <input
          type="radio"
          name={name}
          value={value}
          checked={checked}
          onChange={onChange}
          disabled={disabled}
          className="w-4 h-4 shrink-0"
        />
        <span className="text-[14px] font-medium text-[var(--color-text-primary)]">
          {primaryLabel}
        </span>
      </div>
      {showContent && (
        <div
          onClick={(e) => e.stopPropagation()}
          onMouseDown={(e) => e.stopPropagation()}
          role="group"
          aria-label={typeof primaryLabel === "string" ? primaryLabel : undefined}
        >
          {content}
        </div>
      )}
    </label>
  );
}


==========================================================================================
# FILE: ui/modal/ModalTimeSection.tsx
==========================================================================================
// PATH: src/shared/ui/modal/ModalTimeSection.tsx
// ëª¨ë‹¬ SSOT â€” ì‹œê°„ ì„¹ì…˜: ê¸°ë³¸ê°’ ì‚¬ìš© | ì§ì ‘ì„ íƒ(ì „ì—­ TimeRangeInput/íƒ€ì„ìŠ¤í¬ë¡¤)

import { TimeRangeInput } from "@/shared/ui/time";
import ModalOptionRow from "./ModalOptionRow";
import { ModalOptionRowWithContent } from "./ModalOptionRow";

export interface ModalTimeSectionProps {
  name?: string;
  useDefault: boolean;
  onUseDefaultChange: (use: boolean) => void;
  customTime: string;
  onCustomTimeChange: (value: string) => void;
  showDefaultOption: boolean;
  disableDefaultOption?: boolean;
  defaultLabel?: string;
  disabled?: boolean;
}

export default function ModalTimeSection({
  name = "timeMode",
  useDefault,
  onUseDefaultChange,
  customTime,
  onCustomTimeChange,
  showDefaultOption,
  disableDefaultOption = false,
  defaultLabel = "ë¯¸ì„¤ì •",
  disabled = false,
}: ModalTimeSectionProps) {
  const showCustom = !useDefault || disableDefaultOption;

  return (
    <div>
      <div className="modal-section-label">ì‹œê°„</div>
      <div className="flex flex-col gap-2">
        {showDefaultOption && (
          <ModalOptionRow
            name={name}
            value="default"
            checked={useDefault && !disableDefaultOption}
            onChange={() => onUseDefaultChange(true)}
            disabled={disableDefaultOption}
            primaryLabel="ê°•ì˜ ê¸°ë³¸ê°’ ì‚¬ìš©"
            secondaryLabel={defaultLabel}
          />
        )}
        <ModalOptionRowWithContent
          name={name}
          value="custom"
          checked={showCustom}
          onChange={() => onUseDefaultChange(false)}
          primaryLabel="ì§ì ‘ì„ íƒ"
          showContent={showCustom}
          content={
            <div role="group" aria-label="ì‹œê°„ ì„ íƒ">
              <TimeRangeInput
                value={customTime}
                onChange={onCustomTimeChange}
                disabled={disabled}
                startLabel="ì‹œì‘"
                endLabel="ì¢…ë£Œ"
                startPlaceholder="ì‹œì‘"
                endPlaceholder="ì¢…ë£Œ"
              />
            </div>
          }
        />
      </div>
    </div>
  );
}


==========================================================================================
# FILE: ui/modal/constants.ts
==========================================================================================
// PATH: src/shared/ui/modal/constants.ts
// ëª¨ë‹¬ SSOT â€” ê³µí†µ ìƒìˆ˜ (width ê¸°ë³¸ê°’, í…Œë§ˆ êµ¬ë¶„ ë“±). ëª¨ë“  Admin ëª¨ë‹¬ì€ ì—¬ê¸°ì„œ import.

/** Admin ëª¨ë‹¬ ê¸°ë³¸ ë„ˆë¹„ (px) */
export const MODAL_DEFAULT_WIDTH = 520;

/** Admin ëª¨ë‹¬ íƒ€ì…ë³„ ê¶Œì¥ ë„ˆë¹„ (í•„ìš” ì‹œ ì‚¬ìš©) */
export const MODAL_WIDTH = {
  sm: 400,
  md: 560,
  default: MODAL_DEFAULT_WIDTH,
  form: 620,
  wide: 720,
  xwide: 820,
  enroll: 920,
  board: 980,
  full: 1000,
} as const;

/** ë¼ì´íŠ¸/ë¸Œëœë“œ í…Œë§ˆì—ì„œ ëª¨ë‹¬ ë°°ê²½ í°ìƒ‰ ì²˜ë¦¬ (AdminModal ë‚´ë¶€ìš©) */
export const BRAND_AND_LIGHT_THEMES = new Set([
  "modern-white",
  "navy-pro",
  "ivory-office",
  "minimal-mono",
  "kakao-business",
  "naver-works",
  "samsung-admin",
  "purple-insight",
]);


==========================================================================================
# FILE: ui/modal/index.ts
==========================================================================================
// PATH: src/shared/ui/modal/index.ts
// =============================================================================
// ëª¨ë‹¬ SSOT (Single Source of Truth) â€” Admin ì•± ì „ì²´ ëª¨ë‹¬
// =============================================================================
// - ëª¨ë“  Admin ëª¨ë‹¬ì€ ë°˜ë“œì‹œ ì—¬ê¸°ì„œë§Œ import (AdminModal, ModalHeader, ModalBody, ModalFooter)
// - ìŠ¤íƒ€ì¼: src/styles/design-system/modal.css (design-system/index.cssì—ì„œ ë¡œë“œ)
// - í¼ ëª¨ë‹¬ ë‚´ ë‚ ì§œ/ì‹œê°„: ModalDateSection, ModalTimeSection (ì „ì—­ DatePickerÂ·TimeRangeInput ì‚¬ìš©)
// =============================================================================

export { default as AdminModal } from "./AdminModal";
export type { AdminModalType } from "./AdminModal";
export { default as ModalHeader } from "./ModalHeader";
export { default as ModalBody } from "./ModalBody";
export { default as ModalFooter } from "./ModalFooter";
export { default as ModalOptionRow } from "./ModalOptionRow";
export { ModalOptionRowWithContent } from "./ModalOptionRow";
export type { ModalOptionRowProps, ModalOptionRowWithContentProps } from "./ModalOptionRow";
export { default as ModalDateSection } from "./ModalDateSection";
export type { ModalDateSectionProps } from "./ModalDateSection";
export { default as ModalTimeSection } from "./ModalTimeSection";
export type { ModalTimeSectionProps } from "./ModalTimeSection";
export { MODAL_DEFAULT_WIDTH, MODAL_WIDTH } from "./constants";


==========================================================================================
# FILE: ui/overlays/InspectOverlayShell.tsx
==========================================================================================
import { ReactNode, useEffect } from "react";
import { createPortal } from "react-dom";
import { Panel } from "@/shared/ui/ds";

type InspectOverlayShellProps = {
  title: string;
  description?: string;
  width?: number;
  onClose: () => void;

  /** NEW */
  sidebar?: ReactNode;
  tabs?: ReactNode;
  children: ReactNode;
};

export default function InspectOverlayShell({
  title,
  description,
  width = 1080,
  onClose,
  sidebar,
  tabs,
  children,
}: InspectOverlayShellProps) {
  useEffect(() => {
    function onKeyDown(e: KeyboardEvent) {
      if (e.key === "Escape") onClose();
    }
    window.addEventListener("keydown", onKeyDown);
    return () => window.removeEventListener("keydown", onKeyDown);
  }, [onClose]);

  return createPortal(
    <div
      data-overlay="inspect"
      style={{
        position: "fixed",
        inset: 0,
        zIndex: 50,
        background: "rgba(0,0,0,0.45)",
        display: "flex",
        justifyContent: "center",
        alignItems: "flex-start",
        padding: 32,
        overflow: "auto",
      }}
      onClick={onClose}
    >
      <div
        style={{ width: "100%", maxWidth: width }}
        onClick={(e) => e.stopPropagation()}
      >
        <Panel title={title} description={description}>
          <div
            style={{
              display: "grid",
              gridTemplateColumns: sidebar ? "320px 1fr" : "1fr",
              gap: 24,
            }}
          >
            {/* ===== LEFT : META / SUMMARY ===== */}
            {sidebar && (
              <Panel variant="subtle" density="compact">
                {sidebar}
              </Panel>
            )}

            {/* ===== RIGHT : WORK ===== */}
            <div style={{ minWidth: 0 }}>
              {tabs && <div style={{ marginBottom: 12 }}>{tabs}</div>}

              <div>{children}</div>
            </div>
          </div>
        </Panel>
      </div>
    </div>,
    document.body
  );
}


==========================================================================================
# FILE: ui/overlays/index.ts
==========================================================================================
export { default as InspectOverlayShell } from "./InspectOverlayShell";


==========================================================================================
# FILE: ui/session-block/SessionBlockView.tsx
==========================================================================================
// PATH: src/shared/ui/session-block/SessionBlockView.tsx
// ì°¨ì‹œ ë¸”ë¡ SSOT â€” ë§ˆí¬ì—…Â·í´ë˜ìŠ¤ëŠ” ì´ ì»´í¬ë„ŒíŠ¸ë§Œ ì‚¬ìš©. ìŠ¤íƒ€ì¼ì€ session-block.css

import type { ReactNode } from "react";
import { Link } from "react-router-dom";

import {
  SESSION_BLOCK_CLASS,
  sessionBlockClassNames,
  type SessionBlockVariant,
} from "./session-block.constants";

export interface SessionBlockViewProps {
  /** n1(ì •ê·œì°¨ì‹œ) | supplement(ë³´ê°•) | add(ì°¨ì‹œ ì¶”ê°€) */
  variant: SessionBlockVariant;
  /** ì„¸ì…˜ë°”/ì„¸ì…˜ëª©ë¡ìš© ì‘ì€ ë¸”ë¡. ëª¨ë‹¬ì—ì„œëŠ” false */
  compact?: boolean;
  selected?: boolean;
  /** ì˜ˆ: "2ì°¨ì‹œ", "ë³´ê°•" */
  title?: ReactNode;
  /** ì˜ˆ: ë‚ ì§œ, ì„¤ëª… */
  desc?: ReactNode;
  /** ë§í¬ì¼ ë•Œ (SessionBar) */
  to?: string;
  /** ë²„íŠ¼ì¼ ë•Œ */
  onClick?: () => void;
  /** add ë¸”ë¡ì¼ ë•Œ ì•„ì´ì½˜ ë“± */
  children?: ReactNode;
  /** ëª¨ë‹¬ ì°¨ì‹œ ìœ í˜• ì„ íƒ ì‹œ ì²´í¬ í‘œì‹œ */
  showCheck?: boolean;
  ariaLabel?: string;
  ariaPressed?: boolean;
  type?: "button" | "submit";
  /** Linkìš© â€” ì™¸ë¶€ì—ì„œ key ë“± ì „ë‹¬ */
  className?: string;
}

function cx(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

export function SessionBlockView({
  variant,
  compact = false,
  selected = false,
  title,
  desc,
  to,
  onClick,
  children,
  showCheck = false,
  ariaLabel,
  ariaPressed,
  type = "button",
  className: extraClass,
}: SessionBlockViewProps) {
  const base = SESSION_BLOCK_CLASS;
  const variantClass =
    variant === "add"
      ? sessionBlockClassNames.add
      : variant === "supplement"
        ? sessionBlockClassNames.supplement
        : sessionBlockClassNames.n1;
  const classes = cx(
    base,
    variantClass,
    compact && sessionBlockClassNames.compact,
    selected && sessionBlockClassNames.selected,
    extraClass
  );

  const content = (
    <>
      {showCheck && (
        <span className="session-block__check" aria-hidden>
          âœ“
        </span>
      )}
      {variant === "add" ? (
        children ? (
          <span className="session-block__icon" aria-hidden>
            {children}
          </span>
        ) : null
      ) : (
        <>
          {title != null && <span className="session-block__title">{title}</span>}
          {desc != null && <span className="session-block__desc">{desc}</span>}
        </>
      )}
    </>
  );

  if (to != null && to !== "") {
    return (
      <Link to={to} className={classes} aria-current={selected ? "page" : undefined}>
        {content}
      </Link>
    );
  }

  return (
    <button
      type={type}
      className={classes}
      onClick={onClick}
      aria-label={ariaLabel}
      aria-pressed={ariaPressed}
    >
      {content}
    </button>
  );
}


==========================================================================================
# FILE: ui/session-block/index.ts
==========================================================================================
// PATH: src/shared/ui/session-block/index.ts
// ì°¨ì‹œ ë¸”ë¡ SSOT (Single Source of Truth)
// - ìŠ¤íƒ€ì¼: session-block.css
// - ë§ˆí¬ì—…Â·í´ë˜ìŠ¤: SessionBlockView + session-block.constants
// ëª¨ë‹¬Â·ì„¸ì…˜ë°”Â·ì„¸ì…˜ ëª©ë¡ ë“± ëª¨ë“  ì°¨ì‹œ ë¸”ë¡ì€ ì—¬ê¸°ì„œ import.

import "@/styles/design-system/components/session-block.css";

export { SessionBlockView } from "./SessionBlockView";
export type { SessionBlockViewProps } from "./SessionBlockView";
export {
  SESSION_BLOCK_CLASS,
  sessionBlockClassNames,
  isSupplement,
} from "./session-block.constants";
export type { SessionBlockVariant } from "./session-block.constants";


==========================================================================================
# FILE: ui/session-block/session-block.constants.ts
==========================================================================================
// PATH: src/shared/ui/session-block/session-block.constants.ts
// ì°¨ì‹œ ë¸”ë¡ SSOT â€” í´ë˜ìŠ¤ëª…Â·variant ìƒìˆ˜ (session-block.cssì™€ 1:1 ëŒ€ì‘)

export const SESSION_BLOCK_CLASS = "session-block";

export const sessionBlockClassNames = {
  base: SESSION_BLOCK_CLASS,
  compact: "session-block--compact",
  n1: "session-block--n1",
  supplement: "session-block--supplement",
  add: "session-block--add",
  selected: "session-block--selected",
  title: "session-block__title",
  desc: "session-block__desc",
  check: "session-block__check",
  icon: "session-block__icon",
} as const;

export type SessionBlockVariant = "n1" | "supplement" | "add";

/** ì œëª©ì— "ë³´ê°•"ì´ í¬í•¨ë˜ë©´ ë³´ê°• ì°¨ì‹œë¡œ ê°„ì£¼ (ì„¸ì…˜ ëª©ë¡/ë°”ìš©) */
export function isSupplement(title: string | null | undefined): boolean {
  return Boolean(title?.includes?.("ë³´ê°•"));
}


==========================================================================================
# FILE: ui/state/ModalState.tsx
==========================================================================================
// PATH: src/shared/ui/state/ModalState.tsx
export default function ModalState({
  message = "ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤â€¦",
}: {
  message?: string;
}) {
  return (
    <div
      style={{
        padding: "32px 24px",
        textAlign: "center",
        fontSize: 13,
        fontWeight: "var(--font-meta)",
        color: "var(--color-text-muted)",
      }}
    >
      {message}
    </div>
  );
}


==========================================================================================
# FILE: ui/state/PageState.tsx
==========================================================================================
// PATH: src/shared/ui/state/PageState.tsx
import React from "react";
import EmptyState, { EmptyStateTone } from "@/shared/ui/ds/EmptyState";

export type PageStateType = "empty" | "loading" | "error";

export default function PageState({
  type,
  title,
  description,
}: {
  type: PageStateType;
  title?: string;
  description?: string;
}) {
  const tone: EmptyStateTone =
    type === "loading" ? "loading" : type === "error" ? "error" : "empty";

  const fallbackTitle =
    type === "loading"
      ? title ?? "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦"
      : type === "error"
      ? title ?? "ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"
      : title ?? "í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤";

  const fallbackDesc =
    type === "loading"
      ? description ?? "ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”."
      : type === "error"
      ? description ?? "ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
      : description;

  // Page context: do NOT render a nested panel container.
  // Place this under hero or as page content section.
  return (
    <div
      style={{
        borderRadius: "var(--radius-xl)",
        border: "1px solid var(--color-border-divider)",
        background: "var(--color-bg-surface)",
        boxShadow: "var(--elevation-1)",
      }}
    >
      <EmptyState
        mode="embedded"
        scope="page"
        tone={tone}
        title={fallbackTitle}
        description={fallbackDesc}
      />
    </div>
  );
}


==========================================================================================
# FILE: ui/state/PanelState.tsx
==========================================================================================
// PATH: src/shared/ui/state/PanelState.tsx
import React from "react";
import EmptyState from "@/shared/ui/ds/EmptyState";

export default function PanelState({
  title,
  description,
  tone = "empty",
}: {
  title?: string;
  description?: string;
  tone?: "empty" | "error" | "loading";
}) {
  // PanelBody ë‚´ë¶€ì—ì„œ ì“°ì´ë¯€ë¡œ "panel card"ë¥¼ ì¤‘ì²©í•˜ì§€ ì•ŠëŠ”ë‹¤.
  return (
    <div style={{ padding: "var(--space-2) 0" }}>
      <EmptyState
        mode="embedded"
        scope="panel"
        tone={tone}
        title={title ?? "ë°ì´í„° ì—†ìŒ"}
        description={description}
      />
    </div>
  );
}


==========================================================================================
# FILE: ui/state/index.ts
==========================================================================================
// PATH: src/shared/ui/state/index.ts
export { default as PageState } from "./PageState";
export { default as PanelState } from "./PanelState";
export { default as ModalState } from "./ModalState";


==========================================================================================
# FILE: ui/templates/ListPage.tsx
==========================================================================================
// PATH: src/shared/ui/templates/ListPage.tsx
import React from "react";
import { Page, Panel, SectionHeader } from "@/shared/ui/ds";

export default function ListPage({
  title,
  description,
  actions,
  navigation,
  filters,
  children,
}: {
  title: React.ReactNode;
  description?: React.ReactNode;
  actions?: React.ReactNode;
  navigation?: React.ReactNode;
  filters?: React.ReactNode;
  children: React.ReactNode;
}) {
  return (
    <Page density="browse">
      {/* ===== SECTION HEADER (GLOBAL) ===== */}
      <SectionHeader
        title={title}
        description={description}
        actions={actions}
        navigation={navigation}
      />

      {/* ===== FILTER ZONE ===== */}
      {filters && (
        <div
          style={{
            marginTop: 20,
            borderRadius: "var(--radius-xl)",
            border: "1px solid var(--color-border-divider)",
            background: "var(--color-bg-surface)",
            boxShadow: "var(--elevation-1)",
            overflow: "hidden",
          }}
        >
          <div
            style={{
              padding: "14px 16px",
              background: "var(--bg-surface)",
              borderBottom: "1px solid var(--color-border-divider)",
              display: "flex",
              alignItems: "center",
              justifyContent: "space-between",
            }}
          >
            <div
              style={{
                fontSize: 12,
                fontWeight: "var(--font-title)",
                letterSpacing: "-0.12px",
                color: "var(--color-text-secondary)",
              }}
            >
              í•„í„°
            </div>
          </div>

          <div style={{ padding: 16 }}>{filters}</div>
        </div>
      )}

      {/* ===== WORK CUT (ì¤‘ìš”) ===== */}
      <div
        aria-hidden
        style={{
          margin: "28px 0 18px",
          height: 1,
          background:
            "linear-gradient(90deg, transparent, var(--color-border-divider), transparent)",
        }}
      />

      {/* ===== WORK PANEL ===== */}
      <Panel variant="default" density="default">
        {children}
      </Panel>
    </Page>
  );
}


==========================================================================================
# FILE: ui/templates/index.ts
==========================================================================================
// PATH: src/shared/ui/templates/index.ts
export { default as ListPage } from "./ListPage";


==========================================================================================
# FILE: ui/time/TimeRangeInput.tsx
==========================================================================================
// PATH: src/shared/ui/time/TimeRangeInput.tsx
// ì „ì—­ SSOT: ì‹œì‘/ì¢…ë£Œ ì‹œê°„ â€” 12ì‹œê°„ì œ(ì˜¤ì „/ì˜¤í›„) ì›ìŠ¤í¬ë¡¤ ìˆœí™˜, ì‹œê°„ ì˜ì—­ í´ë¦­ ì‹œ í”¼ì»¤, [+âˆ’30ë¶„Â·1ì‹œê°„].
// ëª¨ë‹¬ SSOT: startLabel "ì‹œì‘" / endLabel "ì¢…ë£Œ" ì‹œ íŠ¸ë¦¬ê±° ë¹ˆê°’ ë¬¸êµ¬ëŠ” "ì‹œì‘ ì‹œê°„" / "ì¢…ë£Œ ì‹œê°„" ë‹¨ì¼ì§„ì‹¤.

import { useRef, useState } from "react";
import { Clock, ChevronDown } from "lucide-react";
import dayjs from "dayjs";
import { TimeScrollPopover, format24To12Display } from "./TimeScrollPopover";
import "@/styles/design-system/components/TimeRangeInput.css";

export interface TimeRangeInputProps {
  /** "HH:mm~HH:mm" í˜•ì‹ */
  value: string;
  onChange: (value: string) => void;
  disabled?: boolean;
  startPlaceholder?: string;
  endPlaceholder?: string;
  /** ë ˆì´ë¸” ì§§ê²Œ ì“¸ ë•Œ (ëª¨ë‹¬ ë“±): "ì‹œì‘" "ì¢…ë£Œ" â†’ ì¤„ë°”ê¿ˆ ë°©ì§€ */
  startLabel?: string;
  endLabel?: string;
}

function parseRange(value: string): { start: string; end: string } {
  const s = (value || "").trim();
  const idx = s.indexOf("~");
  if (idx >= 0) {
    const start = s.slice(0, idx).trim();
    const end = s.slice(idx + 1).trim();
    return { start: toHHmm(start) || "", end: toHHmm(end) || "" };
  }
  if (s) {
    const t = toHHmm(s);
    return { start: t || "", end: "" };
  }
  return { start: "", end: "" };
}

function toHHmm(s: string): string {
  if (!s?.trim()) return "";
  const m = s.trim().match(/^(\d{1,2}):(\d{2})$/);
  if (!m) return "";
  const h = Math.max(0, Math.min(23, parseInt(m[1], 10)));
  const min = Math.max(0, Math.min(59, parseInt(m[2], 10)));
  return `${String(h).padStart(2, "0")}:${String(min).padStart(2, "0")}`;
}

function formatRange(start: string, end: string): string {
  if (!start) return "";
  if (!end) return start;
  return `${start}~${end}`;
}

function addMinutes(timeStr: string, minutes: number): string {
  if (!timeStr) return "";
  const [h, m] = timeStr.split(":").map((x) => parseInt(x, 10));
  const d = dayjs().hour(h).minute(m).add(minutes, "minute");
  return d.format("HH:mm");
}

/** endì—ì„œ ë¶„ì„ ë¹¼ë˜, startë³´ë‹¤ ì‘ì•„ì§€ì§€ ì•Šë„ë¡ í•¨ */
function clampEndAboveStart(endStr: string, startStr: string, deltaMinutes: number): string {
  if (!endStr) return "";
  const next = addMinutes(endStr, -deltaMinutes);
  if (!startStr) return next;
  const startM = dayjs().hour(parseInt(startStr.slice(0, 2), 10)).minute(parseInt(startStr.slice(3), 10));
  const nextM = dayjs().hour(parseInt(next.slice(0, 2), 10)).minute(parseInt(next.slice(3), 10));
  if (nextM.isBefore(startM) || nextM.isSame(startM)) return startStr;
  return next;
}

const SLOT_MINUTES = 30; // 30ë¶„ ë‹¨ìœ„ ìˆœí™˜ ì„ íƒ
const SLOTS = (() => {
  const out: string[] = [];
  for (let h = 0; h < 24; h++) {
    for (let m = 0; m < 60; m += SLOT_MINUTES) {
      out.push(`${String(h).padStart(2, "0")}:${String(m).padStart(2, "0")}`);
    }
  }
  return out;
})();

export default function TimeRangeInput({
  value,
  onChange,
  disabled = false,
  startPlaceholder = "00:00",
  endPlaceholder = "00:00",
  startLabel = "ì‹œì‘ì‹œê°„",
  endLabel = "ì¢…ë£Œì‹œê°„",
}: TimeRangeInputProps) {
  const startAnchorRef = useRef<HTMLDivElement>(null);
  const endAnchorRef = useRef<HTMLDivElement>(null);
  const [openStart, setOpenStart] = useState(false);
  const [openEnd, setOpenEnd] = useState(false);
  const { start, end } = parseRange(value);

  /** ëª¨ë‹¬ SSOT: ë ˆì´ë¸” "ì‹œì‘"/"ì¢…ë£Œ"ì¼ ë•Œ íŠ¸ë¦¬ê±° ë¹ˆê°’ ë¬¸êµ¬ "ì‹œì‘ ì‹œê°„"/"ì¢…ë£Œ ì‹œê°„" */
  const startTriggerPlaceholder =
    startLabel === "ì‹œì‘" ? "ì‹œì‘ ì‹œê°„" : startPlaceholder === "00:00" ? "ì˜¤ì „ 12:00" : startPlaceholder;
  const endTriggerPlaceholder =
    endLabel === "ì¢…ë£Œ" ? "ì¢…ë£Œ ì‹œê°„" : endPlaceholder === "00:00" ? "ì˜¤ì „ 12:00" : endPlaceholder;

  const setStart = (v: string) => onChange(formatRange(toHHmm(v) || v, end));
  const setEnd = (v: string) => onChange(formatRange(start, toHHmm(v) || v));

  const addToEnd = (deltaMinutes: number) => {
    const base = end || start || "09:00";
    const effectiveStart = start || base;
    const nextEnd = addMinutes(base, deltaMinutes);
    onChange(formatRange(effectiveStart, nextEnd));
  };

  const subtractFromEnd = (deltaMinutes: number) => {
    const effectiveEnd = end || start || "09:30";
    const effectiveStart = start || "09:00";
    const nextEnd = clampEndAboveStart(effectiveEnd, effectiveStart, deltaMinutes);
    onChange(formatRange(effectiveStart, nextEnd));
  };

  return (
    <div className="shared-time-range">
      <div className="shared-time-range-card">
        <div className="shared-time-range-grid">
          <label className="shared-time-range-label">{startLabel}</label>
          <div className="shared-time-range-input-wrap">
            <div
              ref={startAnchorRef}
              role="button"
              tabIndex={disabled ? -1 : 0}
              className={`shared-time-range-trigger ${!start ? "shared-time-range-trigger--placeholder" : ""}`}
              onClick={() => {
                if (disabled) return;
                setOpenEnd(false);
                setOpenStart((prev) => !prev);
              }}
              onKeyDown={(e) => {
                if (e.key === "Enter" && !disabled) {
                  setOpenEnd(false);
                  setOpenStart((prev) => !prev);
                }
              }}
              aria-label="ì‹œì‘ ì‹œê°„ ì„ íƒ"
            >
              <Clock className="shared-time-range-trigger-clock" size={20} aria-hidden />
              <span className="shared-time-range-trigger-text">
                {start ? format24To12Display(start) : startTriggerPlaceholder}
              </span>
              <ChevronDown className="shared-time-range-trigger-icon" size={18} aria-hidden />
            </div>
            {openStart && startAnchorRef.current && (
              <TimeScrollPopover
                value={start || "00:00"}
                slots={SLOTS}
                slotMinutes={SLOT_MINUTES}
                anchorEl={startAnchorRef.current}
                onSelect={(v) => setStart(v)}
                onClose={() => setOpenStart(false)}
              />
            )}
          </div>
          <div className="shared-time-range-quick">
            <button
              type="button"
              className="shared-time-range-btn"
              onClick={(e) => {
                e.stopPropagation();
                e.preventDefault();
                addToEnd(30);
              }}
              disabled={disabled}
            >
              +30ë¶„
            </button>
            <button
              type="button"
              className="shared-time-range-btn"
              onClick={(e) => {
                e.stopPropagation();
                e.preventDefault();
                addToEnd(60);
              }}
              disabled={disabled}
            >
              +1ì‹œê°„
            </button>
          </div>

          <label className="shared-time-range-label">{endLabel}</label>
          <div className="shared-time-range-input-wrap">
            <div
              ref={endAnchorRef}
              role="button"
              tabIndex={disabled ? -1 : 0}
              className={`shared-time-range-trigger ${!end ? "shared-time-range-trigger--placeholder" : ""}`}
              onClick={() => {
                if (disabled) return;
                setOpenStart(false);
                setOpenEnd((prev) => !prev);
              }}
              onKeyDown={(e) => {
                if (e.key === "Enter" && !disabled) {
                  setOpenStart(false);
                  setOpenEnd((prev) => !prev);
                }
              }}
              aria-label="ì¢…ë£Œ ì‹œê°„ ì„ íƒ"
            >
              <Clock className="shared-time-range-trigger-clock" size={20} aria-hidden />
              <span className="shared-time-range-trigger-text">
                {end ? format24To12Display(end) : endTriggerPlaceholder}
              </span>
              <ChevronDown className="shared-time-range-trigger-icon" size={18} aria-hidden />
            </div>
            {openEnd && endAnchorRef.current && (
              <TimeScrollPopover
                value={end || "00:00"}
                slots={SLOTS}
                slotMinutes={SLOT_MINUTES}
                anchorEl={endAnchorRef.current}
                onSelect={(v) => setEnd(v)}
                onClose={() => setOpenEnd(false)}
              />
            )}
          </div>
          <div className="shared-time-range-quick">
            <button
              type="button"
              className="shared-time-range-btn"
              onClick={(e) => {
                e.stopPropagation();
                e.preventDefault();
                subtractFromEnd(30);
              }}
              disabled={disabled}
            >
              âˆ’30ë¶„
            </button>
            <button
              type="button"
              className="shared-time-range-btn"
              onClick={(e) => {
                e.stopPropagation();
                e.preventDefault();
                subtractFromEnd(60);
              }}
              disabled={disabled}
            >
              âˆ’1ì‹œê°„
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: ui/time/TimeScrollPopover.tsx
==========================================================================================
// PATH: src/shared/ui/time/TimeScrollPopover.tsx
// [ ì˜¤ì „ | 24hë¡¤ëŸ¬ ] â€” ìš°ì¸¡ 24h 48ìŠ¬ë¡¯ ë¡¤ë§, ì¢Œì¸¡ ì˜¤ì „/ì˜¤í›„ ì‹œê°+í´ë¦­(ê°™ì€ ì‹œê° AMâ†”PM Â±12h).

import { useCallback, useEffect, useLayoutEffect, useRef, useState } from "react";
import "@/styles/design-system/components/TimeScrollPopover.css";

const ROW_HEIGHT = 48;
const VISIBLE_ROWS = 5;
const VISIBLE_HEIGHT = ROW_HEIGHT * VISIBLE_ROWS;

/** 24h 30ë¶„ ë‹¨ìœ„ 48ìŠ¬ë¡¯ (00:00~23:30) */
const ALL_SLOTS = (() => {
  const out: string[] = [];
  for (let h = 0; h < 24; h++) {
    for (let m = 0; m < 60; m += 30) {
      out.push(`${String(h).padStart(2, "0")}:${String(m).padStart(2, "0")}`);
    }
  }
  return out;
})();

/** 24h "HH:mm" â†’ "ì˜¤ì „ 9:30" / "ì˜¤í›„ 2:00" (ì˜¤í›„ = +12h í‘œí˜„) */
export function format24To12Display(hhmm: string): string {
  if (!hhmm) return "ì˜¤ì „ 12:00";
  const [hStr, mStr] = hhmm.split(":");
  const h = parseInt(hStr ?? "0", 10);
  const m = parseInt(mStr ?? "0", 10);
  const period = h < 12 ? "ì˜¤ì „" : "ì˜¤í›„";
  const h12 = h === 0 ? 12 : h > 12 ? h - 12 : h;
  return `${period} ${h12}:${String(m).padStart(2, "0")}`;
}

/** 24h "HH:mm" â†’ ì‹œ:ë¶„ë§Œ "12:00", "1:30" (ì¢Œì¸¡ ì˜¤ì „/ì˜¤í›„ì™€ ì¤‘ë³µ ë°©ì§€ìš©) */
function format24To12TimeOnly(hhmm: string): string {
  if (!hhmm) return "12:00";
  const [hStr, mStr] = hhmm.split(":");
  const h = parseInt(hStr ?? "0", 10);
  const m = parseInt(mStr ?? "0", 10);
  const h12 = h === 0 ? 12 : h > 12 ? h - 12 : h;
  return `${h12}:${String(m).padStart(2, "0")}`;
}

function slotIndex(hhmm: string): number {
  const [hStr, mStr] = (hhmm || "00:00").split(":");
  const h = parseInt(hStr ?? "0", 10);
  const m = parseInt(mStr ?? "0", 10);
  const idx = h * 2 + Math.round(m / 30);
  return Math.max(0, Math.min(47, idx));
}

function slotTo24h(idx: number): string {
  const i = ((idx % 48) + 48) % 48;
  const h = Math.floor(i / 2);
  const m = (i % 2) * 30;
  return `${String(h).padStart(2, "0")}:${String(m).padStart(2, "0")}`;
}

/** idx 0-23 = ì˜¤ì „, 24-47 = ì˜¤í›„ */
function isAfternoon(idx: number): boolean {
  return idx >= 24;
}

/** ì˜¤ì „â†”ì˜¤í›„ í† ê¸€: ê°™ì€ 12h ì‹œê°, Â±12h */
function flipPeriod(idx: number): number {
  if (idx < 24) return idx + 24; // ì˜¤ì „ â†’ ì˜¤í›„
  return idx - 24; // ì˜¤í›„ â†’ ì˜¤ì „
}

export interface TimeScrollPopoverProps {
  value: string;
  slots: string[];
  slotMinutes: number;
  anchorEl: HTMLElement;
  onSelect: (value: string) => void;
  onClose: () => void;
}

export function TimeScrollPopover({
  value,
  slots: _slots,
  slotMinutes: _slotMinutes,
  anchorEl,
  onSelect,
  onClose,
}: TimeScrollPopoverProps) {
  const popoverRef = useRef<HTMLDivElement>(null);
  const listRef = useRef<HTMLDivElement>(null);
  const isMountedRef = useRef(false);
  const isJumpingRef = useRef(false);
  const lastIdxRef = useRef(slotIndex(value));
  const scrollEndTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);
  const isUserScrollingRef = useRef(false);
  const wheelAccumRef = useRef(0);
  const lastWheelTimeRef = useRef(0);

  const initialIdx = slotIndex(value);
  const [selectedIdx, setSelectedIdx] = useState(initialIdx);

  const onSelectRef = useRef(onSelect);
  onSelectRef.current = onSelect;
  const onCloseRef = useRef(onClose);
  onCloseRef.current = onClose;

  const emit = useCallback((idx: number) => {
    onSelectRef.current(slotTo24h(idx));
  }, []);

  const scrollToIdx = useCallback((idx: number, options?: { smooth?: boolean }) => {
    const el = listRef.current;
    if (!el) return;
    isUserScrollingRef.current = false;
    if (scrollEndTimeoutRef.current) {
      clearTimeout(scrollEndTimeoutRef.current);
      scrollEndTimeoutRef.current = null;
    }
    lastIdxRef.current = idx;
    const blockHeight = ALL_SLOTS.length * ROW_HEIGHT;
    const top = blockHeight + idx * ROW_HEIGHT - VISIBLE_HEIGHT / 2 + ROW_HEIGHT / 2;
    const clampedTop = Math.max(0, Math.min(top, el.scrollHeight - VISIBLE_HEIGHT));
    setSelectedIdx(idx);
    emit(idx);
    if (options?.smooth) {
      el.scrollTo({ top: clampedTop, behavior: "smooth" });
    } else {
      el.scrollTop = clampedTop;
    }
  }, [emit]);

  // ì™¸ë¶€ value ë³€ê²½ ì‹œ ë™ê¸°í™” (ìŠ¤í¬ë¡¤ ì¤‘ì—ëŠ” ë®ì–´ì“°ì§€ ì•ŠìŒ)
  useEffect(() => {
    if (isUserScrollingRef.current) return;
    const idx = slotIndex(value);
    lastIdxRef.current = idx;
    setSelectedIdx(idx);
  }, [value]);

  useEffect(() => {
    isMountedRef.current = true;
    return () => {
      isMountedRef.current = false;
      if (scrollEndTimeoutRef.current) {
        clearTimeout(scrollEndTimeoutRef.current);
        scrollEndTimeoutRef.current = null;
      }
    };
  }, []);

  // ì´ˆê¸° ìŠ¤í¬ë¡¤ (ë§ˆìš´íŠ¸ ì‹œ 1íšŒ)
  useLayoutEffect(() => {
    const el = listRef.current;
    if (!el) return;
    const blockHeight = ALL_SLOTS.length * ROW_HEIGHT;
    el.scrollTop =
      blockHeight + initialIdx * ROW_HEIGHT - VISIBLE_HEIGHT / 2 + ROW_HEIGHT / 2;
  }, [initialIdx]);

  // ìŠ¤í¬ë¡¤ â†’ ì¸ë±ìŠ¤ ë°˜ì˜ + ë¬´í•œ ìˆœí™˜ + ìŠ¤í¬ë¡¤ ì¢…ë£Œ ì‹œì—ë§Œ emit
  useEffect(() => {
    const el = listRef.current;
    if (!el) return;
    const blockLen = ALL_SLOTS.length;
    const blockHeight = blockLen * ROW_HEIGHT;
    const EMIT_DELAY_MS = 120;

    const handleScroll = () => {
      isUserScrollingRef.current = true;
      if (scrollEndTimeoutRef.current) {
        clearTimeout(scrollEndTimeoutRef.current);
      }
      if (isJumpingRef.current) {
        isJumpingRef.current = false;
      }
      let st = el.scrollTop;
      if (st < blockHeight * 0.5) {
        isJumpingRef.current = true;
        el.scrollTop = st + blockHeight;
        st = el.scrollTop;
      } else if (st > blockHeight * 2 - blockHeight * 0.5) {
        isJumpingRef.current = true;
        el.scrollTop = st - blockHeight;
        st = el.scrollTop;
      }
      const centerY = st + VISIBLE_HEIGHT / 2;
      const row = Math.floor((centerY - ROW_HEIGHT / 2) / ROW_HEIGHT);
      const idx = ((row % blockLen) + blockLen) % blockLen;
      if (idx !== lastIdxRef.current) {
        lastIdxRef.current = idx;
        setSelectedIdx(idx);
      }
      scrollEndTimeoutRef.current = setTimeout(() => {
        scrollEndTimeoutRef.current = null;
        isUserScrollingRef.current = false;
        if (isMountedRef.current) {
          emit(lastIdxRef.current);
        }
      }, EMIT_DELAY_MS);
    };

    const handleWheel = (e: WheelEvent) => {
      e.preventDefault();
      const now = performance.now();
      const timeSinceLast = now - lastWheelTimeRef.current;
      lastWheelTimeRef.current = now;
      wheelAccumRef.current += e.deltaY;
      const isBurst = timeSinceLast < 100;
      const threshold = isBurst ? 25 : 100;
      const steps: number[] = [];
      while (Math.abs(wheelAccumRef.current) >= threshold) {
        const step = wheelAccumRef.current > 0 ? 1 : -1;
        wheelAccumRef.current -= step * threshold;
        steps.push(step);
      }
      if (steps.length === 0 && Math.abs(wheelAccumRef.current) < 12) return;
      if (steps.length === 0) {
        const step = wheelAccumRef.current > 0 ? 1 : -1;
        wheelAccumRef.current = 0;
        steps.push(step);
      }
      const totalDelta = steps.reduce((a, b) => a + b, 0) * ROW_HEIGHT;
      const nextTop = Math.max(
        0,
        Math.min(el.scrollTop + totalDelta, el.scrollHeight - VISIBLE_HEIGHT)
      );
      el.scrollTo({ top: nextTop, behavior: "smooth" });
    };

    el.addEventListener("scroll", handleScroll, { passive: true });
    el.addEventListener("wheel", handleWheel, { passive: false });
    return () => {
      el.removeEventListener("wheel", handleWheel);
      el.removeEventListener("scroll", handleScroll);
      if (scrollEndTimeoutRef.current) {
        clearTimeout(scrollEndTimeoutRef.current);
        scrollEndTimeoutRef.current = null;
      }
    };
  }, [emit]);

  useEffect(() => {
    const handler = (e: MouseEvent) => {
      const t = e.target as Node;
      if (anchorEl.contains(t) || popoverRef.current?.contains(t)) return;
      onClose();
    };
    document.addEventListener("mousedown", handler);
    return () => document.removeEventListener("mousedown", handler);
  }, [anchorEl, onClose]);

  const handlePeriodClick = useCallback(
    (wantAfternoon: boolean) => {
      const currentlyAfternoon = isAfternoon(selectedIdx);
      if (currentlyAfternoon === wantAfternoon) return;
      const newIdx = flipPeriod(selectedIdx);
      scrollToIdx(newIdx, { smooth: true });
    },
    [selectedIdx, scrollToIdx]
  );

  const rect = anchorEl.getBoundingClientRect();
  const isPM = isAfternoon(selectedIdx);

  return (
    <div
      ref={popoverRef}
      className="time-picker"
      style={{
        position: "fixed",
        left: rect.left,
        bottom: window.innerHeight - rect.top + 8,
        width: Math.max(rect.width, 260),
        zIndex: 1100,
      }}
      role="listbox"
      aria-label="ì‹œê°„ ì„ íƒ"
    >
      <div className="time-picker__body">
        {/* ì¢Œì¸¡: ì˜¤ì „/ì˜¤í›„ ì‹œê° + í´ë¦­(ê°™ì€ ì‹œê° AMâ†”PM) */}
        <div className="time-picker__period">
          <button
            type="button"
            className={`time-picker__period-btn ${!isPM ? "time-picker__period-btn--active" : ""}`}
            onClick={() => handlePeriodClick(false)}
          >
            ì˜¤ì „
          </button>
          <button
            type="button"
            className={`time-picker__period-btn ${isPM ? "time-picker__period-btn--active" : ""}`}
            onClick={() => handlePeriodClick(true)}
          >
            ì˜¤í›„
          </button>
        </div>

        <div className="time-picker__divider" aria-hidden />

        {/* ìš°ì¸¡: 24h ë¡¤ëŸ¬ (ì‹œ:ë¶„ë§Œ í‘œì‹œ) */}
        <div className="time-picker__roller">
          <div className="time-picker__highlight" aria-hidden />
          <div
            ref={listRef}
            className="time-picker__list"
            style={{ height: VISIBLE_HEIGHT }}
          >
            {[0, 1, 2].map((block) =>
              ALL_SLOTS.map((slot, i) => (
                <button
                  key={`${block}-${slot}`}
                  type="button"
                  className="time-picker__item"
                  style={{ height: ROW_HEIGHT }}
                  onClick={() => {
                    scrollToIdx(i, { smooth: true });
                    onCloseRef.current();
                  }}
                >
                  {format24To12TimeOnly(slot)}
                </button>
              ))
            )}
          </div>
        </div>
      </div>
    </div>
  );
}


==========================================================================================
# FILE: ui/time/index.ts
==========================================================================================
export { default as TimeRangeInput } from "./TimeRangeInput";
export type { TimeRangeInputProps } from "./TimeRangeInput";


==========================================================================================
# FILE: utils/formatPhone.ts
==========================================================================================
/**
 * ì „í™”ë²ˆí˜¸ í‘œì‹œìš© í¬ë§· â€” 010-XXXX-XXXX í˜•ì‹
 */
export function formatPhone(v?: string | null): string {
  if (v == null || String(v).trim() === "") return "-";
  const d = String(v).replace(/\D/g, "");
  if (d.length === 11) return `${d.slice(0, 3)}-${d.slice(3, 7)}-${d.slice(7)}`;
  if (d.length === 10 && d.startsWith("02")) return `${d.slice(0, 2)}-${d.slice(2, 6)}-${d.slice(6)}`;
  if (d.length === 10) return `${d.slice(0, 3)}-${d.slice(3, 6)}-${d.slice(6)}`;
  if (d.length >= 6) return d; // 8ìë¦¬ ì‹ë³„ì ë“±ì€ ê·¸ëŒ€ë¡œ
  return v;
}

/**
 * OMR ì‹œí—˜ ì‹ë³„ì½”ë“œ í‘œì‹œ â€” 8ìë¦¬ë¥¼ XXXX-XXXX í˜•ì‹ìœ¼ë¡œ
 * í•™ìƒë²ˆí˜¸ ë’¤ 8ìë¦¬ or ë¶€ëª¨ë²ˆí˜¸ ë’¤ 8ìë¦¬ (í•™ìƒë²ˆí˜¸ ì—†ëŠ” ê²½ìš° ë¶€ëª¨ë²ˆí˜¸ 8ìë¦¬ë§Œ)
 */
export function formatOmrCode(omrCode?: string | null): string {
  if (omrCode == null || String(omrCode).trim() === "") return "â€”";
  const d = String(omrCode).replace(/\D/g, "").slice(0, 8);
  if (d.length >= 4) return `${d.slice(0, 4)}-${d.slice(4)}`;
  return d || "â€”";
}

/**
 * í•™ìƒ ì „í™” í‘œì‹œ â€” í•™ìƒ ì „í™”ë²ˆí˜¸ ì—†ìœ¼ë©´ "-", ìˆìœ¼ë©´ "010-XXXX-XXXX"
 */
export function formatStudentPhoneDisplay(phone?: string | null): string {
  if (phone == null || String(phone).trim() === "") return "-";
  return formatPhone(phone);
}


==========================================================================================
# FILE: utils/phoneInput.ts
==========================================================================================
/**
 * ì „í™”ë²ˆí˜¸/ì‹ë³„ì ì…ë ¥ìš© â€” í‘œì‹œ í¬ë§· + raw ê°’ ë¶„ë¦¬
 */

/** 11ìë¦¬ ì „í™”ë²ˆí˜¸ â†’ 010-XXXX-XXXX í‘œì‹œ */
export function formatPhoneForInput(raw: string): string {
  const d = String(raw).replace(/\D/g, "").slice(0, 11);
  if (d.length <= 3) return d;
  if (d.length <= 7) return `${d.slice(0, 3)}-${d.slice(3)}`;
  return `${d.slice(0, 3)}-${d.slice(3, 7)}-${d.slice(7)}`;
}

/** ì…ë ¥ê°’ì—ì„œ 11ìë¦¬ raw ì¶”ì¶œ */
export function parsePhoneInput(v: string): string {
  return v.replace(/\D/g, "").slice(0, 11);
}

/** 8ìë¦¬ ì‹ë³„ì â†’ XXXX-XXXX í‘œì‹œ */
export function formatIdentifierForInput(raw: string): string {
  const d = String(raw).replace(/\D/g, "").slice(0, 8);
  if (d.length <= 4) return d;
  return `${d.slice(0, 4)}-${d.slice(4)}`;
}

/** ì…ë ¥ê°’ì—ì„œ 8ìë¦¬ raw ì¶”ì¶œ */
export function parseIdentifierInput(v: string): string {
  return v.replace(/\D/g, "").slice(0, 8);
}
